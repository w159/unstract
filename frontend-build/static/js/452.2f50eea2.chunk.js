(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[452],{99919:(e,t,o)=>{"use strict";o.r(t),o.d(t,{App:()=>pc});var n=o(64303),l=o(93296),i=o(2556),s=o(67049),a=o(11087),d=o(33050),r=o(84222),c=o(57689),u=o(38935),p=o(72791),v=o(80184);function m(){const[e]=(0,a.lr)(),[t,o]=(0,p.useState)({}),[n,l]=(0,p.useState)(null);return(0,p.useEffect)((()=>{const t={IDM:{title:"Sorry, but this invitation is not meant for you.",subtitle:"Please make sure to use the same email address that you were invited with. If that doesn't work, contact the organization owner to send you another invite."},INF:{title:"This invitation is either invalid or has expired.",subtitle:"Please contact the organization owner to send you another invite."},UMM:{title:"Sorry, but you seem to be a member of multiple organizations.",subtitle:"This is not allowed normally. Please contact support."},USF:{title:"We're unable to create your account since an account for your organization ".concat(e.get("domain")," already exists."),subtitle:"You'll need to contact the admin of your organization's account to get access or you'll need to use a different email address to sign up."},USR:{title:"Sign-up not allowed.",subtitle:"You'll need to contact the admin of your organization's account to get access."},INE001:{title:"Email not allowed",subtitle:"Disposable emails not allowed."},INE002:{title:"Invalid Email format",subtitle:"Please give a valid email address"},INS:{title:"Access Denied",subtitle:"Please contact your administrator to request access."}},n=e.get("code");l(n),o(t)}),[]),(0,v.jsx)(u.ZP,{status:"403",title:n&&t[n]?t[n].title:"Hm, you shouldn't see this normally.",subTitle:n&&t[n]?t[n].subtitle:"Please try to login again for accessing your data."})}function h(){const e=(0,c.s0)();return(0,v.jsx)(u.ZP,{status:"404",title:"Page Not Found",subTitle:"Sorry, the page you visited does not exist.",extra:(0,v.jsx)(i.ZP,{type:"primary",onClick:()=>e(-1),children:"Go Back"})})}var x=o(31243),f=o(88329);function g(e){return e&&!1!==(null===e||void 0===e?void 0:e.isLoggedIn)?{id:null===e||void 0===e?void 0:e.id,email:null===e||void 0===e?void 0:e.email,name:null===e||void 0===e?void 0:e.name,display_name:null===e||void 0===e?void 0:e.display_name,family_name:null===e||void 0===e?void 0:e.family_name,picture:null===e||void 0===e?void 0:e.picture,orgId:null===e||void 0===e?void 0:e.orgId,orgName:null===e||void 0===e?void 0:e.orgName,csrfToken:null===e||void 0===e?void 0:e.csrfToken,zCode:null===e||void 0===e?void 0:e.zCode,isLoggedIn:!0,isAdmin:e.isAdmin,adapters:null===e||void 0===e?void 0:e.adapters,logEventsId:null===e||void 0===e?void 0:e.logEventsId,allOrganization:null===e||void 0===e?void 0:e.allOrganization,isPlatformAdmin:null===e||void 0===e?void 0:e.isPlatformAdmin,loginOnboardingMessage:null===e||void 0===e?void 0:e.loginOnboardingMessage,promptOnboardingMessage:null===e||void 0===e?void 0:e.promptOnboardingMessage,flags:null===e||void 0===e?void 0:e.flags,role:null===e||void 0===e?void 0:e.role,provider:null===e||void 0===e?void 0:e.provider}:{isLoggedIn:!1}}var j=o(52007),y=o.n(j);const _=()=>{const e=(0,c.s0)();return function(t){var o,n;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Something went wrong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Failed",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!t)return{type:"error",content:l,title:s,duration:a};if("ERR_NETWORK"===t.code&&!navigator.onLine)return{type:"error",content:"Please check your internet connection.",title:s,duration:a};if("ERR_CANCELED"===t.code)return{type:"error",content:"Request has been canceled.",title:s,duration:a};if(null===t||void 0===t||null===(o=t.response)||void 0===o||!o.data)return{title:s,type:"error",content:l,duration:a};{const{type:o,errors:c}=t.response.data;switch(o){case"validation_error":var d,r;if(!i)return{title:s,type:"error",content:null!==c&&void 0!==c&&null!==(d=c[0])&&void 0!==d&&d.detail?c[0].detail:l,duration:a};i(null===t||void 0===t||null===(r=t.response)||void 0===r?void 0:r.data);break;case"subscription_error":return e("/subscription-expired"),{title:s,type:"error",content:c,duration:a};case"client_error":case"server_error":return{title:s,type:"error",content:null!==c&&void 0!==c&&null!==(n=c[0])&&void 0!==n&&n.detail?c[0].detail:l,duration:a};default:return{title:s,type:"error",content:l,duration:a}}}}};_.propTypes={err:y().object,errMessage:y().string};var S=o(65847);const b={sessionDetails:{}},N=(0,S.Ue)(((e,t)=>({...b,setSessionDetails:t=>{e((()=>({sessionDetails:t})))},updateSessionDetails:o=>{e((()=>({sessionDetails:{...t().sessionDetails,...o}})))}})));var w=o(763);const k={alertDetails:{type:"",content:"",title:"",duration:6,key:null}},T=(0,S.Ue)((e=>({...k,setAlertDetails:t=>{if(!t)return k;const o="error"===(null===t||void 0===t?void 0:t.type),n={...t,title:t.title||(o?"Failed":"Success"),duration:(0,r._r)(t.duration)?t.duration:6,key:"open".concat(Date.now(),"-").concat((0,w.uniqueId)())};e({alertDetails:n})}}))),E=()=>{const e=(0,c.s0)(),t=_(),{setAlertDetails:o}=T();return async()=>{try{const e=(new Date).getTime(),t={method:"GET",url:"/api/v1/session?q=".concat(e)};return(await(0,x.Z)(t)).data}catch(a){var n,l,i,s;if("Unauthorized"===(null===a||void 0===a||null===(n=a.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.message))return;if("subscription_error"===(null===a||void 0===a||null===(i=a.response)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.type))return void e("/subscription-expired");o(t(a,"Error while getting session"))}}};async function C(e,t,o,n){const l={"X-CSRFToken":n};try{const n=await(0,x.Z)({method:e,url:t,data:o,headers:l});return null===n||void 0===n?void 0:n.data}catch(i){return console.error("Error making API call to ".concat(t,": ").concat(i)),null}}let O,D,P;try{O=Object(function(){var e=new Error("Cannot find module '../plugins/hooks/usePlatformAdmin.js'");throw e.code="MODULE_NOT_FOUND",e}())()}catch(vc){}let Z={};try{P=o(Object(function(){var e=new Error("Cannot find module '../plugins/store/select-product-store.js'");throw e.code="MODULE_NOT_FOUND",e}())),Z=Object(function(){var e=new Error("Cannot find module '../plugins/llm-whisperer/helper'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}const I=function(){const e=N((e=>e.setSessionDetails)),t=_(),{setAlertDetails:o}=T(),n=(0,c.s0)(),l=E();try{var i,s;if(null!==(i=P)&&void 0!==i&&i.useSelectedProductStore)D=null===(s=P)||void 0===s?void 0:s.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct))}catch(a){}return async()=>{let i=null;try{var s,a,d,r,c,u,p,v,m,h,j;const e=await l();if(!e)return;const t=null===e||void 0===e?void 0:e.organization_id,o=((e,t,o)=>!(!e||!t||0===Object.keys(Z).length||Object.values(Z).includes(o))&&(n("/selectProduct"),!0))(e,P,D);if(o)return;const g=!(D&&"unstract"!==D),_={method:"GET",url:"/api/v1/organization"},S=await(0,x.Z)(_),b=null===S||void 0===S||null===(s=S.data)||void 0===s?void 0:s.organizations;if(null===b||void 0===b||!b.length)throw Error("Organizations not available.");if((null===b||void 0===b?void 0:b.length)>1&&(null===t||void 0===t||!t.length))return void n("/setOrg",{state:b});const N=t||b[0].id,w=f.Z.get("csrftoken");_.method="POST",_.url="/api/v1/organization/".concat(N,"/set"),_.headers={"X-CSRFToken":w};const k=await(0,x.Z)(_).catch((e=>{var t;null!==e&&void 0!==e&&e.response&&403===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&(n("/",{state:null}),window.location.reload())}));i=null===k||void 0===k||null===(a=k.data)||void 0===a?void 0:a.user,i.orgName=null===k||void 0===k||null===(d=k.data)||void 0===d||null===(r=d.organization)||void 0===r?void 0:r.name,i.orgId=N,i.csrfToken=w,i.logEventsId=null===k||void 0===k||null===(c=k.data)||void 0===c?void 0:c.log_events_id,_.method="GET",_.url="/api/v1/unstract/".concat(N,"/users/profile/"),_.headers={"X-CSRFToken":w};const T=await(0,x.Z)(_);i.isAdmin=null===T||void 0===T||null===(u=T.data)||void 0===u||null===(p=u.user)||void 0===p?void 0:p.is_admin,i.loginOnboardingMessage=null===T||void 0===T||null===(v=T.data)||void 0===v||null===(m=v.user)||void 0===m?void 0:m.login_onboarding_message_displayed,i.promptOnboardingMessage=null===T||void 0===T||null===(h=T.data)||void 0===h||null===(j=h.user)||void 0===j?void 0:j.prompt_onboarding_message_displayed;const E=("; "+document.cookie).split("; z_code=").pop().split(";")[0];if(i.zCode=E,g){var y;_.method="GET",_.url="/api/v1/unstract/".concat(N,"/adapter/"),_.headers={"X-CSRFToken":w};const e=await(0,x.Z)(_),t=[...new Set(null===e||void 0===e||null===(y=e.data)||void 0===y?void 0:y.map((e=>e.adapter_type.toLowerCase())))];i.adapters=t}if(g){const e=await async function(e,t){var o;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default";const l="/api/v1/unstract/".concat(e,"/flags/?namespace=").concat(n);return null!==(o=(await C("GET",l,null,t)).feature_flags.flags)&&void 0!==o?o:{}}(N,w);i.flags=e}i.allOrganization=b,O&&(i.isPlatformAdmin=await O()),i.role=e.role,i.provider=e.provider}catch(vc){var _,S;if(402===(null===(_=vc.response)||void 0===_?void 0:_.status)&&t(vc),412===(null===(S=vc.request)||void 0===S?void 0:S.status)){const t=JSON.parse(vc.request.response),o=t.domain,n=t.code;window.location.href="/error?code=".concat(n,"&domain=").concat(o)}o(t(vc))}finally{e(g(i))}}};var L=o(33038),A=o.n(L),U=o(84488);const F={logs:[]},M=(0,S.Ue)(((e,t)=>({...F,pushLogMessages:function(o){var n;let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i={...t()},{sessionDetails:s}=N.getState();let a=[...(null===i||void 0===i?void 0:i.logs)||[]];const d=o.map(((e,t)=>{var o,n,l;return{timestamp:null===e||void 0===e?void 0:e.timestamp,key:(null===(o=a)||void 0===o?void 0:o.length)+t+1,level:null===e||void 0===e?void 0:e.level,stage:null===e||void 0===e?void 0:e.stage,step:null===e||void 0===e?void 0:e.step,state:null===e||void 0===e?void 0:e.state,prompt_key:null===e||void 0===e||null===(n=e.component)||void 0===n?void 0:n.prompt_key,doc_name:null===e||void 0===e||null===(l=e.component)||void 0===l?void 0:l.doc_name,message:(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.log),cost_value:null===e||void 0===e?void 0:e.cost,iteration:null===e||void 0===e?void 0:e.iteration,iteration_total:null===e||void 0===e?void 0:e.iteration_total,type:null===e||void 0===e?void 0:e.type}}));a=[...a,...d],d.forEach((e=>{if("NOTIFICATION"===(null===e||void 0===e?void 0:e.type)&&null!==s&&void 0!==s&&s.isLoggedIn&&l){const t={method:"POST",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/logs/"),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken},data:{log:JSON.stringify(e)}};(0,x.Z)(t).catch((e=>{}))}}));const r=null===(n=a)||void 0===n?void 0:n.length;if(r>200){const e=r-200;a=a.slice(e)}i.logs=a,e(i)},emptyLogs:()=>{e({logs:[]})}}))),R={stagedMessages:[],message:{},pointer:0},z=R,W=(0,S.Ue)(((e,t)=>({...z,pushStagedMessage:o=>{const n={...t()},l=[...(null===n||void 0===n?void 0:n.stagedMessages)||[]];l.push(o),n.stagedMessages=l,e(n)},shiftStagedMessage:()=>{const o={...t()},n=[...(null===o||void 0===o?void 0:o.stagedMessages)||[]];n.shift(),o.stagedMessages=n,e(o)},updateMessage:o=>{const n={...t()};n.message=o,e(n)},setPointer:o=>{e({...t(),pointer:o})},setDefault:()=>{e(R)}}))),q=(0,S.Ue)((e=>({llmTokenUsage:null,setLLMTokenUsage:t=>{e({llmTokenUsage:t})}}))),H=2e3;function G(){const[e,t]=(0,p.useState)(""),{pushStagedMessage:o,updateMessage:n,stagedMessages:l,pointer:i,setPointer:s}=W(),{pushLogMessages:a}=M(),{sessionDetails:d}=N(),r=(0,p.useContext)(U.J),{setAlertDetails:c}=T(),u=_(),{setLLMTokenUsage:v}=q(),m=(0,p.useRef)([]);(0,p.useEffect)((()=>{t((null===d||void 0===d?void 0:d.logEventsId)||"")}),[d]);const h=(0,p.useMemo)((()=>A()((e=>{e.length&&(a(e),m.current=[])}),H)),[a]);(0,p.useEffect)((()=>()=>h.cancel()),[h]);const x=(0,p.useCallback)((e=>{m.current=[...m.current,e],h(m.current)}),[h]),f=(0,p.useCallback)((e=>{try{var t,n,l,i,s,a,d,r;let c=e.data;var p;if(("string"===typeof c||c instanceof Uint8Array)&&(c="string"===typeof c?JSON.parse(c):JSON.parse((new TextDecoder).decode(c))),"LOG"!==(null===(t=c)||void 0===t?void 0:t.type)&&"COST"!==(null===(n=c)||void 0===n?void 0:n.type)||"prompt"===(null===(l=c)||void 0===l?void 0:l.service))"UPDATE"===(null===(i=c)||void 0===i?void 0:i.type)?o(c):"LOG"===(null===(s=c)||void 0===s?void 0:s.type)&&"prompt"===(null===(a=c)||void 0===a?void 0:a.service)&&x(c);else c.message=null===(p=c)||void 0===p?void 0:p.log,x(c);if("LOG"===(null===(d=c)||void 0===d?void 0:d.type)&&"usage"===(null===(r=c)||void 0===r?void 0:r.service)){var m,h;const e=(null===(m=c)||void 0===m?void 0:m.max_token_count_set)-(null===(h=c)||void 0===h?void 0:h.added_token_count);v(Math.max(e,0))}}catch(vc){c(u(vc,"Failed to process socket message"))}}),[x,o]);return(0,p.useEffect)((()=>{if(!e)return;const t="logs:".concat(e);return r.on(t,f),()=>{r.off(t,f)}}),[r,e,f]),(0,p.useEffect)((()=>{if(i>(null===l||void 0===l?void 0:l.length)-1)return;const e=l[i],t=setTimeout((()=>{n(e),s(i+1)}),0);return()=>clearTimeout(t)}),[l,i,s,n]),null}var K=o(35462);const B={activeApis:0,queue:[]},X={...B},V=(0,S.Ue)(((e,t)=>({...X,setDefaultPromptRunQueue:()=>{e({...B})},setPromptRunQueue:t=>{e(t)},pushPromptRunApi:o=>{const n={...t()},l=[...(null===n||void 0===n?void 0:n.queue)||[],...o];e({existingState:n,queue:l})},freeActiveApi:function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n={...t()},l=(null===n||void 0===n?void 0:n.activeApis)-o;l<0||e({...n,activeApis:l})},removePromptRunApi:()=>{const o={...t()},n=null===o||void 0===o?void 0:o.activeApis,l=[...(null===o||void 0===o?void 0:o.queue)||[]];null!==l&&void 0!==l&&l.length&&(l.shift(),e({activeApis:n-1,queue:l}))}}))),Y={dropdownItems:{},selectedDoc:null,listOfDocs:[],refreshRawView:!1,defaultLlmProfile:"",llmProfiles:[],details:{},disableLlmOrDocChange:[],indexDocs:[],rawIndexStatus:[],summarizeIndexStatus:[],singlePassExtractMode:!1,isMultiPassExtractLoading:!1,isSinglePassExtractLoading:!1,isSimplePromptStudio:!1,shareId:null,isPublicSource:!1,isChallengeEnabled:!1,adapters:[],selectedHighlight:null},Q={prompt_key:"Enter key",prompt:"Enter prompt",output_type:"Text",output_processing:"Default",prompt_type:r.A6.prompt},J={prompt_key:"Enter key",prompt:"Enter notes",output_type:"Text",output_processing:"Default",prompt_type:r.A6.notes},$={...Y},ee=(0,S.Ue)(((e,t)=>({...$,setDefaultCustomTool:()=>{e({...Y})},setCustomTool:t=>{e(t)},updateCustomTool:t=>{e((e=>({state:e,...t})))},addNewInstance:o=>{var n;const l={...t()},i=null===l||void 0===l||null===(n=l.details)||void 0===n?void 0:n.prompts;if(o===r.A6.prompt){const e={...Q};e.prompt_id="unsaved_".concat(i.length+1),i.push(e)}else{const e={...J};e.prompt_id="unsaved_".concat(i.length+1),i.push(e)}l.details.prompts=[...i],e({...l})},deleteInstance:o=>{var n;const l={...t()},i=(null===l||void 0===l||null===(n=l.details)||void 0===n?void 0:n.prompts).filter((e=>(null===e||void 0===e?void 0:e.prompt_id)!==o));l.details.prompts=i,e({...l})},getDropdownItems:e=>{const o={...t()};return((null===o||void 0===o?void 0:o.dropdownItems)||{})[e]},pushIndexDoc:o=>{const n={...t()},l=[...(null===n||void 0===n?void 0:n.indexDocs)||[]];l.push(o),n.indexDocs=l,e(n)},deleteIndexDoc:o=>{const n={...t()},l=[...(null===n||void 0===n?void 0:n.indexDocs)||[]].filter((e=>e!==o));n.indexDocs=l,e(n)}}))),te={promptRunStatus:{}},oe=(0,S.Ue)(((e,t)=>({...te,clearPromptStatus:()=>{e({promptRunStatus:{}})},addPromptStatus:t=>{e((e=>{const o=e.promptRunStatus||{},n={...o};for(const l in t)Object.hasOwn(t,l)&&(n[l]={...o[l],...t[l]});return{promptRunStatus:n}}))},removePromptStatus:(t,o)=>{e((e=>{const n={...e.promptRunStatus||{}};if(Object.hasOwn(n,t)){const e={...n[t]};delete e[o],0===Object.keys(e).length?delete n[t]:n[t]=e}return{promptRunStatus:n}}))}})));var ne=o(14733);const le=function(){const e=N((e=>e.setSessionDetails)),t=(0,ne.U0)();return()=>{e(g(null)),t.reset(),f.Z.remove("sessionid"),f.Z.remove("csrftoken");const o=(0,r.SV)()+"/api/v1/logout";window.location.href=o}};function ie(){const e=x.Z.create(),t=le();return(0,p.useEffect)((()=>{const o=e.interceptors.response.use((e=>e),(async e=>{var o;return 401===(null===e||void 0===e||null===(o=e.response)||void 0===o?void 0:o.status)&&t(),Promise.reject(e)}));return()=>{e.interceptors.response.eject(o)}}),[]),e}const se={promptOutputs:{}},ae={...se},de=(0,S.Ue)(((e,t)=>({...ae,resetPromptOutput:()=>{e(se)},setPromptOutput:t=>{e({promptOutputs:t})},updatePromptOutput:o=>{let n={...t()}.promptOutputs;n={...n,...o},e({promptOutputs:n})},deletePromptOutput:o=>{const n={...t()}.promptOutputs;delete n[o],e({promptOutputs:n})}}))),re={tokenUsage:{}},ce=(0,S.Ue)((e=>({...re,setTokenUsage:t=>{e({tokenUsage:{...t}})},updateTokenUsage:t=>{e((e=>({tokenUsage:{...e.tokenUsage,...t}})))},resetTokenUsage:()=>{e(re)}})));let ue,pe;try{ue=Object(function(){var e=new Error("Cannot find module '../plugins/simple-prompt-studio/helper'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{pe=Object(function(){var e=new Error("Cannot find module '../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}const ve=()=>{const{sessionDetails:e}=N(),{setTokenUsage:t,updateTokenUsage:o}=ce(),{setPromptOutput:n,updatePromptOutput:l}=de(),{isSimplePromptStudio:i,isPublicSource:s,selectedDoc:a}=ee(),d=ie(),{id:r}=(0,c.UO)(),u=function(e,t,o,n){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i="".concat(e,"__").concat(t,"__").concat(o);return l&&(i+="__".concat(n)),i},p=(e,t)=>{let o=e;return Object.keys(t).forEach((n=>{const[l,i,,s]=n.split("__");if(i===(null===a||void 0===a?void 0:a.document_id)){const l={[n]:t[n]};o={...e,...l}}Object.keys(o).forEach((e=>{const[i,,,a]=e.split("__");var d;l===i&&s===a&&(o[e].coverage=null===(d=t[n])||void 0===d?void 0:d.coverage)}))})),o};return{promptOutputApi:async function(t){const o=((t,o,n,l,a)=>{let d="/api/v1/unstract/".concat(null===e||void 0===e?void 0:e.orgId,"/prompt-studio/prompt-output/?tool_id=").concat(t);return i&&(d=ue(t,null,null)),s&&(d=pe(r,n,a,null,null)),o&&(d+="&document_manager=".concat(o)),n&&(d+="&prompt_id=".concat(n)),l&&(d+="&profile_manager=".concat(l)),a&&(d+="&is_single_pass_extract=".concat(a)),d})(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4]),n={method:"GET",url:o,headers:{"X-CSRFToken":null===e||void 0===e?void 0:e.csrfToken}};return d(n).then((e=>e)).catch((e=>e))},updatePromptOutputState:function(e,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a={};let d=!1;const r={};if(e.forEach((e=>{const t=null===e||void 0===e?void 0:e.prompt_id,o=null===e||void 0===e?void 0:e.document_manager,n=null===e||void 0===e?void 0:e.profile_manager,l=null===e||void 0===e?void 0:e.is_single_pass_extract;if(!t||!o||!n)return;const i=u(t,o,n,l,!0);if(a[i]={runId:null===e||void 0===e?void 0:e.run_id,promptOutputId:null===e||void 0===e?void 0:e.prompt_output_id,profileManager:n,context:null===e||void 0===e?void 0:e.context,challengeData:null===e||void 0===e?void 0:e.challenge_data,tokenUsage:null===e||void 0===e?void 0:e.token_usage,output:null===e||void 0===e?void 0:e.output,timer:s,coverage:null===e||void 0===e?void 0:e.coverage,highlightData:null===e||void 0===e?void 0:e.highlight_data,confidenceData:null===e||void 0===e?void 0:e.confidence_data},null!==e&&void 0!==e&&e.is_single_pass_extract&&d)return;if(null!==e&&void 0!==e&&e.is_single_pass_extract){const t=((e,t)=>"single_pass__".concat(e,"__").concat(t))(n,o);return r[t]=null===e||void 0===e?void 0:e.token_usage,r[((e,t)=>"single_pass__".concat(e,"__").concat(t,"__context"))(n,o)]=null===e||void 0===e?void 0:e.context,r[((e,t)=>"single_pass__".concat(e,"__").concat(t,"__challenge_data"))(n,o)]=null===e||void 0===e?void 0:e.challenge_data,void(d=!0)}const c=u(t,o,n,!1,!1);r[c]=null===e||void 0===e?void 0:e.token_usage})),i)n(a),t(r);else{const e=de.getState().promptOutputs;l(p(e,a)),o(r)}},generatePromptOutputKey:u}},me=()=>{const{pushPromptRunApi:e,freeActiveApi:t}=V(),{generatePromptOutputKey:o,updatePromptOutputState:n}=ve(),{addPromptStatus:l,removePromptStatus:i}=oe(),{details:s,llmProfiles:a,listOfDocs:d,selectedDoc:c}=ee(),{sessionDetails:u}=N(),p=ie(),{setAlertDetails:v}=T(),m=_(),h=e=>p(e),x=e=>{const[o,l,a]=e.split("__"),d=(0,r.DO)(),p={id:o,document_id:l,profile_manager:a,run_id:d},x={method:"POST",url:"/api/v1/unstract/".concat(null===u||void 0===u?void 0:u.orgId,"/prompt-studio/fetch_response/").concat(null===s||void 0===s?void 0:s.tool_id),headers:{"X-CSRFToken":null===u||void 0===u?void 0:u.csrfToken,"Content-Type":"application/json"},data:p},f=Date.now();(0,r.DE)(f,x,3e4,5e3,h).then((e=>{if(l!==(null===c||void 0===c?void 0:c.document_id))return;const t=(null===e||void 0===e?void 0:e.data)||[],o=Math.floor((Date.now()-f)/1e3);n(t,!1,o)})).catch((e=>{v(m(e,"Failed to generate prompt output"))})).finally((()=>{t();const e=(0,r.ty)(l,a);i(o,e)}))};return{runPrompt:e=>{null!==e&&void 0!==e&&e.length&&e.forEach(x)},handlePromptRunRequest:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const u=n?[n]:(null===s||void 0===s?void 0:s.prompts.map((e=>e.prompt_id)))||[],p=i?[i]:a.map((e=>e.profile_id))||[],v=c?[c]:d.map((e=>e.document_id))||[];let m=[],h={};const x={[r.SS.RUN_ONE_PROMPT_ONE_LLM_ONE_DOC]:{requiredParams:["promptId","profileId","docId"],prompts:[n],profiles:[i],docs:[c]},[r.SS.RUN_ONE_PROMPT_ONE_LLM_ALL_DOCS]:{requiredParams:["promptId","profileId"],prompts:[n],profiles:[i],docs:v},[r.SS.RUN_ONE_PROMPT_ALL_LLMS_ONE_DOC]:{requiredParams:["promptId","docId"],prompts:[n],profiles:p,docs:[c]},[r.SS.RUN_ONE_PROMPT_ALL_LLMS_ALL_DOCS]:{requiredParams:["promptId"],prompts:[n],profiles:p,docs:v},[r.SS.RUN_ALL_PROMPTS_ALL_LLMS_ONE_DOC]:{requiredParams:["docId"],prompts:u,profiles:p,docs:[c]},[r.SS.RUN_ALL_PROMPTS_ALL_LLMS_ALL_DOCS]:{requiredParams:[],prompts:u,profiles:p,docs:v}}[t];if(!x)return;const f={promptId:n,profileId:i,docId:c};x.requiredParams.filter((e=>!f[e])).length>0||(({apiRequestsToQueue:m,promptRunApiStatus:h}=((e,t,n)=>{const l=[],i=[],s=[];for(const o of e)for(const e of t)for(const t of n)s.push({promptId:o,profileId:e,docId:t});return s.forEach((e=>{let{promptId:t,profileId:n,docId:s}=e;i[t]||(i[t]={});const a=o(t,s,n,null,!1),d=(0,r.ty)(s,n);i[t][d]=r.yc.RUNNING,l.push(a)})),{apiRequestsToQueue:l,promptRunApiStatus:i}})(x.prompts,x.profiles,x.docs)),l(h),e(m))},syncPromptRunApisAndStatus:t=>{const o={};t.forEach((e=>{const[t,n,l]=e.split("__"),i=(0,r.ty)(n,l);o[t]||(o[t]={}),o[t][i]=r.yc.RUNNING})),l(o),e(t)}}},he=5,xe=!1;function fe(){const e=V((e=>e.activeApis)),t=V((e=>e.queue)),o=V((e=>e.setPromptRunQueue)),{runPrompt:n,syncPromptRunApisAndStatus:l}=me(),i=oe((e=>e.promptRunStatus)),s=ee((e=>e.updateCustomTool));return(0,p.useEffect)((()=>{var e;const t=f.Z.get("promptRunQueue");if(t&&null!==(e=JSON.parse(t))&&void 0!==e&&e.length){const e=JSON.parse(t);l(e)}const o=()=>{if(!xe)return;const{queue:e}=V.getState();null!==e&&void 0!==e&&e.length&&f.Z.set("promptRunQueue",JSON.stringify(e),{expires:5/1440})};return window.addEventListener("beforeunload",o),()=>{window.removeEventListener("beforeunload",o)}}),[l]),(0,p.useEffect)((()=>{if(null===t||void 0===t||!t.length||e>=he)return;const l=he-e,i=t.slice(0,l);o({activeApis:e+i.length,queue:t.slice(i.length)}),n(i)}),[e,t,o,n]),(0,p.useEffect)((()=>{const e=!!Object.keys(i).length;s({isMultiPassExtractLoading:e})}),[i,s]),null}let ge,je,ye,_e,Se,be,Ne,we={};try{ge=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/select-product-store.js'");throw e.code="MODULE_NOT_FOUND",e}())),_e=Object(function(){var e=new Error("Cannot find module '../../../plugins/helpers/common'");throw e.code="MODULE_NOT_FOUND",e}()),we=Object(function(){var e=new Error("Cannot find module '../../../plugins/helpers/common'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function ke(){const[e,t]=(0,p.useState)(!0),{sessionDetails:o}=N(),n=I(),l=(0,c.TH)(),i=new URLSearchParams(l.search).get(_e);try{var s,a;if(null!==(s=ge)&&void 0!==s&&s.useSelectedProductStore)je=null===(a=ge)||void 0===a?void 0:a.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct)),ye=ge.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.setSelectedProduct))}catch(d){}return(0,p.useEffect)((()=>{let e=!0;return null!==o&&void 0!==o&&o.isLoggedIn?t(!1):(t(!0),(async()=>{try{await n()}finally{e&&t(!1)}})()),()=>e=!1}),[je]),(0,p.useEffect)((()=>{i&&Object.values(we).includes(i)&&ye(i)}),[i]),e?(0,v.jsx)(K.b,{}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.j3,{}),(0,v.jsx)(G,{}),(0,v.jsx)(fe,{})]})}try{Se=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/select-product-store.js'");throw e.code="MODULE_NOT_FOUND",e}()))}catch{}const Te=()=>{const{sessionDetails:e}=N(),{orgName:t,adapters:o}=e,n=(0,c.TH)().pathname;try{be="llm-whisperer"===Se.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct))}catch(i){}try{Ne="verticals"===Se.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct))}catch(i){}let l="/".concat(t,"/onboard");return be?l="/llm-whisperer/".concat(t,"/playground"):Ne?l="/verticals/":(0,r.IU)(o)&&(l="/".concat(t,"/").concat(r.DK)),"unstract_reviewer"!==e.role&&"unstract_supervisor"!==e.role||(l="/".concat(t,"/review")),null!==e&&void 0!==e&&e.isLoggedIn||!r.jE.includes(n)?(0,v.jsx)(c.Fg,{to:l}):(0,v.jsx)(c.j3,{})};var Ee=o(45863);const Ce="success",Oe="danger";function De(){const e=(0,c.TH)(),t=new URLSearchParams(e.search).get("status");return localStorage.setItem("oauth-status",t),t===Ce&&setTimeout((()=>{window.close()}),1e3),(0,v.jsx)("div",{className:"display-flex-center oauth-status-layout",children:(0,v.jsx)(Ee.default.Text,{type:t===Ce?Ce:Oe,className:"oauth-status-text",children:"Authentication "+(t===Ce?"Successful":"Failed")})})}var Pe=o(66106),Ze=o(30914),Ie=o(79190);const Le=o.p+"static/media/login-right-panel.a8f5757e2918907e279b9aab3a67f920.svg",Ae={title:"UNLOCK VALUE FROM UNSTRUCTURED DATA.",description:"Unstract is a no-code LLM platform that lets you automate even the most complex workflows involving unstructured data, saving you time, money, and automation headaches."};function Ue(e){let{title:t,description:o,image:n}=e;return(0,v.jsxs)("div",{className:"right-section-text-wrapper",children:[(0,v.jsx)("div",{className:"right-title-cover",children:(0,v.jsx)(Ee.default.Title,{className:"right-section-title",children:t||Ae.title})}),(0,v.jsx)("div",{className:"right-subtitle-cover",children:(0,v.jsx)(Ee.default,{align:"center",className:"right-subtitle",children:o||Ae.description})}),(0,v.jsx)("div",{children:(0,v.jsx)("img",{src:n||Le,alt:"login background",className:"login-background"})})]})}let Fe=null;try{Fe=Object(function(){var e=new Error("Cannot find module '../../plugins/login-form/LoginForm'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Me(){const e=(0,r.SV)()+"/api/v1/login",t=()=>{window.location.href=e};return(0,v.jsx)("div",{className:"login-main",children:(0,v.jsx)(Pe.Z,{children:Fe?(0,v.jsx)(Fe,{handleLogin:t}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ze.Z,{xs:24,md:12,className:"login-left-section",children:(0,v.jsxs)("div",{className:"button-wraper",children:[(0,v.jsx)(Ie.pO,{className:"logo"}),(0,v.jsx)("div",{children:(0,v.jsx)(i.ZP,{className:"login-button button-margin",onClick:t,children:"Login"})})]})}),(0,v.jsx)(Ze.Z,{xs:24,md:12,className:"login-right-section",children:(0,v.jsx)(Ue,{})})]})})})}function Re(){return(0,v.jsx)(Me,{})}var ze=o(87888);function We(){const{state:e}=(0,c.TH)(),t=(0,c.s0)(),[o,n]=(0,p.useState)(!1),[l,i]=(0,p.useState)(null),{setAlertDetails:s}=T(),a=_(),d=E();(0,p.useEffect)((()=>{(async()=>{try{const o=await d(),n=null===o||void 0===o?void 0:o.organization_id;(null===e||n)&&t("/")}catch(o){t("/")}finally{n(!1)}})()}),[e,t]);return e&&(0,v.jsxs)("div",{className:"org-container",children:[(0,v.jsxs)("div",{className:"org-list",children:[(0,v.jsx)(Ie.pO,{className:"select-org-unstract-logo"}),(0,v.jsx)("div",{className:"card-list-container",children:e.map((e=>(0,v.jsx)(qe,{organization:e,onConnect:e=>(e=>{n(!0),i(e);const t=f.Z.get("csrftoken"),o={method:"POST",url:"/api/v1/organization/".concat(e,"/set"),headers:{"X-CSRFToken":t}};(0,x.Z)(o).then((()=>{window.location.reload()})).catch((e=>{s(a(e))})).finally((()=>{n(!1),i(null)}))})(e),loading:o&&l===(null===e||void 0===e?void 0:e.id),disabled:null!==l&&l!==(null===e||void 0===e?void 0:e.id)},null===e||void 0===e?void 0:e.id)))}),(0,v.jsx)(Ie.rG,{className:"yellow-grad-circle"})]}),(0,v.jsxs)("div",{className:"org-svg",children:[(0,v.jsx)(Ie.JD,{className:"org-selection-svg"}),(0,v.jsx)(Ie.ii,{className:"red-grad-circle"})]})]})}function qe(e){let{organization:t,onConnect:o,loading:n,disabled:l}=e;return(0,v.jsxs)(ze.Z,{className:"org-card-container",children:[(0,v.jsx)(ze.Z.Meta,{avatar:(0,v.jsx)(Ie.$_,{className:"org-avatar"}),title:t.display_name}),(0,v.jsx)(i.ZP,{className:"select-org-button",onClick:()=>o(t.id),loading:n,disabled:l,children:"Connect"})]})}function He(){return(0,v.jsx)(We,{})}var Ge=o(37557),Ke=o(83990),Be=o(71046),Xe=o(30842);const Ve=o.p+"static/media/connect_llm.f36777390f6c7e39d3398e1c27cd255a.svg";const Ye=o.p+"static/media/connect_vector_db.60dbca371c61421cedc76acd1ac41d8c.svg";const Qe=o.p+"static/media/connect_embedding.dae3f6c8a1ed86be62ec911e5e606a60.svg";const Je=o.p+"static/media/connect_x2text.c486679d28dca2b312ba7532503079d0.svg";var $e=o(72506),et=o(79286);function tt(e){let{text:t,btnText:o,handleClick:n}=e;return(0,v.jsx)("div",{className:"display-flex-center-h-and-v",children:(0,v.jsxs)(Be.Z,{direction:"vertical",className:"display-flex-align-center",children:[(0,v.jsx)(Ie.$J,{}),(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"display-flex-center",children:(0,v.jsx)(Ee.default.Text,{type:"secondary",children:t})}),(null===o||void 0===o?void 0:o.length)>0&&(0,v.jsx)("div",{className:"display-flex-center",children:(0,v.jsx)(i.ZP,{type:"link",icon:(0,v.jsx)(et.Z,{}),onClick:n,children:o})})]})]})})}var ot=o(75160),nt=o(96015),lt=o(86604),it=o(97943),st=o(72426),at=o.n(st),dt=o(93070);const{Text:rt,Link:ct,Paragraph:ut}=Ee.default,pt=e=>{let{text:t="",renderNewLines:o=!0,isSecondary:n=!1,styleClassName:l}=e;const i=n?"secondary":void 0,s=[{type:"tripleCode",regex:/```\n([\s\S]*?)\n```/g},{type:"inlineCode",regex:/`([^`]{1,100})`/g},{type:"bold",regex:/\*\*([^*]{1,100})\*\*/g},{type:"link",regex:/\[([^\]]{1,100})\]\(([^)]{1,200})\)/g},{type:"newline",regex:/\n/g}],a=(e,t,n)=>{switch(e){case"tripleCode":return(0,v.jsx)(ut,{style:{margin:0},children:(0,v.jsx)("pre",{style:{margin:0},children:t})});case"inlineCode":return(0,v.jsx)(rt,{code:!0,type:i,children:t});case"bold":return(0,v.jsx)(rt,{strong:!0,type:i,children:t});case"link":return(0,v.jsx)(ct,{href:n,target:"_blank",rel:"noopener noreferrer",children:t});case"newline":return o?(0,v.jsx)("br",{}):"\n";default:return t}},d=(0,p.useMemo)((()=>{let e=[t];return s.forEach((t=>{let{type:o,regex:n}=t;const l=[];e.forEach((e=>{if("string"!==typeof e)return void l.push(e);let t,i=0;for(;null!==(t=n.exec(e));){const n=t.index;n>i&&l.push(e.substring(i,n));const s=t[2];l.push(a(o,t[1],s)),i=n+t[0].length}i<e.length&&l.push(e.substring(i))})),e=l})),e}),[t,o,i]);return(0,v.jsx)(rt,{type:i,className:l,children:d})};function vt(e){let{children:t,label:o,description:n,required:l}=e;return(0,v.jsxs)(dt.Z.Item,{className:"widget-form-item",children:[(0,v.jsxs)(Ee.default,{className:"form-item-label",children:[l&&(0,v.jsx)("span",{className:"form-item-required",children:"* "}),o]}),t,(null===n||void 0===n?void 0:n.length)>0&&(0,v.jsx)(pt,{text:n,isSecondary:!0,styleClassName:"rjsf-helper-font"})]})}const mt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsxs)(vt,{label:l,description:d,required:s,children:[(0,v.jsx)(lt.default,{id:t,value:o?at()(o):null,onChange:e=>{n(null===e||void 0===e?void 0:e.toISOString())},disabled:a}),(0,v.jsx)(it.Z,{value:o?at()(o):null,onChange:e=>{const t=o?new Date(o):new Date;t.setHours(e.hour()),t.setMinutes(e.minute()),n(t.toISOString())},disabled:a})]})},ht=e=>{const{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e,d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(lt.default,{id:t,value:o?at()(o):null,onChange:e=>{n(null===e||void 0===e?void 0:e.toISOString())},disabled:a})})};var xt=o(3702);const ft=e=>{const{schema:t,formData:o,onChange:n,required:l,readonly:i}=e,[s,a]=(0,p.useState)([]),[d,r]=(0,p.useState)([]);(0,p.useEffect)((()=>{var e,o;Array.isArray(null===t||void 0===t||null===(e=t.items)||void 0===e?void 0:e.enum)&&a(null===t||void 0===t||null===(o=t.items)||void 0===o?void 0:o.enum)}),[]),(0,p.useEffect)((()=>{if((null===s||void 0===s?void 0:s.length)>0){const e=s.map((e=>({value:e,label:e})));r(e)}}),[s]);return(0,v.jsx)(vt,{label:null===t||void 0===t?void 0:t.title,description:null===t||void 0===t?void 0:t.description,required:l,children:(0,v.jsx)(xt.default,{mode:"tags",allowClear:!0,className:"array-field-select",placeholder:"Please select",value:o,onChange:e=>{if(null===e||void 0===e||!e.length)return void n([]);const t=e[(null===e||void 0===e?void 0:e.length)-1];null!==s&&void 0!==s&&s.length&&!s.includes(t)||n(e)},options:d,disabled:i})})};var gt=o(89862);const jt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsxs)(Be.Z,{direction:"vertical",className:"checkbox-widget-main",size:0,children:[(0,v.jsx)(gt.Z,{id:t,checked:o,onChange:e=>{n(e.target.checked)},disabled:a,children:(0,v.jsxs)(Ee.default,{children:[s&&(0,v.jsx)("span",{className:"form-item-required",children:"* "}),l]})}),(null===d||void 0===d?void 0:d.length)>0&&(0,v.jsx)(pt,{text:d,isSecondary:!0,styleClassName:"rjsf-helper-font"})]})},yt=e=>{let{id:t,options:o,value:n,onChange:l,label:i,schema:s,required:a,readonly:d}=e;const r=(null===s||void 0===s?void 0:s.description)||"";return(0,v.jsx)(vt,{label:i,description:r,required:a,children:o.map((e=>(0,v.jsx)(gt.Z,{checked:null===n||void 0===n?void 0:n.includes(e.value),onChange:()=>(e=>{const t=[...n||[]],o=t.indexOf(e);-1===o?t.push(e):t.splice(o,1),l(t)})(e.value),disabled:d,children:e.label},e.value)))})};var _t=o(300);const St=e=>{let{id:t,value:o,onChange:n,schema:l,label:i,required:s,readonly:a}=e;const d=(null===l||void 0===l?void 0:l.description)||"";return(0,v.jsx)(vt,{label:i,description:d,required:s,children:(0,v.jsx)(_t.default,{type:"color",id:t,value:o,onChange:e=>{n(e.target.value)},disabled:a})})},bt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(lt.default,{showTime:!0,id:t,value:o?at()(o):null,onChange:e=>{n(null===e||void 0===e?void 0:e.toISOString())},disabled:a})})},Nt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(lt.default,{id:t,value:o?at()(o):null,onChange:e=>{n(null===e||void 0===e?void 0:e.toISOString())},disabled:a})})},wt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(_t.default,{type:"email",id:t,value:o,onChange:e=>{n(e.target.value)},disabled:a})})};var kt=o(72351),Tt=o(98583);const Et=e=>{let{id:t,onChange:o,label:n,schema:l,required:s,readonly:a}=e;const d=(null===l||void 0===l?void 0:l.description)||"";return(0,v.jsx)(vt,{label:n,description:d,required:s,children:(0,v.jsx)(Tt.Z,{id:t,onChange:e=>{if("done"===e.file.status){const t=e.file.response.url;o(t)}},disabled:a,children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(kt.Z,{}),children:"Upload File"})})})},Ct=e=>{let{id:t,value:o,label:n}=e;return(0,v.jsx)(vt,{label:n,children:(0,v.jsx)("input",{type:"hidden",id:t,value:o})})},{Option:Ot}=xt.default,Dt=e=>{const{id:t,value:o,options:n,onChange:l,label:i,schema:s,rawErrors:a,readonly:d}=e,r=(null===s||void 0===s?void 0:s.description)||"",c=a&&a.length>0;return(0,v.jsx)(dt.Z.Item,{className:"width-100",validateStatus:c?"error":"",children:(0,v.jsxs)(Be.Z,{direction:"vertical",className:"width-100",children:[(0,v.jsx)(Ee.default.Text,{children:i}),(0,v.jsxs)("div",{children:[(0,v.jsx)(xt.default,{id:t,value:o,onChange:e=>{l(e)},showSearch:!0,disabled:d,children:(null===n||void 0===n?void 0:n.enumOptions)&&n.enumOptions.map(((e,t)=>(0,v.jsx)(Ot,{value:e.value,children:e.label},e.value)))}),(null===r||void 0===r?void 0:r.length)>0&&(0,v.jsx)(pt,{text:r,isSecondary:!0,styleClassName:"rjsf-helper-font"})]})]})})},Pt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(it.Z,{id:t,value:o?at()(o):null,onChange:e=>{n(null===e||void 0===e?void 0:e.toISOString())},disabled:a})})},Zt=e=>{const{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e,d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(_t.default,{type:"url",id:t,value:o,onChange:e=>{n(e.target.value)},disabled:a})})};var It=o(20043);const Lt={DEFAULT:"default"};function At(e){let{size:t="default",delay:o=0,text:n="",align:l="center"}=e;return(0,v.jsx)("div",{className:"width-100 height-100",children:(0,v.jsx)("div",{className:"spinner-loader-layout ".concat(l===Lt.DEFAULT?"":"center"),children:(0,v.jsx)(It.Z,{delay:o,tip:n,size:t})})})}const Ut=e=>{const{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e,d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(_t.default,{id:t,value:o,onChange:e=>{n(e.target.value)},disabled:a})})},Ft=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(_t.default.Password,{id:t,value:o,onChange:e=>{n(e.target.value)},disabled:a})})};var Mt=o(42926);const Rt=e=>{let{id:t,value:o,onChange:n,label:l,schema:i,required:s,readonly:a}=e;const d=(null===i||void 0===i?void 0:i.description)||"";return(0,v.jsx)(vt,{label:l,description:d,required:s,children:(0,v.jsx)(Mt.Z,{id:t,value:o,onChange:e=>{n(e)},disabled:a})})},zt=e=>{const{classNames:t,errors:o,children:n,help:l}=e;return(0,v.jsxs)("div",{className:t,children:[n,(0,v.jsx)(Ee.default.Text,{type:"danger",children:o}),l]})};var Wt=o(71234);function qt(e){let{children:t,schema:o,formData:n,setFormData:l,isLoading:i,formRef:s,validateAndSubmit:a,isStateUpdateRequired:d}=e;const r=(0,p.useMemo)((()=>{if(!o)return{};const e={...o};return delete e.title,delete e.description,e}),[o]),c=(0,p.useMemo)((()=>(null===o||void 0===o?void 0:o.description)||""),[o]),u=(0,p.useMemo)((()=>({AltDateTimeWidget:mt,AltDateWidget:ht,CheckboxWidget:jt,CheckboxesWidget:yt,ColorWidget:St,DateTimeWidget:bt,DateWidget:Nt,EmailWidget:wt,FileWidget:Et,HiddenWidget:Ct,PasswordWidget:Ft,SelectWidget:Dt,TextWidget:Ut,TimeWidget:Pt,UpDownWidget:Rt,URLWidget:Zt})),[]),m=(0,p.useMemo)((()=>({ArrayField:ft})),[]),h=(0,p.useMemo)((()=>({"ui:classNames":"my-rjsf-form"})),[n]),x=(0,p.useCallback)((e=>{if(null!==e&&void 0!==e&&e.properties&&null!==e&&void 0!==e&&e.required){const t=e.properties;e.required.forEach((e=>{!t[e]||null!==t[e].default&&""!==t[e].default||delete t[e].default}))}return e}),[]),f=(0,p.useCallback)((e=>e.map((e=>"required"===e.name?{...e,message:"This field is mandatory. Please provide a value."}:e))),[]),g=(0,p.useCallback)((e=>{if(!d)return;const t=e.formData;l(t)}),[d,l]);return(0,v.jsx)(v.Fragment,{children:i?(0,v.jsx)(At,{}):(0,v.jsxs)(Be.Z,{direction:"vertical",className:"width-100",children:[c&&(0,v.jsx)(Wt.Z,{message:(0,v.jsx)(pt,{text:c}),type:"info"}),(0,v.jsx)(ot.ZP,{form:s,schema:x(r),uiSchema:h,validator:nt.ZP,widgets:u,fields:m,formData:n,transformErrors:f,onError:()=>{},onSubmit:e=>a(e.formData),showErrorList:!1,onChange:g,templates:{FieldTemplate:zt},children:t})]})})}var Ht=o(84682);const Gt=e=>{let{handleOAuth:t,status:o}=e;const[n,l]=(0,p.useState)("");return(0,p.useEffect)((()=>{l("success"!==o?"Sign in with Google":"Authenticated")}),[o]),(0,v.jsx)("div",{className:"google-oauth-layout",children:(0,v.jsx)(Ht.GoogleLoginButton,{onClick:t,children:(0,v.jsx)(Ee.default.Text,{children:n})})})};function Kt(e){let{oAuthProvider:t,setCacheKey:o,setStatus:n}=e;const l=ie(),{setAlertDetails:i}=T(),s=_(),[a,d]=(0,p.useState)(localStorage.getItem("oauth-status"));(0,p.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("oauth-status");d(e),n(e)};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e),localStorage.removeItem("oauth-status"),d("")}}),[]);const c=async()=>{try{var e;const n={method:"GET",url:"/api/v1/oauth/cache-key/".concat(t)},i=await l(n),s=null===i||void 0===i||null===(e=i.data)||void 0===e?void 0:e.cache_key,a=encodeURIComponent(s);o(s);const d=(0,r.SV)(),c="".concat(d,"/api/v1/oauth/login/").concat(t,"?oauth-key=").concat(a);window.open(c,"_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=200,left=500,width=500,height=600")}catch(vc){i(s(vc))}};return r.U4.GOOGLE===t?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Gt,{handleOAuth:c,status:a})}):(0,v.jsx)(Ee.default,{children:"Provider not available."})}function Bt(e){let{...t}=e;const{type:o}=t;return(0,v.jsx)(i.ZP,{className:"primary"===o?"custom-button-primary":"",...t})}const Xt=()=>{const e=(0,ne.U0)(),{sessionDetails:t}=N();return{posthogEventText:{llm:"intent_add_llm",vector_db:"intent_add_vectordb",embedding:"intent_add_embedding",x2text:"intent_add_text_extractor",ocr:null},posthogTcEventText:{llm:"test_connection_llm",vector_db:"test_connection_vectordb",embedding:"test_connection_embedding",x2text:"test_connection_text_extractor",ocr:null},posthogSubmitEventText:{llm:"intent_success_add_llm",vector_db:"intent_success_add_vectordb",embedding:"intent_success_add_embedding",x2text:"intent_success_add_text_extractor",ocr:null},posthogConnectorEventText:{"FILESYSTEM:input":"intent_wf_fs_source","FILESYSTEM:output":"intent_wf_fs_dest","DATABASE:output":"intent_wf_db_dest"},posthogConnectorAddedEventText:{"FILESYSTEM:input":"intent_success_wf_fs_source","FILESYSTEM:output":"intent_success_wf_fs_dest","DATABASE:output":"intent_success_wf_db_dest"},posthogWfDeploymentEventText:{API:"wf_deploy_api",ETL:"wf_deploy_etl",TASK:"wf_deploy_task"},posthogDeploymentEventText:{api:"intent_api_deployment",api_success:"intent_success_api_deployment",etl:"intent_etl_deployment",etl_success:"intent_success_etl_deployment",task:"intent_task_deployment",task_success:"intent_success_task_deployment"},setPostHogIdentity:()=>{const o="".concat(null===t||void 0===t?void 0:t.orgId,":").concat(null===t||void 0===t?void 0:t.orgName),n=null===t||void 0===t?void 0:t.orgName,l="mock_org"===n,i={name:"".concat(null===t||void 0===t?void 0:t.name," ").concat((null===t||void 0===t?void 0:t.family_name)||""),org:n,software:l?"OSS":"SAAS"},s=null===t||void 0===t?void 0:t.email,a=null===t||void 0===t?void 0:t.id;s?i.email=s:i.userId=a,e.identify(o,i)},setPostHogCustomEvent:(t,o)=>{e.capture(t,o)}}};function Vt(e){let{spec:t,formData:o,setFormData:n,setOpen:l,oAuthProvider:i,selectedSourceId:s,isLoading:a,addNewItem:d,type:u,editItemId:m,sourceType:h,handleUpdate:x,connDetails:f,metadata:g,selectedSourceName:j,connType:y,formDataConfig:S}=e;const b=(0,p.createRef)(null),w=ie(),[k,E]=(0,p.useState)(!1),[C,O]=(0,p.useState)(!1),[D,P]=(0,p.useState)(!1),[Z,I]=(0,p.useState)(""),[L,A]=(0,p.useState)(""),{sessionDetails:U}=N(),{setAlertDetails:F}=T(),M=_(),{updateSessionDetails:R}=N(),{posthogTcEventText:z,posthogSubmitEventText:W,posthogConnectorAddedEventText:q,setPostHogCustomEvent:H}=Xt(),{id:G}=(0,c.UO)();(0,p.useEffect)((()=>{k&&E(!1)}),[o]),(0,p.useEffect)((()=>{const{connector_id:e}=f||{};e===s&&g&&n(g)}),[s]);const K=e=>{const t=e.toLowerCase(),o=null===U||void 0===U?void 0:U.adapters;if(o&&!o.includes(t)){o.push(t);R({adapters:o})}};return(0,v.jsxs)("div",{className:"config-layout",children:[!a&&(null===i||void 0===i?void 0:i.length)>0&&(0,v.jsx)(Kt,{oAuthProvider:i,setCacheKey:I,setStatus:A}),(0,v.jsx)(qt,{schema:t,formData:o,setFormData:n,isLoading:a,validateAndSubmit:e=>{if(!(()=>{var e;return b&&(null===b||void 0===b||null===(e=b.current)||void 0===e||e.validateFields(((e,t)=>{if(e)return!1}))),!0})())return;if(null!==i&&void 0!==i&&i.length&&("success"!==L||null===Z||void 0===Z||!Z.length))return void F({type:"error",content:"Invalid OAuth"});let t={},o="/api/v1/unstract/".concat(null===U||void 0===U?void 0:U.orgId,"/");if(h===Object.keys(r.z0)[0]){const n={...e};delete n.connectorName,t={connector_id:s,connector_metadata:n},o+="test_connectors/"}else{const n={...e};delete n.adapterName,t={adapter_id:s,adapter_metadata:n,adapter_type:u.toUpperCase()},o+="test_adapters/";try{H(z[u],{info:"Test connection was triggered: ".concat(j)})}catch(vc){}}(null===i||void 0===i?void 0:i.length)>0&&(t.connector_metadata={...t.connector_metadata,"oauth-key":Z});const n={method:"POST",url:o,headers:{"X-CSRFToken":null===U||void 0===U?void 0:U.csrfToken,"Content-Type":"application/json"},data:t};O(!0),w(n).then((e=>{var t;const o=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.is_valid;E(o),F(o?{type:"success",content:"Test connection successful"}:{type:"error",content:"Test connection failed"})})).catch((e=>{var t,o;const n=(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.message)||"Test connection failed";F(M(e,n))})).finally((()=>{O(!1)}))},formRef:b,isStateUpdateRequired:!0,children:(0,v.jsxs)(Pe.Z,{className:"config-row",children:[(0,v.jsx)(Ze.Z,{span:12,className:"config-col1",children:(0,v.jsx)(Bt,{block:!0,type:"primary",htmlType:"submit",className:"config-tc-btn",loading:C,children:"Test Connection"})}),(0,v.jsx)(Ze.Z,{span:12,className:"config-col2",children:(0,v.jsx)(Bt,{block:!0,type:"primary",onClick:()=>{if(!k)return void F({type:"error",content:"Please test the connection before submitting."});let e={},t="/api/v1/unstract/".concat(null===U||void 0===U?void 0:U.orgId,"/");if(h===Object.keys(r.z0)[0]){const n={...o},l=null===n||void 0===n?void 0:n.connectorName;delete n.connectorName,e={workflow:G,created_by:null===U||void 0===U?void 0:U.id,connector_id:s,connector_metadata:n,connector_type:u.toUpperCase(),connector_name:l},t+="connector/";try{H(q["".concat(y,":").concat(u)],{info:"Clicked on 'Submit' button",connector_name:j})}catch(vc){}}else{const n={...o},l=null===n||void 0===n?void 0:n.adapter_name;delete n.adapter_name,e={adapter_id:s,adapter_metadata:n,adapter_type:u.toUpperCase(),adapter_name:l},t+="adapter/";try{H(W[u],{info:"Clicked on 'Submit' button",adpater_name:j})}catch(vc){}}let n="POST";if(null!==m&&void 0!==m&&m.length&&(n="PUT",t+="".concat(m,"/")),(null===i||void 0===i?void 0:i.length)>0){const e=encodeURIComponent(Z);t+="?oauth-key=".concat(e)}const a={method:n,url:t,headers:{"Content-Type":"application/json","X-CSRFToken":null===U||void 0===U?void 0:U.csrfToken},data:e};P(!0),w(a).then((e=>{const t=null===e||void 0===e?void 0:e.data;if(r.z0.connectors.includes(u))return x({connector_instance:null===t||void 0===t?void 0:t.id,configuration:S},!0),void E(!1);t&&d(t,!!m),F({type:"success",content:"Successfully ".concat("POST"===n?"added":"updated"," connector")}),h===Object.keys(r.z0)[1]&&"POST"===n&&K(u),l(!1)})).catch((e=>{F(M(e))})).finally((()=>{P(!1)}))},disabled:!k,loading:D,children:"Submit"})})]})})]})}let Yt,Qt,Jt,$t,eo;try{Yt=Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/helper/transformLlmWhispererJsonSchema'");throw e.code="MODULE_NOT_FOUND",e}()),Qt=Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/helper/transformLlmWhispererJsonSchema'");throw e.code="MODULE_NOT_FOUND",e}()),Jt=Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/helper/constants'");throw e.code="MODULE_NOT_FOUND",e}()),$t=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/unstract-subscription-plan-store'");throw e.code="MODULE_NOT_FOUND",e}())),eo=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/hooks/useLlmWhispererAdapterSchema.js'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(vc){}function to(e){var t,o;let{selectedSourceId:n,selectedSourceName:l,setOpen:i,type:s,addNewItem:a,editItemId:d,metadata:c,handleUpdate:u,connDetails:m,connType:h,formDataConfig:x}=e;const[f,g]=(0,p.useState)({}),[j,y]=(0,p.useState)({}),[S,b]=(0,p.useState)(!1),[w,k]=(0,p.useState)(""),{sessionDetails:E}=N(),{setAlertDetails:C}=T(),O=ie(),D=_();let P,Z;try{var I,L;P=null===(I=eo)||void 0===I||null===(L=I.useLlmWhipererAdapterSchema())||void 0===L?void 0:L.transformLlmWhispererFormData}catch{}var A;null!==(t=$t)&&void 0!==t&&t.useUnstractSubscriptionPlanStore&&(Z=null===(A=$t)||void 0===A?void 0:A.useUnstractSubscriptionPlanStore((e=>{var t;return null===e||void 0===e||null===(t=e.unstractSubscriptionPlan)||void 0===t?void 0:t.planType})));const U=(0,p.useMemo)((()=>{var e;return Qt&&Yt&&Jt&&n===Qt&&Z===(null===(e=Jt)||void 0===e?void 0:e.PAID)}),[Qt,Yt,Jt,n,Z]);return(0,p.useEffect)((()=>{if(!U||!P)return;const e=P(j);JSON.stringify(e)!==JSON.stringify(j)&&y(e)}),[U,j]),(0,p.useEffect)((()=>{if(!n)return g({}),void k("");let e="/api/v1/unstract/".concat(null===E||void 0===E?void 0:E.orgId);r.z0.connectors.includes(s)?e+="/connector_schema/?id=".concat(n):e+="/adapter_schema/?id=".concat(n);const t={method:"GET",url:e};b(!0),O(t).then((e=>{const t=null===e||void 0===e?void 0:e.data;y(c||{}),g(U?Yt((null===t||void 0===t?void 0:t.json_schema)||{}):(null===t||void 0===t?void 0:t.json_schema)||{}),null!==t&&void 0!==t&&t.oauth?k(null===t||void 0===t?void 0:t.python_social_auth_backend):k("")})).catch((e=>{C(D(e)),i(!1)})).finally((()=>{b(!1)}))}),[n]),(0,p.useEffect)((()=>{var e;null!==d&&void 0!==d&&d.length&&c&&null!==(e=Object.keys(c))&&void 0!==e&&e.length&&y(c)}),[c]),n.includes("pcs|")?(0,v.jsx)(Ee.default.Text,{children:"Edit is not supported for this connector"}):f&&null!==(o=Object.keys(f))&&void 0!==o&&o.length?(0,v.jsx)(Vt,{spec:f,formData:j,setFormData:y,setOpen:i,oAuthProvider:w,selectedSourceId:n,isLoading:S,addNewItem:a,type:s,editItemId:d,sourceType:r.z0.connectors.includes(s)?Object.keys(r.z0)[0]:Object.keys(r.z0)[1],handleUpdate:u,connDetails:m,metadata:c,selectedSourceName:l,connType:h,formDataConfig:x}):(0,v.jsx)(tt,{text:"Failed to load the settings form"})}var oo=o(11730),no=o(88715),lo=o(48573),io=o.n(lo),so=o(48531);function ao(e){let{srcDetails:t,setSelectedSourceId:o,type:n}=e;const{posthogEventText:l,setPostHogCustomEvent:i}=Xt();return(0,v.jsx)(ze.Z,{hoverable:!(null!==t&&void 0!==t&&t.isDisabled),size:"small",type:"inner",bordered:!0,className:"ds-card ".concat(null!==t&&void 0!==t&&t.isDisabled?"disabled":""),onClick:()=>{if(null===t||void 0===t||!t.isDisabled){o(null===t||void 0===t?void 0:t.id);try{i(l[n],{info:"Clicked on the adapters card",adapter_name:null===t||void 0===t?void 0:t.name})}catch(vc){}}},children:(0,v.jsxs)("div",{className:"cover-container",children:[(null===t||void 0===t?void 0:t.isDisabled)&&(0,v.jsx)("div",{className:"disabled-overlay",children:(0,v.jsx)(Ee.default.Text,{strong:!0,children:"Coming Soon"})}),(0,v.jsx)("div",{className:"cover-img",children:(0,v.jsx)(so.Z,{src:null===t||void 0===t?void 0:t.icon,width:"80%",height:"auto",preview:!1})}),(0,v.jsx)("div",{className:"ds-card-name display-flex-center",children:(0,v.jsx)(Ee.default,{children:null===t||void 0===t?void 0:t.name})})]})})}function ro(e){let{setSelectedSourceId:t,open:o,sourcesList:n,type:l}=e;const[i,s]=(0,p.useState)([]),[a,d]=(0,p.useState)("");(0,p.useEffect)((()=>{r(a)}),[n]),(0,p.useEffect)((()=>{const e=[...n].filter((e=>{var t;const o=null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.toUpperCase(),n=a.toUpperCase();return o.includes(n)}));s(e)}),[n]);const r=io()((e=>{var t;const o=null===e||void 0===e||null===(t=e.toUpperCase())||void 0===t?void 0:t.trim(),l=null===n||void 0===n?void 0:n.filter((e=>{var t;return(null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.toUpperCase()).includes(o)}));s(l),d(e)}),600);return(0,v.jsxs)("div",{className:"list-of-srcs",children:[(0,v.jsx)("div",{className:"searchbox",children:(0,v.jsx)(_t.default,{placeholder:"Search",prefix:(0,v.jsx)(oo.Z,{className:"search-outlined"}),onChange:e=>{const{value:t}=e.target;r(t)}})}),(0,v.jsx)("div",{className:"list",children:(0,v.jsx)(no.Z,{grid:{gutter:16,column:4},dataSource:i,renderItem:e=>(0,v.jsx)(no.Z.Item,{children:(0,v.jsx)(ao,{srcDetails:e,setSelectedSourceId:t,type:l})})})})]})}function co(e){let{open:t,setOpen:o,type:n,addNewItem:l,editItemId:i,setEditItemId:s}=e;const[a,d]=(0,p.useState)(null),[c,u]=(0,p.useState)({}),[m,h]=(0,p.useState)({}),[x,f]=(0,p.useState)(""),{sessionDetails:g}=N(),{setAlertDetails:j}=T(),y=ie(),S=_(),[b,w]=(0,p.useState)(!1),[k,E]=(0,p.useState)([]),C={EMBEDDING:["huggingface|90ec9ec2-1768-4d69-8fb1-c88b95de5e5a"],LLM:["replicate|2715ce84-05af-4ab4-b8e9-67ac3211b81e"],VECTOR_DB:[]};(0,p.useEffect)((()=>{const e=null!==i&&void 0!==i&&i.length?"Edit":"Add";h({input:e+" Data Source",output:e+" Data Destination",llm:e+" LLM",vector_db:e+" Vector DB",embedding:e+" Embedding",x2text:e+" Text Extractor"}),null!==i&&void 0!==i&&i.length&&O()}),[i]),(0,p.useEffect)((()=>{t||setTimeout((()=>{d(null),s(null)}),500),n&&null!==n&&D()}),[t]),(0,p.useEffect)((()=>{const e=k.find((e=>(null===e||void 0===e?void 0:e.id)===a));f(null===e||void 0===e?void 0:e.name)}),[a]);const O=()=>{const e=r.z0.connectors.includes(n);let t="/api/v1/unstract/".concat(null===g||void 0===g?void 0:g.orgId);t+=e?"/connector/".concat(i,"/"):"/adapter/".concat(i,"/");y({method:"GET",url:t}).then((t=>{o(!0);const n=null===t||void 0===t?void 0:t.data;if(e){d(null===n||void 0===n?void 0:n.connector_id);const e=null===n||void 0===n?void 0:n.connector_metadata;e.connectorName=null===n||void 0===n?void 0:n.connector_name,u(e)}else{d(null===n||void 0===n?void 0:n.adapter_id);const e=null===n||void 0===n?void 0:n.adapter_metadata;e.adapter_name=null===n||void 0===n?void 0:n.adapter_name,u(e)}})).catch((e=>{j(S(e)),o(!1),s(null)}))},D=()=>{let e="/api/v1/unstract/".concat(null===g||void 0===g?void 0:g.orgId);n&&r.z0.connectors.includes(n)?e+="/supported_connectors/?type=".concat(null===n||void 0===n?void 0:n.toUpperCase()):e+="/supported_adapters/?adapter_type=".concat(null===n||void 0===n?void 0:n.toUpperCase());const t={method:"GET",url:e};w(!0),E([]),y(t).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||[],o=null===t||void 0===t?void 0:t.map((e=>{var t;return{...e,isDisabled:null===(t=C[null===e||void 0===e?void 0:e.adapter_type])||void 0===t?void 0:t.includes(null===e||void 0===e?void 0:e.id)}}));E(o||[])})).catch((e=>{j(S(e))})).finally((()=>{w(!1)}))};return(0,v.jsx)($e.Z,{open:t,onCancel:()=>{o(!1),u(null)},maskClosable:!1,title:m[n],width:null!==a&&void 0!==a&&a.length?500:1100,centered:!0,footer:null,closable:!0,children:a?(0,v.jsx)(to,{selectedSourceId:a,selectedSourceName:x,setOpen:o,type:n,addNewItem:l,editItemId:i,metadata:c}):b?(0,v.jsx)(At,{}):(0,v.jsx)(ro,{setSelectedSourceId:d,open:t,sourcesList:k,type:n})})}const{Content:uo}=Ke.default;function po(){const e=(0,c.s0)(),{sessionDetails:t}=N(),{orgName:o,adapters:n}=t,[l,s]=(0,p.useState)(!1),[a,d]=(0,p.useState)(null),[u,m]=(0,p.useState)(null),h="/".concat(o,"/").concat(r.DK),[x,f]=(0,p.useState)(n||[]);(0,p.useEffect)((()=>{(0,r.IU)(x)&&e(h)}),[x]);const g=[{id:1,title:"CONNECT AN LLM",icon:Ve,type:"llm",description:"Unstract harnesses Large Language Models (LLMs) to organize and analyze vast unstructured data, offering support for diverse LLMs from multiple providers."},{id:2,title:"CONNECT A VECTOR DATABASE",icon:Ye,type:"vector_db",description:"Vector Databases locate text segments within unstructured source data, facilitating the retrieval of pertinent information for LLMs to process queries or structure unstructured data efficiently."},{id:3,title:"CHOOSE AN EMBEDDING MODEL",icon:Qe,type:"embedding",description:"Embedding models semantically map unstructured data for precise retrieval, impacting the quality of data organization and search relevance."},{id:4,title:"CONNECT A TEXT EXTRACTOR",icon:Je,type:"x2text",description:"The Text Extractor extracts text from diverse unstructured documents, optimizing input for LLM comprehension, including OCR as needed, ensuring optimal understanding of content."}];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(uo,{className:"onboard-content",children:(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{src:Xe.Z,alt:"Logo",className:"landing-logo"}),(0,v.jsx)("h1",{className:"uppercase-text",children:"You're 4 steps away from nirvana"}),(0,v.jsx)(Be.Z,{direction:"vertical",children:g.map(((e,t)=>(0,v.jsxs)(ze.Z,{className:"card-style",children:[(0,v.jsx)("div",{className:"card-container",children:(0,v.jsx)("div",{className:"circle",children:(0,v.jsx)("div",{className:"circle-number",children:e.id})})}),(0,v.jsxs)(Pe.Z,{align:"middle",children:[(0,v.jsx)(Ze.Z,{span:3,align:"",justify:"",children:(0,v.jsx)("div",{className:"",children:(0,v.jsx)("img",{src:e.icon,alt:"Logo",className:"icon-overlay"})})}),(0,v.jsx)(Ze.Z,{span:17,children:(0,v.jsxs)(Be.Z,{direction:"vertical",style:{marginTop:"-5px"},children:[(0,v.jsx)("h3",{className:"text-title-style",children:e.title}),(0,v.jsx)(Ee.default.Text,{className:"text-description-style",children:e.description})]})}),(0,v.jsx)(Ze.Z,{span:4,align:"center",justify:"center",children:null!==x&&void 0!==x&&x.includes(e.type)?(0,v.jsxs)("div",{children:[(0,v.jsx)(Ge.Z,{className:"configured-icon"}),(0,v.jsx)("span",{className:"configured-text",children:"Configured"})]}):(0,v.jsx)(i.ZP,{className:"button-style",onClick:()=>(e=>{m(e),s(!0)})(e.type),children:"Connect"})})]})]},e.id)))}),(0,v.jsxs)("div",{className:"later-div-style",children:[(0,v.jsxs)("div",{className:"help-text",children:["Need help? Here's our\xa0",(0,v.jsx)("a",{href:"https://docs.unstract.com/",target:"_blank",rel:"noreferrer",className:"link-color",children:"quick start guide\xa0"}),"to help you get going."]}),(0,v.jsx)(Bt,{type:"primary",onClick:()=>e(h),children:"Complete Later >"})]})]})}),(0,v.jsx)(co,{open:l,setOpen:s,type:u,addNewItem:(e,t)=>{const o=null===e||void 0===e?void 0:e.adapter_type.toLowerCase();f([...x,o])},editItemId:a,setEditItemId:d})]})}function vo(){return(0,v.jsx)(po,{})}function mo(){return(0,v.jsx)(Ke.default,{className:"container",children:(0,v.jsx)(c.j3,{})})}function ho(e){let{children:t}=e;return(0,v.jsx)("div",{className:"island-layout",children:(0,v.jsx)("div",{children:t})})}var xo=o(64248),fo=o(2603),go=o(99372);function jo(e){let{title:t,enableSearch:o,CustomButtons:n,setSearchList:l,previousRoute:s,segmentFilter:a,segmentOptions:d,onSearch:r}=e;const u=(0,c.s0)(),p=(0,w.debounce)((e=>{let{target:{value:t}}=e;r(t,l)}),600);return(0,v.jsxs)(Pe.Z,{align:"middle",justify:"space-between",className:"searchNav",children:[(0,v.jsxs)(Ze.Z,{children:[s&&(0,v.jsx)(i.ZP,{type:"text",shape:"circle",icon:(0,v.jsx)(go.Z,{}),onClick:()=>u(s)}),t&&(0,v.jsx)(Ee.default,{style:{fontWeight:600,fontSize:"18px",display:"inline",lineHeight:"24px"},children:t}),a&&d&&(0,v.jsx)(xo.Z,{options:d,onChange:a,className:"tool-bar-segment"})]}),(0,v.jsxs)(Ze.Z,{children:[o&&(0,v.jsx)(fo.Z,{className:"api-search-input",placeholder:"Search by name",onChange:p,allowClear:!0}),n&&(0,v.jsx)(n,{})]})]})}var yo=o(14520),_o=o(49367),So=o(91082),bo=o(61431),No=o(29529),wo=o(31752),ko=o(19951),To=o(28624),Eo=o(82622);function Co(e){let{listOfTools:t,handleEdit:o,handleDelete:n,handleShare:l,titleProp:i,descriptionProp:s,iconProp:a,idProp:d,centered:r,isClickable:u=!0,showOwner:p=!0,type:m}=e;const h=(0,c.s0)(),{sessionDetails:x}=N(),f=(e,t,o)=>{e.stopPropagation(),l(e,t,o)},g=e=>{let t=null;return t=a&&e[a].length>4?(0,v.jsxs)("div",{className:"adapter-cover-img",children:[(0,v.jsx)(so.Z,{src:e[a],preview:!1,className:"fit-cover"}),(0,v.jsx)(Ee.default.Text,{className:"adapters-list-title",children:e[i]})]}):a?(0,v.jsx)(Ee.default.Text,{className:"adapters-list-title",children:"".concat(e[a]," ").concat(e[i])}):(0,v.jsx)(Ee.default.Text,{className:"adapters-list-title",children:e[i]}),(0,v.jsxs)(yo.Z,{gap:20,align:"center",justify:"space-between",className:"list-view-container",children:[(0,v.jsxs)("div",{className:"list-view-content",children:[(0,v.jsx)("div",{className:"adapters-list-title-container display-flex-left",children:t}),p&&(0,v.jsxs)("div",{className:"adapters-list-profile-container",children:[(0,v.jsx)(_o.C,{size:20,className:"adapters-list-user-avatar",icon:(0,v.jsx)(No.Z,{})}),(0,v.jsx)(Ee.default.Text,{disabled:!0,className:"adapters-list-user-prefix",children:"Owned By:"}),(0,v.jsx)(Ee.default.Text,{className:"shared-username",children:null!==e&&void 0!==e&&e.created_by_email?(null===e||void 0===e?void 0:e.created_by_email)===x.email?"Me":null===e||void 0===e?void 0:e.created_by_email:"-"})]})]}),(0,v.jsxs)("div",{className:"action-button-container",onClick:e=>e.stopPropagation(),role:"none",children:[(0,v.jsx)(wo.Z,{onClick:t=>o(t,e),className:"action-icon-buttons edit-icon"},"".concat(e.id,"-edit")),l&&(0,v.jsx)(ko.Z,{className:"action-icon-buttons",onClick:t=>f(t,e,!0)},"".concat(e.id,"-share")),(0,v.jsx)(So.Z,{title:"Delete the ".concat(m),description:"Are you sure to delete ".concat(e[i]),okText:"Yes",cancelText:"No",icon:(0,v.jsx)(To.Z,{}),onConfirm:t=>{((e,t)=>{e.stopPropagation(),n(e,t)})(t,e)},children:(0,v.jsx)(Ee.default.Text,{children:(0,v.jsx)(Eo.Z,{className:"action-icon-buttons delete-icon"})})},"".concat(e.id,"-delete"))]})]})};return(0,v.jsx)(no.Z,{size:"large",dataSource:t,style:{marginInline:"4px"},pagination:{position:"bottom",align:"end",size:"small"},className:"list-view-wrapper",renderItem:e=>(0,v.jsx)(no.Z.Item,{onClick:t=>{u?h("".concat(e[d])):f(t,e,!1)},className:"cur-pointer ".concat(r?"centered":""),children:(0,v.jsx)(no.Z.Item.Meta,{className:"list-item-desc",title:g(e),description:(0,v.jsx)(Ee.default.Text,{type:"secondary",ellipsis:!0,children:(0,v.jsx)(bo.Z,{title:e[s],children:e[s]})})})},null===e||void 0===e?void 0:e.id)})}function Oo(e){let{isLoading:t,isEmpty:o,listOfTools:n,setOpenAddTool:l,handleEdit:i,handleDelete:s,titleProp:a,descriptionProp:d,iconProp:r,idProp:c,centered:u,isClickable:p=!0,handleShare:m,showOwner:h,type:x}=e;if(t)return(0,v.jsx)(At,{});if(o){let e="No tools available",t="New Tool";return x&&(e="No ".concat(x.toLowerCase()," available"),t=x),(0,v.jsx)(tt,{text:e,btnText:t,handleClick:()=>l(!0)})}return null!==n&&void 0!==n&&n.length?(0,v.jsx)(Co,{listOfTools:n,handleEdit:i,handleDelete:s,descriptionProp:d,iconProp:r,titleProp:a,idProp:c,centered:u,isClickable:p,handleShare:m,showOwner:h,type:x}):(0,v.jsx)("div",{className:"center",children:(0,v.jsx)(Ee.default.Title,{level:5,children:"No results found for this search"})})}function Do(e){let{open:t,setOpen:o,adapter:n,permissionEdit:l,loading:i,allUsers:s,onApply:a,isSharableToOrg:d=!1}=e;const[r,c]=(0,p.useState)([]),[u,m]=(0,p.useState)([]),[h,x]=(0,p.useState)(!1);(0,p.useEffect)((()=>{if(l&&n&&null!==n&&void 0!==n&&n.shared_users){const e=s.filter((e=>{var t,o,l,i,s,a,c,u;return void 0!==(null===n||void 0===n||null===(t=n.created_by)||void 0===t?void 0:t.id)?d?!r.includes(null===e||void 0===e||null===(o=e.id)||void 0===o?void 0:o.toString()):(null===e||void 0===e?void 0:e.id)!==(null===n||void 0===n||null===(l=n.created_by)||void 0===l||null===(i=l.id)||void 0===i?void 0:i.toString())&&!r.includes(null===e||void 0===e||null===(s=e.id)||void 0===s?void 0:s.toString()):d?!r.includes(null===e||void 0===e||null===(a=e.id)||void 0===a?void 0:a.toString()):(null===e||void 0===e?void 0:e.id)!==(null===n||void 0===n||null===(c=n.created_by)||void 0===c?void 0:c.toString())&&!r.includes(null===e||void 0===e||null===(u=e.id)||void 0===u?void 0:u.toString())}));m(e),x((null===n||void 0===n?void 0:n.shared_to_org)||!1)}}),[l,n,s,r]),(0,p.useEffect)((()=>{null!==n&&void 0!==n&&n.shared_users&&c(n.shared_users.map((e=>void 0!==(null===e||void 0===e?void 0:e.id)?e.id.toString():null===e||void 0===e?void 0:e.toString())))}),[n,s]);let f;return f=h?(0,v.jsx)(Ee.default.Text,{children:"Shared with everyone"}):r.length>0?(0,v.jsx)(no.Z,{dataSource:r.map((e=>{const t=s.find((t=>(null===t||void 0===t?void 0:t.id.toString())===e.toString()));return{id:null===t||void 0===t?void 0:t.id,email:null===t||void 0===t?void 0:t.email}})),renderItem:e=>(0,v.jsx)(no.Z.Item,{extra:l&&(0,v.jsx)("div",{onClick:e=>e.stopPropagation(),role:"none",children:(0,v.jsx)(So.Z,{title:"Delete the User",description:"Are you sure to remove ".concat(null===e||void 0===e?void 0:e.email,"?"),okText:"Yes",cancelText:"No",icon:(0,v.jsx)(To.Z,{}),onConfirm:t=>{return o=null===e||void 0===e?void 0:e.id,void c((e=>e.filter((e=>e!==o))));var o},children:(0,v.jsx)(Ee.default.Text,{children:(0,v.jsx)(Eo.Z,{className:"action-icon-buttons"})})},"".concat(e.id,"-delete"))}),children:(0,v.jsx)(no.Z.Item.Meta,{title:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(_o.C,{className:"shared-user-avatar",icon:(0,v.jsx)(No.Z,{})}),(0,v.jsx)(Ee.default.Text,{className:"shared-username",children:e.email})]})})})}):(0,v.jsx)(Ee.default,{children:"Not shared with anyone yet"}),n&&(0,v.jsx)($e.Z,{title:"Share Users",open:t,onCancel:()=>o(!1),maskClosable:!1,centered:!0,closable:!0,okText:"Apply",onOk:()=>a(r,n,h),cancelButtonProps:!l&&{style:{display:"none"}},okButtonProps:!l&&{style:{display:"none"}},className:"share-permission-modal",children:i?(0,v.jsx)(At,{}):(0,v.jsxs)(v.Fragment,{children:[d&&s.length>1&&(0,v.jsx)(gt.Z,{checked:h,onChange:e=>{return t=e.target.checked,void x(t);var t},className:"share-per-checkbox",children:"Share with everyone in current org"}),l&&!h&&(0,v.jsx)(xt.default,{filterOption:(e,t)=>{var o;return(null!==(o=null===t||void 0===t?void 0:t.label)&&void 0!==o?o:"").toLowerCase().includes(e.toLowerCase())},showSearch:!0,size:"middle",placeholder:"Search",value:null,className:"share-permission-search",onChange:e=>{r.includes(e)||c([...r,e])},options:u.map((e=>({label:e.email,value:e.id}))),children:u.map((e=>(0,v.jsx)(xt.default.Option,{value:null===e||void 0===e?void 0:e.id,children:null===e||void 0===e?void 0:e.email},null===e||void 0===e?void 0:e.id)))}),(0,v.jsx)(Ee.default.Title,{level:5,children:"Shared with"}),f]})})}const Po={llm:"LLMs",vector_db:"Vector DBs",embedding:"Embeddings",x2text:"Text Extractor",ocr:"OCR"},Zo={llm:"New LLM Profile",vector_db:"New Vector DB Profile",embedding:"New Embedding Profile",x2text:"New Text Extractor",ocr:"New OCR"};function Io(e){let{type:t}=e;const[o,n]=(0,p.useState)([]),[l,i]=(0,p.useState)(!1),[s,a]=(0,p.useState)(!1),[d,r]=(0,p.useState)(null),[c,u]=(0,p.useState)([]),[m,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(!1),[y,S]=(0,p.useState)(null),{sessionDetails:b}=N(),{setAlertDetails:w}=T(),k=ie(),E=_(),{posthogEventText:C,setPostHogCustomEvent:O}=Xt();(0,p.useEffect)((()=>{n([]),t&&D()}),[t]);const D=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===b||void 0===b?void 0:b.orgId,"/adapter?adapter_type=").concat(t.toUpperCase())};i(!0),k(e).then((e=>{n(null===e||void 0===e?void 0:e.data)})).catch((e=>{w(E(e))})).finally((()=>{i(!1)}))},P=()=>{a(!0);const e={method:"GET",url:"/api/v1/unstract/".concat(null===b||void 0===b?void 0:b.orgId,"/users/")};k(e).then((e=>{var t;const o=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.members)||[];u(o.map((e=>({id:null===e||void 0===e?void 0:e.id,email:null===e||void 0===e?void 0:e.email}))))})).catch((e=>{w(E(e,"Failed to load"))})).finally((()=>{a(!1)}))},Z=()=>{h(!0);try{O(C[t],{info:"Clicked on '+ ".concat(Zo[t],"' button")})}catch(vc){}};return(0,v.jsxs)("div",{className:"plt-tool-settings-layout",children:[(0,v.jsx)(jo,{title:Po[t],CustomButtons:()=>(0,v.jsx)(Bt,{type:"primary",onClick:Z,icon:(0,v.jsx)(et.Z,{}),children:Zo[t]})}),(0,v.jsx)(ho,{children:(0,v.jsx)("div",{className:"plt-tool-settings-layout-2",children:(0,v.jsx)("div",{className:"plt-tool-settings-body",children:(0,v.jsx)(Oo,{listOfTools:o,isLoading:l,handleDelete:(e,t)=>{const l={method:"DELETE",url:"/api/v1/unstract/".concat(null===b||void 0===b?void 0:b.orgId,"/adapter/").concat(null===t||void 0===t?void 0:t.id,"/"),headers:{"X-CSRFToken":null===b||void 0===b?void 0:b.csrfToken}};i(!0),k(l).then((e=>{const l=o.filter((e=>(null===e||void 0===e?void 0:e.id)!==(null===t||void 0===t?void 0:t.id)));n(l),w({type:"success",content:"Successfully deleted"})})).catch((e=>{w(E(e))})).finally((()=>{i(!1)}))},setOpenAddTool:h,handleEdit:(e,t)=>S(null===t||void 0===t?void 0:t.id),idProp:"id",titleProp:"adapter_name",descriptionProp:"description",iconProp:"icon",isEmpty:!(null!==o&&void 0!==o&&o.length),centered:!0,isClickable:!1,handleShare:(e,t,o)=>{const n={method:"GET",url:"/api/v1/unstract/".concat(null===b||void 0===b?void 0:b.orgId,"/adapter/users/").concat(t.id,"/"),headers:{"X-CSRFToken":null===b||void 0===b?void 0:b.csrfToken}};a(!0),P(),k(n).then((e=>{f(!0),r(null===e||void 0===e?void 0:e.data),j(o)})).catch((e=>{w(E(e))})).finally((()=>{a(!1)}))},showOwner:!0,type:"Adapter"})})})}),(0,v.jsx)(co,{open:m,setOpen:h,type:t,addNewItem:(e,t)=>{if(t){const t=[...o].map((t=>((null===t||void 0===t?void 0:t.id)!==(null===e||void 0===e?void 0:e.id)||(t.adapter_name=null===e||void 0===e?void 0:e.adapter_name),t)));n(t)}else{const t=[...o];t.push(e),n(t)}},editItemId:y,setEditItemId:S}),(0,v.jsx)(Do,{open:x,setOpen:f,adapter:d,permissionEdit:g,loading:s,allUsers:c,onApply:(e,t)=>{const o={method:"PATCH",url:"/api/v1/unstract/".concat(null===b||void 0===b?void 0:b.orgId,"/adapter/").concat(null===t||void 0===t?void 0:t.id,"/"),headers:{"X-CSRFToken":null===b||void 0===b?void 0:b.csrfToken},data:{shared_users:e}};k(o).then((e=>{f(!1)})).catch((e=>{w(E(e,"Failed to load"))}))}})]})}function Lo(e){let{type:t}=e;return(0,v.jsx)(Io,{type:t})}function Ao(){const e=(0,c.s0)(),{sessionDetails:t}=N(),{setPostHogCustomEvent:o}=Xt();return(0,v.jsx)("div",{className:"settings-bg-col",children:(0,v.jsx)(ho,{children:(0,v.jsxs)("div",{className:"settings-layout",children:[(0,v.jsx)("div",{className:"settings-head",children:(0,v.jsx)(Ee.default.Text,{className:"settings-head-typo",children:"General Settings"})}),(0,v.jsx)("div",{className:"settings-plt",children:(0,v.jsx)(Ee.default.Link,{className:"settings-plt-typo",strong:!0,onClick:()=>e("platform"),children:"Platform Settings"})}),(0,v.jsx)("div",{className:"settings-plt",children:(0,v.jsx)(Ee.default.Link,{className:"settings-plt-typo",strong:!0,onClick:()=>e("/".concat(null===t||void 0===t?void 0:t.orgName,"/users")),children:"User Management"})}),(0,v.jsx)("div",{className:"settings-plt",children:(0,v.jsx)(Ee.default.Link,{className:"settings-plt-typo",strong:!0,onClick:()=>{e("triad");try{o("intent_select_default_triad",{info:"Clicked on 'Default Triad' button"})}catch(vc){}},children:"Default Triad"})}),(null===t||void 0===t?void 0:t.isPlatformAdmin)&&(0,v.jsx)("div",{className:"settings-plt",children:(0,v.jsx)(Ee.default.Link,{className:"settings-plt-typo",strong:!0,onClick:()=>e("admin"),children:"Admin settings"})}),(0,v.jsx)("div",{className:"settings-plt",children:(0,v.jsx)(Ee.default.Link,{className:"settings-plt-typo",strong:!0,onClick:()=>e("review"),children:"Human In The Loop Settings"})})]})})})}function Uo(){return(0,v.jsx)(Ao,{})}var Fo=o(23414),Mo=o(74424),Ro=o(77128);function zo(e){let{children:t,handleConfirm:o,title:n,content:l,okText:i,cancelText:s,isDisabled:a}=e;const[d,r]=$e.Z.useModal();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Be.Z,{onClick:()=>{a?o():d.confirm({title:n||"Are you sure?",content:l||"",okText:i||"Confirm",cancelText:s||"Cancel",onOk:o,centered:!0})},children:t}),r]})}zo.defaultProps={isDisabled:!1};const Wo=[{id:null,keyName:"Key #1",key:"",isActive:!0},{id:null,keyName:"Key #2",key:"",isActive:!1}];function qo(){const[e,t]=(0,p.useState)(null),[o,n]=(0,p.useState)(Wo),[l,s]=(0,p.useState)(null),[a,d]=(0,p.useState)(null),{sessionDetails:r}=N(),{setAlertDetails:u}=T(),m=ie(),h=(0,c.s0)(),x=_(),{setPostHogCustomEvent:f}=Xt();(0,p.useEffect)((()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===r||void 0===r?void 0:r.orgId,"/platform/keys/")};m(e).then((e=>{const l=null===e||void 0===e?void 0:e.data;if(0===(null===l||void 0===l?void 0:l.length))return;const i=o.map(((e,o)=>{const n=null===e||void 0===e?void 0:e.keyName,i=l.find((e=>(null===e||void 0===e?void 0:e.key_name)===n));return i?(!0===(null===i||void 0===i?void 0:i.is_active)&&t(o),{id:null===i||void 0===i?void 0:i.id,keyName:null===i||void 0===i?void 0:i.key_name,key:null===i||void 0===i?void 0:i.key,isActive:null===i||void 0===i?void 0:i.is_active}):{id:null,keyName:"Key #"+(o+1),key:"",isActive:!1}}));1===(null===i||void 0===i?void 0:i.length)&&i.push({id:null,keyName:"Key #2",key:"",isActive:!1}),n(i)})).catch((e=>{u(x(e,"Failed to get the keys"))}))}),[]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"plt-set-head",children:[(0,v.jsx)(i.ZP,{size:"small",type:"text",children:(0,v.jsx)(go.Z,{onClick:()=>h(-1)})}),(0,v.jsx)(Ee.default.Text,{className:"plt-set-head-typo",children:"Platform Settings"})]}),(0,v.jsx)("div",{className:"plt-set-layout",children:(0,v.jsx)(ho,{children:(0,v.jsx)("div",{className:"plt-set-layout-2",children:(0,v.jsx)("div",{children:o.map(((c,p)=>{var h;return(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"plt-set-key-head",children:(0,v.jsxs)(Pe.Z,{children:[(0,v.jsx)(Ze.Z,{children:(0,v.jsx)("div",{className:"plt-set-key-head-col-1",children:(0,v.jsx)(Ee.default.Text,{children:null===c||void 0===c?void 0:c.keyName})})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsx)("div",{className:"plt-set-key-head-col-2",children:(0,v.jsx)(Mo.ZP,{checked:(null===c||void 0===c?void 0:c.id)&&e===p,disabled:null===(null===c||void 0===c?void 0:c.id),onClick:()=>(n=>{const l=e;t(n);const i={...o[n]};if(null===(null===i||void 0===i?void 0:i.id))return;const s={method:"PUT",url:"/api/v1/unstract/".concat(null===r||void 0===r?void 0:r.orgId,"/platform/keys/").concat(null===i||void 0===i?void 0:i.id,"/"),headers:{"X-CSRFToken":null===r||void 0===r?void 0:r.csrfToken,"Content-Type":"application/json"},data:{action:"ACTIVATE"}};m(s).catch((e=>{t(l),u(x(e,"Failed to set active key"))}))})(p),children:"Active Key"})})})]})}),(0,v.jsx)("div",{children:(0,v.jsxs)(Pe.Z,{gutter:10,children:[(0,v.jsx)(Ze.Z,{children:(0,v.jsx)("div",{className:"plt-set-key-display",children:(0,v.jsx)(_t.default,{size:"small",value:o[p].key,suffix:(0,v.jsx)(Fo.Z,{onClick:()=>{return e=o[p].key,void navigator.clipboard.writeText(e).then((()=>{u({type:"success",content:"Key copied to clipboard"})})).catch((e=>{u({type:"error",content:"Copy failed"})}));var e}})})})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsx)(i.ZP,{size:"small",loading:l===p,onClick:()=>(t=>{var l;const i={...o[t]},a={key_name:null===i||void 0===i?void 0:i.keyName},d="/api/v1/unstract/".concat(null===r||void 0===r?void 0:r.orgId,"/platform/keys/");let c="POST";(null===i||void 0===i||null===(l=i.id)||void 0===l?void 0:l.length)>0?(a.id=i.id,c="PUT"):a.is_active=e===t;try{var p;(null===i||void 0===i||null===(p=i.id)||void 0===p?void 0:p.length)>0?f("intent_api_key_refreshed",{info:"API Key has been refreshed"}):f("intent_api_key_generation",{info:"API Key has been generated"})}catch(vc){}const v={method:c,url:d,headers:{"X-CSRFToken":null===r||void 0===r?void 0:r.csrfToken,"Content-Type":"application/json"},data:a};s(t),m(v).then((e=>{const l=null===e||void 0===e?void 0:e.data,i=[...o];i[t].id=(null===l||void 0===l?void 0:l.id)||null,i[t].key=(null===l||void 0===l?void 0:l.key)||null,n(i)})).catch((e=>{u(x(e,"Failed to generate the key"))})).finally((()=>{s(null)}))})(p),children:(null===c||void 0===c||null===(h=c.id)||void 0===h?void 0:h.length)>0?"Refresh":"Generate"})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsx)(zo,{handleConfirm:()=>(e=>{const t={...o[e]};if(null===(null===t||void 0===t?void 0:t.id))return;const l={method:"DELETE",url:"/api/v1/unstract/".concat(null===r||void 0===r?void 0:r.orgId,"/platform/keys/").concat(null===t||void 0===t?void 0:t.id,"/"),headers:{"X-CSRFToken":null===r||void 0===r?void 0:r.csrfToken}};d(e),m(l).then((()=>{const t=[...o];t[e].id=null,t[e].key="",n(t)})).catch((e=>{u(x(e,"Failed to delete"))})).finally((()=>{d(null)}))})(p),content:"Want to delete this platform key? This action cannot be undone.",okText:"Delete",children:(0,v.jsx)(i.ZP,{size:"small",disabled:null===(null===c||void 0===c?void 0:c.id),loading:a===p,children:(0,v.jsx)(Eo.Z,{})})})})]})})]}),p<(null===o||void 0===o?void 0:o.length)-1&&(0,v.jsx)(Ro.Z,{})]},null===c||void 0===c?void 0:c.keyName)}))})})})})]})}function Ho(){return(0,v.jsx)(ho,{children:(0,v.jsx)("div",{className:"unauth-container",children:(0,v.jsx)(Ee.default,{className:"unauth-text",children:"Sorry, you dont have access to this page. Please contact the administrator for assistance."})})})}const Go=()=>{const{sessionDetails:e}=N(),t=null===e||void 0===e?void 0:e.isAdmin,o=null===e||void 0===e?void 0:e.orgName;return t?"mock_org"===o?(0,v.jsx)(h,{}):(0,v.jsx)(c.j3,{}):(0,v.jsx)(Ho,{})};var Ko=o(75033),Bo=o(23605),Xo=o(41583),Vo=o(11609);function Yo(e){let{title:t,enableSearch:o,searchData:n,setFilteredUserList:l,children:i}=e;const s=(0,c.s0)(),a=io()((e=>{let{target:{value:t}}=e;d(t)}),600),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===(null===e||void 0===e?void 0:e.trim()))return void l(n);const t=[...n].filter((t=>{var o;const n=null===t||void 0===t||null===(o=t.email)||void 0===o?void 0:o.toLowerCase(),l=e.toLowerCase();return n.includes(l)}));l(t)};return(0,v.jsxs)(Pe.Z,{align:"middle",justify:"space-between",className:"search-nav",children:[(0,v.jsxs)(Ze.Z,{children:[(0,v.jsx)(go.Z,{onClick:()=>s(-1)}),(0,v.jsx)(Ee.default,{className:"topbar-title",children:t})]}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)("div",{className:"invite-user-search",children:[o&&(0,v.jsx)(_t.default,{placeholder:"Search Users",onChange:a}),i]})})]})}function Qo(){const e=ie(),{sessionDetails:t}=N(),o=(0,c.s0)(),n=_(),{setPostHogCustomEvent:l}=Xt(),[s,a]=(0,p.useState)([]),[d,r]=(0,p.useState)(s),{setAlertDetails:u}=T(),[m,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(),[y,S]=(0,p.useState)(!1),{Text:b}=Ee.default,w=async()=>{try{var o;S(!0);const n={method:"GET",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/users/")},l=await e(n),i=(null===l||void 0===l||null===(o=l.data)||void 0===o?void 0:o.members)||[];a(i.map((e=>({key:e.id,email:e.email,role:e.role}))))}catch(vc){u(n(vc,"Failed to load"))}finally{S(!1)}},k=[{key:"1",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>o("/".concat(null===t||void 0===t?void 0:t.orgName,"/users/edit"),{state:g}),children:[(0,v.jsx)("div",{children:(0,v.jsx)(wo.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Edit"})})]})},{key:"2",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>{h(!0)},children:[(0,v.jsx)("div",{children:(0,v.jsx)(Eo.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Delete"})})]})}],E=[{title:"Email",dataIndex:"email"},{title:"Role",dataIndex:"role"}],C={title:"Actions",align:"center",render:(e,t)=>(0,v.jsx)(Xo.Z,{menu:{items:k},trigger:["click"],placement:"bottomLeft",children:(0,v.jsx)(Ko.Z,{rotate:90,style:{cursor:"pointer"},onClick:()=>j(t)})})},O=null!==t&&void 0!==t&&t.provider?E:[...E,C];return(0,p.useEffect)((()=>{w()}),[]),(0,p.useEffect)((()=>{r(s)}),[s]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(Yo,{enableSearch:!0,title:"Manage Users",searchData:s,setFilteredUserList:r,children:[!(null!==t&&void 0!==t&&t.provider)&&(0,v.jsx)(Bt,{type:"primary",icon:(0,v.jsx)(et.Z,{}),onClick:()=>{o("/".concat(null===t||void 0===t?void 0:t.orgName,"/users/invite"));try{l("intent_add_user",{info:"Clicked on '+ Invite User' button"})}catch(vc){}},children:"Invite User"}),(0,v.jsx)(i.ZP,{shape:"circle",icon:(0,v.jsx)(Bo.Z,{}),onClick:w,className:"user-reload-button"})]}),(0,v.jsx)("div",{className:"user-bg-col",children:(0,v.jsx)(ho,{children:(0,v.jsx)("div",{className:"user-table",children:(0,v.jsx)(Vo.Z,{columns:O,dataSource:d,size:"small",loading:{indicator:(0,v.jsx)(At,{}),spinning:y}})})})}),(0,v.jsxs)($e.Z,{title:"Delete User",open:m,onOk:async()=>{const o={method:"DELETE",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/users/"),data:{emails:[null===g||void 0===g?void 0:g.email]},headers:{"X-CSRFToken":null===t||void 0===t?void 0:t.csrfToken,"Content-Type":"application/json"}};f(!0),e(o).then((e=>{u({type:"success",content:"User deleted successfully"}),f(!1),h(!1),(e=>{const t=s.filter((t=>t.email!==e));a(t)})(g.email)})).catch((e=>{u(n(e,"Failed to delete user")),f(!1),h(!1)}))},confirmLoading:x,onCancel:()=>{h(!1)},centered:!0,className:"delete-user-modal",children:[(0,v.jsx)(Ee.default,{children:"Are you sure you want to delete user id"}),(0,v.jsx)(b,{strong:!0,children:null===g||void 0===g?void 0:g.email})]})]})}function Jo(){return(0,v.jsx)(Qo,{})}function $o(){const e=ie(),{sessionDetails:t}=N(),{setAlertDetails:o}=T(),n=(0,c.TH)(),l=(0,c.s0)(),i=_(),[s,a]=(0,p.useState)(),[d,u]=(0,p.useState)(!0),[m,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(),{setPostHogCustomEvent:g}=Xt(),j="invite"===n.pathname.split("/").slice(-1)[0];return(0,p.useEffect)((()=>{j||n.state||l("/".concat(null===t||void 0===t?void 0:t.orgName,"/").concat(r.DK)),(async()=>{u(!0);const l={method:"GET",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/roles"),headers:{"X-CSRFToken":null===t||void 0===t?void 0:t.csrfToken,"Content-Type":"application/json"}};e(l).then((e=>{var t;const o=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.members)||[];a(o),f(j?o.find((e=>"unstract_user"===e.name)):o.find((e=>e.name===n.state.role)))})).catch((e=>{o(i(e,"Failed to load user roles"))})).finally((()=>{u(!1)}))})()}),[]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Yo,{enableSearch:!1,title:j?"Invite User":"Edit User"}),(0,v.jsx)(ho,{children:(0,v.jsx)("div",{className:"invite-user-container",children:d?(0,v.jsx)("div",{className:"loader-container",children:(0,v.jsx)(At,{})}):(0,v.jsxs)(dt.Z,{name:"invite-edit-form",onFinish:n=>{if(h(!0),j){var a;const d=null===s||void 0===s||null===(a=s.filter((e=>e.id===n.role))[0])||void 0===a?void 0:a.name;n.role=d,(async n=>{const s={method:"POST",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/users/invite/"),data:{users:[n]},headers:{"X-CSRFToken":null===t||void 0===t?void 0:t.csrfToken,"Content-Type":"application/json"}};e(s).then((e=>{var n;const i=(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message[0])||{};o({type:"success"===i.status?"success":"error",content:"success"===i.status?"Invited user successfully":"Failed to invite user, ".concat(null===i||void 0===i?void 0:i.message)}),l("/".concat(null===t||void 0===t?void 0:t.orgName,"/users/"))})).catch((e=>{o(i(e,"Failed to invite user"))})).finally((()=>h(!1)))})(n)}else(n=>{const l={method:"POST",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/users/role/"),data:{...n},headers:{"X-CSRFToken":null===t||void 0===t?void 0:t.csrfToken,"Content-Type":"application/json"}};e(l).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||{};o({type:"success"===t.status?"success":"error",content:"success"===t.status?"User updated successfully":"Failed to update user"})})).catch((e=>{o(i(e,"Failed to update user"))})).finally((()=>h(!1)))})(n);try{g("intent_success_add_user",{info:j?"Clicked on 'Invite' button":"Clicked on 'Update' button"})}catch(vc){}},validateMessages:{required:"required!",types:{email:"Enter a valid email!",number:"Enter a valid number!"}},children:[(0,v.jsx)(dt.Z.Item,{name:["email"],rules:[{type:"email",required:!0}],initialValue:j?null:n.state.email,children:(0,v.jsx)(_t.default,{placeholder:"Email",disabled:!j})}),(0,v.jsxs)("div",{className:"invite-button-container",children:[(0,v.jsx)("div",{className:"admin-toggle-container",children:(0,v.jsx)(dt.Z.Item,{name:"role",initialValue:x.id,className:"form-select",children:(0,v.jsx)(xt.default,{className:"role-select",options:s.map((e=>{return{value:e.id,label:(t=e.name,t.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())))};var t}))})})}),(0,v.jsx)(Bt,{type:"primary",htmlType:"submit",loading:m,children:j?"Invite":"Update"})]})]})})})]})}function en(){return(0,v.jsx)($o,{})}const tn=e=>{let{children:t}=e;return(0,v.jsx)(Be.Z,{direction:"vertical",className:"width-100",children:t})},{Option:on}=xt.default;function nn(){const e=(0,c.s0)(),{sessionDetails:t}=N(),o=ie(),{setAlertDetails:n}=T(),l=_(),{setPostHogCustomEvent:s}=Xt(),[a,d]=(0,p.useState)([]),[r,u]=(0,p.useState)([]),[m,h]=(0,p.useState)({}),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(!1),y={LLM:"Default LLM",EMBEDDING:"Default Embedding",VECTOR_DB:"Default Vector DB",X2TEXT:"Default Text Extractor"};function S(e){return Object.keys(y).find((t=>y[t]===e))}const b=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/adapter/")};o(e).then((e=>{const t=null===e||void 0===e?void 0:e.data;d(t)})).catch((e=>{n(l(e,"Failed to get the adapters list"))}))},w=()=>{j(!0);const e={method:"GET",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/adapter/default_triad/")};o(e).then((e=>{const t=null===e||void 0===e?void 0:e.data,o={};o[S(y.LLM)]=null===t||void 0===t?void 0:t.default_llm_adapter,o[S(y.EMBEDDING)]=null===t||void 0===t?void 0:t.default_embedding_adapter,o[S(y.VECTOR_DB)]=null===t||void 0===t?void 0:t.default_vector_db_adapter,o[S(y.X2TEXT)]=null===t||void 0===t?void 0:t.default_x2text_adapter,h(o),(e=>{const t=a.map((t=>e[t.adapter_type]===(null===t||void 0===t?void 0:t.id)?{...t,adapter_name:"".concat(t.adapter_name," (current default)")}:t));u(t)})(o)})).catch((e=>{n(l(e,"Failed to fetch Default Triads"))})).finally((()=>{j(!1)}))};(0,p.useEffect)((()=>{b()}),[]),(0,p.useEffect)((()=>{a.length>0&&w()}),[a]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"plt-set-head",children:[(0,v.jsx)(i.ZP,{size:"small",type:"text",onClick:()=>e(-1),children:(0,v.jsx)(go.Z,{})}),(0,v.jsx)(Ee.default.Text,{className:"plt-set-head-typo",children:"Default Triad"})]}),(0,v.jsx)("div",{className:"plt-set-layout",children:(0,v.jsx)(ho,{children:g?(0,v.jsx)(At,{}):(0,v.jsxs)("div",{className:"plt-set-layout-2 form-width",children:[["LLM","EMBEDDING","VECTOR_DB","X2TEXT"].map((e=>(0,v.jsxs)(tn,{children:[(0,v.jsx)(Ee.default,{className:"triad-select",children:y[e]}),(0,v.jsx)(xt.default,{placeholder:"Select ".concat(y[e]),value:m[e]||void 0,onChange:t=>((e,t)=>{h((o=>({...o,[e]:t}))),f(!0);try{s("intent_success_select_default_triad",{info:"Selected default triad",adapter_name:e})}catch(vc){}})(e,t),style:{width:"100%"},children:r.filter((t=>(null===t||void 0===t?void 0:t.adapter_type)===e)).map((e=>(0,v.jsx)(on,{value:null===e||void 0===e?void 0:e.id,children:null===e||void 0===e?void 0:e.adapter_name},null===e||void 0===e?void 0:e.id)))})]},e))),(0,v.jsx)(Bt,{type:"primary",className:"triad-select",onClick:async()=>{let e={llm_default:m[S(y.LLM)],embedding_default:m[S(y.EMBEDDING)],vector_db_default:m[S(y.VECTOR_DB)],x2text_default:m[S(y.X2TEXT)]};e=Object.fromEntries(Object.entries(e).filter((e=>{let[t,o]=e;return null!==o&&""!==o})));const i={"X-CSRFToken":null===t||void 0===t?void 0:t.csrfToken,"Content-Type":"application/json"},s={method:"POST",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/adapter/default_triad/"),headers:i,data:e};o(s).then((e=>{n({type:"success",content:"Default triad setting saved successfully"}),b(),f(!1)})).catch((e=>{n(l(e,"Failed to update Default Triads"))}))},disabled:!x,children:"Save"})]})})})]})}var ln=o(41938),sn=o(76864),an=o(55035),dn=o(95505),rn=o(35702),cn=o(28761);const un=o.p+"static/media/embedding.61a72472948536d00b2f921ecaad8e70.svg";var pn=o(74125);const vn=o.p+"static/media/llm.01cc36f5d0e9fcb23869e5d5643696eb.svg";const mn=o.p+"static/media/platform-settings.712578256bc5435b358ea268955cfacb.svg";var hn=o(45313);const xn=o.p+"static/media/vector-db.981e1f2227daa05ec0f2708069982e2f.svg";var fn=o(87998);const gn=o.p+"static/media/terminal.ff4eae8a8584326cc41bef579a215225.svg",{Sider:jn}=Ke.default;let yn,_n,Sn,bn,Nn,wn,kn,Tn;try{yn=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/app-deployment/getMenuItem'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(vc){}try{_n=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/hooks/useSideMenu'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(vc){}try{bn=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/unstract-subscription-plan-store'");throw e.code="MODULE_NOT_FOUND",e}()));const e=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/helper/constants'");throw e.code="MODULE_NOT_FOUND",e}()));Nn=null===e||void 0===e?void 0:e.dashboardSideMenuItem,wn=null===e||void 0===e?void 0:e.UNSTRACT_SUBSCRIPTION_PLANS}catch(vc){}try{kn=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/select-product-store.js'");throw e.code="MODULE_NOT_FOUND",e}()))}catch{}const En=e=>{var t;let{collapsed:o}=e;const n=(0,c.s0)(),{sessionDetails:l}=N(),{orgName:i,flags:s}=l;try{var a,d;if(null!==(a=bn)&&void 0!==a&&a.useUnstractSubscriptionPlanStore)Sn=null===(d=bn)||void 0===d?void 0:d.useUnstractSubscriptionPlanStore((e=>null===e||void 0===e?void 0:e.unstractSubscriptionPlan))}catch(g){}let r;null!==(t=kn)&&void 0!==t&&t.useSelectedProductStore&&(Tn=kn.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct))),_n&&(r=_n.useSideMenu());const u=[{id:1,mainTitle:"BUILD",subMenu:[{id:1.1,title:"Prompt Studio",description:"Create structured data from unstructured documents",image:cn.Z,path:"/".concat(i,"/tools"),active:window.location.pathname.startsWith("/".concat(i,"/tools"))},{id:1.2,title:"Workflows",description:"Build no-code data workflows for unstructured data",icon:an.Z,image:dn.Z,path:"/".concat(i,"/workflows"),active:window.location.pathname.startsWith("/".concat(i,"/workflows"))}]},{id:2,mainTitle:"MANAGE",subMenu:[{id:2.2,title:"API Deployments",description:"Unstructured to structured APIs",image:rn.Z,path:"/".concat(i,"/api"),active:window.location.pathname.startsWith("/".concat(i,"/api"))},{id:2.3,title:"ETL Pipelines",description:"Unstructured to structured data pipelines",image:pn.Z,path:"/".concat(i,"/etl"),active:window.location.pathname.startsWith("/".concat(i,"/etl"))},{id:2.4,title:"Task Pipelines",description:"Ad-hoc unstructured data task pipelines",image:hn.Z,path:"/".concat(i,"/task"),active:window.location.pathname.startsWith("/".concat(i,"/task"))},{id:1.5,title:"Logs",description:"Records system events for monitoring and debugging",image:gn,path:"/".concat(i,"/logs"),active:window.location.pathname.startsWith("/".concat(i,"/logs"))}]},{id:3,mainTitle:"SETTINGS",subMenu:[{id:3.1,title:"LLMs",description:"Setup platform wide access to Large Language Models",icon:an.Z,image:vn,path:"/".concat(i,"/settings/llms"),active:window.location.pathname.startsWith("/".concat(i,"/settings/llms"))},{id:3.2,title:"Vector DBs",description:"Setup platform wide access to Vector DBs",image:xn,path:"/".concat(i,"/settings/vectorDbs"),active:window.location.pathname.startsWith("/".concat(i,"/settings/vectorDbs"))},{id:3.3,title:"Embedding",description:"Setup platform wide access to Embedding models",image:un,path:"/".concat(i,"/settings/embedding"),active:window.location.pathname.startsWith("/".concat(i,"/settings/embedding"))},{id:3.4,title:"Text Extractor",description:"Setup platform wide access to Text extractor services",image:fn.Z,path:"/".concat(i,"/settings/textExtractor"),active:window.location.pathname.startsWith("/".concat(i,"/settings/textExtractor"))},{id:3.5,title:"Platform",description:"Settings for the platform",image:mn,path:"/".concat(i,"/settings"),active:window.location.pathname==="/".concat(i,"/settings")||window.location.pathname==="/".concat(i,"/settings/platform")||window.location.pathname==="/".concat(i,"/settings/triad")||window.location.pathname==="/".concat(i,"/users")}]}];Nn&&u[1].subMenu.unshift(Nn(i));const m=r||u;var h,x;yn&&null!==s&&void 0!==s&&s.app_deployment&&(null===(h=m[1])||void 0===h||null===(x=h.subMenu)||void 0===x||x.splice(1,0,yn.default(i)));const f=(0,p.useMemo)((()=>{var e;return!(!Sn||!wn||Tn&&"unstract"!==Tn)&&(null===(e=Sn)||void 0===e?void 0:e.remainingDays)<0}),[Sn]);return m.forEach((e=>{e.subMenu.forEach((e=>{e.disable=f}))})),(0,v.jsx)(jn,{trigger:null,collapsible:!0,collapsed:o,className:"side-bar",width:240,collapsedWidth:65,children:(0,v.jsx)("div",{className:"main-slider",children:(0,v.jsx)("div",{className:"slider-wrap",children:null===m||void 0===m?void 0:m.map(((e,t)=>(0,v.jsxs)("div",{children:[!o&&(0,v.jsx)(Ee.default,{className:"sidebar-main-heading",children:e.mainTitle}),(0,v.jsx)(Be.Z,{direction:"vertical",className:"menu-item-body",children:e.subMenu.map((e=>(0,v.jsx)(bo.Z,{title:o?e.title:"",children:(0,v.jsxs)(Be.Z,{className:"space-styles ".concat(e.active?"space-styles-active":""," ").concat(e.disable?"space-styles-disable":""),onClick:()=>{e.disable||n(e.path)},children:[(0,v.jsx)(so.Z,{src:e.image,alt:"side_icon",className:"menu-item-icon",preview:!1}),!o&&(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default,{className:"sidebar-item-text fs-14",children:e.title}),(0,v.jsx)(Ee.default,{className:"sidebar-item-text fs-11",children:e.description})]})]})},e.id)))}),t<m.length-1&&(0,v.jsx)(Ro.Z,{className:"sidebar-divider"})]},null===e||void 0===e?void 0:e.id)))})})})};var Cn=o(4210),On=o(9973),Dn=o(27804),Pn=o(92365),Zn=o(87962),In=o(56058),Ln=o(23197);let An,Un,Fn,Mn,Rn;try{An=Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/components/TrialDaysInfo.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Un=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/select-product-store.js'");throw e.code="MODULE_NOT_FOUND",e}()))}catch{}try{Mn=Object(function(){var e=new Error("Cannot find module '../../../plugins/platform-dropdown/PlatformDropDown.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Rn=Object(function(){var e=new Error("Cannot find module '../../../plugins/assets/llmWhisperer/index.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}const zn=e=>{let{onClick:t,className:o}=e;return Ln.Z.logoUrl?(0,v.jsx)(so.Z,{src:Ln.Z.logoUrl,preview:!1,className:o,onClick:t,alt:"logo",width:120,style:{cursor:t?"pointer":void 0,background:"transparent"},onError:()=>{Ln.Z.logoUrl&&(Ln.Z.logoUrl=null)}}):(0,v.jsx)(Ie.a5,{className:o,onClick:t})};let Wn,qn,Hn,Gn,Kn;try{Wn=Object(function(){var e=new Error("Cannot find module '../../../plugins/assets/verticals/index.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{Hn=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/unstract-subscription-plan-store'");throw e.code="MODULE_NOT_FOUND",e}())),Gn=Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/helper/constants'");throw e.code="MODULE_NOT_FOUND",e}()),Kn=Object(function(){var e=new Error("Cannot find module '../../../plugins/unstract-subscription/components/UnstractPricingMenuLink.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}function Bn(e){let{isSimpleLayout:t,topNavBarOptions:o}=e;const n=(0,c.s0)(),{sessionDetails:l}=N(),{orgName:s,allOrganization:a,orgId:d,isLoggedIn:u}=l,m=(0,r.SV)(),h="".concat(m,"/").concat(s,"/onboard"),f=le(),[g,j]=(0,p.useState)(!1),[y,S]=(0,p.useState)(!1),[b,w]=(0,p.useState)(!1),[k,E]=(0,p.useState)(""),{setAlertDetails:C}=T(),O=_(),D=(0,c.TH)();Un&&(Fn=Un.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct)));try{var P,Z;if(null!==(P=Hn)&&void 0!==P&&P.useUnstractSubscriptionPlanStore)qn=null===(Z=Hn)||void 0===Z?void 0:Z.useUnstractSubscriptionPlanStore((e=>null===e||void 0===e?void 0:e.unstractSubscriptionPlan))}catch(z){}const I=(0,p.useMemo)((()=>{var e;return!(!qn||!Gn)&&(null===(e=qn)||void 0===e?void 0:e.remainingDays)<=0}),[qn]),L=!(Fn&&"unstract"!==Fn),A=Fn&&"verticals"===Fn;(0,p.useEffect)((()=>{const{role:e}=l,t="unstract_reviewer"===e,o="unstract_supervisor"===e,n=e===r.eN;j(!(0,r.IU)(null===l||void 0===l?void 0:l.adapters)&&!t&&!o),S(n||o),w(t)}),[l]),(0,p.useEffect)((()=>{const e=D.pathname.split("review");e.length>1?e[1].includes("/approve")?E("Approve"):e[1].includes("/download_and_sync")?E("Download and syncmanager"):E("Review"):E(null),D.pathname.includes("/simple_review")&&E("Simple Review")}),[D]);const U=(0,p.useCallback)((async e=>{const t={method:"POST",url:"/api/v1/organization/".concat(e,"/set"),headers:{"X-CSRFToken":null===l||void 0===l?void 0:l.csrfToken}};try{await(0,x.Z)(t),n("/"),window.location.reload()}catch(vc){C(O(vc))}}),[]),F=(0,p.useMemo)((()=>null===a||void 0===a?void 0:a.map((e=>({key:null===e||void 0===e?void 0:e.id,label:(null===e||void 0===e?void 0:e.id)===(null===l||void 0===l?void 0:l.orgId)?(0,v.jsx)("div",{onClick:()=>C({type:"error",content:"You are already in ".concat(null===e||void 0===e?void 0:e.display_name)}),children:null===e||void 0===e?void 0:e.display_name}):(0,v.jsx)(zo,{handleConfirm:()=>U(null===e||void 0===e?void 0:e.id),content:"Want to switch to ".concat(null===e||void 0===e?void 0:e.display_name,"?"),children:(0,v.jsx)("div",{children:null===e||void 0===e?void 0:e.display_name})})})))),[a,U]),M=(0,p.useMemo)((()=>{const e=[];L&&!t&&e.push({key:"1",label:(0,v.jsxs)(i.ZP,{onClick:()=>n("/".concat(s,"/profile")),className:"logout-button",disabled:I,children:[(0,v.jsx)(No.Z,{})," Profile"]})}),(null===a||void 0===a?void 0:a.length)>1&&e.push({key:"3",label:(0,v.jsx)(Xo.Z,{placeholder:"Switch Organization",menu:{items:F,selectable:!0,selectedKeys:[d],className:"switch-org-menu"},placement:"left",children:(0,v.jsxs)("div",{children:[(0,v.jsx)(Cn.Z,{})," Switch Org"]})})}),L&&!t&&(b||y)&&e.push({key:"4",label:(0,v.jsxs)(i.ZP,{onClick:()=>n("/".concat(s,"/review")),className:"logout-button",disabled:I,children:[(0,v.jsx)(On.Z,{})," Review"]})}),L&&!t&&y&&(e.push({key:"5",label:(0,v.jsxs)(i.ZP,{onClick:()=>n("/".concat(s,"/review/approve")),className:"logout-button",disabled:I,children:[(0,v.jsx)(Dn.Z,{})," Approve"]})}),e.push({key:"6",label:(0,v.jsxs)(i.ZP,{onClick:()=>n("/".concat(s,"/review/download_and_sync")),className:"logout-button",disabled:I,children:[(0,v.jsx)(Pn.Z,{})," Download and Sync Manager"]})})),L&&Kn&&null!==l&&void 0!==l&&l.isAdmin&&(null===l||void 0===l||!l.provider)&&e.push({key:"7",label:(0,v.jsx)(Kn,{orgName:s})});const o=u?f:()=>{const e=(0,r.SV)()+"/api/v1/login";window.location.href=e},c=u?(0,v.jsx)(Zn.Z,{}):(0,v.jsx)(In.Z,{}),p=u?"Logout":"Login";return e.push({key:"2",label:(0,v.jsx)(i.ZP,{onClick:o,icon:c,className:"logout-button",children:p})}),e.filter(Boolean)}),[L,t,b,y,a,F,s,d,I]),R=(0,p.useCallback)((e=>{var t,o;const n=null===e||void 0===e?void 0:e.split(" ");return null===n||void 0===n||null===(t=n.map((e=>e.charAt(0))))||void 0===t||null===(o=t.join(""))||void 0===o?void 0:o.toUpperCase()}),[]);return(0,v.jsxs)(Pe.Z,{align:"middle",className:"topNav",children:[(0,v.jsxs)(Ze.Z,{span:6,className:"platform-switch-container",children:[L?(0,v.jsx)(zn,{className:"topbar-logo cursor-pointer",onClick:()=>n("/".concat(null===l||void 0===l?void 0:l.orgName,"/").concat(r.DK))}):A?Wn&&(0,v.jsx)(Wn,{className:"topbar-logo"}):Rn&&(0,v.jsx)(Rn,{className:"topbar-logo"}),k&&(0,v.jsxs)("span",{className:"page-identifier",children:[(0,v.jsx)("span",{className:"custom-tools-header-v-divider"}),(0,v.jsx)("span",{className:"page-heading",children:k})]}),Mn&&(0,v.jsx)(Mn,{})]}),t?(0,v.jsx)(Ze.Z,{span:14}):(0,v.jsx)(Ze.Z,{span:14,className:"top-nav-alert-col",children:L&&g&&(0,v.jsx)(Wt.Z,{type:"error",message:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{className:"top-nav-alert-msg",children:"Your setup process is incomplete. Now, that's a bummer!"}),(0,v.jsx)("a",{href:h,className:"top-nav-alert-link",children:"Complete it to start using Unstract"})]}),showIcon:!0})}),(0,v.jsx)(Ze.Z,{span:4,children:(0,v.jsx)(Pe.Z,{justify:"end",align:"middle",children:(0,v.jsxs)(Be.Z,{children:[o,L&&An&&(0,v.jsx)(An,{}),(0,v.jsx)(Xo.Z,{menu:{items:M},placement:"bottomLeft",arrow:!0,children:(0,v.jsx)("div",{className:"top-navbar-dp",children:null!==l&&void 0!==l&&l.picture?(0,v.jsx)(so.Z,{className:"navbar-img",height:"100%",width:"100%",preview:!1,src:null===l||void 0===l?void 0:l.picture}):(0,v.jsx)(Ee.default.Text,{className:"initials",children:R(null===l||void 0===l?void 0:l.name)})})})]})})})]})}var Xn=o(37295),Vn=o(40447),Yn=o(60732),Qn=o(69604);const Jn=(0,p.memo)((function(e){let{isMinimized:t,isFull:o,errorCount:n,onToggleExpand:l,onMinimize:s}=e;const a=o?(0,v.jsx)(Xn.Z,{}):(0,v.jsx)(Vn.Z,{}),d=(0,v.jsx)(Yn.Z,{});return(0,v.jsxs)("div",{className:"logs-header-container",children:[(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(Ee.default.Text,{children:"Logs"}),t&&n>0&&(0,v.jsx)(Qn.Z,{color:"red",children:n})]}),(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(i.ZP,{type:"text",size:"small",onClick:l,children:a}),(0,v.jsx)(i.ZP,{type:"text",size:"small",icon:d,onClick:s})]})]})}));function $n(e){let{errorCount:t,setErrorCount:o,isMinimized:n}=e;const l=(0,p.useRef)(null),{logs:i}=M();(0,p.useEffect)((()=>{n||0===t||o(0)}),[n]);const s=(0,p.useMemo)((()=>i.map((e=>{var t,l;return"ERROR"===(null===e||void 0===e?void 0:e.level)&&"LOG"===(null===e||void 0===e?void 0:e.type)&&n&&o((e=>e+1)),{key:"".concat(e.timestamp,"-").concat((0,w.uniqueId)()),time:(0,r.tF)(null===e||void 0===e?void 0:e.timestamp),level:null===e||void 0===e?void 0:e.level,type:null===e||void 0===e?void 0:e.type,stage:null===e||void 0===e?void 0:e.stage,step:null===e||void 0===e?void 0:e.step,state:null===e||void 0===e?void 0:e.state,promptKey:null===e||void 0===e||null===(t=e.component)||void 0===t?void 0:t.prompt_key,docName:null===e||void 0===e||null===(l=e.component)||void 0===l?void 0:l.doc_name,message:(0,v.jsx)(pt,{text:null===e||void 0===e?void 0:e.message,styleClassName:"display-logs-md"})}}))),[i]),a=(0,p.useMemo)((()=>[{title:"Time",dataIndex:"time",key:"time"},{title:"Level",dataIndex:"level",key:"level"},{title:"Type",dataIndex:"type",key:"type",filters:[{text:"LOG",value:"LOG"},{text:"NOTIFICATION",value:"NOTIFICATION"}],defaultFilteredValue:[],filterMultiple:!0,onFilter:(e,t)=>t.type===e},{title:"Stage",dataIndex:"stage",key:"stage"},{title:"Step",dataIndex:"step",key:"step"},{title:"State",dataIndex:"state",key:"state"},{title:"Prompt Key",dataIndex:"promptKey",key:"promptKey"},{title:"Doc Name",dataIndex:"docName",key:"docName"},{title:"Message",dataIndex:"message",key:"message"}]),[]);(0,p.useEffect)((()=>{if(null!==i&&void 0!==i&&i.length&&l.current){const e=l.current.querySelector(".ant-table-body");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}}),[i]);return(0,v.jsx)("div",{className:"tool-logs-table",ref:l,children:(0,v.jsx)(Vo.Z,{dataSource:s,columns:a,rowClassName:e=>"ERROR"===e.level?"display-logs-error-bg":"",pagination:!1,showHeader:!0,size:"small"})})}function el(){const[e,t]=(0,p.useState)(0),[o,n]=(0,p.useState)(0),l=ie(),{sessionDetails:i}=N(),{pushLogMessages:s}=M(),{setAlertDetails:a}=T(),d=_(),r=(0,p.useRef)(!1),c=(0,p.useRef)(0),u=(0,p.useRef)(0),m=(0,p.useRef)(null);(0,p.useEffect)((()=>{var e;h();const t=null===(e=m.current)||void 0===e?void 0:e.parentElement;t&&"static"===window.getComputedStyle(t).position&&(t.style.position="relative")}),[]);const h=async()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===i||void 0===i?void 0:i.orgId,"/logs/"),headers:{"X-CSRFToken":null===i||void 0===i?void 0:i.csrfToken}};l(e).then((e=>{var t;const o=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data)||[];s(o,!1)})).catch((e=>{a(d(e))}))},x=(0,p.useCallback)((()=>{var e;const t=null===(e=m.current)||void 0===e?void 0:e.parentElement;return t?t.getBoundingClientRect().height:0}),[]),f=(0,p.useCallback)((()=>{t(0)}),[]),g=(0,p.useCallback)((()=>{const e=.3*x()-40,o=Math.max(0,e);t(o)}),[x]),j=(0,p.useCallback)((()=>{const e=x(),o=Math.max(0,e-40);t(o)}),[x]),y=(0,p.useCallback)((()=>{const t=x();e>=t-40-1||e<.3*t-40?g():j()}),[e,x,g,j]),S=(0,p.useCallback)((t=>{r.current=!0,c.current=t.clientY,u.current=e,document.addEventListener("mousemove",b),document.addEventListener("mouseup",w)}),[e]),b=(0,p.useCallback)((e=>{if(!r.current)return;const o=c.current-e.clientY,n=u.current+o,l=x()-40;t(Math.max(0,Math.min(l,n)))}),[x]),w=(0,p.useCallback)((()=>{r.current=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",w)}),[b]),k=x(),E=e>=k-40-1;return(0,v.jsxs)("div",{ref:m,className:"logs-container",style:{height:e+40},children:[(0,v.jsx)("div",{className:"logs-handle",onMouseDown:S,children:(0,v.jsx)(Jn,{isMinimized:0===e,isFull:E,errorCount:o,onToggleExpand:y,onMinimize:f})}),(0,v.jsx)("div",{className:"logs-content",children:(0,v.jsx)($n,{errorCount:o,setErrorCount:n,isMinimized:0===e})})]})}function tl(e){let{sideBarOptions:t,topNavBarOptions:o,showLogsAndNotifications:n=!0}=e;const l=JSON.parse(localStorage.getItem("collapsed"))||!1,[s,a]=(0,p.useState)(l);return(0,p.useEffect)((()=>{localStorage.setItem("collapsed",JSON.stringify(s))}),[s]),(0,v.jsxs)("div",{className:"landingPage",children:[(0,v.jsx)(Bn,{topNavBarOptions:o}),(0,v.jsxs)(Ke.default,{children:[(0,v.jsx)(En,{collapsed:s,...t}),(0,v.jsxs)(Ke.default,{children:[(0,v.jsx)(i.ZP,{shape:"circle",size:"small",icon:s?(0,v.jsx)(ln.Z,{}):(0,v.jsx)(sn.Z,{}),onClick:()=>a(!s),className:"collapse_btn"}),(0,v.jsx)(c.j3,{}),(0,v.jsx)("div",{className:"height-40"}),n&&(0,v.jsx)(el,{})]})]})]})}function ol(){const{sessionDetails:e}=N();return(0,v.jsx)("div",{className:"grey-body",children:(0,v.jsxs)("div",{className:"paper-layout",children:[(0,v.jsx)("div",{className:"header-text",children:(0,v.jsx)(Ee.default.Text,{className:"typo-text",strong:!0,children:"User Profile"})}),(0,v.jsxs)(Be.Z,{direction:"vertical",size:"middle",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:"User Name:"}),(0,v.jsx)(_t.default,{defaultValue:e.display_name,readOnly:!0})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:"Email:"}),(0,v.jsx)(_t.default,{defaultValue:e.email,readOnly:!0})]}),e.roles&&(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:"Roles:"}),(0,v.jsx)(_t.default,{defaultValue:e.roles,readOnly:!0})]}),(0,v.jsx)(i.ZP,{disabled:!0,children:"Reset Password"})]})]})})}function nl(){return(0,v.jsx)(ol,{})}var ll=o(95027),il=o(84791),sl=o(15831),al=o(8527),dl=o(9150),rl=o(21306);const cl={count:0,isLoading:!1,error:null},ul=(0,S.Ue)(((e,t)=>({...cl,fetchCount:async o=>{if(!t().isLoading){e({isLoading:!0});try{const t=await o();e({count:t,isLoading:!1,error:null})}catch(n){e({error:n,isLoading:!1})}}},resetStore:()=>{e(cl)}})));let pl={};function vl(){const e=ie(),{sessionDetails:t}=N(),o="/api/v1/unstract/".concat(t.orgId.replaceAll('"',"")),n=t.csrfToken;return{getWorkflowList:()=>(pl={url:"".concat(o,"/workflow/?is_active=True"),method:"GET"},e(pl)),getWorkflowEndpointList:(t,n)=>(pl={url:"".concat(o,"/workflow/endpoint/?endpoint_type=").concat(t,"&connection_type=").concat(n),method:"GET"},e(pl)),getProjectList:function(){const n=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?{created_by:null===t||void 0===t?void 0:t.id}:{};return pl={url:"".concat(o,"/workflow/"),method:"GET",params:n},e(pl)},editProject:(l,i,s)=>(pl={url:s?"".concat(o,"/workflow/").concat(s,"/"):"".concat(o,"/workflow/"),method:s?"PUT":"POST",headers:{"X-CSRFToken":n},data:{workflow_name:l,description:i,[s?"modified_by":"created_by"]:null===t||void 0===t?void 0:t.id}},e(pl)),deleteProject:t=>(pl={url:"".concat(o,"/workflow/").concat(t,"/"),method:"DELETE",headers:{"X-CSRFToken":n}},e(pl)),clearCache:t=>(pl={url:"".concat(o,"/workflow/").concat(t,"/clear-cache/"),method:"GET",headers:{"X-CSRFToken":n}},e(pl)),clearFileMarkers:t=>(pl={url:"".concat(o,"/workflow/").concat(t,"/clear-file-marker/"),method:"GET",headers:{"X-CSRFToken":n}},e(pl)),canUpdate:t=>(pl={url:"".concat(o,"/workflow/").concat(t,"/can-update"),method:"GET"},e(pl))}}let ml={};function hl(){const e=ie(),{sessionDetails:t}=N(),o="/api/v1/unstract/".concat(t.orgId.replaceAll('"',"")),n={"Content-Type":"application/json","X-CSRFToken":t.csrfToken};return{getApiDeploymentsList:()=>(ml={url:"".concat(o,"/api/deployment/"),method:"GET"},e(ml)),createApiDeployment:t=>(ml={url:"".concat(o,"/api/deployment/"),method:"POST",headers:n,data:t},e(ml)),updateApiDeployment:t=>(ml={url:"".concat(o,"/api/deployment/").concat(null===t||void 0===t?void 0:t.id,"/"),method:"PUT",headers:n,data:t},e(ml)),deleteApiDeployment:t=>(ml={url:"".concat(o,"/api/deployment/").concat(t,"/"),method:"DELETE",headers:n},e(ml)),getApiKeys:t=>(ml={method:"GET",url:"".concat(o,"/api/keys/api/").concat(t,"/")},e(ml)),createApiKey:(t,l)=>(ml={method:"POST",url:"".concat(o,"/api/keys/api/").concat(t,"/"),headers:n,data:l},e(ml)),updateApiKey:(t,l)=>(ml={method:"PUT",url:"".concat(o,"/api/keys/").concat(t,"/"),headers:n,data:l},e(ml)),deleteApiKey:t=>(ml={method:"DELETE",url:"".concat(o,"/api/keys/").concat(t,"/"),headers:n},e(ml)),downloadPostmanCollection:t=>(ml={method:"GET",url:"".concat(o,"/api/postman_collection/").concat(t,"/"),responseType:"blob"},e(ml))}}const xl={projectId:"",projectName:"",logId:"",prompt:"",isLoading:!1,loadingType:"",source:{},destination:{},details:{},allowChangeEndpoint:!0},fl={...xl},gl=(0,S.Ue)(((e,t)=>({...fl,setDefaultWorkflowState:()=>{e({...xl})},setWorkflow:t=>{e(t)},updateWorkflow:o=>{const n={...t()};e({existingState:n,...o})},getMetadata:e=>{try{var o;const n={...t()},l=((null===n||void 0===n||null===(o=n.details)||void 0===o?void 0:o.tool_instances)||[]).find((t=>(null===t||void 0===t?void 0:t.id)===e));return null===l||void 0===l?void 0:l.metadata}catch{return{}}},updateMetadata:(o,n)=>{try{var l;const i={...t()},s=(null===i||void 0===i||null===(l=i.details)||void 0===l?void 0:l.tool_instances)||[],a=s.findIndex((e=>(null===e||void 0===e?void 0:e.id)===o));s[a].metadata=n,i.details.tool_instances=s,e({...i})}catch{return}},addNewTool:o=>{try{var n;const l={...t()},i=[...(null===l||void 0===l||null===(n=l.details)||void 0===n?void 0:n.tool_instances)||[]];i.push(o),l.details.tool_instances=[...i],e((()=>({...t(),existingState:l})))}catch(vc){return}},deleteToolInstance:o=>{try{var n;const l={...t()},i=[...(null===l||void 0===l||null===(n=l.details)||void 0===n?void 0:n.tool_instances)||[]].filter((e=>(null===e||void 0===e?void 0:e.id)!==o));l.details.tool_instances=[...i],e({...t(),existingState:l})}catch{return}}}))),jl={display_name:"",description:"",api_name:"",workflow:""},yl=e=>{let{open:t,setOpen:o,setTableData:n,isEdit:l,selectedRow:i={},openCodeModal:s,setSelectedRow:a,workflowId:d,workflowEndpointList:c,setDeploymentName:u}=e;const m=gl(),{updateWorkflow:h}=m,x=hl(),{setAlertDetails:f}=T(),g=_(),{Option:j}=xt.default,[y,S]=(0,p.useState)(l?{...i}:{...jl}),[b,N]=(0,p.useState)(!1),[w]=dt.Z.useForm(),[k,E]=(0,p.useState)(null),[C,O]=(0,p.useState)(!1),{setPostHogCustomEvent:D}=Xt();(0,p.useEffect)((()=>{d&&S((e=>({...e,workflow:d})))}),[d]);const P=()=>{S({...jl})},Z=()=>{x.getApiDeploymentsList().then((e=>{n(null===e||void 0===e?void 0:e.data)})).catch((e=>{f({type:"error",content:"Error fetching API deployments"})}))};return(0,v.jsx)($e.Z,{title:l?"Update API deployment ":"Add API deployment",centered:!0,maskClosable:!1,open:t,onOk:l?()=>{N(!0);const e=y;x.updateApiDeployment(e).then((e=>{Z(),o(!1),P(),f({type:"success",content:"API deployment updated successfully"})})).catch((e=>{g(e,"",E)})).finally((()=>{N(!1)}))}:()=>{try{const e=c.find((e=>(null===e||void 0===e?void 0:e.workflow)===(null===y||void 0===y?void 0:y.workflow)));D("intent_success_api_deployment",{info:"Clicked on 'Save' button",deployment_name:null===y||void 0===y?void 0:y.api_name,workflow_name:null===e||void 0===e?void 0:e.workflow_name})}catch(vc){}N(!0);const e=y;x.createApiDeployment(e).then((t=>{d?(h({allowChangeEndpoint:!1}),u(e.display_name)):(Z(),a(null===t||void 0===t?void 0:t.data),s(!0)),o(!1),P(),f({type:"success",content:"New API created successfully"})})).catch((e=>{g(e,"",E)})).finally((()=>{N(!1)}))},onCancel:()=>{o(!1)},okText:l?"Update":"Save",okButtonProps:{loading:b,disabled:!C},width:450,children:(0,v.jsxs)(dt.Z,{form:w,name:"myForm",layout:"vertical",initialValues:y,onValuesChange:(e,t)=>{O(!0),S({...y,...t});const o=Object.keys(e)[0];w.setFields([{name:o,errors:[]}]),E((e=>{if(e){const t=e.errors.filter((e=>e.attr!==o));return{...e,errors:t}}return null}))},children:[(0,v.jsx)(dt.Z.Item,{label:"Display Name (for humans)",name:"display_name",rules:[{required:!0,message:"Please enter a display name"}],validateStatus:(0,r.dz)("display_name",k)?"error":"",help:(0,r.dz)("display_name",k),children:(0,v.jsx)(_t.default,{})}),(0,v.jsx)(dt.Z.Item,{label:"Description",name:"description",validateStatus:(0,r.dz)("description",k)?"error":"",help:(0,r.dz)("description",k),children:(0,v.jsx)(_t.default,{})}),(0,v.jsx)(dt.Z.Item,{label:"API Name (forms part of the API signature)",name:"api_name",rules:[{required:!0,message:"Please enter an API Name"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"Only letters, numbers, hyphen and underscores are allowed"},{pattern:/^.{1,30}$/,message:"Maximum 30 characters only allowed"}],validateStatus:(0,r.dz)("api_name",k)?"error":"",help:(0,r.dz)("api_name",k),children:(0,v.jsx)(_t.default,{})}),!d&&(0,v.jsx)(dt.Z.Item,{label:"Workflow",name:"workflow",rules:[{required:!0,message:"Please select a workflow"}],validateStatus:(0,r.dz)("workflow",k)?"error":"",help:(0,r.dz)("workflow",k),children:(0,v.jsx)(xt.default,{children:c.map((e=>(0,v.jsx)(j,{value:e.workflow,children:e.workflow_name},e.workflow_name)))})})]})})},_l=e=>{let{open:t,setOpen:o,deleteRecord:n}=e;return(0,v.jsx)($e.Z,{title:"Are you sure you want to delete this?",centered:!0,open:t,onOk:n,onCancel:()=>o(!1),okText:"Delete",width:500})};var Sl=o(68944),bl=o(73851),Nl=o(25215),wl=o.n(Nl),kl=o(61293),Tl=o.n(kl);o(27862);const El=e=>{let{code:t}=e;return(0,p.useEffect)((()=>{Tl().highlightAll()}),[t]),(0,v.jsx)("pre",{className:"codeSnippet",children:(0,v.jsx)("code",{className:"language-javascript",children:t})})},Cl=e=>{let{isDialogOpen:t,setDialogOpen:o,url:n}=e;const[l,i]=(0,p.useState)(!1),[s,a]=(0,p.useState)("python"),[d,r]=(0,p.useState)(""),[c,u]=(0,p.useState)("POST"),m="?execution_id=REPLACE_WITH_EXECUTION_ID&include_metadata=False",h=e=>e.split("\n").map((e=>e.trim())).join("\n"),x=()=>{let e="import requests\n      {{#if isPost}}\n        api_url = '{{url}}'\n        headers = {\n          'Authorization': 'Bearer REPLACE_WITH_API_KEY'\n        }\n        payload = {'timeout': 300, 'include_metadata': False}\n        filepath = '/path/to/file'\n        files=[('files',('file',open(filepath,'rb'),'application/octet-stream'))]\n        response = requests.request(\"POST\", api_url, headers=headers, data=payload, files=files)\n      {{else}}\n        api_url = '{{url}}{{{params}}}'\n        headers = {\n          'Authorization': 'Bearer REPLACE_WITH_API_KEY'\n        }\n        response = requests.request(\"GET\", api_url, headers=headers)\n      {{/if}}\n      print('Response:', response.json())\n    ";e=h(e);const t=wl().compile(e)({url:n,params:m,isPost:"POST"===c});r(t)},f=()=>{let e="{{#if isPost}}\n    curl --request POST --location '{{url}}' \\\n    --header 'Authorization: Bearer REPLACE_WITH_API_KEY' \\\n    --form 'files=@\"{{pathToFile}}\"' \\\n    --form 'timeout=300' \\\n    --form 'include_metadata=false'\n    {{else}}\n    curl --location '{{url}}{{{params}}}' \\\n    --header 'Authorization: Bearer REPLACE_WITH_API_KEY'\n    {{/if}}\n  ";e=h(e);const t=wl().compile(e)({url:n,params:m,isPost:"POST"===c,pathToFile:"/path/to/file"});r(t)},g=()=>{let e='var myHeaders = new Headers();\n    myHeaders.append("Authorization", "Bearer REPLACE_WITH_API_KEY");\n    {{#if isPost}}\n    var formdata = new FormData();\n    formdata.append("files", fileInput.files[0], "file");\n    formdata.append("timeout", "300");\n    formdata.append("include_metadata", "false");\n    var requestOptions = { method: \'POST\', body: formdata, redirect: \'follow\', headers: myHeaders };\n    fetch("{{url}}", requestOptions)\n    {{else}}\n    var requestOptions = { method: \'GET\', redirect: \'follow\', headers: myHeaders};\n    fetch("{{url}}{{{params}}}", requestOptions)\n    {{/if}}\n    .then(response => response.text())\n    .then(result => console.log(result))\n    .catch(error => console.log(\'error\', error));\n    ';e=h(e);const t=wl().compile(e)({url:n,params:m,isPost:"POST"===c});r(t)},j=[{key:"POST",label:"POST Document",children:(0,v.jsx)(El,{code:d})},{key:"GET",label:"GET Status",children:(0,v.jsx)(El,{code:d})}];return(0,p.useEffect)((()=>{"python"===s?x():"bash"===s?f():"javascript"===s?g():r("")}),[n,s,c]),(0,v.jsx)($e.Z,{title:"Code Snippets",centered:!0,maskClosable:!1,open:t,onCancel:()=>{o(!1)},width:700,footer:null,children:(0,v.jsx)(bl.Z,{defaultActiveKey:"1",tabBarExtraContent:(0,v.jsxs)("div",{className:"codeActions",children:[(0,v.jsx)(xt.default,{className:"codeLanguage",width:300,onChange:e=>(e=>{a(e)})(e),name:"language",value:s,options:[{value:"python",label:"Python"},{value:"bash",label:"cURL"},{value:"javascript",label:"JavaScript"}]}),(0,v.jsx)("button",{className:"copyCodeBtn",onClick:()=>{navigator.clipboard.writeText(d),i(!0),setTimeout((()=>i(!1)),1500)},children:l?(0,v.jsx)(bo.Z,{title:"Copied",children:(0,v.jsx)(Sl.Z,{})}):(0,v.jsx)(bo.Z,{title:"Copy snippet",children:(0,v.jsx)(Fo.Z,{})})})]}),onChange:e=>{u(e.toString())},items:j,moreIcon:(0,v.jsx)(v.Fragment,{})})})};function Ol(e){let{type:t,columns:o,tableData:n,isTableLoading:l,openAddModal:i}=e;return l?(0,v.jsx)(At,{}):null!==n&&void 0!==n&&n.length?(0,v.jsx)(ho,{children:(0,v.jsx)("div",{className:"body-div",children:(0,v.jsx)("div",{className:"table-div",children:(0,v.jsx)(Vo.Z,{className:"table",size:"middle",columns:o,dataSource:n,rowKey:"id",loading:{indicator:(0,v.jsx)(At,{}),spinning:l}})})})}):(0,v.jsx)(tt,{text:"Currently you have no ".concat(r.xs[t].addBtn),btnText:r.xs[t].addBtn,handleClick:()=>i(!1)})}function Dl(e){let{type:t,openAddModal:o}=e;const{posthogDeploymentEventText:n,setPostHogCustomEvent:l}=Xt(),i=()=>{o(!1);try{l(n[t],{info:"Clicked on '+ ".concat(r.xs[t].addBtn,"' button")})}catch(vc){}};return(0,v.jsx)(jo,{title:r.xs[t].title,CustomButtons:()=>(0,v.jsx)(Bt,{type:"primary",icon:(0,v.jsx)(et.Z,{}),onClick:i,children:r.xs[t].addBtn})})}function Pl(e){let{type:t,columns:o,tableData:n,isTableLoading:l,openAddModal:i}=e;return(0,v.jsxs)("div",{className:"deploy-layout",children:[(0,v.jsx)("div",{children:(0,v.jsx)(Dl,{type:t,openAddModal:i})}),(0,v.jsx)("div",{className:"layout-body",children:(0,v.jsx)(Ol,{type:t,columns:o,tableData:n,isTableLoading:l,openAddModal:i})})]})}const Zl=e=>{let{isDialogOpen:t,setDialogOpen:o,apiKeys:n,setApiKeys:l,selectedApiRow:i,apiService:s,type:a}=e;const{sessionDetails:d}=N(),r=ie(),c=_(),[u,m]=(0,p.useState)(!1),{setAlertDetails:h}=T(),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(!1),[y,S]=(0,p.useState)({}),[b,w]=(0,p.useState)(!1),[k,E]=(0,p.useState)({}),[C,O]=(0,p.useState)(!1);(0,p.useEffect)((()=>{S(x?{description:"",[a]:null===i||void 0===i?void 0:i.id,is_active:!0}:{})}),[x]),(0,p.useEffect)((()=>{S(g?{description:null===k||void 0===k?void 0:k.description,[a]:null===i||void 0===i?void 0:i.id,is_active:null===k||void 0===k?void 0:k.is_active}:{})}),[g]);const D=()=>{f(!1),j(!1),w(!1)},P=[{title:"Description",dataIndex:"description",key:"description"},{title:"API Key",dataIndex:"api_key",key:"api_key",render:(e,t)=>(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",children:[(0,v.jsx)("div",{children:(0,v.jsx)(bo.Z,{title:"click to copy",className:"cursorPointer",onClick:()=>{return e=null===t||void 0===t?void 0:t.api_key,void navigator.clipboard.writeText(e).then((()=>{h({type:"success",content:"API key copied to clipboard"})})).catch((e=>{h({type:"error",content:"Copy failed"})}));var e},children:(0,v.jsx)(Fo.Z,{})})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:null===t||void 0===t?void 0:t.api_key})})]})},{title:"Active",key:"is_active",dataIndex:"is_active",align:"center",render:(e,t)=>(0,v.jsx)(rl.Z,{size:"small",checked:t.is_active,onChange:e=>{(e=>{m(!0),e.is_active=!(null!==e&&void 0!==e&&e.is_active);const t={method:"PUT",url:"/api/v1/unstract/".concat(null===d||void 0===d?void 0:d.orgId,"/api/keys/").concat(null===e||void 0===e?void 0:e.id,"/"),headers:{"X-CSRFToken":null===d||void 0===d?void 0:d.csrfToken},data:e};r(t).then((e=>{h({type:"success",content:"Status updated successfully"})})).catch((e=>{h(c(e))})).finally((()=>{m(!1)}))})(t)}})},{title:"Actions",key:"pipeline_id",align:"center",render:(e,t)=>(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Be.Z,{className:"actions",onClick:()=>(e=>{E(e),j(!0),f(!1)})(t),children:(0,v.jsx)(bo.Z,{title:"edit",className:"cursorPointer",children:(0,v.jsx)(wo.Z,{})})}),(0,v.jsx)(Be.Z,{className:"actions",onClick:()=>(e=>{E(e),O(!0)})(t),children:(0,v.jsx)(bo.Z,{title:"delete",className:"cursorPointer",children:(0,v.jsx)(Eo.Z,{})})})]})}];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)($e.Z,{title:"Manage Keys",centered:!0,maskClosable:!1,open:t,onCancel:()=>{o(!1)},width:700,footer:null,children:[(0,v.jsx)("div",{className:"display-flex-right new-key-btn",children:(0,v.jsx)(Bt,{type:"primary",size:"small",icon:(0,v.jsx)(et.Z,{}),onClick:()=>{f(!0),j(!1)},children:"New Key"})}),(0,v.jsx)("div",{className:"keys-table",children:(0,v.jsx)(Vo.Z,{size:"small",dataSource:n,columns:P,rowKey:"id",loading:{indicator:(0,v.jsx)(At,{}),spinning:u},pagination:{defaultPageSize:5}})})]}),(x||g)&&(0,v.jsx)($e.Z,{title:x?"Add Key":"Update Key",centered:!0,open:x||g,onOk:x?()=>{s.createApiKey(null===i||void 0===i?void 0:i.id,y).then((e=>{var t;t=null===e||void 0===e?void 0:e.data,l((e=>{const o=[...e];return o.push(t),o})),h({type:"success",content:"Key added successfully"})})).catch((e=>{h(c(e))})).finally((()=>{D()}))}:()=>{s.updateApiKey(null===k||void 0===k?void 0:k.id,y).then((e=>{var t,o;t=null===k||void 0===k?void 0:k.id,o=null===e||void 0===e?void 0:e.data,l((e=>e.map((e=>e.id===t?o:e)))),h({type:"success",content:"Key updated successfully"})})).catch((e=>{h(c(e))})).finally((()=>{D()}))},okText:x?"Add":"Update",okButtonProps:{disabled:!b},onCancel:D,children:(0,v.jsxs)(tn,{children:[(0,v.jsx)(Ee.default,{children:"Description"}),(0,v.jsx)(_t.default,{placeholder:"Description",name:"description",onChange:e=>((e,t)=>{const o={[e]:t};(null===t||void 0===t?void 0:t.trim().length)>0?w(!0):w(!1),S({...y,...o})})("description",e.target.value),value:y.description||""})]})}),C&&(0,v.jsx)(_l,{open:C,setOpen:O,deleteRecord:()=>{s.deleteApiKey(null===k||void 0===k?void 0:k.id).then((e=>{var t;t=null===k||void 0===k?void 0:k.id,l((e=>e.filter((e=>e.id!==t)))),h({type:"success",content:"Key deleted successfully"})})).catch((e=>{h(c(e))})).finally((()=>{O(!1)}))}})]})};function Il(e){let{onClose:t,showModal:o}=e;const n=(0,c.s0)(),{sessionDetails:l}=N(),s=()=>{t&&t()};return(0,v.jsxs)($e.Z,{title:"Create Prompt Studio",open:o,onCancel:s,footer:null,centered:!0,width:500,maskClosable:!1,className:"prompt-studio-modal",closeIcon:(0,v.jsx)("span",{children:"\xd7"}),children:[(0,v.jsx)("div",{className:"prompt-studio-description",children:"You first need to create and export a Prompt Studio project or export an existing sample Prompt Studio project before you can create a workflow."}),(0,v.jsxs)("div",{className:"prompt-studio-buttons",children:[(0,v.jsx)(i.ZP,{type:"link",onClick:()=>{n("/".concat(null===l||void 0===l?void 0:l.orgName,"/tools")),s()},className:"prompt-studio-guide-btn",children:"+ Create Prompt Studio"}),(0,v.jsx)(i.ZP,{type:"link",href:"https://docs.unstract.com/unstract/unstract_platform/quick_start/",target:"_blank",className:"prompt-studio-guide-btn",children:"Quick Start Guide"}),(0,v.jsx)(i.ZP,{type:"text",onClick:s,className:"prompt-studio-cancel-btn",children:"Cancel"})]})]})}Il.defaultProps={onClose:null};const Ll=e=>{let{open:t,setOpen:o,logRecord:n,totalLogs:l,fetchExecutionLogs:s}=e;const[a,d]=(0,p.useState)(null),[r,c]=(0,p.useState)(!1),[u,m]=(0,p.useState)([]),{sessionDetails:h}=N(),{setAlertDetails:x}=T(),f=ie(),g=_(),[j,y]=(0,p.useState)(0),S=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const n={method:"GET",url:"/api/v1/unstract/".concat(null===h||void 0===h?void 0:h.orgId,"/workflow/execution/").concat(e,"/logs/"),headers:{"X-CSRFToken":null===h||void 0===h?void 0:h.csrfToken},params:{page:t,page_size:o}};f(n).then((e=>{var t,o,n;const l=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(o=t.results)||void 0===o?void 0:o.map((e=>{var t,o,n,l;return{id:null===e||void 0===e?void 0:e.id,log:(0,v.jsx)(pt,{text:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.log}),type:null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.type,stage:null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.stage,level:null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.level,event_time:null===e||void 0===e?void 0:e.event_time}}));m(l),y(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.count)})).catch((e=>{x(g(e))}))},b=[{title:"Executed At",dataIndex:"created_at",key:"created_at"},{title:"Execution ID",dataIndex:"execution_id",key:"execution_id",render:(e,t)=>(0,v.jsx)(i.ZP,{type:"link",onClick:()=>{return e=null===t||void 0===t?void 0:t.execution_id,d(e),S(e),void c(!0);var e},children:e})},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,v.jsx)("span",{className:null===e||void 0===e?void 0:e.toLowerCase(),children:e})}],w=[{title:"Event Time",dataIndex:"event_time",key:"event_time"},{title:"Event Stage",dataIndex:"stage",key:"stage"},{title:"Log Level",dataIndex:"level",key:"level",render:e=>(0,v.jsx)("span",{className:null===e||void 0===e?void 0:e.toLowerCase(),children:e})},{title:"Log",dataIndex:"log",key:"log"}];return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)($e.Z,{title:"Execution Logs",centered:!0,open:t,onCancel:()=>o(!1),footer:null,width:"80%",children:(0,v.jsx)(Vo.Z,{columns:b,dataSource:n,rowKey:"id",align:"left",pagination:{total:l,onChange:(e,t)=>{s(e,t)}}})}),(0,v.jsx)($e.Z,{title:"Execution Log Details - ".concat(a),centered:!0,open:r,onCancel:()=>c(!1),footer:null,width:"80%",wrapClassName:"modal-body",children:(0,v.jsx)(Vo.Z,{columns:w,dataSource:u,rowKey:"id",align:"left",pagination:{pageSize:10,total:j,onChange:(e,t)=>{S(a,e,t)}}})})]})};var Al=o(24320);const Ul=()=>{const{setAlertDetails:e}=T(),t=_();return{getApiKeys:(o,n,l,i)=>{o.getApiKeys(n).then((e=>{l(null===e||void 0===e?void 0:e.data)})).catch((o=>{e(t(o))})).finally((()=>{i(!0)}))},downloadPostmanCollection:(o,n)=>{o.downloadPostmanCollection(n).then((t=>{var o,n;const{data:l,headers:i}=t,s=URL.createObjectURL(l),a=(null===(o=i["content-disposition"])||void 0===o||null===(n=o.split("filename=")[1])||void 0===n?void 0:n.trim().replaceAll('"',""))||"postman_collection.json",d=document.createElement("a");d.href=s,d.setAttribute("download",a),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(s),e({type:"success",content:"Collection downloaded successfully"})})).catch((o=>{e(t(o))}))},copyUrl:t=>{const o=(0,r.ow)(t);navigator.clipboard.writeText(o).then((()=>{e({type:"success",content:"Endpoint copied to clipboard"})})).catch((t=>{e({type:"error",content:"Copy failed"})}))}}},Fl={name:"",authorization_type:"BEARER",notification_type:"WEBHOOK",platform:"SLACK",authorization_header:"",authorization_key:"",is_active:!1,max_retries:0,pipeline:"",api:"",url:""},Ml=[{value:"WEBHOOK",label:"WEBHOOK"}],Rl=[{value:"SLACK",label:"SLACK"},{value:"API",label:"API"}],zl=[{value:"BEARER",label:"BEARER"},{value:"API_KEY",label:"API_KEY"},{value:"CUSTOM_HEADER",label:"CUSTOM_HEADER"},{value:"NONE",label:"NONE"}];function Wl(e){let{setIsForm:t,type:o,id:n,isLoading:l,handleSubmit:s,handleUpdate:a,editDetails:d}=e;const[c]=dt.Z.useForm(),[u,m]=(0,p.useState)(Fl),[h,x]=(0,p.useState)(null),[f,g]=(0,p.useState)(!1);(0,p.useEffect)((()=>{d&&(m(d),g(!0))}),[d]),(0,p.useEffect)((()=>{f&&(c.resetFields(),g(!1))}),[u]);const j=[{label:"Name",name:"name",rules:[{required:!0,message:"Please enter name"}],component:(0,v.jsx)(_t.default,{})},{label:"URL",name:"url",rules:[{required:!0,message:"Please enter URL"}],component:(0,v.jsx)(_t.default,{}),tooltip:"Provide the URL associated with this item. This field is required."},{label:"Notification Type",name:"notification_type",component:(0,v.jsx)(xt.default,{options:Ml}),tooltip:"Select the type of notification you want to send."},{label:"Platform",name:"platform",component:(0,v.jsx)(xt.default,{options:Rl}),tooltip:"Choose the platform where the notification will be used."},{label:"Authorization Type",name:"authorization_type",component:(0,v.jsx)(xt.default,{options:zl,onChange:e=>{m((t=>({...t,authorization_type:e,authorization_key:"NONE"===e?"":t.authorization_key,authorization_header:"CUSTOM_HEADER"===e?t.authorization_header:""})))}}),tooltip:"Select the type of authorization required for this notification."},{label:"Authorization Header",name:"authorization_header",component:(0,v.jsx)(_t.default,{}),tooltip:"Enter the custom authorization header needed for requests.",rules:"CUSTOM_HEADER"===u.authorization_type?[{required:!0,message:"Authorization Header is required"}]:[],hidden:"CUSTOM_HEADER"!==u.authorization_type},{label:"Authorization Key",name:"authorization_key",component:(0,v.jsx)(_t.default,{}),tooltip:"Provide the authorization key used to validate the notification.",rules:"NONE"!==u.authorization_type?[{required:!0,message:"Authorization key is required"}]:[],hidden:"NONE"===u.authorization_type},{label:"Max Retries",name:"max_retries",component:(0,v.jsx)(_t.default,{type:"number"}),tooltip:"Specify the maximum number of times the notification should be retried if it fails."}];return(0,v.jsxs)(dt.Z,{form:c,layout:"vertical",initialValues:u,onValuesChange:(e,t)=>{m({...u,...t});const o=Object.keys(e)[0];c.setFields([{name:o,errors:[]}]),x((e=>{if(e){const t=e.errors.filter((e=>e.attr!==o));return{...e,errors:t}}return null}))},onFinish:()=>{const e={...u};e[o]=n,d?a(e,null===d||void 0===d?void 0:d.id):s(e)},children:[j.map((e=>{let{label:t,name:o,rules:n,component:l,tooltip:i,hidden:s}=e;return!s&&(0,v.jsx)(dt.Z.Item,{label:t,name:o,rules:n,tooltip:i||"",validateStatus:(0,r.dz)(o,h)?"error":"",help:(0,r.dz)(o,h),children:l},o)})),(0,v.jsx)(dt.Z.Item,{className:"display-flex-right",children:(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(i.ZP,{onClick:()=>t(!1),children:"Cancel"}),(0,v.jsxs)(i.ZP,{type:"primary",htmlType:"submit",loading:l,children:[d?"Update":"Create"," Notification"]})]})})]})}function ql(e){let{setIsForm:t,rows:o,isLoading:n,updateStatus:l,handleDelete:s,setEditDetails:a}=e;const d=[{title:"Name",dataIndex:"name",key:"name"},{title:"Type",dataIndex:"notification_type",key:"notification_type"},{title:"Active",key:"is_active",dataIndex:"is_active",align:"center",render:(e,t)=>(0,v.jsx)(rl.Z,{size:"small",defaultChecked:null===t||void 0===t?void 0:t.is_active,onChange:()=>l(t)})},{title:"Actions",key:"pipeline_id",align:"center",render:(e,t)=>(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Be.Z,{className:"actions",children:(0,v.jsx)(bo.Z,{title:"edit",className:"cursorPointer",children:(0,v.jsx)(i.ZP,{type:"text",size:"small",onClick:()=>r(t),children:(0,v.jsx)(wo.Z,{})})})}),(0,v.jsx)(Be.Z,{className:"actions",children:(0,v.jsx)(bo.Z,{title:"delete",className:"cursorPointer",children:(0,v.jsx)(zo,{handleConfirm:()=>s(null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.name),content:"Are you sure you want to delete?",children:(0,v.jsx)(i.ZP,{type:"text",size:"small",children:(0,v.jsx)(Eo.Z,{})})})})})]})}],r=e=>{t(!0),a(e)};return(0,v.jsxs)(tn,{children:[(0,v.jsx)("div",{className:"display-flex-right",children:(0,v.jsx)(i.ZP,{type:"primary",icon:(0,v.jsx)(et.Z,{}),onClick:()=>t(!0),children:"Create Notification"})}),(0,v.jsx)(Vo.Z,{columns:d,dataSource:o,loading:{indicator:(0,v.jsx)(At,{}),spinning:n},pagination:{pageSize:5}})]})}function Hl(){const e=ie(),{sessionDetails:t}=N(),o="/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId.replaceAll('"',"")),n={"Content-Type":"application/json","X-CSRFToken":t.csrfToken};return{getApiKeys:t=>{const n={url:"".concat(o,"/api/keys/pipeline/").concat(t,"/"),method:"GET"};return e(n)},createApiKey:(t,l)=>{const i={method:"POST",url:"".concat(o,"/api/keys/pipeline/").concat(t,"/"),headers:n,data:l};return e(i)},updateApiKey:(t,l)=>{const i={method:"PUT",url:"".concat(o,"/api/keys/").concat(t,"/"),headers:n,data:l};return e(i)},deleteApiKey:t=>{const l={method:"DELETE",url:"".concat(o,"/api/keys/").concat(t,"/"),headers:n};return e(l)},downloadPostmanCollection:t=>{const n={method:"GET",url:"".concat(o,"/pipeline/api/postman_collection/").concat(t,"/"),responseType:"blob"};return e(n)},getNotifications:(t,n)=>{const l={method:"GET",url:"".concat(o,"/notifications/").concat(t,"/").concat(n,"/")};return e(l)},createNotification:t=>{const l={method:"POST",url:"".concat(o,"/notifications/"),headers:n,data:t};return e(l)},updateNotification:(t,l)=>{const i={method:"PUT",url:"".concat(o,"/notifications/").concat(l,"/"),headers:n,data:t};return e(i)},deleteNotification:t=>{const l={method:"DELETE",url:"".concat(o,"/notifications/").concat(t,"/"),headers:n};return e(l)}}}function Gl(e){let{open:t,setOpen:o,type:n,id:l}=e;const[i,s]=(0,p.useState)(!1),[a,d]=(0,p.useState)([]),[r,c]=(0,p.useState)(!1),[u,m]=(0,p.useState)(!1),[h,x]=(0,p.useState)(null),f=Hl(),{setAlertDetails:g}=T(),j=_();(0,p.useEffect)((()=>{if(!l||!t)return s(!1),void d([]);c(!0),f.getNotifications(n,l).then((e=>{d((null===e||void 0===e?void 0:e.data)||[])})).catch((e=>{g(j(e))})).finally((()=>{c(!1)}))}),[l,t]),(0,p.useEffect)((()=>{!i&&h&&x(null)}),[i]);const y=(e,t)=>{m(!0),f.updateNotification(e,t).then((t=>{b(null===t||void 0===t?void 0:t.data),s(!1),g({type:"success",content:"Successfully updated notification: ".concat(null===e||void 0===e?void 0:e.name)})})).catch((e=>{g(j(e))})).finally((()=>{m(!1)}))},S=e=>{d((t=>{const o=[...t];return o.push(e),o}))},b=e=>{d((t=>{const o=[...t],n=o.findIndex((t=>(null===t||void 0===t?void 0:t.id)===(null===e||void 0===e?void 0:e.id)));return-1!==n&&(o[n]=e),o}))},N=e=>{d((t=>t.filter((t=>(null===t||void 0===t?void 0:t.id)!==e))))};return(0,v.jsx)($e.Z,{title:"Setup Notifications",open:t,onCancel:()=>o(!1),centered:!0,footer:null,maskClosable:!1,children:i?(0,v.jsx)(Wl,{setIsForm:s,addNewRow:S,type:n,id:l,isLoading:u,handleSubmit:e=>{m(!0),f.createNotification(e).then((t=>{S(null===t||void 0===t?void 0:t.data),s(!1),g({type:"success",content:"Successfully created notification: ".concat(null===e||void 0===e?void 0:e.name)})})).catch((e=>{g(j(e))})).finally((()=>{m(!1)}))},handleUpdate:y,editDetails:h}):(0,v.jsx)(ql,{setIsForm:s,rows:a,isLoading:r,updateStatus:e=>{const t=!(null!==e&&void 0!==e&&e.is_active),o={...e,is_active:t};y(o,null===e||void 0===e?void 0:e.id)},handleDelete:(e,t)=>{f.deleteNotification(e).then((()=>{N(e),g({type:"success",content:"Successfully delete: ".concat(t)})})).catch((e=>{g(j(e))}))},setEditDetails:x})})}const Kl=()=>{const{sessionDetails:e}=N();return{getUrl:t=>{if(!t)return null;return"/api/v1/unstract/".concat(null===e||void 0===e?void 0:e.orgId,"/")+t.replace(/^\//,"")}}},Bl=()=>{const e=ie(),{getUrl:t}=Kl();return{getPromptStudioCount:(0,p.useCallback)((async()=>(await e({method:"GET",url:t("/tool/prompt-studio/count/")})).data.count),[e,t])}};function Xl(){const{sessionDetails:e}=N(),{setAlertDetails:t}=T(),o=(0,c.s0)(),n=hl(),l=vl(),[s,a]=(0,p.useState)(!0),[d,u]=(0,p.useState)(!1),[m,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(!1),[y,S]=(0,p.useState)({}),[b,w]=(0,p.useState)([]),[k,E]=(0,p.useState)([]),[C,O]=(0,p.useState)(!1),[D,P]=(0,p.useState)([]),Z=_(),[I,L]=(0,p.useState)(!1),[A,U]=(0,p.useState)([]),[F,M]=(0,p.useState)(0),R=ie(),{getApiKeys:z,downloadPostmanCollection:W,copyUrl:q}=Ul(),[H,G]=(0,p.useState)(!1),{count:K,isLoading:B,fetchCount:X}=ul(),[V,Y]=(0,p.useState)(!1),[Q,J]=(0,p.useState)(!1),{getPromptStudioCount:$}=Bl();(0,p.useEffect)((()=>{X($)}),[X]);const ee=[{title:"API Name",key:"display_name",render:(e,t)=>(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.display_name}),align:"left"},{title:"Description",key:"description",render:(e,t)=>(0,v.jsx)(Be.Z,{children:null===t||void 0===t?void 0:t.description}),align:"left"},{title:"API Endpoint",key:"api_endpoint",render:(e,t)=>(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"display-flex-space-between",children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:(0,r.ow)(null===t||void 0===t?void 0:t.api_endpoint)})}),(0,v.jsx)("div",{children:(0,v.jsx)(bo.Z,{title:"click to copy",children:(0,v.jsx)(i.ZP,{size:"small",onClick:()=>q(null===t||void 0===t?void 0:t.api_endpoint),children:(0,v.jsx)(Fo.Z,{})})})})]}),align:"left"},{title:"Workflow",key:"workflow_name",render:(t,n)=>(0,v.jsx)(bo.Z,{title:"view workflow",children:(0,v.jsx)(Be.Z,{className:"workflowName",onClick:()=>o("/".concat(null===e||void 0===e?void 0:e.orgName,"/workflows/").concat(null===n||void 0===n?void 0:n.workflow)),children:null===n||void 0===n?void 0:n.workflow_name})}),align:"left"},{title:"Enabled",key:"active",dataIndex:"active",align:"center",render:(e,t)=>(0,v.jsx)(rl.Z,{size:"small",checked:t.is_active,onChange:e=>{ne(t)}})},{title:"Actions",key:"pipeline_id",align:"center",render:(e,t)=>(0,v.jsx)(Xo.Z,{menu:{items:se},placement:"bottomLeft",trigger:["click"],onOpenChange:()=>S(t),children:(0,v.jsx)(Ko.Z,{className:"cur-pointer"})})}];(0,p.useEffect)((()=>{oe(),te()}),[]);const te=()=>{l.getWorkflowEndpointList("SOURCE","API").then((e=>{P(null===e||void 0===e?void 0:e.data)})).catch((()=>{t({type:"error",content:"Unable to get workflow list."})}))},oe=()=>{a(!0),n.getApiDeploymentsList().then((e=>{w(null===e||void 0===e?void 0:e.data)})).catch((e=>{t(Z(e))})).finally((()=>{a(!1)}))},ne=e=>{a(!0),e.is_active=!(null!==e&&void 0!==e&&e.is_active),n.updateApiDeployment(e).then((e=>{t({type:"success",content:"Status updated successfully"})})).catch((e=>{t(Z(e))})).finally((()=>{a(!1)}))},le=e=>{O(e),u(!0)},se=[{key:"1",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>le(!0),children:[(0,v.jsx)("div",{children:(0,v.jsx)(wo.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Edit"})})]})},{key:"2",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>z(n,null===y||void 0===y?void 0:y.id,E,j),children:[(0,v.jsx)("div",{children:(0,v.jsx)(ll.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Manage Keys"})})]})},{key:"3",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>W(n,null===y||void 0===y?void 0:y.id),children:[(0,v.jsx)("div",{children:(0,v.jsx)(il.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Download Postman Collection"})})]})},{key:"4",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>f(!0),children:[(0,v.jsx)("div",{children:(0,v.jsx)(sl.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Code Snippets"})})]})},{key:"5",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>{L(!0),(0,Al.fetchExecutionLogs)(R,Z,e,y,U,M,t)},children:[(0,v.jsx)("div",{children:(0,v.jsx)(al.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"View Logs"})})]})},{key:"6",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>h(!0),children:[(0,v.jsx)("div",{children:(0,v.jsx)(Eo.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Delete"})})]})},{key:"7",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>G(!0),children:[(0,v.jsx)("div",{children:(0,v.jsx)(dl.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Setup Notifications"})})]})}];(0,p.useEffect)((()=>{B||0!==K||Q?!B&&K>0&&Y(!1):Y(!0)}),[B,K,Q]);const ae=(0,p.useCallback)((()=>{Y(!1),J(!0)}),[]);return(0,v.jsxs)(v.Fragment,{children:[V&&(0,v.jsx)(Il,{onClose:ae,showModal:V}),(0,v.jsx)(Pl,{type:"api",columns:ee,tableData:b,isTableLoading:s,openAddModal:le}),d&&(0,v.jsx)(yl,{open:d,setOpen:u,setTableData:w,isEdit:C,selectedRow:y,openCodeModal:f,setSelectedRow:S,workflowEndpointList:D}),(0,v.jsx)(_l,{open:m,setOpen:h,deleteRecord:()=>{n.deleteApiDeployment(y.id).then((e=>{h(!1),oe(),t({type:"success",content:"API Deployment Deleted Successfully"})})).catch((e=>{t(Z(e))}))}}),(0,v.jsx)(Zl,{isDialogOpen:g,setDialogOpen:j,apiKeys:k,setApiKeys:E,selectedApiRow:y,apiService:n,type:r.S$.api}),(0,v.jsx)(Cl,{isDialogOpen:x,setDialogOpen:f,url:(0,r.ow)(null===y||void 0===y?void 0:y.api_endpoint)}),(0,v.jsx)(Ll,{open:I,setOpen:L,logRecord:A,totalLogs:F,fetchExecutionLogs:(o,n)=>{(0,Al.fetchExecutionLogs)(R,Z,e,y,U,M,t,o,n)}}),(0,v.jsx)(Gl,{open:H,setOpen:G,type:r.S$.api,id:null===y||void 0===y?void 0:y.id})]})}var Vl=o(12056),Yl=o(62),Ql=o(14057),Jl=o(47619),$l=o.n(Jl);const ei=e=>{let{open:t,setOpen:o,deleteRecord:n}=e;return(0,v.jsx)($e.Z,{title:"Are you sure you want to delete this?",centered:!0,open:t,onOk:n,onCancel:()=>o(!1),okText:"Delete",width:500})};var ti=o(45794),oi=o(40050),ni=o(86528);o(22104);const li=function(e){let{open:t,showCronGenerator:o,setCronValue:n}=e;const[l,i]=(0,p.useState)("0 * * * *"),s=()=>{o(!1)};return(0,v.jsx)($e.Z,{title:"Choose Cron schedule",open:t,maskClosable:!1,closable:!1,onCancel:s,onOk:()=>{n(l),s()},children:(0,v.jsx)(ni.Po,{value:l,setValue:i})})},ii={pipeline_name:"",workflow:"",cron_string:""},si=e=>{let{open:t,setOpen:o,type:n,title:l,setTableData:s,workflowId:a,isEdit:d,selectedRow:c={},setDeploymentName:u}=e;const[m]=dt.Z.useForm(),h=gl(),{updateWorkflow:x}=h,{sessionDetails:f}=N(),{setAlertDetails:g}=T(),j=ie(),y=vl(),S=_(),{Option:b}=xt.default,[w,k]=(0,p.useState)([]),[E,C]=(0,p.useState)(d?{...c}:{...ii}),[O,D]=(0,p.useState)(!1),[P,Z]=(0,p.useState)(!1),[I,L]=(0,p.useState)(null),[A,U]=(0,p.useState)(null),{posthogDeploymentEventText:F,setPostHogCustomEvent:M}=Xt(),{count:R,isLoadingModal:z,fetchCount:W}=ul(),[q,H]=(0,p.useState)(!1),[G,K]=(0,p.useState)(!1),B=(0,p.useCallback)((()=>{W()}),[W]);(0,p.useEffect)((()=>{B()}),[B]),(0,p.useEffect)((()=>{a&&C({...E,workflow:a})}),[a]),(0,p.useEffect)((()=>{null!==E&&void 0!==E&&E.cron_string&&U($l().toString(E.cron_string))}),[E]);const X=e=>y.getWorkflowEndpointList("DESTINATION",e).then((e=>null===e||void 0===e?void 0:e.data.map((e=>({...e,id:e.workflow}))))).catch((()=>[]));(0,p.useEffect)((()=>{"app"===n?y.getWorkflowList().then((e=>{k(null===e||void 0===e?void 0:e.data)})).catch((()=>{console.error("Unable to get workflow list")})):(()=>{const e="task"===n?"FILESYSTEM":"DATABASE";k([]),X(e).then((t=>{"DATABASE"===e?X("MANUALREVIEW").then((e=>{const o=[...t,...e];k(o)})):k(t)}))})(),W()}),[n,W]);const V=()=>{C({...ii})};(0,p.useEffect)((()=>{z||0!==R||G||H(!0)}),[z,R,G]);return(0,v.jsxs)(v.Fragment,{children:[q&&(0,v.jsx)(Il,{onClose:()=>{H(!1),K(!0),B()}}),(0,v.jsx)($e.Z,{title:d?"Update ".concat(l):"Add ".concat(l),centered:!0,open:t,onOk:d?()=>{const e=E;e.pipeline_type=n.toUpperCase();const t={method:"PUT",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/").concat(null===e||void 0===e?void 0:e.id,"/"),headers:{"Content-Type":"application/json","X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken},data:e};D(!0),j(t).then((e=>{var t;t=null===e||void 0===e?void 0:e.data,s((e=>{const o=e.findIndex((e=>(null===e||void 0===e?void 0:e.id)===(null===t||void 0===t?void 0:t.id)));if(-1!==o){const n=[...e];return n[o]={...n[o],...t},n}return e})),o(!1),V(),g({type:"success",content:"Pipeline Updated Successfully"})})).catch((e=>{g(S(e,"",L))})).finally((()=>{D(!1)}))}:()=>{try{const e=w.find((e=>(null===e||void 0===e?void 0:e.id)===(null===E||void 0===E?void 0:E.workflow)));M(F["".concat(n,"_success")],{info:"Clicked on 'Save and Deploy' button",deployment_name:null===E||void 0===E?void 0:E.pipeline_name,workflow_name:null===e||void 0===e?void 0:e.workflow_name})}catch(vc){}const e=E;e.pipeline_type=n.toUpperCase();const t={method:"POST",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/"),headers:{"Content-Type":"application/json","X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken},data:e};D(!0),j(t).then((t=>{var n;a?(x({allowChangeEndpoint:!1}),u(e.pipeline_name)):(n=null===t||void 0===t?void 0:t.data,s((e=>{const t=[...e];return t.push(n),t}))),o(!1),V(),g({type:"success",content:"New Pipeline Created Successfully"})})).catch((e=>{g(S(e,"",L))})).finally((()=>{D(!1)}))},onCancel:()=>{o(!1)},okText:d?"Update and Deploy":"Save and Deploy",okButtonProps:{loading:O},width:400,closable:!0,maskClosable:!1,children:(0,v.jsxs)(dt.Z,{form:m,name:"myForm",layout:"vertical",initialValues:E,onValuesChange:(e,t)=>{C({...E,...t});const o=Object.keys(e)[0];m.setFields([{name:o,errors:[]}]),L((e=>{if(e){const t=e.errors.filter((e=>e.attr!==o));return{...e,errors:t}}return null}))},children:[(0,v.jsx)(dt.Z.Item,{label:"Display Name",name:"pipeline_name",rules:[{required:!0,message:"Please enter display name"}],validateStatus:(0,r.dz)("pipeline_name",I)?"error":"",help:(0,r.dz)("pipeline_name",I),children:(0,v.jsx)(_t.default,{placeholder:"Name"})}),!a&&(0,v.jsx)(dt.Z.Item,{label:"Workflow",name:"workflow",rules:[{required:!0,message:"Please select an workflow"}],validateStatus:(0,r.dz)("workflow",I)?"error":"",help:(0,r.dz)("workflow",I),children:(0,v.jsx)(xt.default,{children:w.map((e=>(0,v.jsx)(b,{value:e.id,children:e.workflow_name},e.workflow_name)))})}),(0,v.jsx)(dt.Z.Item,{label:"Cron Schedule",name:"cron_string",validateStatus:(0,r.dz)("cron_string",I)?"error":"",help:(0,r.dz)("cron_string",I),children:(0,v.jsxs)("div",{className:"cron-string-div",children:[(0,v.jsx)(_t.default,{readOnly:!0,value:null===E||void 0===E?void 0:E.cron_string,className:"cron-string-input"}),(0,v.jsx)(i.ZP,{type:"primary",onClick:()=>{Z(!0)},icon:(0,v.jsx)(ti.Z,{}),className:"cron-string-btn"})]})}),(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)("div",{className:"cron-summary-div",children:(0,v.jsx)(oi.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"summary-text",children:A||"Summary not available."})})]})]})}),P&&(0,v.jsx)(li,{open:P,showCronGenerator:Z,setCronValue:e=>{const t={cron_string:e};C({...E,...t})}})]})};function ai(e){let{type:t}=e;const[n,l]=(0,p.useState)([]),[s,a]=(0,p.useState)(!1),[d,c]=(0,p.useState)(!1),[u,m]=(0,p.useState)({}),[h,x]=(0,p.useState)(!0),{sessionDetails:f}=N(),{setAlertDetails:g}=T(),j=ie(),y=_(),[S,b]=(0,p.useState)(!1),[w,k]=(0,p.useState)(!1),[E,C]=(0,p.useState)([]),[O,D]=(0,p.useState)(0),{fetchExecutionLogs:P}=o(24320),[Z,I]=(0,p.useState)(!1),[L,A]=(0,p.useState)([]),U=Hl(),{getApiKeys:F,downloadPostmanCollection:M,copyUrl:R}=Ul(),[z,W]=(0,p.useState)(!1),{count:q,isLoading:H,fetchCount:G}=ul(),[K,B]=(0,p.useState)(!1),[X,V]=(0,p.useState)(!1),{getPromptStudioCount:Y}=Bl();(0,p.useEffect)((()=>{G(Y)}),[G]);(0,p.useEffect)((()=>{J()}),[t]);const Q=e=>{b(e),a(!0)},J=()=>{x(!0);const e={method:"GET",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/?type=").concat(t.toUpperCase())};j(e).then((e=>{l(null===e||void 0===e?void 0:e.data)})).catch((e=>{g(y(e))})).finally((()=>{x(!1)}))},$=(e,t)=>{const o=n.map((o=>o.id===t?{...o,...e}:o));l(o)},ee=async e=>{const t={method:"POST",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/execute/"),headers:{"Content-Type":"application/json","X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken},data:e};return j(t).then((e=>e)).catch((e=>{throw e}))},te=e=>{const t={method:"GET",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/").concat(e,"/"),headers:{"X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken}};return j(t).then((e=>e)).catch((e=>{throw e}))},oe=[{key:"1",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>Q(!0),children:[(0,v.jsx)("div",{children:(0,v.jsx)(wo.Z,{})}),(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:"Edit"})})]})},{key:"2",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>c(!0),children:[(0,v.jsx)(Eo.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Delete"})]})},{key:"3",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>F(U,null===u||void 0===u?void 0:u.id,A,I),children:[(0,v.jsx)(ll.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Manage Keys"})]})},{key:"4",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>M(U,null===u||void 0===u?void 0:u.id),children:[(0,v.jsx)(il.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Download Postman Collection"})]})},{key:"5",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>{k(!0),P(j,y,f,u,C,D,g)},children:[(0,v.jsx)(al.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"View Logs"})]})},{key:"6",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>(()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/workflow/").concat(u.workflow_id,"/clear-cache/"),headers:{"X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken}};j(e).then((()=>{c(!1),g({type:"success",content:"Pipeline Cache Cleared Successfully"})})).catch((e=>{g(y(e))}))})(),children:[(0,v.jsx)(Vl.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Clear Cache"})]})},{key:"7",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>(()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/workflow/").concat(u.workflow_id,"/clear-file-marker/"),headers:{"X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken}};j(e).then((()=>{c(!1),g({type:"success",content:"Pipeline File History Cleared Successfully"})})).catch((e=>{g(y(e))}))})(),children:[(0,v.jsx)(Yl.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Clear Processed File History"})]})},{key:"8",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>(e=>{const o={...e,pipeline_type:t.toUpperCase()},n=null===e||void 0===e?void 0:e.pipeline_id,l={last_run_status:"processing"};$(l,n),ee(o).then((e=>{var t;const o=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.pipeline;l.last_run_status=null===o||void 0===o?void 0:o.last_run_status,l.last_run_time=null===o||void 0===o?void 0:o.last_run_time,g({type:"success",content:"Pipeline Sync Initiated"})})).catch((e=>{g(y(e,"Failed to sync.")),l.last_run_status="FAILURE",l.last_run_time=(new Date).toISOString()})).finally((()=>{$(l,n)}))})({pipeline_id:u.id}),children:[(0,v.jsx)(Ql.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Sync Now"})]})},{key:"9",label:(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"action-items",onClick:()=>W(!0),children:[(0,v.jsx)(dl.Z,{}),(0,v.jsx)(Ee.default.Text,{children:"Setup Notifications"})]})}],ne=[{title:"Source",render:(e,t)=>(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{children:(0,v.jsx)(so.Z,{src:null===t||void 0===t?void 0:t.source_icon,preview:!1,width:30})}),(0,v.jsx)(Ee.default.Text,{className:"p-or-d-typography",strong:!0,children:null===t||void 0===t?void 0:t.source_name})]}),key:"source",align:"center"},{title:"Pipeline",key:"pipeline_name",render:(e,t)=>(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.pipeline_name}),(0,v.jsx)("br",{}),(0,v.jsxs)(Ee.default.Text,{type:"secondary",className:"p-or-d-typography",children:["from ",null===t||void 0===t?void 0:t.workflow_name]})]}),align:"center"},{title:"Destination",render:(e,t)=>(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{children:(0,v.jsx)(so.Z,{src:null===t||void 0===t?void 0:t.destination_icon,preview:!1,width:30})}),(0,v.jsx)(Ee.default.Text,{className:"p-or-d-typography",strong:!0,children:null===t||void 0===t?void 0:t.destination_name})]}),key:"destination",align:"center"},{title:"API Endpoint",key:"api_endpoint",render:(e,t)=>(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"display-flex-space-between",children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{children:(0,r.ow)(null===t||void 0===t?void 0:t.api_endpoint)})}),(0,v.jsx)("div",{children:(0,v.jsx)(bo.Z,{title:"click to copy",children:(0,v.jsx)(i.ZP,{size:"small",onClick:()=>R(null===t||void 0===t?void 0:t.api_endpoint),children:(0,v.jsx)(Fo.Z,{})})})})]}),align:"left"},{title:"Status of Previous Run",dataIndex:"last_run_status",key:"last_run_status",align:"center",render:(e,t)=>(0,v.jsx)(v.Fragment,{children:"processing"===t.last_run_status?(0,v.jsx)(At,{}):(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(Ee.default.Text,{className:"p-or-d-typography",strong:!0,children:null===t||void 0===t?void 0:t.last_run_status}),(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(Bo.Z,{}),type:"text",size:"small",onClick:()=>(e=>{const t={last_run_status:"processing"};$(t,e),te(e).then((e=>{const o=null===e||void 0===e?void 0:e.data;t.last_run_status=null===o||void 0===o?void 0:o.last_run_status,t.last_run_time=null===o||void 0===o?void 0:o.last_run_time})).catch((e=>{g(y(e,"Failed to update pipeline status."));const o=new Date;t.last_run_status="FAILURE",t.last_run_time=o.toISOString()})).finally((()=>{$(t,e)}))})(null===t||void 0===t?void 0:t.id)})]})})},{title:"Previous Run At",key:"last_run_time",dataIndex:"last_run_time",align:"center",render:(e,t)=>(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"p-or-d-typography",strong:!0,children:null===t||void 0===t?void 0:t.last_run_time})})},{title:"Frequency",key:"last_run_time",dataIndex:"last_run_time",align:"center",render:(e,t)=>(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"p-or-d-typography",strong:!0,children:(null===t||void 0===t?void 0:t.cron_string)&&$l().toString(null===t||void 0===t?void 0:t.cron_string)})})},{title:"Enabled",key:"active",dataIndex:"active",align:"center",render:(e,t)=>(0,v.jsx)(rl.Z,{checked:t.active,onChange:e=>{((e,t)=>{const o={active:e,pipeline_id:t},n={method:"PATCH",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/").concat(t,"/"),headers:{"Content-Type":"application/json","X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken},data:o};j(n).then((()=>{J(),g({type:"success",content:e?"Pipeline Enabled Successfully":"Pipeline Disabled Successfully"})})).catch((e=>{g(y(e))})).finally((()=>{}))})(!t.active,t.id)}})},{title:"Actions",key:"pipeline_id",align:"center",render:(e,t)=>(0,v.jsx)(Xo.Z,{menu:{items:oe},placement:"bottomLeft",onOpenChange:()=>m(t),trigger:["click"],children:(0,v.jsx)(Ko.Z,{className:"p-or-d-actions cur-pointer"})})}];(0,p.useEffect)((()=>{H||0!==q||X?!H&&q>0&&B(!1):B(!0)}),[H,q,X]);const le=(0,p.useCallback)((()=>{B(!1),V(!0)}),[]);return(0,v.jsxs)("div",{className:"p-or-d-layout",children:[K&&(0,v.jsx)(Il,{onClose:le,showModal:K}),(0,v.jsx)(Pl,{type:t,columns:ne,tableData:n,isTableLoading:h,openAddModal:Q}),s&&(0,v.jsx)(si,{open:s,setOpen:a,setTableData:l,type:t,title:r.xs[t].modalTitle,isEdit:S,selectedRow:u,setSelectedRow:m}),(0,v.jsx)(Ll,{open:w,setOpen:k,logRecord:E,totalLogs:O,fetchExecutionLogs:(e,t)=>{P(j,y,f,u,C,D,g,e,t)}}),(0,v.jsx)(ei,{open:d,setOpen:c,deleteRecord:()=>{const e={method:"DELETE",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/pipeline/").concat(u.id,"/"),headers:{"X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken}};j(e).then((()=>{c(!1),J(),g({type:"success",content:"Pipeline Deleted Successfully"})})).catch((e=>{g(y(e))}))}}),(0,v.jsx)(Zl,{isDialogOpen:Z,setDialogOpen:I,apiKeys:L,setApiKeys:A,selectedApiRow:u,apiService:U,type:r.S$.pipeline}),(0,v.jsx)(Gl,{open:z,setOpen:W,type:r.S$.pipeline,id:null===u||void 0===u?void 0:u.id})]})}function di(e){let{type:t}=e;return"api"===t?(0,v.jsx)(Xl,{}):(0,v.jsx)(ai,{type:t})}var ri=o(66364),ci=o.n(ri),ui=o(53226);const pi=[{label:"My Workflows",value:"mine"},{label:"Organization Workflows",value:"all"}],{Title:vi,Text:mi}=Ee.default;function hi(){const e=(0,c.s0)(),t=(0,c.TH)(),n=vl(),l=_(),{setPostHogCustomEvent:i}=Xt(),{count:s,isLoading:a,fetchCount:d}=ul(),[r,u]=(0,p.useState)(!1),[m,h]=(0,p.useState)(!1),{getPromptStudioCount:x}=Bl();(0,p.useEffect)((()=>{d(x)}),[d]);const[f,g]=(0,p.useState)(),[j,y]=(0,p.useState)(),[S,b]=(0,p.useState)(!1),[w,k]=(0,p.useState)(!0),E=(0,p.useRef)(),C=(0,p.useRef)(pi[0].value),[O,D]=(0,p.useState)(null),{setAlertDetails:P}=T(),Z=N((e=>null===e||void 0===e?void 0:e.sessionDetails)),{updateWorkflow:I}=gl(),L=null===Z||void 0===Z?void 0:Z.orgName;function A(){n.getProjectList(C.current===pi[0].value).then((e=>{E.current=e.data,g(e.data)})).catch((()=>{console.error("Unable to get project list")}))}function U(){y({name:"",description:""})}(0,p.useEffect)((()=>{t.pathname==="/".concat(L,"/workflows")&&A()}),[t.pathname]);function F(){y()}const M=()=>{U(),k(!0);try{i("intent_new_wf_project",{info:"Clicked on '+ New Workflow' button"})}catch(vc){}};(0,p.useEffect)((()=>{a||0!==s||m?!a&&s>0&&u(!1):u(!0)}),[a,s,m]);const R=(0,p.useCallback)((()=>{u(!1),h(!0)}),[]);return(0,v.jsxs)(v.Fragment,{children:[r&&(0,v.jsx)(Il,{onClose:R,showModal:r}),(0,v.jsx)(jo,{enableSearch:!0,searchList:f,setSearchList:g,CustomButtons:()=>(0,v.jsx)(Bt,{type:"primary",icon:(0,v.jsx)(et.Z,{}),onClick:M,children:"New Workflow"}),segmentFilter:function(e){C.current=e,E.current="",g(""),A()},segmentOptions:pi,onSearch:function(e,t){if(!e.trim())return void t(E.current);t(E.current.filter((t=>t.workflow_name.toLowerCase().includes(e.toLowerCase()))))}}),(0,v.jsx)("div",{className:"workflows-pg-layout",children:(0,v.jsxs)("div",{className:"workflows-pg-body",children:[!E.current&&(0,v.jsx)(At,{}),E.current&&ci()(null===E||void 0===E?void 0:E.current)&&(0,v.jsx)("div",{className:"list-of-workflows-body",children:(0,v.jsx)(tt,{text:"No Workflow available",btnText:"New Workflow",handleClick:()=>{U(),k(!0)}})}),ci()(f)&&!ci()(null===E||void 0===E?void 0:E.current)&&(0,v.jsx)("div",{className:"center",children:(0,v.jsx)(vi,{level:5,children:"No results found for this search"})}),!ci()(f)&&(0,v.jsx)(Oo,{isLoading:S,isEmpty:!(null!==f&&void 0!==f&&f.length),listOfTools:f,setOpenAddTool:k,handleEdit:function(e,t){k(!0),y({name:t.workflow_name,description:t.description||"",id:t.id})},handleDelete:async(e,t)=>{await(async e=>{let t=!1;return await n.canUpdate(e).then((e=>{var o;t=(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.can_update)||!1})),t})(t.id)?n.deleteProject(t.id).then((()=>{A(),P({type:"success",content:"Workflow deleted successfully"})})).catch((()=>{P({type:"error",content:"Unable to delete workflow ".concat(t.id)})})):P({type:"error",content:"Cannot delete this Workflow, since it is used in one or many of the API/ETL/Task pipelines"})},titleProp:"workflow_name",descriptionProp:"description",idProp:"id",type:"Workflow"}),j&&(0,v.jsx)(ui.E,{component:()=>o.e(7).then(o.bind(o,71007)),componentName:"NewWorkflow",name:j.name,description:j.description,onDone:function(t,o){b(!0),n.editProject(t,o,null===j||void 0===j?void 0:j.id).then((t=>{var o;F(),null!==j&&void 0!==j&&j.name?A():(o=t.data,I({projectName:null===o||void 0===o?void 0:o.workflow_name}),e("/".concat(L,"/workflows/").concat(o.id))),P({type:"success",content:"Workflow updated successfully"}),A()})).catch((e=>{l(e,"",D)})).finally((()=>{b(!1)}))},onClose:F,loading:S,toggleModal:k,openModal:w,backendErrors:O,setBackendErrors:D})]})})]})}function xi(){return(0,v.jsx)(hi,{})}function fi(e){let{children:t}=e;const o=(0,c.s0)(),n=(0,c.TH)(),l=(0,p.useRef)(),[s,a]=(0,p.useState)(""),{sessionDetails:d}=N(),{projectName:r}=gl();return(0,p.useEffect)((()=>{l.current=n.pathname;const e=l.current.split("/"),t=e.length-1;if(-1===t)return;const o=e[t];a(o)}),[]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"appHeader",children:[(0,v.jsxs)("div",{className:"project_detail",children:[(0,v.jsx)(i.ZP,{size:"small",type:"text",onClick:()=>o("/".concat(d.orgName,"/workflows")),children:(0,v.jsx)(go.Z,{})}),(0,v.jsx)(Ee.default,{className:"proj_name",children:r||"Name of the project"})]}),(0,v.jsx)("div",{children:(0,v.jsx)(Be.Z,{children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(To.Z,{}),disabled:!0,type:"help"===s?"primary":"default",children:"Help"},"help")})})]}),(0,v.jsx)("div",{className:"appBody",children:(0,v.jsx)("div",{className:"appBody2",children:t})})]})}const gi={toolSettings:{id:"",tool_id:""}},ji=(0,S.Ue)(((e,t)=>({...gi,setToolSettings:t=>{const o={toolSettings:{...t}};e((()=>({...o})))},updateToolSettings:o=>{e((()=>({toolSettings:{...t().toolSettings,...o}})))},cleanUpToolSettings:()=>{e(gi)}})));function yi(){const{id:e}=(0,c.UO)(),{sessionDetails:t}=N(),{updateWorkflow:o,setDefaultWorkflowState:n}=gl(),{cleanUpToolSettings:l}=ji(),{setAlertDetails:i}=T(),s=ie(),[a,d]=(0,p.useState)(!0),u=(0,c.s0)(),m=_();return(0,p.useEffect)((()=>()=>{l(),n()}),[]),(0,p.useEffect)((()=>{const n={projectId:e,isLoading:!1};o(n);const l={method:"GET",url:"/api/v1/unstract/".concat(null===t||void 0===t?void 0:t.orgId,"/workflow/").concat(e,"/")};d(!0),s(l).then((e=>{const t=null===e||void 0===e?void 0:e.data;n.prompt=null===t||void 0===t?void 0:t.prompt_text,n.details=t,n.status=r.xB.generated,n.isLoading=!1,n.projectName=t.workflow_name,o(n)})).catch((e=>{i(m(e,"Failed to load the workflow")),u("/".concat(null===t||void 0===t?void 0:t.orgName,"/workflows"))})).finally((()=>{d(!1)}))}),[e]),a?(0,v.jsx)(At,{}):(0,v.jsx)(fi,{children:(0,v.jsx)(c.j3,{})})}var _i=o(46199),Si=o(52273),bi=o(79023),Ni=o(71524),wi=o(91515),ki=o(39045),Ti=o(30161),Ei=o(12586);const Ci=e=>{let{open:t,setOpen:o,fileList:n,setFileList:l,wfExecutionParams:s,continueWfExecution:a}=e;return(0,v.jsx)($e.Z,{title:"Upload input file",centered:!0,open:t,maskClosable:!1,onCancel:()=>{o(!1)},onOk:()=>{a(s[0],s[1],s[2]),o(!1)},okButtonProps:{disabled:0===n.length},okText:"Continue",children:(0,v.jsx)(Tt.Z,{fileList:n,beforeUpload:e=>(l([...n,e]),!1),onRemove:e=>{l(n.filter((t=>t.uid!==e.uid)))},children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(kt.Z,{}),children:"Select File"})})})},Oi=!0;function Di(e){let{statusBarMsg:t,initializeWfComp:o,stepLoader:n}=e;const[l,s]=(0,p.useState)(""),[d,c]=(0,p.useState)(""),[u,m]=(0,p.useState)(""),[h,x]=(0,p.useState)(!1),[f,g]=(0,p.useState)([]),[j,y]=(0,p.useState)([]),[S,b]=(0,p.useState)(!1),[w,k]=(0,p.useState)(!1),[E,C]=(0,p.useState)(!1),[O,D]=(0,p.useState)(!1),[P,Z]=(0,p.useState)(!1),[I,L]=(0,p.useState)(!1),[A,U]=(0,p.useState)(""),[F,M]=(0,p.useState)(""),R=_(),{projectName:z,details:W,isLoading:q,loadingType:H,updateWorkflow:G,source:K,destination:B}=gl(),{setAlertDetails:X}=T(),{sessionDetails:V}=N(),{orgName:Y}=V,Q=ie(),{posthogWfDeploymentEventText:J,setPostHogCustomEvent:$}=Xt();(0,p.useEffect)((()=>{k("API"===(null===K||void 0===K?void 0:K.connection_type)&&"API"===(null===B||void 0===B?void 0:B.connection_type)),C("FILESYSTEM"===(null===B||void 0===B?void 0:B.connection_type)&&(null===K||void 0===K?void 0:K.connector_instance)&&(null===B||void 0===B?void 0:B.connector_instance)),D((null===K||void 0===K?void 0:K.connector_instance)&&("DATABASE"===(null===B||void 0===B?void 0:B.connection_type)&&B.connector_instance||"MANUALREVIEW"===B.connection_type))}),[K,B]),(0,p.useEffect)((()=>{w?M("API"):E?M("Task Pipeline"):O&&M("ETL Pipeline")}),[A]),(0,p.useEffect)((()=>{u===r.au[1]&&m("")}),[n]);const ee=(e,t,o)=>{y([e,t,o]),g([]),x(!0)},te=async(e,t,n)=>{try{t?$("wf_step",{info:"Clicked on '".concat(r.au[n],"' button (Step Execution)")}):$("wf_run_wf",{info:"Clicked on 'Run Workflow' button (Normal Execution)"})}catch(vc){}const i=null===W||void 0===W?void 0:W.id;if(!i)return void X({type:"error",content:"Invalid workflow id"});const a={workflow_id:i};e?await(async(e,t,n)=>{o(),t?(c("STEP"),e.execution_action=r.au[0]):c("NORMAL");const l={isLoading:!0,loadingType:"EXECUTE"};G(l);try{var i;const o=await oe(e),l=null===o||void 0===o||null===(i=o.data)||void 0===i?void 0:i.execution_id;s(l),e.execution_id=l,t&&(e.execution_action=r.au[n]);const a=await oe(e),d=null===a||void 0===a?void 0:a.data;"ERROR"===(null===d||void 0===d?void 0:d.execution_status)&&X({type:"error",content:null===d||void 0===d?void 0:d.error})}catch(vc){var a,d,u;const t=(null===vc||void 0===vc||null===(a=vc.response)||void 0===a||null===(d=a.data)||void 0===d||null===(u=d.errors)||void 0===u?void 0:u.length)>0?vc.response.data.errors[0].detail:"Something went wrong";X({type:"error",content:t})}finally{le(),l.isLoading=!1,l.loadingType="",G(l)}})(a,t,n):(m(r.au[n]),a.execution_id=l,a.execution_action=r.au[n],oe(a).then((()=>{})).catch((e=>{X(R(e))})))},oe=async e=>{let t={"X-CSRFToken":null===V||void 0===V?void 0:V.csrfToken,"Content-Type":"application/json"};(e=>e.execution_id&&e.execution_id.length>0)(e)&&w&&f.length>0&&(e=(e=>{const t=new FormData;return f.forEach((e=>{t.append("files",e)})),t.append("workflow_id",e.workflow_id),t.append("execution_id",e.execution_id),e.execution_action&&t.append("execution_action",e.execution_action),t})(e),t={"X-CSRFToken":null===V||void 0===V?void 0:V.csrfToken,"Content-Type":"multipart/form-data"});const o={method:"POST",url:"/api/v1/unstract/".concat(null===V||void 0===V?void 0:V.orgId,"/workflow/execute/"),headers:t,data:e};return Q(o).then((e=>e)).catch((e=>{X(R(e))}))},ne=e=>q?"GENERATE"===H||("NORMAL"===d||(0===e||4===e||(u===r.au[1]||u===r.au[2]||u===r.au[e]))):1===e||2===e||3===e,le=()=>{c(""),m(""),s("")},se=()=>{if(0===(null===W||void 0===W?void 0:W.tool_instances.length))return!0},ae=()=>!!se()||("API"!==(null===K||void 0===K?void 0:K.connection_type)||"API"!==(null===B||void 0===B?void 0:B.connection_type))&&(("FILESYSTEM"!==(null===K||void 0===K?void 0:K.connection_type)||"MANUALREVIEW"!==(null===B||void 0===B?void 0:B.connection_type))&&(!(null!==K&&void 0!==K&&K.connector_instance)||!(null!==B&&void 0!==B&&B.connector_instance))),de=e=>{var t;t=e,(null===W||void 0===W?void 0:W.id)?("API"===t&&b(!0),"TASK"===t&&Z(!0),"ETL"===t&&L(!0)):X({type:"error",content:"Invalid workflow id"});try{$(J[e],{info:"Clicked on 'Deploy as ".concat(e,"' button"),workflow_name:z})}catch(vc){}};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"actions-container",children:[(0,v.jsxs)(Be.Z,{direction:"horizontal",className:"display-flex-left",children:[(0,v.jsx)(bo.Z,{title:"Run Workflow",children:(0,v.jsx)(i.ZP,{onClick:()=>w?ee(!0,!1,4):te(!0,!1,4),disabled:ae()||ne(4),loading:"NORMAL"===d,children:(0,v.jsx)(Si.Z,{})})}),(0,v.jsx)(Ro.Z,{type:"vertical"}),!Oi&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(bo.Z,{title:"Start step execution",children:(0,v.jsx)(i.ZP,{onClick:()=>w?ee(!0,!0,0):te(!0,!0,0),disabled:ae()||ne(0),loading:"STEP"===d,children:(0,v.jsx)(Ie.ZH,{className:"step-icon"})})}),(0,v.jsx)(bo.Z,{title:"Next step",children:(0,v.jsx)(i.ZP,{onClick:()=>te(!1,!0,1),disabled:ne(1),loading:u===r.au[1],children:(0,v.jsx)(bi.Z,{})})}),(0,v.jsx)(bo.Z,{title:"Execute remaining steps",children:(0,v.jsx)(i.ZP,{onClick:()=>te(!1,!0,3),disabled:ne(3),loading:u===r.au[3],children:(0,v.jsx)(Ni.Z,{})})}),(0,v.jsx)(bo.Z,{title:"Stop execution",children:(0,v.jsx)(i.ZP,{onClick:()=>te(!1,!0,2),disabled:ne(2),loading:u===r.au[2],children:(0,v.jsx)(wi.Z,{})})}),(0,v.jsx)(Ro.Z,{type:"vertical"})]}),(0,v.jsx)(bo.Z,{title:"Clear Cache",children:(0,v.jsx)(i.ZP,{disabled:q,onClick:()=>{const e=null===W||void 0===W?void 0:W.id;if(!e)return void X({type:"error",content:"Invalid workflow id"});const t={method:"GET",url:"/api/v1/unstract/".concat(null===V||void 0===V?void 0:V.orgId,"/workflow/").concat(e,"/clear-cache/")};Q(t).then((e=>{const t=null===e||void 0===e?void 0:e.data;X({type:"success",content:t})})).catch((e=>{var t;const o=(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)||"Failed to clear cache.";X({type:"error",content:o})}))},children:(0,v.jsx)(Vl.Z,{})})}),(0,v.jsx)(bo.Z,{title:"Clear Processed File History",children:(0,v.jsx)(i.ZP,{disabled:q,onClick:()=>{const e=null===W||void 0===W?void 0:W.id;if(!e)return void X({type:"error",content:"Invalid workflow id"});const t={method:"GET",url:"/api/v1/unstract/".concat(null===V||void 0===V?void 0:V.orgId,"/workflow/").concat(e,"/clear-file-marker/")};Q(t).then((e=>{const t=null===e||void 0===e?void 0:e.data;X({type:"success",content:t})})).catch((e=>{var t;const o=(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.data)||"Failed to clear file marker.";X({type:"error",content:o})}))},children:(0,v.jsx)(ki.Z,{})})}),(0,v.jsx)(Ro.Z,{type:"vertical"}),(0,v.jsx)(bo.Z,{title:"Deploy as API",children:(0,v.jsx)(i.ZP,{disabled:se()||!w,onClick:()=>de("API"),children:(0,v.jsx)(Ti.Z,{})})}),(0,v.jsx)(bo.Z,{title:"Deploy as ETL Pipeline",children:(0,v.jsx)(i.ZP,{disabled:se()||!O,onClick:()=>de("ETL"),children:(0,v.jsx)(Ei.Z,{})})}),(0,v.jsx)(bo.Z,{title:"Deploy as Task Pipeline",children:(0,v.jsx)(i.ZP,{onClick:()=>de("TASK"),disabled:se()||!E,children:(0,v.jsx)(Ti.Z,{})})}),(0,v.jsx)(Ro.Z,{type:"vertical"}),A&&(0,v.jsx)(Wt.Z,{message:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("span",{children:["This Workflow has been deployed as an ",F,":"," "]}),(0,v.jsx)(a.rU,{to:"/".concat(Y,"/").concat(F.split(" ")[0].toLowerCase()),children:A})]}),type:"success"})]}),(0,v.jsx)("div",{className:"status-bar",children:(0,v.jsx)(Ee.default.Text,{children:t})})]}),h&&(0,v.jsx)(Ci,{open:h,setFileList:g,fileList:f,setOpen:x,wfExecutionParams:j,continueWfExecution:te}),S&&(0,v.jsx)(yl,{open:S,setOpen:b,isEdit:!1,workflowId:null===W||void 0===W?void 0:W.id,setDeploymentName:U}),P&&(0,v.jsx)(si,{open:P,setOpen:Z,type:"task",title:r.xs.task.modalTitle,workflowId:null===W||void 0===W?void 0:W.id,setDeploymentName:U}),I&&(0,v.jsx)(si,{open:I,setOpen:L,type:"etl",title:r.xs.etl.modalTitle,workflowId:null===W||void 0===W?void 0:W.id,setDeploymentName:U})]})}var Pi=o(60090),Zi=o(46401),Ii=o(62444),Li=o(82864),Ai=o(92414),Ui=o(55527),Fi=o(35796),Mi=o(83388);const Ri=o.p+"static/media/coming-soon.757b1d690f276c60d8b3.png";function zi(e){let{listOfConnectors:t,selectedId:o,handleSelectItem:n}=e;return(0,v.jsx)("div",{className:"conn-modal-menu",children:(0,v.jsx)(Mi.Z,{className:"sidebar-menu",style:{border:0},selectedKeys:[o],mode:"inline",items:t.map((e=>({key:null===e||void 0===e?void 0:e.key,label:(0,v.jsx)(v.Fragment,{children:null!==e&&void 0!==e&&e.isDisabled?(0,v.jsx)(bo.Z,{title:"Coming Soon",children:(0,v.jsxs)("div",{className:"coming-soon-container",children:[(0,v.jsx)("img",{src:Ri,alt:"Coming Soon",className:"coming-soon-img"}),null===e||void 0===e?void 0:e.label]})}):null===e||void 0===e?void 0:e.label}),disabled:null===e||void 0===e?void 0:e.isDisabled,icon:null===e||void 0===e?void 0:e.icon}))),onClick:n})})}function Wi(e){let{spec:t,formData:o,setFormData:n,isLoading:l,handleUpdate:i}=e;return(0,v.jsx)(qt,{schema:t,formData:o,setFormData:n,isLoading:l,validateAndSubmit:()=>{i({configuration:o},!0)},isStateUpdateRequired:!0,children:(0,v.jsx)("div",{className:"display-flex-right tool-settings-submit-btn",children:(0,v.jsx)(Bt,{type:"primary",htmlType:"submit",children:"Save"})})})}function qi(e){var t;let{selectedId:o,type:n,handleUpdate:l,editItemId:i,connectorMetadata:s,isConnAvailable:a,specConfig:d,formDataConfig:r,setFormDataConfig:c,isSpecConfigLoading:u,connDetails:p,connType:m,selectedItemName:h}=e;return(0,v.jsxs)(Pe.Z,{className:"conn-modal-tab-body",children:[(0,v.jsx)(Ze.Z,{span:12,className:"conn-modal-form-right",children:(0,v.jsxs)("div",{className:"conn-modal-flex",children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:"Connection Settings"}),(0,v.jsx)("div",{className:"conn-modal-gap"}),(0,v.jsx)("div",{className:"conn-modal-flex-1",children:o?(0,v.jsx)(to,{selectedSourceId:o,metadata:s,type:n,editItemId:i,handleUpdate:l,connDetails:p,connType:m,selectedSourceName:h,formDataConfig:r}):(0,v.jsx)(tt,{text:a?"Select the connector":"No Connector available"})})]})}),"MANUALREVIEW"!==m&&(0,v.jsx)(Ze.Z,{span:12,className:"conn-modal-form-left",children:(0,v.jsxs)("div",{className:"conn-modal-flex",children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:"Configuration"}),(0,v.jsx)("div",{className:"conn-modal-gap"}),(0,v.jsx)("div",{className:"conn-modal-flex-1",children:d&&0!==(null===(t=Object.keys(d))||void 0===t?void 0:t.length)?(0,v.jsx)(Wi,{selectedId:o,handleUpdate:l,spec:d,formData:r,setFormData:c,isLoading:u}):(0,v.jsx)(tt,{text:"Failed to load the configuration form"})})]})})]})}let Hi={};function Gi(){const e=ie(),{sessionDetails:t}=N(),o="/api/v1/unstract/".concat(t.orgId.replaceAll('"',""));return{getFileList:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/";return Hi={url:"".concat(o,"/file"),method:"GET",params:{connector_id:t,path:n}},e(Hi)}}}var Ki=o(61753),Bi=o(87605);const{DirectoryTree:Xi}=Bi.default,{Text:Vi}=Ee.default;function Yi(e){let{selectedItem:t="",data:o=[],loadingData:n,error:l}=e;const i=Gi(),[s,a]=(0,p.useState)([]),[d,r]=(0,p.useState)([]),[c,u]=(0,p.useState)([]),[m,h]=(0,p.useState)(!0),x=(0,p.useRef)("");function f(e){Ji(e),a([...e]),u([])}return(0,p.useEffect)((()=>{f(structuredClone(o))}),[o,n,l]),(0,p.useEffect)((()=>{r([]),u([])}),[t]),(0,v.jsxs)("div",{className:"storageExplorer",children:[0!==s.length&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"fileText fileHeading",children:[(0,v.jsx)(Vi,{type:"secondary",ellipsis:!0,strong:!0,children:"Name"}),(0,v.jsx)(Vi,{type:"secondary",ellipsis:!0,strong:!0,children:"Size"}),(0,v.jsx)(Vi,{type:"secondary",ellipsis:!0,strong:!0,children:"Modified at"})]}),(0,v.jsx)(Xi,{rootClassName:"explorerTree",showLine:!0,treeData:s,switcherIcon:(0,v.jsx)(Ki.Z,{}),expandedKeys:d,selectedKeys:c,autoExpandParent:m,onExpand:function(e){r(e),h(!1)},onSelect:function(e,t){u(e),t.node.isLeaf?x.current="":x.current=t.node.key},loadData:function(e){let{key:o,children:n}=e;return new Promise((e=>{var l;n?e():(l=o,i.getFileList(t,l).then((e=>{let t=s;l?Qi(l,t).children=e.data:t=e.data,f(t)})).catch((()=>{console.error('Unable to get files on "'.concat(t,'" for the folder "').concat(l,'"'))}))).then((()=>{e()})).catch((()=>{}))}))},expandAction:!1})]}),n&&(0,v.jsx)(At,{}),0===(null===s||void 0===s?void 0:s.length)&&!l&&(0,v.jsx)("div",{className:"center",children:(0,v.jsx)(Vi,{children:"No files"})}),l&&(0,v.jsx)("div",{className:"center",children:(0,v.jsx)(Vi,{children:"Error loading the data"})})]})}function Qi(e,t){let o;for(const n of t){if(n.key===e){o=n;break}if(n.children){const t=Qi(e,n.children);if(t){o=t;break}}}return o}function Ji(e){let t="",o="",n="",l="",i="";e.forEach((e=>{var s;t=e.name,o=t.split("/").at(-1),n="file"===e.type,l=(null===(s=e.modified_at)||void 0===s?void 0:s.split(" ")[0])||"",i=n?(0,r.td)(e.size):"",e.key=t,e.icon=n?(0,v.jsx)(Ie.BB,{}):(0,v.jsx)(Ie.gt,{}),e.title=(0,v.jsxs)("div",{className:"fileText",children:[(0,v.jsx)(Vi,{ellipsis:!0,children:o}),(0,v.jsx)(Vi,{children:i}),(0,v.jsx)(Vi,{children:l})]}),e.isLeaf=n,e.children&&Ji(e.children)}))}function $i(e){let{selectedItem:t}=e;const o=Gi(),[n,l]=(0,p.useState)([]),[i,s]=(0,p.useState)(!1),[a,d]=(0,p.useState)(!1);return(0,p.useEffect)((()=>{l([]),t&&(s(!0),o.getFileList(t).then((e=>{l(e.data),d(!1)})).catch((()=>{d(!0)})).finally((()=>{s(!1)})))}),[t]),(0,v.jsx)(Yi,{selectedItem:t,data:n,loadingData:i,error:a})}let es;try{es=Object(function(){var e=new Error("Cannot find module '../../../plugins/manual-review/db-rules/DBRules.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function ts(e){let{open:t,setOpen:o,type:n,selectedId:l,setSelectedId:i,handleUpdate:s,filteredList:a,connectorId:d,connectorMetadata:r,specConfig:c,formDataConfig:u,setFormDataConfig:m,isSpecConfigLoading:h,connDetails:x,connType:f,selectedItemName:g,setSelectedItemName:j,workflowDetails:y}=e;const[_,S]=(0,p.useState)("1");(0,p.useEffect)((()=>{S(r&&"FILESYSTEM"===f?"2":"1")}),[t,r]);const{setPostHogCustomEvent:b,posthogConnectorEventText:N}=Xt(),[w,k]=(0,p.useState)([{key:"1",label:"Settings",visible:!0},{key:"2",label:"File System",disabled:!d||(null===x||void 0===x?void 0:x.connector_id)!==l||"DATABASE"===f,visible:!1}]);(0,p.useEffect)((()=>{const e=w.map((e=>("2"===e.key?e.visible="FILESYSTEM"===f:"MANUALREVIEW"===e.key?(e.disabled=!d||(null===x||void 0===x?void 0:x.connector_id)!==l,e.visible="DATABASE"===f||"MANUALREVIEW"===f):e.visible=!0,e)));k(e)}),[t]),(0,p.useEffect)((()=>{const e=w.map((e=>("MANUALREVIEW"===e.key&&(e.disabled=!d||(null===x||void 0===x?void 0:x.connector_id)!==l),e)));k(e)}),[r]),(0,p.useEffect)((()=>{try{const e=Object(function(){var e=new Error("Cannot find module '../../../plugins/manual-review/connector-config-tab-mrq/ConnectorConfigTabMRQ'");throw e.code="MODULE_NOT_FOUND",e}());e&&(e.disabled=!d||(null===x||void 0===x?void 0:x.connector_id)!==l,e.visible=!1,(e=>{k((t=>t.some((t=>t.key===e.key))?t:[...t,e]))})(e))}catch{}}),[]);return(0,v.jsx)($e.Z,{open:t,onCancel:()=>o(!1),centered:!0,footer:null,width:1200,maskClosable:!1,children:(0,v.jsxs)("div",{className:"conn-modal-body",children:[(0,v.jsx)(Ee.default.Text,{className:"modal-header",strong:!0,children:"Configure Connector"}),(0,v.jsx)("div",{className:"conn-modal-gap"}),(0,v.jsxs)(Pe.Z,{className:"conn-modal-row",children:[(0,v.jsx)(Ze.Z,{span:4,className:"conn-modal-col conn-modal-col-left conn-modal-form-pad-right",children:(0,v.jsx)(zi,{listOfConnectors:a,selectedId:l,handleSelectItem:e=>{const t=e.key;i(null===t||void 0===t?void 0:t.toString()),S("1");const o=[...a].find((e=>(null===e||void 0===e?void 0:e.key)===t));j(null===o||void 0===o?void 0:o.label);try{b(N["".concat(f,":").concat(n)],{info:"Selected a connector",connector_name:null===o||void 0===o?void 0:o.label})}catch(vc){}}})}),(0,v.jsxs)(Ze.Z,{span:20,className:"conn-modal-col conn-modal-form-pad-left",children:[(0,v.jsx)(bl.Z,{activeKey:_,items:w.filter((e=>!1!==(null===e||void 0===e?void 0:e.visible))),onChange:e=>{S(e)},moreIcon:(0,v.jsx)(v.Fragment,{})}),"1"===_&&(0,v.jsx)(qi,{selectedId:l,type:n,handleUpdate:s,editItemId:d,connectorMetadata:r,isConnAvailable:!(null===a||void 0===a||!a.length),specConfig:c,formDataConfig:u,setFormDataConfig:m,isSpecConfigLoading:h,connDetails:x,connType:f,selectedItemName:g}),"2"===_&&"FILESYSTEM"===f&&(0,v.jsx)($i,{selectedItem:d}),"MANUALREVIEW"===_&&es&&(0,v.jsx)(es,{connDetails:x,workflowDetails:y})]})]})]})})}const os={input:"Data Source Settings",output:"Data Destination Settings"},ns={FILE_SYSTEM:["box|4d94d237-ce4b-45d8-8f34-ddeefc37c0bf","http|6fdea346-86e4-4383-9a21-132db7c9a576"]},ls={FILE_SYSTEM:["pcs|b8cd25cd-4452-4d54-bd5e-e7d71459b702"]};function is(e){let{type:t,endpointDetails:o,message:n}=e;const l=gl(),{source:s,destination:a,allowChangeEndpoint:d,details:c}=l,[u,m]=(0,p.useState)({}),[h,x]=(0,p.useState)(!1),[f,g]=(0,p.useState)([]),[j,y]=(0,p.useState)([]),[S,b]=(0,p.useState)(null),[w,k]=(0,p.useState)({}),[E,C]=(0,p.useState)({}),[O,D]=(0,p.useState)(!1),[P,Z]=(0,p.useState)({}),[I,L]=(0,p.useState)(""),[A,U]=(0,p.useState)(""),[F,M]=(0,p.useState)([{value:"API",label:"API"},{value:"FILESYSTEM",label:"File System"},{value:"DATABASE",label:"Database"}]),{sessionDetails:R}=N(),{updateWorkflow:z}=gl(),{setAlertDetails:W}=T(),q=ie(),H=_(),{flags:G}=R,K={input:(0,v.jsx)(Ii.Z,{className:"ds-set-icon-size"}),output:(0,v.jsx)(Li.Z,{className:"ds-set-icon-size"})};(0,p.useEffect)((()=>{try{const e=Object(function(){var e=new Error("Cannot find module '../../../plugins/dscard-input-options/AppDeploymentCardInputOptions'");throw e.code="MODULE_NOT_FOUND",e}());G.app_deployment&&e&&(e=>{M((t=>t.some((t=>t.value===e.value))?t:[...t,e]))})(e)}catch{}}),[]),(0,p.useEffect)((()=>{if("output"===t)if(""===(null===s||void 0===s?void 0:s.connection_type))m({});else{const e="API"===(null===s||void 0===s?void 0:s.connection_type),t=F.filter((t=>e?"API"===t.value:"API"!==t.value));m(t)}if("input"===t){const e=F.filter((e=>"DATABASE"!==e.value&&"APPDEPLOYMENT"!==e.value));m(e)}}),[s,a]),(0,p.useEffect)((()=>{var e;(null===o||void 0===o?void 0:o.connection_type)!==S&&b(null===o||void 0===o?void 0:o.connection_type),null!==o&&void 0!==o&&null!==(e=o.connector_instance)&&void 0!==e&&e.length?(null===w||void 0===w?void 0:w.id)!==(null===o||void 0===o?void 0:o.connector_instance)&&Y():k({})}),[o]),(0,p.useEffect)((()=>{const e=[];if([...f].forEach((t=>{null!==o&&void 0!==o&&o.connection_type&&(null===t||void 0===t?void 0:t.connector_mode.split("_").join(""))!==(null===o||void 0===o?void 0:o.connection_type)||e.push((0,r.Lm)(null===t||void 0===t?void 0:t.name,null===t||void 0===t?void 0:t.id,B(null===t||void 0===t?void 0:t.icon),void 0,void 0,null===t||void 0===t?void 0:t.isDisabled))})),L(""),y(e),null===o||void 0===o||!o.id)return;Z(o.configuration||{});const t={method:"GET",url:"/api/v1/unstract/".concat(null===R||void 0===R?void 0:R.orgId,"/workflow/endpoint/").concat(null===o||void 0===o?void 0:o.id,"/settings/")};D(!0),q(t).then((e=>{const t=null===e||void 0===e?void 0:e.data;C((null===t||void 0===t?void 0:t.schema)||{})})).catch((e=>{W(H(e,"Failed to load the spec"))})).finally((()=>{D(!1)}))}),[S,f]),(0,p.useEffect)((()=>{if(!t)return;const e={method:"GET",url:"/api/v1/unstract/".concat(null===R||void 0===R?void 0:R.orgId,"/supported_connectors/?type=").concat(t.toUpperCase())};q(e).then((e=>{var t;let o=null===e||void 0===e?void 0:e.data;Object.keys(ls).forEach((e=>{const t=ls[e];o=o.filter((o=>!(o.connector_mode===e&&t.includes(o.id))))}));const n=null===(t=o)||void 0===t?void 0:t.map((e=>{var t;return{...e,isDisabled:null===(t=ns[null===e||void 0===e?void 0:e.connector_mode])||void 0===t?void 0:t.includes(null===e||void 0===e?void 0:e.id)}}));g(n||[])})).catch((e=>{W(H(e))})).finally((()=>{}))}),[t]);const B=e=>(0,v.jsx)(so.Z,{src:e,height:25,width:25,preview:!1}),X=()=>{"input"===t&&(e=>{const t={...a,...e},o={method:"PUT",url:"/api/v1/unstract/".concat(null===R||void 0===R?void 0:R.orgId,"/workflow/endpoint/").concat(null===a||void 0===a?void 0:a.id,"/"),headers:{"X-CSRFToken":null===R||void 0===R?void 0:R.csrfToken,"Content-Type":"application/json"},data:t};q(o).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||{},o={};o.destination=t,z(o)})).catch((e=>{W(H(e,"Failed to update"))}))})({connection_type:"",connector_instance:null})},V=(e,n)=>{const l={...o,...e},i={method:"PUT",url:"/api/v1/unstract/".concat(null===R||void 0===R?void 0:R.orgId,"/workflow/endpoint/").concat(null===o||void 0===o?void 0:o.id,"/"),headers:{"X-CSRFToken":null===R||void 0===R?void 0:R.csrfToken,"Content-Type":"application/json"},data:l};q(i).then((e=>{const o=(null===e||void 0===e?void 0:e.data)||{},l={};"input"===t?l.source=o:l.destination=o,z(l),n&&W({type:"success",content:"Successfully updated"})})).catch((e=>{W(H(e,"Failed to update"))}))},Y=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===R||void 0===R?void 0:R.orgId,"/connector/").concat(null===o||void 0===o?void 0:o.connector_instance,"/")};q(e).then((e=>{const t=null===e||void 0===e?void 0:e.data;t.connector_metadata.connectorName=(null===t||void 0===t?void 0:t.connector_name)||"",k(t),L(null===t||void 0===t?void 0:t.connector_id)})).catch((e=>{W(H(e))}))};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(Pe.Z,{className:"ds-set-card-row",children:[(0,v.jsx)(Ze.Z,{span:4,className:"ds-set-card-col1",children:(0,v.jsx)(bo.Z,{title:os[t],children:K[t]})}),(0,v.jsx)(Ze.Z,{span:12,className:"ds-set-card-col2",children:(0,v.jsxs)(tn,{children:[(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(bo.Z,{title:!d&&"Workflow used in API/Task/ETL deployment",children:(0,v.jsx)(xt.default,{className:"ds-set-card-select",size:"small",options:u,placeholder:"Select Connector Type",value:(null===o||void 0===o?void 0:o.connection_type)||void 0,disabled:!d,onChange:e=>{V({connection_type:e,connector_instance:null}),X()}})}),(0,v.jsx)(bo.Z,{title:"".concat(null!==o&&void 0!==o&&o.connection_type?"":"Select the connector type from the dropdown"),children:(0,v.jsx)(i.ZP,{type:"text",size:"small",onClick:()=>x(!0),disabled:!(null!==o&&void 0!==o&&o.connection_type)||"API"===S||"APPDEPLOYMENT"===S,children:(0,v.jsx)(Ai.Z,{})})})]}),(0,v.jsx)("div",{className:"display-flex-align-center",children:null!==w&&void 0!==w&&w.connector_name?(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(so.Z,{src:null===w||void 0===w?void 0:w.icon,height:20,width:20,preview:!1}),(0,v.jsx)(Ee.default.Text,{className:"font-size-12",children:null===w||void 0===w?void 0:w.connector_name})]}):(0,v.jsx)(v.Fragment,{children:"API"===S||"APPDEPLOYMENT"===S?(0,v.jsxs)(Ee.default.Text,{className:"font-size-12 display-flex-align-center",ellipsis:{rows:1,expandable:!1},type:"secondary",children:[(0,v.jsx)(Ui.Z,{twoToneColor:"#52c41a"}),(0,v.jsxs)("span",{style:{marginLeft:"5px"},children:[(0,r.Qs)(t)," set to ",S," successfully"]})]}):(0,v.jsxs)(Ee.default.Text,{className:"font-size-12 display-flex-align-center",ellipsis:{rows:1,expandable:!1},type:"secondary",children:[(0,v.jsx)(Fi.Z,{}),(0,v.jsx)("span",{style:{marginLeft:"5px"},children:"Connector not configured"})]})})})]})}),(0,v.jsx)(Ze.Z,{span:8,className:"ds-set-card-col3",children:(0,v.jsx)(Ee.default.Paragraph,{ellipsis:{rows:2,expandable:!1},className:"font-size-12",type:"secondary",children:n})})]}),(0,v.jsx)(ts,{open:h,setOpen:x,type:t,selectedId:I,setSelectedId:L,handleUpdate:V,filteredList:j,connectorMetadata:null===w||void 0===w?void 0:w.connector_metadata,connectorId:null===w||void 0===w?void 0:w.id,specConfig:E,formDataConfig:P,setFormDataConfig:Z,isSpecConfigLoading:O,connDetails:w,connType:S,selectedItemName:A,setSelectedItemName:U,workflowDetails:c})]})}var ss=o(98422),as=o(44587),ds=o(1067),rs=o(39273);function cs(e){let{iconSrc:t,showBorder:o}=e;const n=(0,rs.Z)();if(t&&"string"===typeof t&&t.includes("<svg")){const e="data:image/svg+xml,".concat(encodeURIComponent(t));return(0,v.jsx)("div",{className:"display-flex-center ".concat(o?"tool-icon-border":""),children:(0,v.jsx)(so.Z,{src:e,preview:!1,height:30,width:30})})}return"string"===typeof t&&n.test(t)?(0,v.jsx)("div",{className:"display-flex-center ".concat(o?"tool-icon-border":""),children:t}):(0,v.jsx)("div",{className:"display-flex-center ".concat(o?"tool-icon-border":""),children:"\ud83e\uddf0"})}const us=e=>{let{step:t,index:o,activeTool:n,moveItem:l}=e;const i=(0,p.useRef)(null),{sessionDetails:s}=N(),{toolSettings:a,setToolSettings:d,cleanUpToolSettings:r}=ji(),{deleteToolInstance:c}=gl(),{setAlertDetails:u}=T(),m=ie(),h=_(),[,x]=(0,ss.L)({accept:"STEP",drop:e=>{(o||null!==e&&void 0!==e&&e.function_name)&&(e.index===o||null!==e&&void 0!==e&&e.function_name)||l(e.index,o,null===e||void 0===e?void 0:e.function_name)},hover(e,t){var n;if(!i.current)return;const s=e.index,a=o;if(s===a)return;const d=null===(n=i.current)||void 0===n?void 0:n.getBoundingClientRect(),r=(d.bottom-d.top)/2,c=t.getClientOffset().y-d.top;s<a&&c<r||s>a&&c>r||(l(s,a,null===e||void 0===e?void 0:e.function_name,!0),e.index=a)}}),[{isDragging:f},g]=(0,ds.c)({type:"STEP",item:{index:o},collect:e=>({isDragging:e.isDragging()})});return g(x(i)),(0,v.jsx)("div",{ref:i,children:(0,v.jsx)(ze.Z,{className:"wf-step-card-layout card-body "+((null===a||void 0===a?void 0:a.id)===(null===t||void 0===t?void 0:t.id)?"tool-active":"")+(f?"tool-dragging":""),onClick:()=>{return e=null===t||void 0===t?void 0:t.id,o=null===t||void 0===t?void 0:t.tool_id,void d({id:e,tool_id:o});var e,o},children:(0,v.jsxs)(Pe.Z,{className:"card-row",children:[(0,v.jsx)(Ze.Z,{span:5,className:"card-col",children:(0,v.jsxs)("div",{className:"card-col-div",children:[(0,v.jsx)("div",{className:"display-flex-center",children:(0,v.jsx)(Ee.default.Text,{className:"card-typography",children:"STEP"})}),(0,v.jsx)("div",{className:"wf-step-card-progress display-flex-center",children:(0,v.jsx)(as.Z,{type:"circle",size:"small",format:()=>o+1})})]})}),(0,v.jsx)(Ze.Z,{span:19,className:"card-col-details ".concat(n===(null===t||void 0===t?void 0:t.id)?"active":""),children:(0,v.jsxs)("div",{className:"card-col-div",children:[(0,v.jsxs)(Pe.Z,{align:"middle",children:[(0,v.jsx)(Ze.Z,{span:2,children:(0,v.jsx)(cs,{iconSrc:null===t||void 0===t?void 0:t.icon,showBorder:!1})}),(0,v.jsx)(Ze.Z,{span:21,children:(0,v.jsx)("div",{className:"step-name",children:(0,v.jsx)(Ee.default.Text,{strong:!0,ellipsis:{tooltip:null===t||void 0===t?void 0:t.name},children:null===t||void 0===t?void 0:t.name})})}),(0,v.jsx)(Ze.Z,{span:1,children:(null===a||void 0===a?void 0:a.id)===(null===t||void 0===t?void 0:t.id)&&(0,v.jsx)("div",{children:(0,v.jsx)(zo,{handleConfirm:()=>(()=>{const e={method:"DELETE",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/tool_instance/").concat(null===a||void 0===a?void 0:a.id,"/"),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken}};m(e).then((()=>{c(null===a||void 0===a?void 0:a.id),r(),u({type:"success",content:"Successfully deleted the tool instance"})})).catch((e=>{u(h(e,"Failed to delete the tool instance"))}))})(),content:"Want to delete this step",children:(0,v.jsx)(Yn.Z,{})})})})]}),(0,v.jsxs)(Ee.default.Text,{type:"secondary",className:"wf-step-card-status",children:["Status: ",null===t||void 0===t?void 0:t.status]})]})})]})})})},ps=e=>{let{steps:t,activeTool:o,moveItem:n}=e;const[,l]=(0,ss.L)({accept:"STEP",drop:(e,o)=>{if((0===t.length||null!==e&&void 0!==e&&e.function_name)&&(null===e||void 0===e||!e.index)){const o=t.length;n(e.index,o,null===e||void 0===e?void 0:e.function_name)}}});return(0,v.jsxs)("div",{ref:l,className:"wf-steps-container",children:[0===t.length&&(0,v.jsx)("div",{className:"content-center-body-3 display-flex-center-h-and-v",children:(0,v.jsxs)(tn,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ie.x2,{})}),(0,v.jsx)("div",{children:(0,v.jsxs)(Ee.default.Text,{className:"wf-steps-empty-state",children:["Enter the prompt to generate the workflow ",(0,v.jsx)("br",{}),"OR ",(0,v.jsx)("br",{})," Drag tool and drop."]})})]})}),(0,v.jsx)(tn,{children:t.map(((e,t)=>(0,v.jsx)(us,{step:e,activeTool:o,moveItem:n,index:t},e.id)))})]})};function vs(e){let{setSteps:t,activeToolId:o,sourceMsg:n,destinationMsg:l}=e;const i=gl(),{projectId:s,details:a,isLoading:d,loadingType:c,addNewTool:u,source:m,destination:h,updateWorkflow:x}=i,{sessionDetails:f}=N(),g=ie(),{setAlertDetails:j}=T(),y=_(),{setPostHogCustomEvent:S}=Xt();(0,p.useEffect)((()=>{k(),b()}),[]);const b=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/workflow/").concat(s,"/can-update/")};g(e).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||{},o={allowChangeEndpoint:null===t||void 0===t?void 0:t.can_update};x(o)})).catch((e=>{j(y(e,"Failed to get can update status"))}))},w=async e=>{const t=e.map((e=>null===e||void 0===e?void 0:e.id)),o={workflow_id:null===a||void 0===a?void 0:a.id,tool_instances:t},n={method:"POST",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/tool_instance/reorder/"),headers:{"X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken,"Content-Type":"application/json"},data:o};return g(n).then((()=>(a.tool_instances=e,e))).catch((e=>{throw e}))},k=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/workflow/").concat(s,"/endpoint/")};g(e).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||[],o=t.find((e=>"SOURCE"===(null===e||void 0===e?void 0:e.endpoint_type))),n=t.find((e=>"DESTINATION"===(null===e||void 0===e?void 0:e.endpoint_type)));x({source:o,destination:n})})).catch((e=>{j(y(e,"Failed to get endpoints"))}))},E=e=>{const t=null===a||void 0===a?void 0:a.id;if(!t||!e)return;const o={tool_id:e,workflow_id:t},n={method:"POST",url:"/api/v1/unstract/".concat(null===f||void 0===f?void 0:f.orgId,"/tool_instance/"),headers:{"X-CSRFToken":null===f||void 0===f?void 0:f.csrfToken,"Content-Type":"application/json"},data:o};return g(n).then((e=>e)).catch((e=>{throw e}))};return(0,v.jsxs)("div",{className:"wf-steps-layout",children:[(0,v.jsxs)("div",{className:"ds-src-set",children:[(0,v.jsx)(is,{type:r.z0.connectors[0],endpointDetails:m,message:n}),(0,v.jsx)(Ro.Z,{className:"wf-steps-div"})]}),(0,v.jsx)("div",{className:"wf-steps-list",children:(0,v.jsx)("div",{className:"wf-steps-list-2",children:d&&"GENERATE"===c?(0,v.jsx)("div",{className:"wf-steps-layout",children:(0,v.jsx)(At,{})}):(0,v.jsx)(Pi.W,{backend:Zi.PD,children:(0,v.jsx)(ps,{steps:null===a||void 0===a?void 0:a.tool_instances,activeTool:o,moveItem:(e,o,n,l)=>{const i=(null===a||void 0===a?void 0:a.tool_instances)||[];if(void 0===e&&n){try{S("wf_tool_drag_dropped",{info:"Tool dragged and dropped",tool_name:n})}catch(vc){}E(n).then((e=>{const t=null===e||void 0===e?void 0:e.data,o=[...i];return o.push(t),u(t),w(o)})).then((e=>{t(e)})).catch((e=>{j(y(e,"Failed to re-order the tools."))}))}else{const n=[...i],[s]=n.splice(e,1);n.splice(o,0,s),l?w(n).then((e=>{t(n)})):w(i).then((e=>{t(e)}))}}})})})}),(0,v.jsxs)("div",{className:"ds-dst-set",children:[(0,v.jsx)(Ro.Z,{className:"wf-steps-div"}),(0,v.jsx)(is,{type:r.z0.connectors[1],endpointDetails:h,message:l})]})]})}const ms=new(o(29527)._),hs=(0,p.memo)((e=>{let{markdownText:t}=e;const o=(0,p.useMemo)((()=>t?ms.render(t):""),[t]);return(0,v.jsx)("div",{dangerouslySetInnerHTML:{__html:o}})}));function xs(e){let{input:t,output:o}=e;return t||o?(0,v.jsx)("div",{className:"wf-input-output-layout",children:(0,v.jsxs)(Pe.Z,{className:"wf-input-output-layout",children:[(0,v.jsx)(Ze.Z,{span:12,className:"wf-input-output-layout",children:(0,v.jsx)("div",{className:"wf-input-output-md wf-input-output-md-right wf-input-output-box",children:(0,v.jsx)(hs,{markdownText:t})})}),(0,v.jsx)(Ze.Z,{span:12,className:"wf-input-output-layout",children:(0,v.jsx)("div",{className:"wf-input-output-md wf-input-output-md-left wf-input-output-box",children:(0,v.jsx)(hs,{markdownText:o})})})]})}):(0,v.jsxs)("div",{className:"wf-input-output-layout wf-input-output-placeholder wf-input-output-box",children:[(0,v.jsxs)(Pe.Z,{className:"display-flex-center",children:[(0,v.jsx)(Ze.Z,{children:(0,v.jsx)("div",{style:{padding:"5px"},children:(0,v.jsx)(Ie.Um,{})})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsx)("div",{style:{padding:"5px"},children:(0,v.jsx)(Ie.aZ,{})})})]}),(0,v.jsx)(Ee.default.Text,{className:"wf-steps-empty-state",children:"Select a workflow stage to see input and output data here."})]})}function fs(e){let{setSteps:t,activeToolId:o,inputMd:n,outputMd:l,sourceMsg:i,destinationMsg:s}=e;return(0,v.jsx)("div",{className:"wf-exec-main-layout",children:(0,v.jsxs)(Pe.Z,{className:"wf-exec-main-layout",children:[(0,v.jsx)(Ze.Z,{span:8,className:"wf-exec-main-layout",children:(0,v.jsx)("div",{className:"wf-exec-main-col-1",children:(0,v.jsx)("div",{className:"wf-exec-main-steps",children:(0,v.jsx)(vs,{setSteps:t,activeToolId:o,sourceMsg:i,destinationMsg:s})})})}),(0,v.jsx)(Ze.Z,{span:16,className:"wf-exec-main-layout",children:(0,v.jsx)("div",{className:"wf-exec-main-col-2",children:(0,v.jsx)(xs,{input:n,output:l})})})]})})}function gs(e){let{setSteps:t,activeToolId:o,inputMd:n,outputMd:l,sourceMsg:i,destinationMsg:s}=e;return(0,v.jsxs)("div",{className:"wf-exec-layout",children:[(0,v.jsx)("div",{className:"wf-exec-heading",children:(0,v.jsx)(Ee.default.Text,{className:"wf-exec-heading-typo",strong:!0,children:"Workflow"})}),(0,v.jsx)("div",{className:"wf-exec-main",children:(0,v.jsx)(fs,{setSteps:t,activeToolId:o,inputMd:n,outputMd:l,sourceMsg:i,destinationMsg:s})})]})}function js(e){let{spec:t,isSpecLoading:o}=e;const n=(0,p.createRef)(null),[l,i]=(0,p.useState)({}),{sessionDetails:s}=N(),{setAlertDetails:a}=T(),{toolSettings:d}=ji(),{updateMetadata:r,getMetadata:c,isLoading:u}=gl(),m=ie(),h=_();(0,p.useEffect)((()=>{const e=null===d||void 0===d?void 0:d.id,t=c(e);i(t)}),[d,t]);const x=e=>{i(e);const t={...e},o={method:"PATCH",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/tool_instance/").concat(null===d||void 0===d?void 0:d.id,"/"),headers:{"Content-Type":"application/json","X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken},data:{metadata:t}};m(o).then((()=>{r(null===d||void 0===d?void 0:d.id,l),a({type:"success",content:"Updated tool settings."})})).catch((e=>{a(h(e))}))};return(0,v.jsx)("div",{className:"tool-settings-layout",children:(0,v.jsx)(qt,{schema:t,formData:l,setFormData:i,isLoading:o,validateAndSubmit:e=>{(()=>{var e;return n&&(null===n||void 0===n||null===(e=n.current)||void 0===e||e.validateFields(((e,t)=>{if(e)return!1}))),!0})()&&x(e)},formRef:n,isStateUpdateRequired:!0,children:(0,v.jsx)("div",{className:"display-flex-right tool-settings-submit-btn",children:(0,v.jsx)(Bt,{type:"primary",block:!0,htmlType:"submit",disabled:u,children:"Save"})})})})}hs.displayName="MarkdownRenderer";var ys=o(34664);function _s(e){let{toolInfo:t}=e;const[,o]=(0,ds.c)({type:"STEP",item:{function_name:null===t||void 0===t?void 0:t.function_name}});return(0,v.jsx)(ze.Z,{className:"toolinfo-card",ref:o,children:(0,v.jsxs)(Pe.Z,{children:[(0,v.jsx)(Ze.Z,{span:4,children:(0,v.jsx)(cs,{iconSrc:null===t||void 0===t?void 0:t.icon,showBorder:!0})}),(0,v.jsx)(Ze.Z,{span:20,children:(0,v.jsxs)("div",{className:"tool-info-header",children:[(0,v.jsx)("div",{className:"tool-info-title",children:(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.name})}),(0,v.jsx)(Ee.default,{type:"secondary",className:"tool-info-typo-sec",style:{color:"#00A6ED",marginTop:"-2px"},children:"by Zipstack Inc"}),(0,v.jsx)(Ee.default.Paragraph,{type:"secondary",className:"tool-info-typo-sec",ellipsis:{rows:2,expandable:!1},style:{marginTop:"2px"},children:null===t||void 0===t?void 0:t.description})]})})]})})}function Ss(e){let{listOfTools:t,isLoading:o}=e;return o?(0,v.jsx)(At,{}):0===(null===t||void 0===t?void 0:t.length)?(0,v.jsx)(ys.Z,{description:"No tools to display"}):(0,v.jsx)("div",{className:"wf-list-of-tools-layout",children:(0,v.jsx)(Pi.W,{backend:Zi.PD,children:t.map((e=>(0,v.jsx)(_s,{toolInfo:e},null===e||void 0===e?void 0:e.name)))})})}function bs(){const[e,t]=(0,p.useState)([]),[o,n]=(0,p.useState)([]),[l,i]=(0,p.useState)(!1),[s,a]=(0,p.useState)(""),{setAlertDetails:d}=T(),{sessionDetails:r}=N(),c=ie(),u=_();(0,p.useEffect)((()=>{i(!0);const e={method:"GET",url:"/api/v1/unstract/".concat(null===r||void 0===r?void 0:r.orgId,"/tool/")};c(e).then((e=>{t(null===e||void 0===e?void 0:e.data)})).catch((e=>{d(u(e))})).finally((()=>{i(!1)}))}),[]),(0,p.useEffect)((()=>{0===(null===s||void 0===s?void 0:s.length)&&n(e);const t=[...e].filter((e=>{const t=null===e||void 0===e?void 0:e.name;if(!t)return!1;const o=s.toUpperCase();return null===t||void 0===t?void 0:t.toUpperCase().includes(o)}));n(t)}),[s,e]);const m=(0,p.useCallback)(io()((e=>{let{target:{value:t}}=e;a(t)}),600),[]);return(0,v.jsxs)("div",{className:"wf-tools-layout",children:[(0,v.jsx)("div",{className:"wf-tools-search",children:(0,v.jsx)(_t.default,{className:"tool-chest-input",placeholder:"Search for tool",onChange:m,prefix:(0,v.jsx)(oo.Z,{className:"icon"})})}),(0,v.jsx)("div",{className:"wf-tools-list",children:(0,v.jsx)(Ss,{listOfTools:o,isLoading:l})})]})}function Ns(){const[e,t]=(0,p.useState)("1"),[o,n]=(0,p.useState)({}),[l,i]=(0,p.useState)(!1),[s,a]=(0,p.useState)(""),{id:d}=(0,c.UO)(),{toolSettings:r}=ji(),{sessionDetails:u}=N(),m=ie(),h=[{key:"1",label:"Tools"},{key:"2",label:"Tool Settings",disabled:0===(null===s||void 0===s?void 0:s.length)},{key:"3",label:"Workflow Template",disabled:!0}];return(0,p.useEffect)((()=>{const o=null===r||void 0===r?void 0:r.tool_id;if(o)if(o!==s){if(o!==s){t("2");const e={method:"GET",url:"/api/v1/unstract/".concat(null===u||void 0===u?void 0:u.orgId,"/tool_settings_schema/?function_name=").concat(o,"&workflow_id=").concat(d)};i(!0),m(e).then((e=>{var l,i;i=null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.properties,0===Object.keys(i).length?(n({}),a(""),t("1")):(a(o),n(null===e||void 0===e?void 0:e.data))})).catch((e=>{})).finally((()=>{i(!1)}))}}else t("2");else"2"===e&&(t("1"),n({}),a(""))}),[r]),(0,v.jsxs)("div",{className:"sidepanel-layout",children:[(0,v.jsx)("div",{className:"sidepanel-tabs",children:(0,v.jsx)(bl.Z,{activeKey:e,items:h,onChange:e=>{t(e.toString())},moreIcon:(0,v.jsx)(v.Fragment,{})})}),(0,v.jsxs)("div",{className:"sidepanel-content",children:["1"===e&&(0,v.jsx)(bs,{}),"2"===e&&(0,v.jsx)(js,{spec:o,isSpecLoading:l})]})]})}function ws(e){let{title:t}=e;return(0,v.jsx)(d.ql,{children:(0,v.jsx)("title",{children:t?"".concat(t," - Unstract"):"Unstract"})})}function ks(){const[e,t]=(0,p.useState)(!1),[o,n]=(0,p.useState)([]),[l,s]=(0,p.useState)(""),[a,d]=(0,p.useState)(""),[r,c]=(0,p.useState)(""),[u,m]=(0,p.useState)(""),[h,x]=(0,p.useState)(""),{message:f,setDefault:g}=W(),j=gl(),{details:y,loadingType:_,projectName:S}=j,b=null===y||void 0===y?void 0:y.prompt_text,[N,w]=(0,p.useState)(""),[k,T]=(0,p.useState)(""),[E,C]=(0,p.useState)(!1),[O,D]=(0,p.useState)(!1);(0,p.useEffect)((()=>{"EXECUTE"!==k&&C(!0),T(_)}),[j]),(0,p.useEffect)((()=>{E&&(P(),C(!1))}),[E,b]);const P=()=>{const e=[...(null===y||void 0===y?void 0:y.tool_instances)||[]];n(e)};return(0,p.useEffect)((()=>()=>{g()}),[]),(0,p.useEffect)((()=>{var e;if(0===(null===(e=Object.keys(f))||void 0===e?void 0:e.length))return;const t=null===f||void 0===f?void 0:f.state,l=null===f||void 0===f?void 0:f.component;if("INPUT_UPDATE"===t)return void s(null===f||void 0===f?void 0:f.message);if("OUTPUT_UPDATE"===t)return void d(null===f||void 0===f?void 0:f.message);if("MESSAGE"===t)return void c(null===f||void 0===f?void 0:f.message);if("SOURCE"===l&&"RUNNING"===t){m(""),x("");const e=[...o].map((e=>(e.progress="",e.status="",e)));n(e)}if("SOURCE"===l){const e=(null===f||void 0===f?void 0:f.state)+": "+(null===f||void 0===f?void 0:f.message);return void m(e)}if("DESTINATION"===l){const e=(null===f||void 0===f?void 0:f.state)+": "+(null===f||void 0===f?void 0:f.message);return x(e),void w("")}if("NEXT_STEP"===l)return void D((e=>!e));const i=[...o||[]].map((e=>{const t={...e};return(null===t||void 0===t?void 0:t.id)!==l||(w(l),t.progress=null===f||void 0===f?void 0:f.state,t.status=null===f||void 0===f?void 0:f.message),t}));n(i)}),[f]),(0,v.jsxs)("div",{className:"agency-layout",children:[(0,v.jsx)(ws,{title:S}),(0,v.jsxs)(Ke.default,{className:"agency-sider-layout",children:[(0,v.jsx)(Ke.default,{className:"agency-sider-layout",children:(0,v.jsx)(ho,{children:(0,v.jsx)(gs,{setSteps:n,activeToolId:N,inputMd:l,outputMd:a,sourceMsg:u,destinationMsg:h})})}),(0,v.jsx)("div",{className:"agency-sider-content",children:(0,v.jsx)("div",{children:(0,v.jsxs)(_i.Z,{className:"agency-sider-layout",width:350,collapsed:e,collapsedWidth:30,children:[(0,v.jsx)("div",{className:"tool-ide-sider-btn",children:(0,v.jsx)(i.ZP,{shape:"circle",size:"small",onClick:()=>t(!e),icon:e?(0,v.jsx)(sn.Z,{}):(0,v.jsx)(ln.Z,{})})}),!e&&(0,v.jsx)(Ns,{})]})})})]}),(0,v.jsx)("div",{className:"agency-actions",children:(0,v.jsx)(Di,{statusBarMsg:r,initializeWfComp:()=>{P(),w(""),s(""),d(""),c(""),g(),m(""),x("")},stepLoader:O})}),(0,v.jsx)("div",{className:"height-20"})]})}function Ts(){return(0,v.jsx)(ks,{})}var Es=o(69228),Cs=o(76421);const Os={tool_name:"",author:"",description:"",icon:""};function Ds(e){let{open:t,setOpen:o,editItem:n,isEdit:l,handleAddNewTool:s}=e;const[a]=dt.Z.useForm(),[d,u]=(0,p.useState)(!1),{setAlertDetails:m}=T(),h=_(),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(l?{...n}:{...Os}),[y,S]=(0,p.useState)(l?g.icon:""),[b,N]=(0,p.useState)(null),w=(0,c.s0)(),k=()=>{j({...Os})};return(0,v.jsx)($e.Z,{title:l?"Edit Prompt Studio project":"Create new Prompt Studio project",width:450,open:t,onCancel:()=>{o(!1),f(!1)},centered:!0,maskClosable:!1,onOk:e=>{const t=g;u(!0),s(t).then((e=>{m({type:"success",content:"".concat(l?"Updated":"Added"," Successfully")}),o(!1),k(),w(null===e||void 0===e?void 0:e.tool_id)})).catch((e=>{h(e,"",N)})).finally((()=>{u(!1)}))},okText:l?"Update":"Save",okButtonProps:{loading:d},destroyOnClose:!0,children:(0,v.jsxs)(dt.Z,{form:a,name:"myForm",layout:"vertical",initialValues:g,onValuesChange:(e,t)=>{j({...g,...t});const o=Object.keys(e)[0];a.setFields([{name:o,errors:[]}]),N((e=>{if(e){const t=e.errors.filter((e=>e.attr!==o));return{...e,errors:t}}return null}))},children:[(0,v.jsx)(dt.Z.Item,{label:"Prompt Studio project name",name:"tool_name",rules:[{required:!0,message:"Please enter project name"}],validateStatus:(0,r.dz)("tool_name",b)?"error":"",help:(0,r.dz)("tool_name",b),children:(0,v.jsx)(_t.default,{})}),(0,v.jsx)(dt.Z.Item,{label:"Author/Org Name",name:"author",rules:[{required:!0,message:"Please enter Author/Org name"}],validateStatus:(0,r.dz)("author",b)?"error":"",help:(0,r.dz)("author",b),children:(0,v.jsx)(_t.default,{})}),(0,v.jsx)(dt.Z.Item,{label:"Description",name:"description",rules:[{required:!0,message:"Please enter description"}],validateStatus:(0,r.dz)("description",b)?"error":"",help:(0,r.dz)("description",b),children:(0,v.jsx)(_t.default.TextArea,{rows:4,showCount:!0,maxLength:200,style:{height:100,resize:"none"}})}),(0,v.jsx)(dt.Z.Item,{label:"Icon",name:"icon",children:(0,v.jsx)(Es.Z,{open:x,placement:"rightTop",arrow:!1,trigger:"click",className:"emoji-modal",title:(0,v.jsx)(Cs.ZP,{previewConfig:{showPreview:!1},lazyLoadEmojis:!0,onEmojiClick:e=>{(e=>{S(e),j((t=>({...t,icon:e})))})(e.emoji),f(!1)}}),children:(0,v.jsxs)(i.ZP,{onClick:()=>f((e=>!e)),children:[y," ",y?"Change":"Choose"," Icon"]})})})]})})}let Ps,Zs;try{Ps=Object(function(){var e=new Error("Cannot find module '../../../plugins/onboarding-messages/OnboardMessagesModal.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Zs=Object(function(){var e=new Error("Cannot find module '../../../plugins/onboarding-messages/login-slides.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){Ps=null,Zs=[]}function Is(){const[e,t]=(0,p.useState)(!1),[o,n]=(0,p.useState)(!1),[l,i]=(0,p.useState)(null),{sessionDetails:s}=N(),{loginOnboardingMessage:a}=s,{setPostHogCustomEvent:d}=Xt(),{setAlertDetails:r}=T(),c=ie(),[u,m]=(0,p.useState)([]),[h,x]=(0,p.useState)([]),f=_(),[g,j]=(0,p.useState)(!1),[y,S]=(0,p.useState)(null),[b,w]=(0,p.useState)(!1),[k,E]=(0,p.useState)(!1),[C,O]=(0,p.useState)(!1),[D,P]=(0,p.useState)([]),[Z,I]=(0,p.useState)(!0);(0,p.useEffect)((()=>{L()}),[]),(0,p.useEffect)((()=>{x(u)}),[u]);const L=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/prompt-studio/ "),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken}};t(!0),c(e).then((e=>{const t=null===e||void 0===e?void 0:e.data;m(t),x(t)})).catch((e=>{r(f(e,"Failed to get the list of tools"))})).finally((()=>{t(!1)}))},A=(e,t)=>{let o=[...u];e?(o=o.map((e=>(null===e||void 0===e?void 0:e.tool_id)===(null===t||void 0===t?void 0:t.tool_id)?t:e)),i(null)):o.push(t),m(o)},U=()=>{i(null),j(!1),n(!0);try{d("intent_new_ps_project",{info:"Clicked on '+ New Project' button"})}catch(vc){}},F=()=>{O(!0);const e={method:"GET",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/users/")};c(e).then((e=>{var t;const o=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.members)||[];P(o.map((e=>({id:null===e||void 0===e?void 0:e.id,email:null===e||void 0===e?void 0:e.email}))))})).catch((e=>{r(f(e,"Failed to load"))})).finally((()=>{O(!1)}))};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(jo,{title:"Prompt Studio",enableSearch:!0,onSearch:(e,t)=>{0===(null===e||void 0===e?void 0:e.length)&&t(u);t([...u].filter((t=>{var o;const n=null===(o=t.tool_name)||void 0===o?void 0:o.toUpperCase(),l=e.toUpperCase();return n.includes(l)})))},searchList:u,setSearchList:x,CustomButtons:()=>(0,v.jsx)(Bt,{type:"primary",icon:(0,v.jsx)(et.Z,{}),onClick:U,children:"New Project"})}),(0,v.jsx)("div",{className:"list-of-tools-layout",children:(0,v.jsx)("div",{className:"list-of-tools-island",children:(0,v.jsx)("div",{className:"list-of-tools-body",children:(0,v.jsx)(Oo,{isLoading:e,isEmpty:!(null!==u&&void 0!==u&&u.length),listOfTools:h,setOpenAddTool:n,handleEdit:(e,t)=>{const o=[...u].find((e=>(null===e||void 0===e?void 0:e.tool_id)===t.tool_id));o&&(j(!0),i(o),n(!0))},handleDelete:(e,t)=>{const o={method:"DELETE",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/prompt-studio/").concat(t.tool_id),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken}};c(o).then((()=>{const e=[...u].filter((e=>(null===e||void 0===e?void 0:e.tool_id)!==t.tool_id));m(e),r({type:"success",content:"".concat(null===t||void 0===t?void 0:t.tool_name," - Deleted successfully")})})).catch((e=>{r(f(e,"Failed to Delete"))}))},titleProp:"tool_name",descriptionProp:"description",iconProp:"icon",idProp:"tool_id",type:"Prompt Project",handleShare:(e,t,o)=>{const n={method:"GET",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/prompt-studio/users/").concat(null===t||void 0===t?void 0:t.tool_id),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken}};O(!0),F(),c(n).then((e=>{w(!0),S(null===e||void 0===e?void 0:e.data),E(o)})).catch((e=>{r(f(e))})).finally((()=>{O(!1)}))}})})})}),o&&(0,v.jsx)(Ds,{open:o,setOpen:n,editItem:l,isEdit:g,handleAddNewTool:e=>{var t;let o="POST",i="/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/prompt-studio/");const a=l&&(null===(t=Object.keys(l))||void 0===t?void 0:t.length)>0;return a&&(o="PATCH",i+="".concat(null===l||void 0===l?void 0:l.tool_id,"/")),new Promise(((t,l)=>{const d={method:o,url:i,headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken,"Content-Type":"application/json"},data:e};c(d).then((e=>{const o=null===e||void 0===e?void 0:e.data;A(a,o),n(!1),t(null===e||void 0===e?void 0:e.data)})).catch((e=>{l(e)}))}))}}),(0,v.jsx)(Do,{open:b,setOpen:w,adapter:y,permissionEdit:k,loading:C,allUsers:D,onApply:(e,t)=>{const o={method:"PATCH",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/prompt-studio/").concat(null===t||void 0===t?void 0:t.tool_id),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken},data:{shared_users:e}};c(o).then((e=>{w(!1)})).catch((e=>{r(f(e,"Failed to load"))}))}}),!a&&Ps&&(0,v.jsx)(Ps,{open:Z,setOpen:I,slides:Zs})]})}function Ls(){return(0,v.jsx)(Is,{})}const As={messages:[]},Us=As,Fs=(0,S.Ue)(((e,t)=>({...Us,updateCusToolMessages:o=>{var n;const l={...t()};let i=[...(null===l||void 0===l?void 0:l.messages)||[],...o];const s=null===(n=i)||void 0===n?void 0:n.length;if(s>200){const e=s-200;i=i.slice(e)}l.messages=i,e(l)},emptyCusToolMessages:()=>{e(As)}})));let Ms;try{Ms=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}function Rs(){const[e,t]=(0,p.useState)(!0),{id:o}=(0,c.UO)(),{sessionDetails:n}=N(),{updateCustomTool:l,setDefaultCustomTool:i}=ee(),{emptyCusToolMessages:s}=Fs(),{setAlertDetails:a}=T(),d=(0,c.s0)(),r=ie(),u=_(),{resetTokenUsage:m}=ce();(0,p.useEffect)((()=>{const e={listOfDocs:[],details:{},defaultLlmProfile:"",llmProfiles:[],selectedDoc:null,adapters:[]},i={method:"GET",url:"/api/v1/unstract/".concat(null===n||void 0===n?void 0:n.orgId,"/prompt-studio/").concat(o)};let s=null;t(!0),h(i).then((t=>{const o=null===t||void 0===t?void 0:t.data;e.defaultLlmProfile=null===o||void 0===o?void 0:o.default_profile,e.details=o,e.singlePassExtractMode=null===o||void 0===o?void 0:o.single_pass_extraction_mode,s=null===o||void 0===o?void 0:o.output,e.isSimplePromptStudio=!1,e.isChallengeEnabled=null===o||void 0===o?void 0:o.enable_challenge;const l={method:"GET",url:"/api/v1/unstract/".concat(null===n||void 0===n?void 0:n.orgId,"/prompt-studio/prompt-document?tool_id=").concat(null===o||void 0===o?void 0:o.tool_id)};return h(l)})).then((t=>{const o=(null===t||void 0===t?void 0:t.data)||[];e.listOfDocs=o;const l=o.find((e=>(null===e||void 0===e?void 0:e.document_id)===s));e.selectedDoc=l||null;const i={method:"GET",url:"/api/v1/unstract/".concat(null===n||void 0===n?void 0:n.orgId,"/prompt-studio/select_choices")};return h(i)})).then((t=>{const l=null===t||void 0===t?void 0:t.data;e.dropdownItems=l;const i={method:"GET",url:"/api/v1/unstract/".concat(null===n||void 0===n?void 0:n.orgId,"/prompt-studio/prompt-studio-profile/").concat(o)};return h(i)})).then((t=>{const l=null===t||void 0===t?void 0:t.data;if(e.llmProfiles=l,Ms){const e={method:"GET",url:Ms(o,null===n||void 0===n?void 0:n.orgId)};return h(e)}})).then((t=>{const o=null===t||void 0===t?void 0:t.data;e.shareId=null===o||void 0===o?void 0:o.share_id;const l={method:"GET",url:"/api/v1/unstract/".concat(null===n||void 0===n?void 0:n.orgId,"/adapter/")};return h(l)})).then((t=>{const o=null===t||void 0===t?void 0:t.data;e.adapters=o})).catch((e=>{a(u(e,"Failed to load the custom tool")),d("/".concat(null===n||void 0===n?void 0:n.orgName,"/tools"))})).finally((()=>{l(e),t(!1)}))}),[o]),(0,p.useEffect)((()=>()=>{i(),s(),m()}),[]);const h=async e=>r(e).then((e=>e)).catch((e=>{throw e}));return e?(0,v.jsx)(At,{}):(0,v.jsx)(c.j3,{})}var zs=o(99660),Ws=o(13876);o(44839),o(61044),o(54027);function qs(e){let{children:t,doc:o,isLoading:n,isContentAvailable:l,setOpenManageDocsModal:i,errMsg:s}=e;return n?(0,v.jsx)(At,{}):o?l?(0,v.jsx)(v.Fragment,{children:t}):(0,v.jsx)("div",{className:"height-100 display-flex-center display-flex-align-center",children:(0,v.jsx)(Ee.default.Text,{children:s||"Failed to load the document"})}):(0,v.jsx)(tt,{text:"Add and view your PDF document here",btnText:"Add Document",handleClick:()=>i(!0)})}var Hs=o(82621);let Gs=null;try{Gs=Object(function(){var e=new Error("Cannot find module '../../../plugins/summarize-status-title/SummarizeStatusTitle'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}let Ks=null;try{Ks=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}let Bs=null;try{Bs=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-multi-doc/ConfirmMultiDoc'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}const Xs={raw:"RAW",summarize:"Summarize"};function Vs(e){let{open:t,setOpen:o,generateIndex:n,handleUpdateTool:l,handleDocChange:s}=e;const[a,d]=(0,p.useState)(!1),[r,u]=(0,p.useState)([]),[m,h]=(0,p.useState)(null),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(null),[y,S]=(0,p.useState)(!1),[b,w]=(0,p.useState)({}),[k,E]=(0,p.useState)(!1),[C,O]=(0,p.useState)(null),[D,P]=(0,p.useState)(""),[Z,I]=(0,p.useState)(null),[L,A]=(0,p.useState)(null),{sessionDetails:U}=N(),{setAlertDetails:F}=T(),{id:M}=(0,c.UO)(),{selectedDoc:R,listOfDocs:z,llmProfiles:W,updateCustomTool:q,details:H,defaultLlmProfile:G,isMultiPassExtractLoading:K,indexDocs:B,rawIndexStatus:X,summarizeIndexStatus:V,isSinglePassExtractLoading:Y,isPublicSource:Q}=ee(),{messages:J}=Fs(),$=ie(),te=_(),{setPostHogCustomEvent:oe}=Xt(),{promptOutputs:ne,updatePromptOutput:le}=de(),se=(0,v.jsxs)(Ee.default.Text,{children:[(0,v.jsx)("span",{style:{marginRight:"8px"},children:(0,v.jsx)(Ge.Z,{style:{color:"#52C41A"}})})," ","Indexed"]}),ae=(0,v.jsxs)(Ee.default.Text,{children:[(0,v.jsx)("span",{style:{marginRight:"8px"},children:(0,v.jsx)(Hs.Z,{style:{color:"#FF4D4F"}})})," ","Not Indexed"]}),re=e=>{let t="default";if("INFO"===(null===e||void 0===e?void 0:e.level)&&(t="processing"),"ERROR"===(null===e||void 0===e?void 0:e.level)&&(t="error"),null!==e&&void 0!==e&&e.message)return(0,v.jsx)(bo.Z,{title:(null===e||void 0===e?void 0:e.message)||"",children:(0,v.jsx)(Qn.Z,{color:t,children:(0,v.jsx)("div",{className:"tag-max-width ellipsis",children:null===e||void 0===e?void 0:e.message})})})},ce=(0,v.jsxs)(Ee.default.Text,{children:[(0,v.jsx)("span",{style:{marginRight:"8px"},children:(0,v.jsx)(Hs.Z,{style:{color:"#FF4D4F"}})})," ","Not Summarized"]});(0,p.useEffect)((()=>{h(G),j(null===H||void 0===H?void 0:H.summarize_llm_profile)}),[G,H]),(0,p.useEffect)((()=>{t&&me(m,Xs.raw)}),[B,m,t]),(0,p.useEffect)((()=>{t&&me(g,Xs.summarize)}),[B,g,t]),(0,p.useEffect)((()=>{var e,t,o;let n=[...J].reverse();if(0===(null===(e=n)||void 0===e?void 0:e.length))return;const l=[...n].findIndex((e=>(null===e||void 0===e?void 0:e.timestamp)===D));if(l>-1&&(n=n.slice(0,l)),n=n.filter((e=>"INFO"===(null===e||void 0===e?void 0:e.level)||"ERROR"===(null===e||void 0===e?void 0:e.level))),0===(null===(t=n)||void 0===t?void 0:t.length))return;const i={};n.forEach((e=>{var t;const o=null===e||void 0===e||null===(t=e.component)||void 0===t?void 0:t.doc_name;void 0===(null===i||void 0===i?void 0:i[o])&&(i[o]={message:(null===e||void 0===e?void 0:e.message)||"",level:(null===e||void 0===e?void 0:e.level)||"INFO"})})),w({...b,...i}),P(null===(o=n[0])||void 0===o?void 0:o.timestamp)}),[J]);const ue=(e,t)=>{e===Xs.raw&&f(t),e===Xs.summarize&&S(t)},pe=(e,t)=>{e===Xs.raw&&q({rawIndexStatus:t}),e===Xs.summarize&&q({summarizeIndexStatus:t})},ve=(e,t)=>{let o=!1;return e===Xs.raw&&(o=!(null===t||void 0===t||!t.raw_index_id)),e===Xs.summarize&&(o=!(null===t||void 0===t||!t.summarize_index_id)),o},me=(e,t)=>{if(!e)return void pe(t,[]);let o="/api/v1/unstract/".concat(null===U||void 0===U?void 0:U.orgId,"/prompt-studio/document-index/?profile_manager=").concat(e);Q&&(o=Ks(M,e));const n={method:"GET",url:o};ue(t,!0),$(n).then((e=>{const o=(null===e||void 0===e?void 0:e.data).map((e=>({docId:null===e||void 0===e?void 0:e.document_manager,isIndexed:ve(t,e)})));pe(t,o)})).catch((e=>{F(te(e,"Failed to get index status"))})).finally((()=>{ue(t,!1)}))},he=e=>{const t=W.find((t=>(null===t||void 0===t?void 0:t.profile_id)===e));return(null===t||void 0===t?void 0:t.profile_name)||"No LLM Profile Selected"},xe=[{title:"Document Variants",dataIndex:"document",key:"document"},{title:(0,v.jsxs)(Be.Z,{className:"w-100",children:[(0,v.jsx)(Ee.default.Text,{children:"Raw View"}),(0,v.jsx)(Ee.default.Text,{type:"secondary",children:"("+he(m)+")"}),x&&(0,v.jsx)(At,{})]}),dataIndex:"index",key:"index",width:300},{title:"Actions",dataIndex:"reindex",key:"reindex",width:200},{title:"",dataIndex:"delete",key:"delete",width:30},{title:"",dataIndex:"select",key:"select",width:30}];Gs&&xe.splice(2,0,{title:(0,v.jsx)(Gs,{profileName:"("+he(g)+")",isLoading:y}),dataIndex:"summary",key:"summary",width:300});const fe=(e,t)=>{var o;let n=null,l=null;return t===Xs.raw?(n=X.find((t=>(null===t||void 0===t?void 0:t.docId)===e)),l=ae):(n=V.find((t=>(null===t||void 0===t?void 0:t.docId)===e)),l=ce),null!==(o=n)&&void 0!==o&&o.isIndexed?se:l};(0,p.useEffect)((()=>{const e=z.map((e=>({key:null===e||void 0===e?void 0:e.document_id,document:(null===e||void 0===e?void 0:e.document_name)||"",index:fe(null===e||void 0===e?void 0:e.document_id,Xs.raw),summary:Gs&&fe(null===e||void 0===e?void 0:e.document_id,Xs.summarize),reindex:(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)("div",{children:B.includes(null===e||void 0===e?void 0:e.document_id)?(0,v.jsx)(At,{}):(0,v.jsx)(bo.Z,{title:"Index",children:(0,v.jsx)(i.ZP,{size:"small",icon:(0,v.jsx)(Bo.Z,{}),onClick:()=>(e=>{n(e);try{oe("intent_ps_indexed_file",{info:"Clicked on index button",document_name:null===e||void 0===e?void 0:e.document_name})}catch(vc){}})(e),disabled:K||Y||B.includes(null===e||void 0===e?void 0:e.document_id)||a||!G||Q})})}),(0,v.jsx)("div",{className:"center",children:re(null===b||void 0===b?void 0:b[null===e||void 0===e?void 0:e.document_name])})]}),delete:(0,v.jsx)(zo,{handleConfirm:()=>ge(null===e||void 0===e?void 0:e.document_id),content:"The document will be permanently deleted.",children:(0,v.jsx)(bo.Z,{title:"Delete",children:(0,v.jsx)(i.ZP,{size:"small",className:"display-flex-align-center",disabled:K||Y||B.includes(null===e||void 0===e?void 0:e.document_id)||a||Q,children:(0,v.jsx)(Eo.Z,{className:"manage-llm-pro-icon"})})})}),select:(0,v.jsx)(Mo.ZP,{checked:(null===R||void 0===R?void 0:R.document_id)===(null===e||void 0===e?void 0:e.document_id),onClick:()=>s(e),disabled:K||Y||B.includes(null===e||void 0===e?void 0:e.document_id)})})));u(e),q({selectedHighlight:null})}),[z,R,K,X,V,B,J,Y]);const ge=e=>{const t={document_id:e},o={method:"DELETE",url:"/api/v1/unstract/".concat(null===U||void 0===U?void 0:U.orgId,"/prompt-studio/file/").concat(null===H||void 0===H?void 0:H.tool_id),headers:{"X-CSRFToken":null===U||void 0===U?void 0:U.csrfToken,"Content-Type":"application/json"},data:t};$(o).then((()=>{const t=[...z].filter((t=>(null===t||void 0===t?void 0:t.document_id)!==e));if(q({listOfDocs:t}),(null===R||void 0===R?void 0:R.document_id)===e){const e=t[0];s(e)}const o=je(H,e),n=ye(ne,e);q({details:o}),le(n)})).catch((e=>{F(te(e,"Failed to delete"))}))},je=(e,t)=>(e.prompts&&Array.isArray(e.prompts)&&e.prompts.forEach((e=>{Array.isArray(e.coverage)&&(e.coverage=e.coverage.filter((e=>e!==t)))})),e),ye=(e,t)=>Object.entries(e).reduce(((e,o)=>{var n;let[l,i]=o;return e[l]={...i,coverage:null!==i&&void 0!==i&&i.coverage?null===i||void 0===i||null===(n=i.coverage)||void 0===n?void 0:n.filter((e=>e!==t)):null===i||void 0===i?void 0:i.coverage},e}),{});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)($e.Z,{className:"pre-post-amble-modal",open:t,onCancel:()=>o(!1),centered:!0,footer:null,maskClosable:!1,width:1400,children:(0,v.jsx)("div",{className:"pre-post-amble-body",children:(0,v.jsxs)(tn,{children:[(0,v.jsx)(Be.Z,{children:(0,v.jsx)(Ee.default.Text,{className:"add-cus-tool-header",children:"Manage Document Variants"})}),(0,v.jsx)("div",{children:(0,v.jsx)(Tt.Z.Dragger,{name:"file",action:"/api/v1/unstract/".concat(null===U||void 0===U?void 0:U.orgId,"/prompt-studio/file/").concat(null===H||void 0===H?void 0:H.tool_id),headers:{"X-CSRFToken":U.csrfToken},onChange:async e=>{if("uploading"===e.file.status&&d(!0),"done"===e.file.status){var t;d(!1),F({type:"success",content:"File uploaded successfully"});const o=null===(t=e.file.response)||void 0===t?void 0:t.data,n=(null===o||void 0===o?void 0:o.length)>0?o[0]:{},i=[...z];i.push(n);q({listOfDocs:i}),l({output:null===n||void 0===n?void 0:n.document_id}),1===(null===i||void 0===i?void 0:i.length)&&(null===R||void 0===R?void 0:R.document_id)!==(null===n||void 0===n?void 0:n.document_id)&&s(n)}else if("error"===e.file.status){var o,n,i;d(!1),F({type:"error",content:(null===e||void 0===e||null===(o=e.file)||void 0===o||null===(n=o.response)||void 0===n||null===(i=n.errors[0])||void 0===i?void 0:i.detail)||"Failed to Upload"})}},disabled:a||!G,showUploadList:!1,beforeUpload:e=>{try{oe("ps_uploaded_file",{info:"Clicked on '+ Upload New File' button"})}catch(vc){}return new Promise(((t,o)=>{I((()=>t)),A((()=>o));const n=new FileReader;n.readAsDataURL(e),n.onload=()=>{const n=e.name,l=e.type,i=((e,t)=>{var o;const n=null===t||void 0===t?void 0:t.replace(/\.[^/.]+$/,"");return null===(o=[...e])||void 0===o?void 0:o.find((e=>{var t;return(null===e||void 0===e||null===(t=e.document_name)||void 0===t?void 0:t.replace(/\.[^/.]+$/,""))===n}))})(z,n);if(i)return F({type:"error",content:"File name already exists"}),void o(new Error("File name already exists"));"application/pdf"!==l?(Bs||F({type:"error",content:"Only PDF files are allowed"}),O(e),E(!0)):t(e)}}))},children:(0,v.jsx)(bo.Z,{title:!G&&"Set the default LLM profile before uploading a document",children:(0,v.jsx)(i.ZP,{type:"text",loading:a,disabled:!G||K||Y||Q,children:"Click or drag file to this area to upload"})})})}),(0,v.jsx)(Ro.Z,{className:"manage-docs-div"}),(0,v.jsxs)(tn,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{strong:!0,children:"Uploaded files"})}),z&&0!==(null===z||void 0===z?void 0:z.length)?(0,v.jsx)("div",{children:(0,v.jsx)(Vo.Z,{columns:xe,dataSource:r,size:"small",bordered:!0,pagination:{pageSize:10}})}):(0,v.jsx)(tt,{text:"Upload the document"})]})]})})}),Bs&&(0,v.jsx)(Bs,{handleModalCancel:()=>{L&&(E(!1),L(new Error("Upload cancelled by user")))},handleModalConfirm:()=>{Z&&C&&(E(!1),Z(C))},isModalVisible:k})]})}var Ys=o(79853),Qs=o(17091),Js=o(56204),$s=o(59475);o(28668);let ea;try{ea=Object(function(){var e=new Error("Cannot find module '../../../plugins/pdf-highlight/RenderHighlights'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}function ta(e){let{fileUrl:t,highlightData:o}=e;const n=(0,Qs.defaultLayoutPlugin)(),l=(0,Js.pageNavigationPlugin)(),{jumpToPage:i}=l,s=(0,p.useRef)(null);function a(e){return null===e||void 0===e?void 0:e.filter((e=>Array.isArray(e)&&e.some((e=>0!==e))))}const d=o?a(o):[],r=(null===d||void 0===d?void 0:d.length)>0?d:[[0,0,0,0]],c=(0,p.useMemo)((()=>ea&&Array.isArray(r)&&(null===r||void 0===r?void 0:r.length)>0?(0,$s.highlightPlugin)({renderHighlights:e=>(0,v.jsx)(ea,{...e,highlightData:r})}):""),[ea,r]);return(0,p.useEffect)((()=>{if(o=a(o),o&&o.length>0){const e=o[0][0];null!==e&&i&&setTimeout((()=>{i(e)}),100)}}),[r,i]),(0,v.jsx)("div",{ref:s,className:"doc-manager-body",children:(0,v.jsx)(Ys.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js",children:(0,v.jsx)(Ys.Viewer,{fileUrl:t,plugins:[n,l,c]})})})}function oa(e){let{text:t}=e;return(0,v.jsx)("div",{className:"text-viewer-layout",children:(0,v.jsx)("pre",{style:{fontSize:"12px"},children:t})})}function na(e){let{text:t}=e;return(0,v.jsx)("div",{className:"text-viewer-layout",children:(0,v.jsx)(Ee.default.Paragraph,{children:t.split("\n").map((e=>(0,v.jsxs)(p.Fragment,{children:[e,(0,v.jsx)("br",{})]},null===e||void 0===e?void 0:e.slice(0,10))))})})}let la=[{key:"1",label:"PDF View"},{key:"2",label:"Raw View"}];const ia={original:"ORIGINAL",extract:"EXTRACT"};let sa,aa,da=null;try{da=Object(function(){var e=new Error("Cannot find module '../../../plugins/summarize-view/SummarizeView'");throw e.code="MODULE_NOT_FOUND",e}());const e=Object(function(){var e=new Error("Cannot find module '../../../plugins/summarize-tab/SummarizeTab'");throw e.code="MODULE_NOT_FOUND",e}());e&&la.push({key:"3",label:e})}catch{}try{sa=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/simple-prompt-studio-api-service'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{aa=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function ra(e){var t,o,n,l,s,a;let{generateIndex:d,handleUpdateTool:u,handleDocChange:m}=e;const[h,x]=(0,p.useState)(!1),[f,g]=(0,p.useState)(1),[j,y]=(0,p.useState)("1"),[_,S]=(0,p.useState)(""),[b,w]=(0,p.useState)(""),[k,T]=(0,p.useState)(""),[E,C]=(0,p.useState)(""),[O,D]=(0,p.useState)(!1),[P,Z]=(0,p.useState)(!1),[I,L]=(0,p.useState)(r.Iu.yet_to_start),[A,U]=(0,p.useState)(!1),{selectedDoc:F,listOfDocs:M,isMultiPassExtractLoading:R,details:z,indexDocs:W,isSinglePassExtractLoading:q,isSimplePromptStudio:H,isPublicSource:G,refreshRawView:K,selectedHighlight:B}=ee(),{sessionDetails:X}=N(),V=ie(),{setPostHogCustomEvent:Y}=Xt(),{id:Q}=(0,c.UO)(),J=(null===B||void 0===B?void 0:B.highlight)||[],[$,te]=(0,p.useState)(""),[oe,ne]=(0,p.useState)({});(0,p.useEffect)((()=>{if(oe.blob){const e=URL.createObjectURL(oe.blob);return te(e),()=>URL.revokeObjectURL(e)}}),[oe]),(0,p.useEffect)((()=>{H&&(la=[{key:"1",label:(0,v.jsx)(bo.Z,{title:"PDF View",children:(0,v.jsx)(zs.Z,{})})},{key:"2",label:(0,v.jsx)(bo.Z,{title:"Raw View",children:(0,v.jsx)(Ws.Z,{})})}])}),[]),(0,p.useEffect)((()=>{A?(T(""),le(ia.extract)):U(!0)}),[K]),(0,p.useEffect)((()=>{S(""),T(""),Object.keys(ia).forEach((e=>{le(ia[e])}))}),[F]),(0,p.useEffect)((()=>{I===r.Iu.done&&(le(ia.extract),L(r.Iu.yet_to_start))}),[I]),(0,p.useEffect)((()=>{if(r.Iu.yet_to_start!==I){if(r.Iu.indexing===I){W.find((e=>e===(null===F||void 0===F?void 0:F.document_id)))||L(r.Iu.done)}}else{W.find((e=>e===(null===F||void 0===F?void 0:F.document_id)))&&L(r.Iu.indexing)}}),[W]);const le=e=>{e===ia.original&&(S(""),w("")),e===ia.extract&&(T(""),C("")),null!==F&&void 0!==F&&F.document_id&&se(H&&sa?sa:ae,e)},se=(e,t)=>{e(null===z||void 0===z?void 0:z.tool_id,null===F||void 0===F?void 0:F.document_id,t).then((e=>{var o,n;const l=(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.data)||"",i=(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.mime_type)||"";de(l,t,i)})).catch((e=>{re(e,t)})).finally((()=>{ce(t,!1)}))},ae=async(e,t,o)=>{let n="/api/v1/unstract/".concat(null===X||void 0===X?void 0:X.orgId,"/prompt-studio/file/").concat(e,"?document_id=").concat(t,"&view_type=").concat(o);G&&(n=aa(Q,t,o));return V({url:n,method:"GET"}).then((e=>e)).catch((e=>{throw e}))},de=(e,t,o)=>{if(t===ia.original){const t=e||"",n=(0,r.G9)(t,o);ne({blob:n,mimeType:o});const l=new FileReader;l.readAsDataURL(n),l.onload=()=>{S(l.result)},l.onerror=()=>{throw new Error("Fail to load the file")}}else t===ia.extract&&T(null===e||void 0===e?void 0:e.data)},re=(e,t)=>{var o;404===(null===e||void 0===e||null===(o=e.response)||void 0===o?void 0:o.status)&&ue(t)},ce=(e,t)=>{e===ia.original&&D(t),e===ia.extract&&Z(t)},ue=e=>{e===ia.original&&w("Document not found."),e===ia.extract&&C("Raw content is not available. Please index or re-index to generate it.")};(0,p.useEffect)((()=>{const e=[...M].findIndex((e=>(null===e||void 0===e?void 0:e.document_id)===(null===F||void 0===F?void 0:F.document_id)));g(e+1)}),[F,M]);const pe=e=>{g(e);const t=M[e-1];t&&m(t)};return(0,v.jsxs)("div",{className:"doc-manager-layout",children:[(0,v.jsxs)("div",{className:"doc-manager-header",children:[(0,v.jsx)("div",{className:"tools-main-tabs",children:(0,v.jsx)(bl.Z,{activeKey:j,items:la,onChange:e=>{y(e);try{"2"===e&&Y("ps_raw_view_clicked",{info:"Clicked on the 'Raw View' tab"}),"3"===e&&Y("ps_summary_view_clicked",{info:"Clicked on the 'Summary View' tab"})}catch(vc){}},moreIcon:(0,v.jsx)(v.Fragment,{})})}),!H&&(0,v.jsxs)(Be.Z,{children:[(null===z||void 0===z?void 0:z.enable_highlight)&&(0,v.jsx)("div",{children:(0,v.jsxs)(Qn.Z,{color:"rgb(45, 183, 245)",children:["Confidence Score:"," ",(null===B||void 0===B||null===(t=B.confidence)||void 0===t||null===(o=t[0])||void 0===o||null===(n=o[0])||void 0===n?void 0:n.confidence)||Array.isArray(null===B||void 0===B||null===(l=B.confidence)||void 0===l?void 0:l[0])&&0===(null===B||void 0===B||null===(s=B.confidence)||void 0===s||null===(a=s[0])||void 0===a?void 0:a.length)&&"1"||"NA"]})}),(0,v.jsx)("div",{className:"doc-main-title-div",children:F?(0,v.jsx)(bo.Z,{title:null===F||void 0===F?void 0:F.document_name,children:(0,v.jsx)(Ee.default.Text,{className:"doc-main-title",ellipsis:!0,children:null===F||void 0===F?void 0:F.document_name})}):null}),(0,v.jsx)("div",{children:(0,v.jsx)(bo.Z,{title:"Manage Document Variants",children:(0,v.jsx)(i.ZP,{className:"doc-manager-btn",onClick:()=>x(!0),children:(0,v.jsx)(Ee.default.Text,{ellipsis:!0,children:"Manage Documents"})})})}),(0,v.jsxs)("div",{children:[(0,v.jsx)(i.ZP,{type:"text",size:"small",disabled:!F||R||q||f<=1,onClick:()=>{if(f<=1)return;pe(f-1)},children:(0,v.jsx)(sn.Z,{className:"doc-manager-paginate-icon"})}),(0,v.jsx)(i.ZP,{type:"text",size:"small",disabled:!F||R||q||f>=(null===M||void 0===M?void 0:M.length),onClick:()=>{if(f>=(null===M||void 0===M?void 0:M.length))return;pe(f+1)},children:(0,v.jsx)(ln.Z,{className:"doc-manager-paginate-icon"})})]})]})]}),"1"===j&&(0,v.jsx)(qs,{doc:null===F||void 0===F?void 0:F.document_name,isLoading:O,isContentAvailable:(null===_||void 0===_?void 0:_.length)>0,setOpenManageDocsModal:x,errMsg:b,children:((e,t,o)=>{const n=null===e||void 0===e?void 0:e.split(".").pop().toLowerCase();switch(n){case"pdf":return(0,v.jsx)(ta,{fileUrl:t,highlightData:o});case"txt":case"md":return(0,v.jsx)(na,{fileUrl:t});default:return(0,v.jsxs)("div",{children:["Unsupported file type: ",n]})}})(null===F||void 0===F?void 0:F.document_name,$,J)}),"2"===j&&(0,v.jsx)(qs,{doc:null===F||void 0===F?void 0:F.document_name,isLoading:P,isContentAvailable:(null===k||void 0===k?void 0:k.length)>0,setOpenManageDocsModal:x,errMsg:E,children:(0,v.jsx)(oa,{text:k})}),da&&!H&&"3"===j&&(0,v.jsx)(da,{setOpenManageDocsModal:x,currDocIndexStatus:I}),(0,v.jsx)(Vs,{open:h,setOpen:x,generateIndex:d,handleUpdateTool:u,handleDocChange:m})]})}function ca(){const e=(0,c.s0)(),{details:t}=ee(),{sessionDetails:o}=N();return(0,v.jsxs)("div",{className:"custom-tools-header",children:[(0,v.jsx)("div",{children:(0,v.jsx)(i.ZP,{size:"small",type:"text",onClick:()=>e("/".concat(null===o||void 0===o?void 0:o.orgName,"/tools")),children:(0,v.jsx)(go.Z,{})})}),(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default.Text,{className:"custom-tools-name",strong:!0,children:null===t||void 0===t?void 0:t.tool_name}),(0,v.jsx)(i.ZP,{size:"small",type:"text",disabled:!0,children:(0,v.jsx)(wo.Z,{})})]})]})}const ua="share_all",pa="share_custom";function va(e){let{open:t,setOpen:o,toolDetails:n,loading:l,allUsers:i,onApply:s}=e;const[a,d]=(0,p.useState)([]),[r,c]=(0,p.useState)([]),[u,m]=(0,p.useState)(ua);(0,p.useEffect)((()=>{var e,t;const o=null===n||void 0===n||null===(e=n.created_by)||void 0===e?void 0:e.toString();if(null===n||void 0===n||!n.shared_users){const e=i.filter((e=>{var t;const n=null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString();return!a.includes(n)&&o!==n}));return void c(e)}const l=null===n||void 0===n||null===(t=n.prompt_studio_users)||void 0===t?void 0:t.map((e=>{var t;return null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString()})),s=i.filter((e=>{var t;const n=null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString();return!a.includes(n)&&!l.includes(n)&&o!==n}));c(s),m(n.shared_to_org?ua:pa)}),[n,i,a]),(0,p.useEffect)((()=>{var e,t;if(null===n||void 0===n||!n.shared_users)return;const o=null===n||void 0===n||null===(e=n.created_by)||void 0===e?void 0:e.toString(),l=null===n||void 0===n||null===(t=n.prompt_studio_users)||void 0===t?void 0:t.map((e=>{var t;return null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString()}));d(n.shared_users.filter((e=>{var t;const n=null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString();return!l.includes(n)&&o!==n})).map((e=>{var t;return null===e||void 0===e||null===(t=e.id)||void 0===t?void 0:t.toString()})))}),[n]);return n&&(0,v.jsx)($e.Z,{title:"Export settings",open:t,onCancel:()=>o(!1),maskClosable:!1,centered:!0,closable:!0,okText:"Apply",onOk:()=>s(a,n,u===ua),className:"share-permission-modal",children:l?(0,v.jsx)(At,{}):(0,v.jsxs)(v.Fragment,{children:[i.length>1&&(0,v.jsxs)(Mo.ZP.Group,{onChange:e=>{m(e.target.value)},value:u,className:"export-per-radio",children:[(0,v.jsx)(Mo.ZP,{value:ua,children:"Share with everyone in current org"}),(0,v.jsx)(Mo.ZP,{value:pa,children:"Custom share"})]}),u!==ua&&(0,v.jsx)(xt.default,{filterOption:(e,t)=>{var o;return(null!==(o=null===t||void 0===t?void 0:t.label)&&void 0!==o?o:"").toLowerCase().includes(e.toLowerCase())},showSearch:!0,size:"middle",placeholder:"Search",className:"export-permission-search",onChange:e=>{a.includes(e)||d([...a,e])},options:r.map((e=>({label:null===e||void 0===e?void 0:e.email,value:null===e||void 0===e?void 0:e.id}))),value:null,children:r.map((e=>(0,v.jsx)(xt.default.Option,{value:null===e||void 0===e?void 0:e.id,children:null===e||void 0===e?void 0:e.email},null===e||void 0===e?void 0:e.id)))}),(0,v.jsx)(Ee.default.Title,{level:5,children:"Shared with"}),u===ua?(0,v.jsx)(Ee.default.Text,{children:"Shared with everyone in current org"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(no.Z,{dataSource:a.map((e=>{const t=i.find((t=>(null===t||void 0===t?void 0:t.id.toString())===e.toString()));return{id:null===t||void 0===t?void 0:t.id,email:null===t||void 0===t?void 0:t.email}})),renderItem:e=>(0,v.jsx)(no.Z.Item,{extra:(0,v.jsx)("div",{onClick:e=>e.stopPropagation(),role:"none",children:(0,v.jsx)(So.Z,{title:"Delete the User",description:"Are you sure to remove ".concat(null===e||void 0===e?void 0:e.email,"?"),okText:"Yes",cancelText:"No",icon:(0,v.jsx)(To.Z,{}),onConfirm:t=>{return o=null===e||void 0===e?void 0:e.id,void d((e=>e.filter((e=>e!==o))));var o},children:(0,v.jsx)(Ee.default.Text,{children:(0,v.jsx)(Eo.Z,{className:"action-icon-buttons"})})},"".concat(null===e||void 0===e?void 0:e.id,"-delete"))}),children:(0,v.jsx)(no.Z.Item.Meta,{title:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(_o.C,{className:"shared-user-avatar",icon:(0,v.jsx)(No.Z,{})}),(0,v.jsx)(Ee.default.Text,{className:"export-username",children:null===e||void 0===e?void 0:e.email})]})})})}),(0,v.jsx)(Ee.default,{children:"Exported Tools are always shared with the Prompt Studio projects owner and users in addition to other users it is explicitly shared with"})]})]})})}let ma,ha,xa;try{ma=Object(function(){var e=new Error("Cannot find module '../../../plugins/single-pass-toggle-switch/SinglePassToggleSwitch'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{xa=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/public-share-btn/PromptShareButton.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{ha=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-clone/clone-btn/CloneButton.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function fa(e){let{setOpenSettings:t,handleUpdateTool:o,setOpenShareModal:n,setOpenCloneModal:l}=e;const[s,a]=(0,p.useState)(!1),{details:d,isPublicSource:r}=ee(),{sessionDetails:c}=N(),{setAlertDetails:u}=T(),m=ie(),h=_(),[x,f]=(0,p.useState)([]),[g,j]=(0,p.useState)(!1),{setPostHogCustomEvent:y}=Xt(),[S,b]=(0,p.useState)(null),[w,k]=(0,p.useState)(!1),[E,C]=(0,p.useState)(null),O=function(e,t,o){const n={is_shared_with_org:o,user_id:o?[]:e,force_export:arguments.length>3&&void 0!==arguments[3]&&arguments[3]},l={method:"POST",url:"/api/v1/unstract/".concat(null===c||void 0===c?void 0:c.orgId,"/prompt-studio/export/").concat(null===d||void 0===d?void 0:d.tool_id),headers:{"X-CSRFToken":null===c||void 0===c?void 0:c.csrfToken,"Content-Type":"application/json"},data:n};a(!0),m(l).then((()=>{u({type:"success",content:"Custom tool exported successfully"})})).catch((n=>{var l,i,s;if("warning"===(null===n||void 0===n||null===(l=n.response)||void 0===l||null===(i=l.data)||void 0===i||null===(s=i.errors[0])||void 0===s?void 0:s.code))return C({selectedUsers:e,toolDetail:t,isSharedWithEveryone:o}),void k(!0);u(h(n,"Failed to export"))})).finally((()=>{a(!1),j(!1)}))},D=(0,p.useCallback)((()=>{const{selectedUsers:e,toolDetail:t,isSharedWithEveryone:o}=E;O(e,t,o,!0),k(!1)}),[E]),P=async()=>{a(!0);const e={method:"GET",url:"/api/v1/unstract/".concat(null===c||void 0===c?void 0:c.orgId,"/users/")};return m(e).then((e=>{var t;const o=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.members)||[];return f(o.map((e=>({id:null===e||void 0===e?void 0:e.id,email:null===e||void 0===e?void 0:e.email})))),o})).catch((e=>{u(h(e,"Failed to load"))})).finally((()=>{a(!1)}))};return(0,v.jsxs)("div",{className:"custom-tools-header-layout",children:[r?(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"custom-tools-name",strong:!0,children:null===d||void 0===d?void 0:d.tool_name})}):(0,v.jsx)(ca,{}),(0,v.jsxs)("div",{className:"custom-tools-header-btns",children:[ma&&(0,v.jsx)(ma,{handleUpdateTool:o}),(0,v.jsx)("div",{children:(0,v.jsx)(bo.Z,{title:"Settings",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(Ai.Z,{}),onClick:()=>t(!0)})})}),ha&&(0,v.jsx)(ha,{setOpenCloneModal:l}),xa&&(0,v.jsx)(xa,{setOpenShareModal:n}),(0,v.jsx)("div",{className:"custom-tools-header-v-divider"}),(0,v.jsx)("div",{children:(0,v.jsx)(bo.Z,{title:"Export as tool",children:(0,v.jsx)(Bt,{type:"primary",onClick:()=>(e=>{try{y("ps_exported_tool",{info:"Clicked on the 'Export' button",tool_name:null===d||void 0===d?void 0:d.tool_name})}catch(vc){}const t={method:"GET",url:"/api/v1/unstract/".concat(null===c||void 0===c?void 0:c.orgId,"/prompt-studio/export/").concat(null===d||void 0===d?void 0:d.tool_id),headers:{"X-CSRFToken":null===c||void 0===c?void 0:c.csrfToken}};a(!0),P().then((e=>{e.length<2?O([null===d||void 0===d?void 0:d.created_by],d,!1):m(t).then((e=>{j(!0),b({...null===e||void 0===e?void 0:e.data,created_by:null===d||void 0===d?void 0:d.created_by})})).catch((e=>{u(h(e))})).finally((()=>{a(!1)}))}))})(),loading:s,disabled:r,children:(0,v.jsx)(Ie.my,{})})})}),(0,v.jsx)(va,{allUsers:x,open:g,setOpen:j,onApply:O,loading:s,toolDetails:S})]}),(0,v.jsxs)($e.Z,{onOk:D,onCancel:()=>k(!1),open:w,title:"Are you sure",okText:"Force Export",centered:!0,children:["Unable to export tool. Some prompt(s) were not run. Please run them before exporting."," ",(0,v.jsx)("strong",{children:"Would you like to force export anyway?"})]})]})}var ga=o(93451),ja=o(30142),ya=o(20938),_a=o(24925);function Sa(e){let{editLlmProfileId:t,setEditLlmProfileId:o,setIsAddLlm:n,handleDefaultLlm:s}=e;const[a]=dt.Z.useForm(),[d,c]=(0,p.useState)({}),[u,m]=(0,p.useState)(!1),[h,x]=(0,p.useState)(null),[f,g]=(0,p.useState)([]),[j,y]=(0,p.useState)([]),[S,b]=(0,p.useState)([]),[w,k]=(0,p.useState)([]),[E,C]=(0,p.useState)([]),[O,D]=(0,p.useState)(!1),[P,Z]=(0,p.useState)(!1),[I,L]=(0,p.useState)(""),[A,U]=(0,p.useState)(!1),{sessionDetails:F}=N(),{details:M,getDropdownItems:R,llmProfiles:z,updateCustomTool:W}=ee(),{setAlertDetails:q}=T(),H=ie(),{token:G}=l.default.useToken(),K=_(),{setPostHogCustomEvent:B}=Xt();(0,p.useEffect)((()=>{$();const e=R("retrieval_strategy");if(!e)return;const t=Object.keys(e).map((t=>({value:e[t]})));return g(t),()=>{o(null)}}),[]),(0,p.useEffect)((()=>{t||(m(!0),c({profile_name:"",llm:"",chunk_size:0,vector_store:"",chunk_overlap:0,embedding_model:"",x2text:"",retrieval_strategy:"simple",similarity_top_k:3,section:"Default",prompt_studio_tool:null===M||void 0===M?void 0:M.tool_id}),L("Add New LLM Profile"),D(!1))}),[]),(0,p.useEffect)((()=>{if(!t||!A)return;L("Edit LLM Profile");const e=[...z].find((e=>(null===e||void 0===e?void 0:e.profile_id)===t)),o=j.find((t=>(null===t||void 0===t?void 0:t.label)===(null===e||void 0===e?void 0:e.llm))),n=S.find((t=>(null===t||void 0===t?void 0:t.label)===(null===e||void 0===e?void 0:e.vector_store))),l=w.find((t=>(null===t||void 0===t?void 0:t.label)===(null===e||void 0===e?void 0:e.embedding_model))),i=E.find((t=>(null===t||void 0===t?void 0:t.label)===(null===e||void 0===e?void 0:e.x2text)));m(!0),c({profile_name:null===e||void 0===e?void 0:e.profile_name,llm:(null===o||void 0===o?void 0:o.value)||null,chunk_size:null===e||void 0===e?void 0:e.chunk_size,vector_store:(null===n||void 0===n?void 0:n.value)||null,chunk_overlap:null===e||void 0===e?void 0:e.chunk_overlap,embedding_model:(null===l||void 0===l?void 0:l.value)||null,x2text:(null===i||void 0===i?void 0:i.value)||null,retrieval_strategy:null===e||void 0===e?void 0:e.retrieval_strategy,similarity_top_k:null===e||void 0===e?void 0:e.similarity_top_k,section:null===e||void 0===e?void 0:e.section,prompt_studio_tool:null===M||void 0===M?void 0:M.tool_id}),D(!0)}),[t,A]),(0,p.useEffect)((()=>{u&&(a.resetFields(),m(!1))}),[d]);const[X,V]=(0,p.useState)(0),[Y,Q]=(0,p.useState)(0),J=(e,t)=>t&&""===t.trim()?Promise.reject(new Error("Please enter a non-whitespace value")):Promise.resolve(),$=()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===F||void 0===F?void 0:F.orgId,"/adapter")};H(e).then((e=>{(null===e||void 0===e?void 0:e.data).forEach((e=>{"LLM"===(null===e||void 0===e?void 0:e.adapter_type)&&y((t=>{const o=[...t];return o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.adapter_name}),o})),"VECTOR_DB"===(null===e||void 0===e?void 0:e.adapter_type)&&b((t=>{const o=[...t];return o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.adapter_name}),o})),"EMBEDDING"===(null===e||void 0===e?void 0:e.adapter_type)&&k((t=>{const o=[...t];return o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.adapter_name}),o})),"X2TEXT"===(null===e||void 0===e?void 0:e.adapter_type)&&C((t=>{const o=[...t];return o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.adapter_name}),o}))})),U(!0)})).catch((e=>{q(K(e,"Failed to get the dropdown list for LLM Adapters"))}))};function te(e){return(e/4/1024).toFixed(1)}return(0,v.jsx)("div",{className:"settings-body-pad-top",children:(0,v.jsxs)(dt.Z,{form:a,layout:"vertical",initialValues:d,onValuesChange:(e,t)=>{c({...d,...t});const o=Object.keys(e)[0];a.setFields([{name:o,errors:[]}]),x((e=>{if(e){const t=e.errors.filter((e=>e.attr!==o));return{...e,errors:t}}return null}))},onFinish:()=>{Z(!0);let e="POST",o="/api/v1/unstract/".concat(null===F||void 0===F?void 0:F.orgId,"/prompt-studio/profilemanager/").concat(null===M||void 0===M?void 0:M.tool_id);if(null!==t&&void 0!==t&&t.length)e="PUT",o="/api/v1/unstract/".concat(null===F||void 0===F?void 0:F.orgId,"/prompt-studio/profile-manager/"),o+="".concat(t,"/");else try{B("intent_success_ps_new_llm_profile",{info:"Clicked on 'Add' button"})}catch(vc){}const l={method:e,url:o,headers:{"X-CSRFToken":null===F||void 0===F?void 0:F.csrfToken,"Content-Type":"application/json"},data:d};H(l).then((e=>{var o;const l=null===e||void 0===e?void 0:e.data;let i=[...z];t?i=[...z].map((e=>(null===e||void 0===e?void 0:e.profile_id)===t?l:e)):i.push(l);W({llmProfiles:i}),q({type:"success",content:"Saved successfully"}),1===(null===(o=i)||void 0===o?void 0:o.length)&&s(null===l||void 0===l?void 0:l.profile_id),n(!1)})).catch((e=>{q(K(e,"",x))})).finally((()=>{Z(!1)}))},children:[(0,v.jsxs)(tn,{children:[(0,v.jsxs)("div",{children:[(0,v.jsx)(i.ZP,{size:"small",type:"text",onClick:()=>n(!1),children:(0,v.jsx)(go.Z,{})}),(0,v.jsx)(Ee.default.Text,{className:"add-cus-tool-header",children:I})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)(dt.Z.Item,{label:"Name",name:"profile_name",rules:[{required:!0,message:"Please enter the name"},{validator:J}],validateStatus:(0,r.dz)("profile_name",h)?"error":"",help:(0,r.dz)("profile_name",h),children:(0,v.jsx)(_t.default,{})}),(0,v.jsxs)(Pe.Z,{className:"add-llm-profile-row",children:[(0,v.jsx)(Ze.Z,{span:15,children:(0,v.jsx)(dt.Z.Item,{label:"LLM",name:"llm",rules:[{required:!0,message:"Please enter the LLM"},{validator:J}],validateStatus:(0,r.dz)("llm",h)?"error":"",help:(0,r.dz)("llm",h),children:(0,v.jsx)(xt.default,{options:j,onSelect:async e=>{if(!e)return null;const t={method:"GET",url:"/api/v1/unstract/".concat(null===F||void 0===F?void 0:F.orgId,"/adapter/info/").concat(e,"/"),headers:{"X-CSRFToken":null===F||void 0===F?void 0:F.csrfToken}};H(t).then((e=>{const t=(null===e||void 0===e?void 0:e.data).context_window_size,o=a.getFieldValue("chunk_size");V(o>0?te(o):0),Q(t)})).catch((e=>{q(K(e,"Failed to get chunk size information for the requested LLM. Please proceed with a sane default."))}))}})})}),(0,v.jsx)(Ze.Z,{span:1}),(0,v.jsx)(Ze.Z,{span:8,children:(0,v.jsx)(dt.Z.Item,{label:(0,v.jsxs)(v.Fragment,{children:["Chunk Size",(0,v.jsxs)(Ee.default.Text,{type:"secondary",children:[" ","(Set to 0 if documents are small)"]})]}),name:"chunk_size",rules:[{required:!0,message:"Please enter the chunk size"}],validateStatus:(0,r.dz)("chunk_size",h)?"error":"",help:(0,r.dz)("chunk_size",h),extra:"~= ".concat(X,"k tokens, Max: ").concat(Y),children:(0,v.jsx)(_t.default,{type:"number",onChange:async e=>{const t=te(e.target.value);V(t)}})})})]}),(0,v.jsxs)(Pe.Z,{className:"add-llm-profile-row",children:[(0,v.jsx)(Ze.Z,{span:15,children:(0,v.jsx)(dt.Z.Item,{label:"Vector Database",name:"vector_store",rules:[{required:!0,message:"Please select the vector store"},{validator:J}],validateStatus:(0,r.dz)("vector_store",h)?"error":"",help:(0,r.dz)("vector_store",h),children:(0,v.jsx)(xt.default,{options:S})})}),(0,v.jsx)(Ze.Z,{span:1}),(0,v.jsx)(Ze.Z,{span:8,children:(0,v.jsx)(dt.Z.Item,{label:"Overlap",name:"chunk_overlap",rules:[{required:!0,message:"Please enter the overlap"}],validateStatus:(0,r.dz)("chunk_overlap",h)?"error":"",help:(0,r.dz)("chunk_overlap",h),children:(0,v.jsx)(_t.default,{type:"number"})})})]}),(0,v.jsx)(dt.Z.Item,{label:"Embedding Model",name:"embedding_model",rules:[{required:!0,message:"Please select the embedding model"},{validator:J}],validateStatus:(0,r.dz)("embedding_model",h)?"error":"",help:(0,r.dz)("embedding_model",h),children:(0,v.jsx)(xt.default,{options:w})}),(0,v.jsx)(dt.Z.Item,{label:"Text Extractor",name:"x2text",rules:[{required:!0,message:"Please select the text extractor"},{validator:J}],validateStatus:(0,r.dz)("x2text",h)?"error":"",help:(0,r.dz)("x2text",h),children:(0,v.jsx)(xt.default,{options:E})}),(0,v.jsx)(_a.Z,{expandIcon:e=>{let{isActive:t}=e;return(e=>(0,v.jsx)(ya.Z,{rotate:e?90:0}))(t)},size:"small",style:{background:G.colorBgContainer},items:(e=>[{key:"1",label:"Advanced Settings",style:e,children:(0,v.jsxs)("div",{children:[(0,v.jsx)(dt.Z.Item,{label:"Retrieval Strategy",name:"retrieval_strategy",validateStatus:(0,r.dz)("retrieval_strategy",h)?"error":"",help:(0,r.dz)("retrieval_strategy",h),children:(0,v.jsx)(xt.default,{options:f})}),(0,v.jsx)(dt.Z.Item,{label:"Matching count limit (similarity top-k)",name:"similarity_top_k",validateStatus:(0,r.dz)("similarity_top_k",h)?"error":"",help:(0,r.dz)("similarity_top_k",h),children:(0,v.jsx)(_t.default,{type:"number"})}),(0,v.jsx)(dt.Z.Item,{label:"Limit-to Section",name:"section",validateStatus:(0,r.dz)("section",h)?"error":"",help:(0,r.dz)("section",h),children:(0,v.jsx)(xt.default,{options:[{value:"Default"}]})})]})}])({marginBottom:16}),activeKey:O&&"1",onChange:e=>{D(!(null===e||void 0===e||!e.length))}})]})]}),(0,v.jsx)(dt.Z.Item,{className:"display-flex-right",children:(0,v.jsx)(Be.Z,{children:(0,v.jsx)(Bt,{type:"primary",htmlType:"submit",loading:P,children:t?"Update":"Add"})})})]})})}const ba=[{title:"Name",dataIndex:"name",key:"name"},{title:"LLM",dataIndex:"llm",key:"llm"},{title:"Embedding Model",dataIndex:"embedding_model",key:"embedding_model"},{title:"Vector Database",dataIndex:"vector_db",key:"vector_db"},{title:"Text Extractor",dataIndex:"text_extractor",key:"text_extractor"},{title:"",dataIndex:"delete",key:"delete",width:30},{title:"",dataIndex:"edit",key:"edit",width:30},{title:"Select Default",dataIndex:"select",key:"select",align:"center"}];function Na(){const[e,t]=(0,p.useState)([]),[o,n]=(0,p.useState)(!1),[l,s]=(0,p.useState)(null),a=ie(),{sessionDetails:d}=N(),{details:r,defaultLlmProfile:c,updateCustomTool:u,llmProfiles:m,isPublicSource:h}=ee(),{setAlertDetails:x}=T(),f=_(),{setPostHogCustomEvent:g}=Xt(),j=m.length>=4,y=e=>{try{g("ps_profile_changed_per_prompt",{info:"Selected default LLM profile"})}catch(vc){}const t={default_profile:e},o={method:"PATCH",url:"/api/v1/unstract/".concat(null===d||void 0===d?void 0:d.orgId,"/prompt-studio/prompt-studio-profile/").concat(null===r||void 0===r?void 0:r.tool_id,"/"),headers:{"X-CSRFToken":null===d||void 0===d?void 0:d.csrfToken,"Content-Type":"application/json"},data:t};a(o).then((e=>{const t=null===e||void 0===e?void 0:e.data,o={defaultLlmProfile:null===t||void 0===t?void 0:t.default_profile};u(o),x({type:"success",content:"Default LLM Profile updated successfully"})})).catch((e=>{f(e,"Failed to set default LLM Profile")}))};(0,p.useEffect)((()=>{const e=m.map((e=>({key:null===e||void 0===e?void 0:e.profile_id,name:(null===e||void 0===e?void 0:e.profile_name)||"",llm:(null===e||void 0===e?void 0:e.llm)||"",embedding_model:(null===e||void 0===e?void 0:e.embedding_model)||"",vector_db:(null===e||void 0===e?void 0:e.vector_store)||"",text_extractor:(null===e||void 0===e?void 0:e.x2text)||"",delete:(0,v.jsx)(zo,{handleConfirm:()=>b(null===e||void 0===e?void 0:e.profile_id),content:"The LLM profile will be permanently deleted.",children:(0,v.jsx)(bo.Z,{title:c===(null===e||void 0===e?void 0:e.profile_id)&&"Default profile cannot be deleted",children:(0,v.jsx)(i.ZP,{size:"small",className:"display-flex-align-center",disabled:h||c===(null===e||void 0===e?void 0:e.profile_id),children:(0,v.jsx)(Eo.Z,{classID:"manage-llm-pro-icon"})})})}),edit:(0,v.jsx)(i.ZP,{size:"small",className:"display-flex-align-center",disabled:h,onClick:()=>S(null===e||void 0===e?void 0:e.profile_id),children:(0,v.jsx)(wo.Z,{classID:"manage-llm-pro-icon"})}),select:(0,v.jsx)(Mo.ZP,{checked:c===(null===e||void 0===e?void 0:e.profile_id),onClick:()=>y(null===e||void 0===e?void 0:e.profile_id),disabled:h})})));t(e)}),[m,c]);const S=e=>{s(e),n(!0)},b=e=>{const t={method:"DELETE",url:"/api/v1/unstract/".concat(null===d||void 0===d?void 0:d.orgId,"/prompt-studio/profile-manager/").concat(e,"/"),headers:{"X-CSRFToken":null===d||void 0===d?void 0:d.csrfToken}};a(t).then((()=>{const t={llmProfiles:[...m].filter((t=>(null===t||void 0===t?void 0:t.profile_id)!==e))};e===c&&(t.defaultLlmProfile=""),u(t)})).catch((e=>{x(f(e,"Failed to delete"))}))};return o?(0,v.jsx)(Sa,{editLlmProfileId:l,setEditLlmProfileId:s,setIsAddLlm:n,handleDefaultLlm:y}):(0,v.jsxs)("div",{className:"settings-body-pad-top",children:[(0,v.jsxs)(tn,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"add-cus-tool-header",children:"LLM Profile Settings"})}),(0,v.jsx)("div",{children:(0,v.jsx)(Vo.Z,{columns:ba,dataSource:e,size:"small",bordered:!0,"max-width":"100%",pagination:{pageSize:10}})})]}),(0,v.jsx)("div",{className:"display-flex-right",children:(0,v.jsx)(bo.Z,{title:j?"Max profile count(".concat(4,")"):"Add New LLM Profile",children:(0,v.jsx)(Bt,{type:"primary",onClick:()=>{n(!0);try{g("intent_ps_new_llm_profile",{info:"Clicked on 'Add New LLM Profile' button"})}catch(vc){}},disabled:j||h,children:"Add New LLM Profile"})})})]})}const wa=[{title:"Word",dataIndex:"word",key:"word",width:200},{title:"Synonyms",dataIndex:"synonyms",key:"synonyms"},{title:"",dataIndex:"delete",key:"delete",width:30}],ka=10,Ta=200,Ea={save:"SAVE",delete:"DELETE"};function Ca(){const[e,t]=(0,p.useState)([]),[o,n]=(0,p.useState)([]),[l,s]=(0,p.useState)(!1),[a,d]=(0,p.useState)(1),{sessionDetails:r}=N(),{details:c,isPublicSource:u}=ee(),{setAlertDetails:m}=T(),h=ie(),x=_();(0,p.useEffect)((()=>{const e=null===c||void 0===c?void 0:c.prompt_grammer;if(!e||0===Object.keys(e).length)return void t([]);const o=Object.keys(e).map(((t,o)=>({key:o,word:t,synonyms:e[t]})));t(o)}),[c]),(0,p.useEffect)((()=>{if(!e||0===e.length)return void n([]);const t=[...e].map(((e,t)=>{const o=null===e||void 0===e?void 0:e.word,n=(null===e||void 0===e?void 0:e.synonyms)||[];return{key:t,word:(0,v.jsx)(_t.default,{value:o,variant:"borderless",onChange:e=>f(t,"word",e.target.value)}),synonyms:(0,v.jsx)(xt.default,{mode:"tags",placeholder:"Please enter synonyms",value:n,className:"cus-syn-select",variant:"borderless",onChange:e=>f(t,"synonyms",e)}),delete:(0,v.jsx)(zo,{handleConfirm:()=>g(t),content:"The word, along with its corresponding synonyms, will be permanently deleted.",isDisabled:0===(null===n||void 0===n?void 0:n.length),children:(0,v.jsx)(i.ZP,{size:"small",disabled:u,type:"text",children:(0,v.jsx)(Eo.Z,{className:"cus-syn-del"})})})}}));n(t)}),[e]);const f=(o,n,l)=>{const i=[...e];i[o][n]=l,t(i)},g=t=>{const o=[...e];o.splice(t,1),j(o,Ea.delete)},j=(e,o)=>{const n={};[...e].forEach((e=>{var t;null!==e&&void 0!==e&&e.word&&null!==e&&void 0!==e&&null!==(t=e.synonyms)&&void 0!==t&&t.length&&!(e.word in n)&&(n[e.word]=e.synonyms||[])}));let l="",i="";o===Ea.save?(l="Saved synonyms successfully",i="Failed to save synonyms"):(l="Deleted synonyms successfully",i="Failed to delete synonyms");const a={prompt_grammer:n},d={method:"PATCH",url:"/api/v1/unstract/".concat(null===r||void 0===r?void 0:r.orgId,"/prompt-studio/").concat(null===c||void 0===c?void 0:c.tool_id,"/"),headers:{"X-CSRFToken":null===r||void 0===r?void 0:r.csrfToken,"Content-Type":"application/json"},data:a};s(!0),h(d).then((()=>{o===Ea.delete&&t(e),m({type:"success",content:l})})).catch((e=>{m(x(e,i))})).finally((()=>{s(!1)}))};return(0,v.jsx)("div",{className:"settings-body-pad-top",children:(0,v.jsxs)(tn,{children:[(0,v.jsxs)("div",{className:"display-flex-space-between",children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"add-cus-tool-header",children:"Custom Synonyms"})}),(0,v.jsx)("div",{children:(0,v.jsx)(Bt,{type:"primary",icon:(0,v.jsx)(et.Z,{}),onClick:()=>{const o=null===e||void 0===e?void 0:e.length;if(o>=Ta)return;const n={key:o,word:"",synonyms:[]},l=[...e];l.push(n),t(l);(null===l||void 0===l?void 0:l.length)/ka+1>a&&d((e=>e+1))},disabled:u||(null===e||void 0===e?void 0:e.length)>=Ta,children:"Rows"})})]}),(0,v.jsx)("div",{children:(0,v.jsx)(Vo.Z,{columns:wa,dataSource:o,size:"small",bordered:!0,pagination:{pageSize:ka,current:a,onChange:e=>d(e)}})}),(0,v.jsx)("div",{className:"display-flex-right",children:(0,v.jsx)(Be.Z,{children:(0,v.jsx)(Bt,{type:"primary",onClick:()=>j(e,Ea.save),loading:l,disabled:u,children:"Save"})})})]})})}const Oa=JSON.parse('{"A":"Your ability to extract and summarize this context accurately is essential for effective analysis. Pay close attention to the context\'s language, structure, and any cross-references to ensure a comprehensive and precise extraction of information. Do not use prior knowledge or information from outside the context to answer the questions. Only use the information provided in the context to answer the questions.","e":"Do not include any explanation in the reply. Only include the extracted information in the reply."}'),Da={preamble:"PREAMBLE",postamble:"POSTAMBLE"};function Pa(e){let{type:t,handleUpdateTool:o}=e;const[n,l]=(0,p.useState)(""),[s,a]=(0,p.useState)(""),{details:d,updateCustomTool:r,isPublicSource:c}=ee(),{setAlertDetails:u}=T(),m=_();(0,p.useEffect)((()=>{if(t===Da.preamble)return l("Preamble Settings"),void a((null===d||void 0===d?void 0:d.preamble)||"");t===Da.postamble&&(l("Postamble Settings"),a((null===d||void 0===d?void 0:d.postamble)||""))}),[t]);return(0,v.jsx)("div",{className:"settings-body-pad-top",children:(0,v.jsxs)(tn,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{strong:!0,className:"pre-post-amble-title",children:n})}),(0,v.jsx)("div",{children:(0,v.jsx)("div",{children:(0,v.jsxs)(Ee.default.Text,{children:["Add ",n]})})}),(0,v.jsxs)("div",{children:[(0,v.jsx)(_t.default.TextArea,{rows:4,value:s,onChange:e=>a(e.target.value),disabled:c}),(0,v.jsx)(i.ZP,{size:"small",type:"link",onClick:()=>{t!==Da.preamble?t===Da.postamble&&a(Oa.e):a(Oa.A)},disabled:c,children:"Reset with default prompt"})]}),(0,v.jsx)("div",{className:"display-flex-right",children:(0,v.jsx)(Be.Z,{children:(0,v.jsx)(Bt,{type:"primary",onClick:()=>{const e={};t===Da.preamble&&(e.preamble=s),t===Da.postamble&&(e.postamble=s),o(e).then((e=>{const t=null===e||void 0===e?void 0:e.data,o={preamble:(null===t||void 0===t?void 0:t.preamble)||"",postamble:(null===t||void 0===t?void 0:t.postamble)||""},n={...d,...o};r({details:n}),u({type:"success",content:"Saved successfully"})})).catch((e=>{u(m(e,"Failed to update."))}))},disabled:c,children:"Save"})})})]})})}let Za=null;const Ia=null;let La=null,Aa=null;try{Za=Object(function(){var e=new Error("Cannot find module '../../../plugins/summarize-manager/SummarizeManager'");throw e.code="MODULE_NOT_FOUND",e}()),La=Object(function(){var e=new Error("Cannot find module '../../../plugins/challenge-manager/ChallengeManager'");throw e.code="MODULE_NOT_FOUND",e}()),Aa=Object(function(){var e=new Error("Cannot find module '../../../plugins/highlight-manager/HighlightManager'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Ua(e){let{open:t,setOpen:o,handleUpdateTool:n}=e;const[l,i]=(0,p.useState)(1),[s,a]=(0,p.useState)([]),{llmProfiles:d}=ee(),[c,u]=(0,p.useState)([]),[m,h]=(0,p.useState)([]);(0,p.useEffect)((()=>{const e=[(0,r.Lm)("LLM Profiles",1,(0,v.jsx)(sl.Z,{})),(0,r.Lm)("Grammar",5,(0,v.jsx)(ga.Z,{})),(0,r.Lm)("Preamble",6,(0,v.jsx)(ja.Z,{})),(0,r.Lm)("Postamble",7,(0,v.jsx)(ja.Z,{}))],t={1:(0,v.jsx)(Na,{}),5:(0,v.jsx)(Ca,{}),6:(0,v.jsx)(Pa,{type:"PREAMBLE",handleUpdateTool:n}),7:(0,v.jsx)(Pa,{type:"POSTAMBLE",handleUpdateTool:n})};let o=1;Za&&(e.splice(o,0,(0,r.Lm)("SummarizedExtraction",2,(0,v.jsx)(Ws.Z,{}))),t[2]=(0,v.jsx)(Za,{llmItems:s,handleUpdateTool:n}),o++),Ia&&(e.splice(o,0,(0,r.Lm)("Evaluation Manager",3,(0,v.jsx)(Ws.Z,{}))),t[3]=(0,v.jsx)(Ia,{handleUpdateTool:n}),o++),La&&(e.splice(o,0,(0,r.Lm)("LLMChallenge",4,(0,v.jsx)(Ws.Z,{}))),t[4]=(0,v.jsx)(La,{handleUpdateTool:n,type:"challenge"}),o++),Aa&&(e.push((0,r.Lm)("Highlighting",8,(0,v.jsx)(Ws.Z,{}))),t[8]=(0,v.jsx)(Aa,{handleUpdateTool:n,type:"highlight"})),u(e),h(t)}),[s]),(0,p.useEffect)((()=>{x()}),[d]);const x=()=>{const e=[...d].map((e=>({value:null===e||void 0===e?void 0:e.profile_id,label:null===e||void 0===e?void 0:e.profile_name})));a(e)};return(0,v.jsx)($e.Z,{open:t,onCancel:()=>o(!1),maskClosable:!1,centered:!0,footer:null,width:1200,children:(0,v.jsxs)(tn,{children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"add-cus-tool-header",children:"Settings"})}),(0,v.jsxs)(Pe.Z,{className:"conn-modal-row",style:{height:"800px"},children:[(0,v.jsx)(Ze.Z,{span:4,className:"conn-modal-col conn-modal-col-left",children:(0,v.jsx)("div",{className:"conn-modal-menu conn-modal-form-pad-right",children:(0,v.jsx)(Mi.Z,{className:"sidebar-menu",style:{border:0},mode:"inline",items:c,onClick:e=>{const t=e.key;i(null===t||void 0===t?void 0:t.toString())},selectedKeys:["".concat(l)]})})}),(0,v.jsx)(Ze.Z,{span:20,className:"conn-modal-col",children:(0,v.jsx)("div",{className:"conn-modal-form-pad-left",children:m[l]})})]})]})})}var Fa=o(50127),Ma=o(99197),Ra=(o(30318),o(40313),o(58819),o(6444));const za=e=>{let{profiles:t,profileId:o}=e;const n=null===t||void 0===t?void 0:t.find((e=>(null===e||void 0===e?void 0:e.profile_id)===o));return n?(0,v.jsxs)(Pe.Z,{className:"profile-info-bar",children:[(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"Profile Name:"})," ",null===n||void 0===n?void 0:n.profile_name]})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"Chunk Size:"})," ",null===n||void 0===n?void 0:n.chunk_size]})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"Vector Store:"})," ",null===n||void 0===n?void 0:n.vector_store]})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"Embedding Model:"})," ",null===n||void 0===n?void 0:n.embedding_model]})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"LLM:"})," ",null===n||void 0===n?void 0:n.llm]})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"X2Text:"})," ",null===n||void 0===n?void 0:n.x2text]})}),(0,v.jsx)(Ze.Z,{children:(0,v.jsxs)(Qn.Z,{children:[(0,v.jsx)("strong",{children:"Reindex:"})," ",null!==n&&void 0!==n&&n.reindex?"Yes":"No"]})})]}):(0,v.jsx)("p",{children:"Profile not found"})};function Wa(e){let{activeKey:t,selectedProfile:o,llmProfiles:n,combinedOutput:l,isLoading:i}=e;return i?(0,v.jsx)(At,{}):(0,v.jsxs)(v.Fragment,{children:["0"!==t&&(0,v.jsx)(za,{profileId:o,profiles:n}),(0,v.jsx)("div",{className:"combined-op-body code-snippet",children:l&&(0,v.jsx)("pre",{className:"line-numbers width-100",children:(0,v.jsx)("code",{className:"language-javascript width-100",children:JSON.stringify(l,null,2)})})})]})}function qa(e){let{combinedOutput:t,handleTabChange:o,adapterData:n,activeKey:l,selectedProfile:i,llmProfiles:s,isSinglePass:a,isLoading:d}=e;return(0,p.useEffect)((()=>{Tl().highlightAll()}),[t]),(0,v.jsxs)("div",{className:"combined-op-layout",children:[(0,v.jsxs)("div",{className:"combined-op-header",children:[(0,v.jsxs)(bl.Z,{activeKey:l,onChange:o,moreIcon:(0,v.jsx)(v.Fragment,{}),children:[!a&&(0,v.jsx)(Ra.Z,{tab:(0,v.jsx)("span",{children:"Default"})},"0"),n.map((e=>(0,v.jsx)(Ra.Z,{tab:(0,v.jsx)("span",{children:(null===e||void 0===e?void 0:e.llm_model)||(null===e||void 0===e?void 0:e.profile_name)})},null===e||void 0===e?void 0:e.profile_id)))]}),(0,v.jsx)("div",{className:"combined-op-segment"})]}),(0,v.jsx)("div",{className:"combined-op-divider"}),(0,v.jsx)(Wa,{activeKey:l,selectedProfile:i,llmProfiles:s,combinedOutput:t,isLoading:d}),(0,v.jsx)("div",{className:"gap"})]})}let Ha,Ga,Ka,Ba,Xa;try{Ha=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/TableView'");throw e.code="MODULE_NOT_FOUND",e}()),Ga=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/helper'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{Ka=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}()),Ba=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}()),Xa=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Va(e){let{docId:t,setFilledFields:o,selectedPrompts:n}=e;const{details:l,defaultLlmProfile:i,singlePassExtractMode:s,isSinglePassExtractLoading:a,llmProfiles:d,isSimplePromptStudio:u,isPublicSource:m}=ee(),[h,x]=(0,p.useState)({}),[f,g]=(0,p.useState)(!1),[j,y]=(0,p.useState)([]),[S,b]=(0,p.useState)(s?i:"0"),[w,k]=(0,p.useState)(i),[E,C]=(0,p.useState)({}),{id:O}=(0,c.UO)(),{sessionDetails:D}=N(),{setAlertDetails:P}=T(),Z=ie(),I=_();(0,p.useEffect)((()=>{if(u)return;(async()=>{let e="/api/v1/unstract/".concat(null===D||void 0===D?void 0:D.orgId,"/adapter/?adapter_type=LLM");m&&(e=Ba(O,"LLM"));try{const t=await Z.get(e),o=null===t||void 0===t?void 0:t.data;y((0,r.Wk)(d,o))}catch(vc){P(I(vc,"Failed to fetch adapter information"))}})()}),[]),(0,p.useEffect)((()=>{b(s?i:"0"),k(s?i:null)}),[s]),(0,p.useEffect)((()=>{if(!t||a)return;(async()=>{g(!0),x({});try{const e=await L(),t=(null===e||void 0===e?void 0:e.data)||[],o=(null===l||void 0===l?void 0:l.prompts)||[];if("0"!==S||u){const e=o.reduce(((e,o)=>{if((null===o||void 0===o?void 0:o.prompt_type)!==r.A6.notes){var n;const l=w||(null===o||void 0===o?void 0:o.profile_manager),i=t.find((e=>(null===e||void 0===e?void 0:e.prompt_id)===(null===o||void 0===o?void 0:o.prompt_id)&&(null===e||void 0===e?void 0:e.profile_manager)===l));e[null===o||void 0===o?void 0:o.prompt_key]=(null===i||void 0===i||null===(n=i.output)||void 0===n?void 0:n.length)>0?(0,r.fe)(null===i||void 0===i?void 0:i.output,!1):""}return e}),{});x(e)}else{const e=Object.entries(t).reduce(((e,t)=>{let[o,n]=t;return e[o]=(0,r.fe)(n,!1),e}),{});x(e)}}catch(vc){P(I(vc,"Failed to generate combined output"))}finally{g(!1)}})()}),[t,S]);const L=(0,p.useCallback)((async()=>{let e;if(u)e=Ga(null===l||void 0===l?void 0:l.tool_id,null,t);else if(m)e=Ka(O,null,s,t,w||i),"0"===S&&(e=Xa(O,t));else{const o=null===D||void 0===D?void 0:D.orgId,n=null===l||void 0===l?void 0:l.tool_id,a=w||i;e="/api/v1/unstract/".concat(o,"/prompt-studio/prompt-output/?tool_id=").concat(n,"&document_manager=").concat(t,"&is_single_pass_extract=").concat(s,"&profile_manager=").concat(a),"0"===S&&(e="/api/v1/unstract/".concat(o,"/prompt-studio/prompt-output/prompt-default-profile/?tool_id=").concat(n,"&document_manager=").concat(t))}const o={method:"GET",url:e,headers:{"X-CSRFToken":null===D||void 0===D?void 0:D.csrfToken}};return await Z(o)}),[s,t,w,i,S]),A=(0,p.useCallback)((e=>{b(e),k("0"===e?i:e)}),[i]);return(0,p.useEffect)((()=>{const e=Object.fromEntries(Object.entries(h).filter((e=>{let[t]=e;return!n||n[t]}))),t=Object.values(e).filter((e=>0===e||e&&e.length>0)).length;o&&o(t),C(e)}),[n,h]),u&&Ha?(0,v.jsx)(Ha,{combinedOutput:h,isLoading:f}):(0,v.jsx)(qa,{combinedOutput:E,handleTabChange:A,selectedProfile:w,llmProfiles:d,activeKey:S,adapterData:j,isSinglePass:s,isLoading:f})}function Ya(e){let{isEditing:t,setIsEditing:o,text:n,setText:l,promptId:i,defaultText:s,handleChange:a,isTextarea:d,placeHolder:r,isCoverageLoading:c}=e;const u=d?"prompt":"prompt_key",[m,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(!1),g=(0,p.useRef)(null),{isSinglePassExtractLoading:j,isPublicSource:y}=ee();(0,p.useEffect)((()=>{l(s)}),[s]),(0,p.useEffect)((()=>(document.addEventListener("click",N),()=>{document.removeEventListener("click",N)})),[]);const _=()=>{o(!1)},S=e=>{const t=e.target.value;l(t),b(e)},b=(0,p.useCallback)(io()((e=>{h(!0)}),1e3),[]);(0,p.useEffect)((()=>{m&&(a(n,i,u,!0,!1),h(!1))}),[m]);const N=e=>{g.current&&!g.current.contains(e.target)&&o(!1)};return d?(0,v.jsx)(_t.default.TextArea,{className:"font-size-12 width-100",value:n,onChange:S,placeholder:r,name:u,size:"small",style:{backgroundColor:"transparent"},variant:"".concat(t||x?"outlined":"borderless"),autoSize:!0,onMouseOver:()=>f(!0),onMouseOut:()=>f(!1),onBlur:_,onClick:()=>o(!0),disabled:c||j||y}):(0,v.jsx)(_t.default,{className:"width-100 input-header-text",value:n,onChange:S,placeholder:"Enter Key",name:u,size:"small",style:{backgroundColor:"transparent"},variant:"".concat(t||x?"outlined":"borderless"),autoSize:!0,onMouseOver:()=>f(!0),onMouseOut:()=>f(!1),onBlur:_,onClick:()=>o(!0),disabled:c||j||y})}var Qa=o(55962),Ja=o(66256);function $a(e){let{expandCard:t,setExpandCard:o}=e;const[n,l]=(0,p.useState)(null),[s,a]=(0,p.useState)("");(0,p.useEffect)((()=>{t?(l((0,v.jsx)(Qa.Z,{className:"prompt-card-actions-head"})),a("Collapse")):(l((0,v.jsx)(Ja.Z,{className:"prompt-card-actions-head"})),a("Expand"))}),[t]);return(0,v.jsx)(bo.Z,{title:s,children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:()=>{o(!t)},children:n})})}const ed="table",td=(e,t,o,n)=>{e&&n({promptId:t,status:o})};function od(e){let{promptDetails:t,handleChangePromptCard:o,handleDelete:n,updatePlaceHolder:l,setUpdatedPromptsCopy:s}=e;const[a,d]=(0,p.useState)({}),[c,u]=(0,p.useState)(!1),[m,h]=(0,p.useState)({promptId:null,status:null}),[x,f]=(0,p.useState)(""),[g,j]=(0,p.useState)(""),[y,_]=(0,p.useState)(!1),[S,b]=(0,p.useState)(!1),[N,w]=(0,p.useState)(!0);(0,p.useEffect)((()=>{var e;!c&&null!==(e=Object.keys(t||{}))&&void 0!==e&&e.length&&(d(t),u(!0))}),[t]);const k=async function(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i={...a},c={...a};return c[n]=e,td(l,t,r.FQ.isUpdating,h),d(c),o(n,e,t).then((e=>{const o=null===e||void 0===e?void 0:e.data;s((e=>(e[t]=o,e))),td(l,t,r.FQ.done,h)})).catch((()=>{td(l,t,null,h),d(i)})).finally((()=>{l&&setTimeout((()=>{td(!0,t,null,h)}),3e3)}))};return(0,v.jsx)(ze.Z,{className:"tool-ide-notes-card",children:(0,v.jsxs)(Be.Z,{direction:"vertical",className:"width-100",size:N?10:0,children:[(0,v.jsxs)(Pe.Z,{children:[(0,v.jsx)(Ze.Z,{span:18,children:(0,v.jsx)(Ya,{isEditing:y,setIsEditing:_,text:x,setText:f,promptId:null===a||void 0===a?void 0:a.prompt_id,defaultText:null===a||void 0===a?void 0:a.prompt_key,handleChange:k,placeHolder:l})}),(0,v.jsxs)(Ze.Z,{span:6,className:"display-flex-right",children:[(null===m||void 0===m?void 0:m.promptId)===(null===a||void 0===a?void 0:a.prompt_id)&&(0,v.jsxs)(v.Fragment,{children:[(null===m||void 0===m?void 0:m.status)===r.FQ.isUpdating&&(0,v.jsx)(Qn.Z,{icon:(0,v.jsx)(Ql.Z,{spin:!0}),color:"processing",className:"display-flex-align-center",children:"Updating"}),(null===m||void 0===m?void 0:m.status)===r.FQ.done&&(0,v.jsx)(Qn.Z,{icon:(0,v.jsx)(Sl.Z,{}),color:"success",className:"display-flex-align-center",children:"Done"})]}),(0,v.jsx)($a,{expandCard:N,setExpandCard:w}),(0,v.jsx)(bo.Z,{title:"Edit",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"display-flex-align-center",onClick:e=>{e.stopPropagation(),_(!0),b(!0)},children:(0,v.jsx)(wo.Z,{className:"prompt-card-actions-head"})})}),(0,v.jsx)(zo,{handleConfirm:()=>n(null===a||void 0===a?void 0:a.prompt_id),content:"The note will be permanently deleted.",children:(0,v.jsx)(bo.Z,{title:"Delete",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",children:(0,v.jsx)(Eo.Z,{className:"delete-icon"})})})})]})]}),(0,v.jsx)(_a.Z,{className:"prompt-card-collapse",ghost:!0,activeKey:N&&"1",children:(0,v.jsx)(_a.Z.Panel,{children:(0,v.jsx)(Ya,{isEditing:S,setIsEditing:b,text:g,setText:j,promptId:null===a||void 0===a?void 0:a.prompt_id,defaultText:null===a||void 0===a?void 0:a.prompt,handleChange:k,isTextarea:!0,placeHolder:l})},"1")})]})})}var nd=o(83844);let ld,id;try{ld=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}()),id=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}const sd="YET_TO_PROCESS",ad="SUCCESS",dd="FAIL",rd=[null,void 0,!1];function cd(e){let{open:t,setOpen:o,promptId:n,promptKey:l,profileManagerId:s,docOutputs:a=[]}=e;const[d,u]=(0,p.useState)([]),[m,h]=(0,p.useState)([]),[x,f]=(0,p.useState)([]),[g,j]=(0,p.useState)(!1),{details:y,listOfDocs:S,selectedDoc:b,isMultiPassExtractLoading:w,singlePassExtractMode:k,isSinglePassExtractLoading:E,isPublicSource:C,llmProfiles:O,defaultLlmProfile:D}=ee(),P=k?D:s,[Z,I]=(0,p.useState)(P),{sessionDetails:L}=N(),A=ie(),U=(0,c.s0)(),{id:F}=(0,c.UO)(),{setAlertDetails:M}=T(),R=_(),{tokenUsage:z}=ce();(0,p.useEffect)((()=>{t&&(K(Z),G())}),[t,Z,k,E]),(0,p.useEffect)((()=>{I(P)}),[s,k]),(0,p.useEffect)((()=>{B(d)}),[d,z]);const W=(e,t,o)=>{const n=q(e,t),l=H(e,t,o,n);n>-1?e[n]=l:e.push(l)},q=(e,t)=>e.findIndex((e=>(null===e||void 0===e?void 0:e.document_manager)===t)),H=(e,t,o,n)=>{var l,i;let s={};return n>-1&&(s={...e[n]}),s.document_manager=t,s.output=null===(l=a[o])||void 0===l?void 0:l.output,s.isLoading=(null===(i=a[o])||void 0===i?void 0:i.isLoading)||!1,s},G=()=>{let e="/api/v1/unstract/".concat(L.orgId,"/adapter/?adapter_type=LLM");C&&(e=id(F,"LLM")),A.get(e).then((e=>{const t=e.data;f((0,r.Wk)(O,t))}))},K=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;if(!e)return void h([]);let t="/api/v1/unstract/".concat(null===L||void 0===L?void 0:L.orgId,"/prompt-studio/prompt-output/?tool_id=").concat(null===y||void 0===y?void 0:y.tool_id,"&prompt_id=").concat(n,"&profile_manager=").concat(e,"&is_single_pass_extract=").concat(k);C&&(t=ld(F,n,k,null,e));const o={method:"GET",url:t,headers:{"X-CSRFToken":null===L||void 0===L?void 0:L.csrfToken}};j(!0),A(o).then((e=>{(e=>{u((t=>{const o=e||[...t];return Object.keys(a).forEach((e=>{const t=(0,r.oP)(e);W(o,t,e)})),o}))})((null===e||void 0===e?void 0:e.data)||[])})).catch((e=>{M(R(e,"Failed to loaded the prompt results"))})).finally((()=>{j(!1)}))},B=e=>{const t=[];(()=>{const e=[...S],t=e.findIndex((e=>(null===e||void 0===e?void 0:e.document_id)===(null===b||void 0===b?void 0:b.document_id)));if(-1!==t&&0!==t){const o=e.splice(t,1)[0];e.unshift(o)}return e})().forEach((o=>{var l,i;const d=e.find((e=>((null===e||void 0===e?void 0:e.document_manager)||(null===e||void 0===e?void 0:e.key)&&(0,r.oP)(null===e||void 0===e?void 0:e.key)||null)===(null===o||void 0===o?void 0:o.document_id))),c="".concat(n,"__").concat(null===o||void 0===o?void 0:o.document_id,"__").concat(Z||s);let u=dd,p=(0,r.fe)(null===d||void 0===d?void 0:d.output,!0);(null!==d&&void 0!==d&&d.output||0===(null===d||void 0===d?void 0:d.output))&&!rd.includes(null===d||void 0===d?void 0:d.output)&&(u=ad,p=(0,r.fe)(null===d||void 0===d?void 0:d.output,!0));const m=null===d||void 0===d||null===(l=d.token_usage)||void 0===l?void 0:l.total_tokens;void 0===(null===d||void 0===d?void 0:d.output)&&(u=sd,p="Yet to process");const h=null===(i=a.find((e=>(null===e||void 0===e?void 0:e.key)===c)))||void 0===i?void 0:i.isLoading,x={key:null===o||void 0===o?void 0:o.document_id,document:null===o||void 0===o?void 0:o.document_name,token_count:!k&&(m||"NA"),value:(0,v.jsx)(v.Fragment,{children:h?(0,v.jsx)(At,{align:"default"}):(0,v.jsxs)(Ee.default.Text,{children:[(0,v.jsxs)("span",{style:{marginRight:"8px"},children:[u===sd&&(0,v.jsx)(nd.Z,{style:{color:"#F0AD4E"}}),u===dd&&(0,v.jsx)(Hs.Z,{style:{color:"#FF4D4F"}}),u===ad&&(0,v.jsx)(Ge.Z,{style:{color:"#52C41A"}})]})," ",p]})})};t.push(x)})),h(t)},X=[{title:"Document Variants",dataIndex:"document",key:"document"},!k&&{title:"Token Count",dataIndex:"token_count",key:"token_count",width:200},{title:"Value",dataIndex:"value",key:"value",width:600}].filter(Boolean);return(0,v.jsx)($e.Z,{className:"pre-post-amble-modal",open:t,width:1e3,onCancel:()=>o(!1),footer:null,centered:!0,maskClosable:!1,children:(0,v.jsxs)("div",{className:"pre-post-amble-body output-doc-layout",children:[(0,v.jsx)("div",{children:(0,v.jsx)(Ee.default.Text,{className:"add-cus-tool-header",children:l})}),(0,v.jsx)("div",{className:"output-doc-gap"}),(0,v.jsxs)("div",{className:"lmm-profile-outputs",children:[(0,v.jsxs)(bl.Z,{defaultActiveKey:"0",onChange:e=>{var t;"0"===e?I(P):I(null===(t=x[e-1])||void 0===t?void 0:t.profile_id)},children:[(0,v.jsx)(Ra.Z,{tab:(0,v.jsx)("span",{children:"Default"})},"0"),null===x||void 0===x?void 0:x.map(((e,t)=>{var o;return(0,v.jsx)(Ra.Z,{tab:(0,v.jsx)("span",{children:(null===e||void 0===e?void 0:e.llm_model)||(null===e||void 0===e?void 0:e.profile_name)})},null===(o=t+1)||void 0===o?void 0:o.toString())}))]})," ",(0,v.jsx)(za,{profileId:Z,profiles:O})]}),(0,v.jsx)("div",{className:"display-flex-right",children:(0,v.jsx)(i.ZP,{size:"small",onClick:()=>U("outputAnalyzer"),disabled:w||E,children:"View in Output Analyzer"})}),(0,v.jsx)("div",{className:"output-doc-gap"}),(0,v.jsx)("div",{className:"output-doc-table",children:(0,v.jsx)(Vo.Z,{columns:X,dataSource:m,pagination:{pageSize:5},loading:{indicator:(0,v.jsx)("div",{children:(0,v.jsx)(At,{})}),spinning:g}})})]})})}var ud=o(29966),pd=o(77106),vd=o(89893),md=o(10711);let hd;try{hd=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/PromptRunBtnSps'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function xd(e){let{promptDetails:t,promptKey:o,setPromptKey:n,progressMsg:l,handleRun:s,handleChange:a,handleDelete:d,updateStatus:c,updatePlaceHolder:u,isCoverageLoading:m,isEditingTitle:h,setIsEditingTitle:x,expandCard:f,setExpandCard:g,spsLoading:j,handleSpsLoading:y,enforceType:_}=e;const{selectedDoc:S,singlePassExtractMode:b,isSinglePassExtractLoading:N,indexDocs:w,isPublicSource:k,isSimplePromptStudio:T,details:E}=ee(),[C,O]=(0,p.useState)([]),[D,P]=(0,p.useState)(null),[Z,I]=(0,p.useState)(!1),L=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;g(!0),s(e,null===t||void 0===t?void 0:t.prompt_id,null,o)},A=e=>{var o;const n=null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.checked;P(n),a(n,null===t||void 0===t?void 0:t.prompt_id,"active",!0,!0).catch((()=>{P(!n)}))},U=e=>{const o=e===Z?null:e;I(o),a(o,null===t||void 0===t?void 0:t.prompt_id,"required",!0,!0).catch((()=>{I((null===t||void 0===t?void 0:t.required)||null)}))};return(0,p.useEffect)((()=>{P(null===t||void 0===t?void 0:t.active),I(null===t||void 0===t?void 0:t.required)}),[t,E]),(0,p.useEffect)((()=>{const e=[{label:(0,v.jsx)(gt.Z,{checked:D,onChange:A,children:D?"Enabled":"Disabled"}),key:"enable"},{label:(0,v.jsxs)("div",{children:[-1===["json","table","record"].indexOf(_)&&(0,v.jsxs)(gt.Z,{checked:"all"===Z,onChange:()=>U("all"),children:["Value Required"," ",(0,v.jsx)(bo.Z,{title:"Marks this as a required field. Saving this record won't be allowed in Human Quality Review should this field be empty.",children:(0,v.jsx)(ud.Z,{})})]}),"json"===_&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(gt.Z,{checked:"all"===Z,onChange:()=>U("all"),children:"All JSON Values Required"}),(0,v.jsx)(bo.Z,{title:"When set, saving this record won't be allowed in Human Quality Review without all key/values filled in this JSON structure.",children:(0,v.jsx)(ud.Z,{})}),(0,v.jsx)(gt.Z,{checked:"any"===Z,onChange:()=>U("any"),className:"required-checkbox-padding",children:"Atleast 1 JSON Value Required"}),(0,v.jsx)(bo.Z,{title:"When set, saving this record won't be allowed in Human Quality Review without at least one value filled in this JSON structure.",children:(0,v.jsx)(ud.Z,{})})]})]}),key:"required"},{label:(0,v.jsxs)(zo,{handleConfirm:()=>d(null===t||void 0===t?void 0:t.prompt_id),content:"The prompt will be permanently deleted.",children:[(0,v.jsx)(Eo.Z,{})," Delete"]}),key:"delete",disabled:m||N||(null===w||void 0===w?void 0:w.includes(null===S||void 0===S?void 0:S.document_id))||k}];T&&e.splice(0,1),O(e)}),[D,Z,_]),(0,v.jsxs)(Pe.Z,{children:[(0,v.jsx)(Ze.Z,{span:12,children:(0,v.jsx)(Ya,{isEditing:h,setIsEditing:x,text:o,setText:n,promptId:null===t||void 0===t?void 0:t.prompt_id,defaultText:null===t||void 0===t?void 0:t.prompt_key,handleChange:a,placeHolder:u,isCoverageLoading:m})}),(0,v.jsxs)(Ze.Z,{span:12,className:"display-flex-right",children:[(0,v.jsx)("div",{children:(null===l||void 0===l?void 0:l.message)&&(0,v.jsx)(bo.Z,{title:(null===l||void 0===l?void 0:l.message)||"",children:(0,v.jsx)(Qn.Z,{icon:m&&(0,v.jsx)(pd.Z,{spin:!0}),color:"ERROR"===(null===l||void 0===l?void 0:l.level)?"error":"processing",className:"display-flex-align-center",children:(0,v.jsx)("div",{className:"tag-max-width ellipsis",children:null===l||void 0===l?void 0:l.message})})})}),(null===c||void 0===c?void 0:c.promptId)===(null===t||void 0===t?void 0:t.prompt_id)&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{children:(null===c||void 0===c?void 0:c.status)===r.FQ.isUpdating&&(0,v.jsx)(Qn.Z,{icon:(0,v.jsx)(Ql.Z,{spin:!0}),color:"processing",className:"display-flex-align-center",children:"Updating"})}),(0,v.jsx)("div",{children:(null===c||void 0===c?void 0:c.status)===r.FQ.done&&(0,v.jsx)(Qn.Z,{icon:(0,v.jsx)(Sl.Z,{}),color:"success",className:"display-flex-align-center",children:"Done"})}),(0,v.jsx)("div",{children:(null===c||void 0===c?void 0:c.status)===r.FQ.validationError&&(0,v.jsx)(Qn.Z,{icon:(0,v.jsx)(Sl.Z,{}),color:"error",className:"display-flex-align-center",children:"Invalid JSON Key"})})]}),!b&&!T&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(bo.Z,{title:"Run all LLMs for current document",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:()=>L(r.SS.RUN_ONE_PROMPT_ALL_LLMS_ONE_DOC,null===S||void 0===S?void 0:S.document_id),disabled:(null===c||void 0===c?void 0:c.promptId)===(null===t||void 0===t?void 0:t.prompt_id)&&(null===c||void 0===c?void 0:c.status)===(null===r.FQ||void 0===r.FQ?void 0:r.FQ.isUpdating)||m||(null===w||void 0===w?void 0:w.includes(null===S||void 0===S?void 0:S.document_id))||k||j[null===S||void 0===S?void 0:S.document_id],children:(0,v.jsx)(Si.Z,{className:"prompt-card-actions-head"})})}),(0,v.jsx)(bo.Z,{title:"Run all LLMs for all documents",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:()=>L(r.SS.RUN_ONE_PROMPT_ALL_LLMS_ALL_DOCS),disabled:(null===c||void 0===c?void 0:c.promptId)===(null===t||void 0===t?void 0:t.prompt_id)&&(null===c||void 0===c?void 0:c.status)===(null===r.FQ||void 0===r.FQ?void 0:r.FQ.isUpdating)||m||(null===w||void 0===w?void 0:w.includes(null===S||void 0===S?void 0:S.document_id))||k,children:(0,v.jsx)(vd.Z,{className:"prompt-card-actions-head"})})})]}),(0,v.jsx)($a,{expandCard:f,setExpandCard:g}),T&&hd&&(0,v.jsx)(hd,{spsLoading:j,handleSpsLoading:y,handleGetOutput:()=>{},promptDetails:t}),(0,v.jsx)(Xo.Z,{menu:{items:C},trigger:["click"],placement:"bottomLeft",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",children:(0,v.jsx)(md.Z,{className:"prompt-card-actions-head"})})})]})]})}var fd=o(77472),gd=o(54423);function jd(e){let{chunkData:t,setIsIndexOpen:o,isIndexOpen:n}=e;const[l,s]=(0,p.useState)(""),[a,d]=(0,p.useState)([]),[r,c]=(0,p.useState)(0),[u,m]=(0,p.useState)([]),h=(0,p.useRef)(null);(0,p.useEffect)((()=>{m(t||[])}),[t]);const x=(0,p.useCallback)(io()((e=>{if(!e)return void d([]);const t=[];null===u||void 0===u||u.forEach(((o,n)=>{(null===o||void 0===o?void 0:o.split("\\n")).forEach(((o,l)=>{const i=new RegExp("(".concat(e,")"),"gi");let s;for(;null!==(s=i.exec(o));){var a,d;t.push({chunkIndex:n,lineIndex:l,startIndex:null===(a=s)||void 0===a?void 0:a.index,matchLength:null===(d=s[0])||void 0===d?void 0:d.length})}}))})),d(t),c(0)}),300),[u]);(0,p.useEffect)((()=>{x(l)}),[l]),(0,p.useEffect)((()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})}),[r]);const f=(e,t,o)=>{if(!l)return e;const n=a.filter((e=>e.lineIndex===t&&e.chunkIndex===o));if(null===n||void 0===n||!n.length)return e;const i=[];let s=0;return n.forEach(((n,l)=>{s<n.startIndex&&i.push(e.substring(s,n.startIndex));const d=r===a.findIndex((e=>e.chunkIndex===o&&e.lineIndex===t&&e.startIndex===n.startIndex));i.push((0,v.jsx)("span",{className:"chunk-highlight ".concat(d?"active-chunk-highlight":""),ref:d?h:null,children:e.substring(n.startIndex,n.startIndex+n.matchLength)},(0,w.uniqueId)())),s=n.startIndex+n.matchLength})),s<e.length&&i.push(e.substring(s)),i};return(0,v.jsxs)($e.Z,{title:"Index Data",open:n,onCancel:()=>{o(!1),s(""),d([]),c(0)},className:"index-output-modal",centered:!0,footer:null,width:1e3,children:[(0,v.jsxs)("div",{className:"chunk-search-container",children:[(0,v.jsx)(_t.default,{placeholder:"Search...",value:l,onChange:e=>{s(e.target.value)},className:"chunk-search-input"}),(0,v.jsxs)("div",{className:"search-control-container",children:[(0,v.jsx)(i.ZP,{size:"small",onClick:()=>{c((e=>0===e?(null===a||void 0===a?void 0:a.length)-1:e-1))},disabled:0===a.length,children:(0,v.jsx)(fd.Z,{})}),(0,v.jsxs)("span",{className:"page-count-container",children:[a.length>0?r+1:0,"/"," ",a.length]}),(0,v.jsx)(i.ZP,{size:"small",onClick:()=>{c((e=>(e+1)%(null===a||void 0===a?void 0:a.length)))},disabled:0===a.length,children:(0,v.jsx)(gd.Z,{})})]})]}),(0,v.jsx)("div",{className:"index-output-tab",children:null===u||void 0===u?void 0:u.map(((e,t)=>{var o;return(0,v.jsxs)("div",{className:"chunk-container",children:[(0,v.jsxs)(Ee.default.Text,{strong:!0,children:["Chunk ",t+1]}),(0,v.jsx)(oa,{text:(0,v.jsx)(v.Fragment,{children:null===e||void 0===e||null===(o=e.split("\\n"))||void 0===o?void 0:o.map(((e,o)=>(0,v.jsxs)("div",{children:[f(e,o,t),(0,v.jsx)("br",{})]},(0,w.uniqueId)())))})})]},(0,w.uniqueId)())}))})]})}var yd=o(78222),_d=o(10187),Sd=o(83791),bd=o(60055),Nd=o(42468);function wd(e){var t;let{tokenUsageId:o,isLoading:n}=e;const[l,i]=(0,p.useState)({}),{tokenUsage:s}=ce();return(0,p.useEffect)((()=>{void 0!==s[o]?i(s[o]):i({})}),[s,o]),l&&null!==(t=Object.keys(l))&&void 0!==t&&t.length&&!n?(0,r.pw)(null===l||void 0===l?void 0:l.total_tokens):"NA"}function kd(e){let{isDisabled:t,copyToClipboard:o}=e;return(0,v.jsx)(bo.Z,{title:"Copy prompt output",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:o,disabled:t,children:(0,v.jsx)(Fo.Z,{className:"prompt-card-actions-head"})})})}wd.propTypes={tokenUsageId:y().string,isLoading:y().bool};var Td=o(99420);function Ed(e){let{output:t,profileId:o,docId:n,promptRunStatus:l,handleSelectHighlight:i,highlightData:s,promptDetails:a,confidenceData:d,isTable:c=!1,setOpenExpandModal:u=(()=>{})}=e;const[m,h]=(0,p.useState)(!1),[x,f]=(0,p.useState)(null),[g,j]=(0,p.useState)(null),{singlePassExtractMode:y,isSinglePassExtractLoading:_,details:S,selectedHighlight:b}=ee();if((0,p.useEffect)((()=>{if(y&&_)return void h(!0);const e=(0,r.ty)(n,o);if((null===l||void 0===l?void 0:l[e])===r.yc.RUNNING)return void h(!0);h(!1);const i=!c;f((0,r.fe)(t,i,null===S||void 0===S?void 0:S.enable_highlight))}),[l,_,null===S||void 0===S?void 0:S.enable_highlight,t,c]),m)return(0,v.jsx)(It.Z,{indicator:(0,v.jsx)(At,{size:"small"})});if(void 0===t)return(0,v.jsxs)(Ee.default.Text,{className:"prompt-not-ran",children:[(0,v.jsx)("span",{children:(0,v.jsx)(nd.Z,{className:"info-circle-colored"})})," ","Yet to run"]});const N=e=>"object"===typeof e&&null!==e&&!Array.isArray(e),w=function(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(d){const t=("string"===typeof e?e:JSON.stringify(e,null,4)).split("\n"),o=t.slice(0,25).join("\n");return(0,v.jsxs)("div",{children:[o,t.length>25&&(0,v.jsx)(Ee.default.Link,{className:"font-size-12",onClick:()=>{u(!0)},children:"...show more"})]})}return"object"!==typeof e||null!==S&&void 0!==S&&S.enable_highlight?"string"===typeof e?'"'.concat(e,'"'):"number"===typeof e||"boolean"===typeof e?e.toString():Array.isArray(e)?(0,v.jsxs)(v.Fragment,{children:["[",(0,v.jsx)("div",{style:{paddingLeft:"20px"},children:null===e||void 0===e?void 0:e.map(((o,i)=>(0,v.jsxs)("div",{children:[w(o,null===t||void 0===t?void 0:t[i],null===n||void 0===n?void 0:n[i],l+1,"".concat(s,"[").concat(i,"]"),d),i<e.length-1?",":""]},(0,r.DO)())))}),"]"]}):N(e)?(0,v.jsxs)(v.Fragment,{children:["{",(0,v.jsx)("div",{style:{paddingLeft:"20px"},children:Object.entries(e).map(((e,r,c)=>{let[u,p]=e;const m=!N(p)&&!Array.isArray(p),h=s?"".concat(s,".").concat(u):u,x=g===h;return(0,v.jsxs)("div",{children:[(0,v.jsx)(Be.Z,{wrap:!0,className:"json-key",children:u}),": ",(0,v.jsx)(Ee.default.Text,{className:"prompt-output-result json-value ".concat(m&&null!==t&&void 0!==t&&t[u]?"clickable":""," ").concat(x?"selected":""),onClick:()=>{m&&null!==t&&void 0!==t&&t[u]&&((e,t,n,l)=>{null!==e&&void 0!==e&&e[n]&&(i(e[n],null===a||void 0===a?void 0:a.prompt_id,o,null===t||void 0===t?void 0:t[n]),j(l))})(t,n,u,h)},children:w(p,null===t||void 0===t?void 0:t[u],null===n||void 0===n?void 0:n[u],l+1,h,d)}),r<c.length-1?",":""]},u)}))}),"}"]}):String(e):JSON.stringify(e,null,4)};return(0,v.jsx)(Ee.default.Paragraph,{className:"prompt-card-display-output font-size-12",children:x&&"object"===typeof x?w(x,s,d,0,"",c):(0,v.jsx)(Cd,{enableHighlight:null===S||void 0===S?void 0:S.enable_highlight,highlightData:s,promptId:null===a||void 0===a?void 0:a.prompt_id,profileId:o,confidenceData:d,selectedHighlight:b,parsedOutput:x,onSelectHighlight:i})})}const Cd=e=>{let{enableHighlight:t,highlightData:o,promptId:n,profileId:l,confidenceData:i,selectedHighlight:s,parsedOutput:a,onSelectHighlight:d}=e;return t?(0,v.jsx)(Ee.default.Text,{wrap:!0,onClick:()=>d(o,n,l,i),className:"prompt-output-result json-value ".concat(o?"clickable":""," ").concat((null===s||void 0===s?void 0:s.highlightedPrompt)===n?"selected":""),children:a}):(0,v.jsx)("div",{children:a})};let Od;try{Od=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-card/TableOutput'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Dd(e){let{open:t,setOpen:o,promptId:n,llmProfiles:l,enforceType:i,displayLlmProfile:s,promptOutputs:a,promptRunStatus:d,tableSettings:r}=e;const{singlePassExtractMode:c,selectedDoc:u}=ee(),{generatePromptOutputKey:p}=ve();return(0,v.jsx)($e.Z,{open:t,onCancel:()=>o(!1),centered:!0,maskClosable:!1,footer:null,width:1600,children:(0,v.jsxs)(tn,{children:[(0,v.jsx)(Ee.default.Text,{className:"prompt-output-pad prompt-output-title",strong:!0,children:"Prompt Results"}),(0,v.jsx)(Pe.Z,{style:{height:"85vh"},children:l.map(((e,t)=>{var o;const m=null===e||void 0===e?void 0:e.profile_id,h=null===u||void 0===u?void 0:u.document_id,x=p(n,h,m,c,!0),f=a[x];return(0,v.jsx)(Ze.Z,{className:"overflow-hidden height-100 prompt-output-pad ".concat(t<(null===l||void 0===l?void 0:l.length)-1&&"border-right-grey"),span:24/(null===l||void 0===l?void 0:l.length),children:(0,v.jsxs)("div",{className:"flex-dir-col",children:[(0,v.jsx)("div",{children:s&&(0,v.jsxs)("div",{className:"prompt-output-llm-bg",children:[(0,v.jsx)(so.Z,{src:null===e||void 0===e?void 0:e.icon,width:15,height:15,preview:!1,className:"prompt-card-llm-icon"}),(0,v.jsx)(Ee.default.Text,{className:"prompt-card-llm-title",children:null===e||void 0===e||null===(o=e.conf)||void 0===o?void 0:o.LLM})]})}),(0,v.jsx)("div",{className:"flex-1 overflow-y-auto pad-top-10",children:i===ed&&"rent_rolls"!==(null===r||void 0===r?void 0:r.document_type)&&Od?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(Od,{output:null===f||void 0===f?void 0:f.output,pagination:10})}):(0,v.jsx)(Ed,{output:null===f||void 0===f?void 0:f.output,profileId:m,docId:h,promptRunStatus:d})})]})},m)}))})]})})}function Pd(e){let{promptId:t,llmProfiles:o,enforceType:n,displayLlmProfile:l,promptOutputs:s,promptRunStatus:a,tableSettings:d,openExpandModal:r,setOpenExpandModal:c}=e;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(bo.Z,{title:"Expand",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:()=>c(!0),children:(0,v.jsx)(Td.Z,{className:"prompt-card-actions-head"})})}),(0,v.jsx)(Dd,{open:r,setOpen:c,promptId:t,llmProfiles:o,enforceType:n,tableSettings:d,displayLlmProfile:l,promptOutputs:s,promptRunStatus:a})]})}const Zd=(0,p.memo)((e=>{let{timer:t,isLoading:o}=e;return!t||o?"Time: 0s":"Time: ".concat(t,"s")}));Zd.displayName="PromptRunTimer",Zd.propTypes={timer:y().number,isLoading:y().bool};const Id=(0,p.memo)((e=>{let{tokenUsage:t,isLoading:o}=e;return!t||o?"Cost: NA":"Cost: $".concat((0,r.pw)((0,r.XB)(t)))}));let Ld,Ad,Ud;Id.displayName="PromptRunCost",Id.propTypes={tokenUsage:y().object,isLoading:y().bool};try{Ld=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-card/TableOutput'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{Ad=Object(function(){var e=new Error("Cannot find module '../../../plugins/challenge-modal/ChallengeModal'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Fd(e){let{promptDetails:t,handleRun:o,selectedLlmProfileId:n,handleSelectDefaultLLM:l,llmProfileDetails:s,setOpenIndexProfile:a,enabledProfiles:d,setEnabledProfiles:c,isNotSingleLlmProfile:u,setIsIndexOpen:m,enforceType:h,tableSettings:x,promptOutputs:f,promptRunStatus:g,isChallenge:j,handleSelectHighlight:y}=e;const[_,S]=(0,p.useState)(!1),{width:b}=function(){const[e,t]=(0,p.useState)({width:window.innerWidth,height:window.innerHeight});return(0,p.useEffect)((()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),N=.4*b,{selectedDoc:w,singlePassExtractMode:k,isSimplePromptStudio:E,isPublicSource:C,defaultLlmProfile:O,selectedHighlight:D,details:P}=ee(),{setAlertDetails:Z}=T(),{generatePromptOutputKey:I}=ve(),L=h===ed,A=!["table","record"].includes(h),U=e=>{var t;return(0,v.jsx)("div",{children:null===(t=Object.entries(e))||void 0===t?void 0:t.map((e=>{let[t,o]=e;return(0,v.jsxs)("div",{children:[(0,v.jsxs)("strong",{children:[t,":"]})," ",o]},t)}))})},F=(e,o)=>"rent_rolls"!==(null===x||void 0===x?void 0:x.document_type)?(0,v.jsx)(Ld,{output:null===o||void 0===o?void 0:o.output}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ed,{output:null===o||void 0===o?void 0:o.output,profileId:e,docId:null===w||void 0===w?void 0:w.document_id,promptRunStatus:g,handleSelectHighlight:y,highlightData:null===o||void 0===o?void 0:o.highlightData,confidenceData:null===o||void 0===o?void 0:o.confidenceData,promptDetails:t,isTable:!0,setOpenExpandModal:S}),(0,v.jsx)("div",{className:"prompt-profile-run",children:(0,v.jsx)(kd,{copyToClipboard:()=>M((0,r.fe)(null===o||void 0===o?void 0:o.output,!0))})})]}),M=e=>{e&&"undefined"!==e&&!L&&navigator.clipboard.writeText(e).then((()=>{Z({type:"success",content:"Prompt output copied successfully"})})).catch((()=>{Z({type:"error",content:"Failed to copy prompt output"})}))};if((k||E)&&(null!==t&&void 0!==t&&t.active||E)){var R,z,W,q,H;const e=null===t||void 0===t?void 0:t.prompt_id,o=null===w||void 0===w?void 0:w.document_id,n=I(e,o,O,k,!0),l=null===(R=f[n])||void 0===R?void 0:R.output;let i={};if(f&&Object.keys(f)){const t=I(e,o,O,k,!0);void 0!==f[t]&&(i=f[t])}return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ro.Z,{className:"prompt-card-divider"}),(0,v.jsxs)(Be.Z,{wrap:!0,className:"prompt-card-result prompt-card-div ".concat((null===P||void 0===P?void 0:P.enable_highlight)&&A&&(null===D||void 0===D?void 0:D.highlightedPrompt)===e&&(null===D||void 0===D?void 0:D.highlightedProfile)===O&&"highlighted-prompt-cell"),children:[(0,v.jsx)(Ed,{output:l,highlightData:null===(z=i)||void 0===z||null===(W=z.highlightData)||void 0===W?void 0:W[t.prompt_key],handleSelectHighlight:y,confidenceData:null===(q=i)||void 0===q||null===(H=q.confidenceData)||void 0===H?void 0:H[t.prompt_key]}),(0,v.jsxs)("div",{className:"prompt-profile-run",children:[(0,v.jsx)(kd,{isDisabled:L,copyToClipboard:()=>M((0,r.fe)(l,!0,null===t||void 0===t?void 0:t.enable_highlight))}),(0,v.jsx)(Pd,{promptId:null===t||void 0===t?void 0:t.prompt_id,llmProfiles:s,enforceType:h,tableSettings:x,displayLlmProfile:!1,promptOutputs:f,promptRunStatus:g,openExpandModal:_,setOpenExpandModal:S})]})]})]})}return(0,v.jsx)(Sd.M,{children:!k&&!E&&s.map(((e,p)=>{var b,T,E,O,Z,R,z,W,q,H;const G=null===t||void 0===t?void 0:t.prompt_id,K=null===w||void 0===w?void 0:w.document_id,B=null===e||void 0===e?void 0:e.profile_id,X=d.includes(B),V=G+"__"+K+"__"+B;let Y={};if(f&&Object.keys(f)){const e=I(G,K,B,k,!0);void 0!==f[e]&&(Y=f[e])}const Q=(null===g||void 0===g?void 0:g[(0,r.ty)(K,B)])===r.yc.RUNNING;return(0,v.jsx)(bd.E.div,{initial:{x:0},animate:{x:B===n&&0!==p?-10:0},transition:{duration:.5,ease:"linear"},className:"prompt-card-llm ".concat((null===P||void 0===P?void 0:P.enable_highlight)&&A&&(null===D||void 0===D?void 0:D.highlightedPrompt)===G&&(null===D||void 0===D?void 0:D.highlightedProfile)===B&&"highlighted-prompt-cell"),children:(0,v.jsxs)(Ze.Z,{className:"prompt-card-llm-container",xs:{span:N<1200?24:6},children:[(0,v.jsx)(Ro.Z,{className:"prompt-card-divider"}),(0,v.jsxs)(Be.Z,{direction:"vertical",className:"prompt-card-llm-layout",onClick:()=>{var e,t;"json"!==h&&y(null===(e=Y)||void 0===e?void 0:e.highlightData,G,B,null===(t=Y)||void 0===t?void 0:t.confidenceData)},children:[(0,v.jsxs)("div",{className:"llm-info",children:[(0,v.jsxs)("div",{className:"llm-info-left",children:[(0,v.jsx)(so.Z,{src:null===e||void 0===e?void 0:e.icon,width:15,height:15,preview:!1,className:"prompt-card-llm-icon"}),(0,v.jsx)(Ee.default.Text,{className:"prompt-card-llm-title",ellipsis:{tooltip:null===e||void 0===e||null===(b=e.conf)||void 0===b?void 0:b.LLM},children:null===e||void 0===e||null===(T=e.conf)||void 0===T?void 0:T.LLM})]}),(0,v.jsx)("div",{className:"llm-info-right",children:(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(bo.Z,{title:U(null===e||void 0===e?void 0:e.conf),children:(0,v.jsx)(ud.Z,{className:"prompt-card-actions-head"})}),(0,v.jsx)(bo.Z,{title:"Chunk used",children:(0,v.jsx)(yd.Z,{onClick:()=>{var e;m(!0),a(null===(e=Y)||void 0===e?void 0:e.context)},className:"prompt-card-actions-head"})}),Ad&&j&&(0,v.jsx)(Ad,{challengeData:(null===(E=Y)||void 0===E?void 0:E.challengeData)||{},context:(null===(O=Y)||void 0===O?void 0:O.context)||"",tokenUsage:(null===(Z=Y)||void 0===Z?void 0:Z.tokenUsage)||{}}),u&&(0,v.jsx)(bo.Z,{title:"Select Default",children:(0,v.jsx)(Mo.ZP,{checked:B===n,onChange:()=>l(B),disabled:C})})]})})]}),(0,v.jsxs)("div",{className:"prompt-cost",children:[(0,v.jsxs)(Ee.default.Text,{className:"prompt-cost-item",children:["Tokens:"," ",!k&&(0,v.jsx)(wd,{tokenUsageId:V,isLoading:Q})]}),(0,v.jsx)(Ee.default.Text,{className:"prompt-cost-item",children:(0,v.jsx)(Zd,{timer:null===(R=Y)||void 0===R?void 0:R.timer,isLoading:Q})}),(0,v.jsx)(Ee.default.Text,{className:"prompt-cost-item",children:(0,v.jsx)(Id,{tokenUsage:null===(z=Y)||void 0===z?void 0:z.tokenUsage,isLoading:Q})})]}),(0,v.jsxs)("div",{className:"prompt-info",children:[(0,v.jsx)("div",{children:(0,v.jsx)(Nd.Z,{checked:X,onChange:e=>((e,t)=>{c((o=>e?[...o,t]:o.filter((e=>e!==t))))})(e,B),disabled:C,className:X?"checked":"unchecked",children:X?(0,v.jsxs)("span",{children:["Enabled",(0,v.jsx)(Sl.Z,{className:"prompt-output-icon-enabled"})]}):(0,v.jsxs)("span",{children:["Disabled",(0,v.jsx)(_d.Z,{className:"prompt-output-icon-disabled"})]})})}),(0,v.jsxs)("div",{children:[(0,v.jsx)(bo.Z,{title:"Run LLM for current document",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:()=>o(r.SS.RUN_ONE_PROMPT_ONE_LLM_ONE_DOC,null===t||void 0===t?void 0:t.prompt_id,B,null===w||void 0===w?void 0:w.document_id),disabled:Q||C,children:(0,v.jsx)(Si.Z,{className:"prompt-card-actions-head"})})}),(0,v.jsx)(bo.Z,{title:"Run LLM for all documents",children:(0,v.jsx)(i.ZP,{size:"small",type:"text",className:"prompt-card-action-button",onClick:()=>o(r.SS.RUN_ONE_PROMPT_ONE_LLM_ALL_DOCS,null===t||void 0===t?void 0:t.prompt_id,B,null),disabled:Q||C,children:(0,v.jsx)(vd.Z,{className:"prompt-card-actions-head"})})}),(0,v.jsx)(Pd,{promptId:null===t||void 0===t?void 0:t.prompt_id,llmProfiles:s,enforceType:h,tableSettings:x,displayLlmProfile:!0,promptOutputs:f,promptRunStatus:g,openExpandModal:_,setOpenExpandModal:S})]})]})]}),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ro.Z,{className:"prompt-card-divider"}),(0,v.jsx)("div",{className:"prompt-card-result prompt-card-div",children:L&&Ld?F(B,Y):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ed,{output:null===(W=Y)||void 0===W?void 0:W.output,profileId:B,docId:null===w||void 0===w?void 0:w.document_id,promptRunStatus:g,handleSelectHighlight:y,highlightData:null===(q=Y)||void 0===q?void 0:q.highlightData,confidenceData:null===(H=Y)||void 0===H?void 0:H.confidenceData,promptDetails:t}),(0,v.jsx)("div",{className:"prompt-profile-run",children:(0,v.jsx)(kd,{isDisabled:L,copyToClipboard:()=>{var e;return M((0,r.fe)(null===(e=Y)||void 0===e?void 0:e.output,!0))}})})]})})]})]},B)},B)}))})}try{Ud=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-card/TableExtractionSettingsBtn'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Md(e){let{promptDetails:t,enforceTypeList:o,allTableSettings:n,setAllTableSettings:l,promptKey:s,setPromptKey:a,promptText:d,setPromptText:r,progressMsg:c,handleRun:u,handleChange:m,handleDelete:h,handleTypeChange:x,updateStatus:f,updatePlaceHolder:g,isCoverageLoading:j,setOpenOutputForDoc:y,selectedLlmProfileId:_,handleSelectDefaultLLM:S,spsLoading:b,handleSpsLoading:N,promptOutputs:w,promptRunStatus:k,coverageCountData:T,isChallenge:E,handleSelectHighlight:C}=e;const{llmProfiles:O,selectedDoc:D,listOfDocs:P,isSinglePassExtractLoading:Z,indexDocs:I,isSimplePromptStudio:L,isPublicSource:A,adapters:U,selectedHighlight:F,details:M,singlePassExtractMode:R}=ee(),[z,W]=(0,p.useState)(!1),[q,H]=(0,p.useState)(!1),[G,K]=(0,p.useState)(!0),[B,X]=(0,p.useState)([]),[V,Y]=(0,p.useState)(null),[Q,J]=(0,p.useState)(O.map((e=>e.profile_id))),[$,te]=(0,p.useState)(!1),oe=O.length>1,ne=(0,p.useRef)(null),[le,ie]=(0,p.useState)(""),[se,ae]=(0,p.useState)({}),de=null===t||void 0===t?void 0:t.prompt_id;(0,p.useEffect)((()=>{le!==(null===t||void 0===t?void 0:t.enforce_type)&&ie(null===t||void 0===t?void 0:t.enforce_type)}),[t]),(0,p.useEffect)((()=>{ae(n.find((e=>e.prompt_id===de))||{})}),[n]);const re=(e,t)=>{const o={conf:{}};return[{key:"llm",label:"LLM"},{key:"embedding_model",label:"Embedding Model"},{key:"vector_store",label:"Vector Store"},{key:"x2text",label:"Text Extractor"}].forEach((n=>{const l=e[n.key],i=null===t||void 0===t?void 0:t.find((e=>(null===e||void 0===e?void 0:e.adapter_name)===l));var s;i&&(o.conf[n.label]=(null===i||void 0===i?void 0:i.model)||(null===i||void 0===i||null===(s=i.adapter_id)||void 0===s?void 0:s.split("|")[0]),"LLM"===(null===i||void 0===i?void 0:i.adapter_type)&&(o.icon=null===i||void 0===i?void 0:i.icon),o.conf["Profile Name"]=null===e||void 0===e?void 0:e.profile_name)})),o},ce=((e,t,o)=>{let n=null;return Object.keys(o).forEach((l=>{const[i,,,s]=l.split("__");if(i===e&&s===String(t)){var a;const e=(null===(a=o[l])||void 0===a?void 0:a.coverage)||[];(!n||e.length>n.length)&&(n=e)}})),n})(de,R,w)||T;return(0,p.useEffect)((()=>{K(!0)}),[Z]),(0,p.useEffect)((()=>{(async e=>{if(L)return;const t=null===O||void 0===O?void 0:O.map((t=>({...re(t,e),...t})));X(t.map((e=>({...e,isDefault:(null===e||void 0===e?void 0:e.profile_id)===_,isEnabled:Q.includes(null===e||void 0===e?void 0:e.profile_id)}))).sort(((e,t)=>null!==e&&void 0!==e&&e.isDefault?-1:null!==t&&void 0!==t&&t.isDefault?1:null===e||void 0===e||!e.isEnabled||null!==t&&void 0!==t&&t.isEnabled?null!==e&&void 0!==e&&e.isEnabled||null===t||void 0===t||!t.isEnabled?0:1:-1)))})(U)}),[O,_,Q]),(0,v.jsxs)(ze.Z,{className:"prompt-card ".concat((null===M||void 0===M?void 0:M.enable_highlight)&&(null===F||void 0===F?void 0:F.highlightedPrompt)===(null===t||void 0===t?void 0:t.prompt_id)&&"highlighted-prompt"),children:[(0,v.jsx)("div",{className:"prompt-card-div prompt-card-bg-col1 prompt-card-rad",children:(0,v.jsx)(Be.Z,{direction:"vertical",className:"width-100",ref:ne,children:(0,v.jsx)(xd,{promptDetails:t,promptKey:s,setPromptKey:a,progressMsg:c,handleRun:u,handleChange:m,handleDelete:h,updateStatus:f,updatePlaceHolder:g,isCoverageLoading:j,isEditingTitle:q,setIsEditingTitle:H,expandCard:G,setExpandCard:K,enabledProfiles:Q,spsLoading:b,handleSpsLoading:N,enforceType:le})})}),(0,v.jsx)(_a.Z,{className:"prompt-card-collapse prompt-card-bg-col1",ghost:!0,activeKey:G&&"1",children:(0,v.jsxs)(_a.Z.Panel,{showArrow:!1,children:[(0,v.jsx)("div",{className:"prompt-card-div-body",children:(0,v.jsx)(Ya,{isEditing:z,setIsEditing:W,text:d,setText:r,promptId:null===t||void 0===t?void 0:t.prompt_id,defaultText:null===t||void 0===t?void 0:t.prompt,handleChange:m,isTextarea:!0,placeHolder:g,isCoverageLoading:j})}),(0,v.jsx)(v.Fragment,{children:!L&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ro.Z,{className:"prompt-card-divider"}),(0,v.jsx)(Be.Z,{direction:"vertical",className:"prompt-card-comp-layout",children:(0,v.jsxs)("div",{className:"prompt-card-llm-profiles",children:[(0,v.jsx)(Be.Z,{direction:"horizontal",children:(0,v.jsx)(i.ZP,{size:"small",type:"link",className:"display-flex-align-center prompt-card-action-button",onClick:()=>y(!0),children:(0,v.jsxs)(Be.Z,{children:[j?(0,v.jsx)(At,{size:"small"}):(0,v.jsx)(oo.Z,{className:"font-size-12"}),(0,v.jsxs)(Ee.default.Link,{className:"font-size-12",children:["Coverage: ",(null===ce||void 0===ce?void 0:ce.length)||0," of"," ",(null===P||void 0===P?void 0:P.length)||0," docs"]})]})})}),(0,v.jsx)(Be.Z,{children:(null===M||void 0===M?void 0:M.enable_highlight)&&["table","record"].includes(le)&&(0,v.jsxs)(Qn.Z,{color:"red",style:{whiteSpace:"normal",wordWrap:"break-word",minWidth:"200px"},children:["Highlighting is not supported when enforce type is"," ",le]})}),(0,v.jsxs)(Be.Z,{children:[le===ed&&Ud&&(0,v.jsx)(Ud,{promptId:null===t||void 0===t?void 0:t.prompt_id,enforceType:le,setAllTableSettings:l}),(0,v.jsx)(xt.default,{className:"prompt-card-select-type",size:"small",placeholder:"Enforce Type",optionFilterProp:"children",options:o,value:(null===t||void 0===t?void 0:t.enforce_type)||null,disabled:j||Z||I.includes(null===D||void 0===D?void 0:D.document_id)||A,onChange:e=>x(e)})]})]})})]})}),(0,v.jsx)(Pe.Z,{children:(0,v.jsx)(Fd,{promptDetails:t,handleRun:u,selectedLlmProfileId:_,handleSelectDefaultLLM:S,spsLoading:b,llmProfileDetails:B,setOpenIndexProfile:Y,enabledProfiles:Q,setEnabledProfiles:J,isNotSingleLlmProfile:oe,setIsIndexOpen:te,enforceType:le,tableSettings:se,promptOutputs:w,promptRunStatus:k,isChallenge:E,handleSelectHighlight:C})})]},"1")}),(0,v.jsx)(jd,{chunkData:V,isIndexOpen:$,setIsIndexOpen:te})]})}const Rd=(0,p.memo)((e=>{let{promptDetails:t,handleChangePromptCard:o,handleDelete:n,updatePlaceHolder:l,promptOutputs:i,enforceTypeList:s,allTableSettings:a,setAllTableSettings:d,setUpdatedPromptsCopy:c,handlePromptRunRequest:u,promptRunStatus:m,coverageCountData:h,isChallenge:x}=e;const[f,g]=(0,p.useState)({}),[j,y]=(0,p.useState)(!1),[_,S]=(0,p.useState)({promptId:null,status:null}),[b,N]=(0,p.useState)(""),[w,k]=(0,p.useState)(""),[E,C]=(0,p.useState)(null),[O,D]=(0,p.useState)(!1),[P,Z]=(0,p.useState)(!1),[I,L]=(0,p.useState)({}),[A,U]=(0,p.useState)({}),{llmProfiles:F,selectedDoc:M,details:R,summarizeIndexStatus:z,updateCustomTool:W,singlePassExtractMode:q}=ee(),{messages:H}=Fs(),{setAlertDetails:G}=T(),{setPostHogCustomEvent:K}=Xt();(0,p.useEffect)((()=>{var e;!j&&null!==(e=Object.keys(t||{}))&&void 0!==e&&e.length&&(g(t),y(!0))}),[t]),(0,p.useEffect)((()=>{const e=[...H].reverse().find((e=>{var t,o;return((null===e||void 0===e||null===(t=e.component)||void 0===t?void 0:t.prompt_id)===(null===f||void 0===f?void 0:f.prompt_id)||(null===e||void 0===e||null===(o=e.component)||void 0===o?void 0:o.prompt_key)===b)&&("INFO"===(null===e||void 0===e?void 0:e.level)||"ERROR"===(null===e||void 0===e?void 0:e.level))}));e&&L({message:(null===e||void 0===e?void 0:e.message)||"",level:(null===e||void 0===e?void 0:e.level)||"INFO"})}),[H]),(0,p.useEffect)((()=>{var e;C((null===f||void 0===f?void 0:f.profile_manager)||(null===(e=F[0])||void 0===e?void 0:e.profile_id))}),[f]),(0,p.useEffect)((()=>{const e=Object.keys(m).some((e=>m[e]===r.yc.RUNNING));D(e)}),[m]);const B=async function(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",s="";null!==n&&void 0!==n&&n.length?(i=n,s=e):(i=e.target.name,s=e.target.value);const a={...f},d={...f};return d[i]=s,td(l,t,r.FQ.isUpdating,S),g(d),o(i,s,t).then((e=>{const o=null===e||void 0===e?void 0:e.data;c((e=>(e[t]=o,e))),td(l,t,r.FQ.done,S)})).catch((()=>{td(l,t,null,S),g(a)})).finally((()=>{l&&setTimeout((()=>{td(!0,t,null,S)}),3e3)}))},X=(e,t)=>{Array.isArray(e)&&t.push(e)},V=(e,t)=>{"object"!==typeof e||Array.isArray(e)||Object.values(e).forEach((e=>((e,t)=>{Array.isArray(e)&&e.forEach((e=>X(e,t)))})(e,t)))},Y=e=>{if(!e||"object"!==typeof e)return e;const t=[];return Object.values(e).forEach((e=>{Array.isArray(e)&&e.forEach((e=>((e,t)=>{Array.isArray(e)?X(e,t):V(e,t)})(e,t)))})),t};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Md,{promptDetails:f,enforceTypeList:s,allTableSettings:a,promptKey:b,setAllTableSettings:d,setPromptKey:N,promptText:w,setPromptText:k,progressMsg:I,handleRun:(e,t,o,n)=>{try{K("ps_prompt_run",{info:"Click on 'Run Prompt' button (Multi Pass)"})}catch(vc){}if(M?b?!w&&(G({type:"error",content:"Prompt cannot be empty"}),1):(G({type:"error",content:"Prompt key cannot be empty"}),1):(G({type:"error",content:"Document not selected"}),1))return;const l=null===M||void 0===M?void 0:M.document_id;![...z].find((e=>(null===e||void 0===e?void 0:e.docId)===l&&!0===(null===e||void 0===e?void 0:e.isIndexed)))&&null!==R&&void 0!==R&&R.summarize_as_source&&null!==R&&void 0!==R&&R.summarize_llm_profile?G({type:"error",content:"Summary needs to be indexed before running the prompt - ".concat(null===M||void 0===M?void 0:M.document_name,".")}):u(e,t,o,n)},handleChange:B,handleTypeChange:e=>{B(e,null===f||void 0===f?void 0:f.prompt_id,"enforce_type",!0)},handleDelete:n,updateStatus:_,updatePlaceHolder:l,isCoverageLoading:O,setOpenOutputForDoc:Z,selectedLlmProfileId:E,handleSelectDefaultLLM:e=>{C(e),B(e,null===f||void 0===f?void 0:f.prompt_id,"profile_manager")},spsLoading:A,handleSpsLoading:(e,t)=>{U((o=>({...o,[e]:t})))},promptOutputs:i,promptRunStatus:m,coverageCountData:h,isChallenge:x,handleSelectHighlight:(e,t,o,n)=>{if(null!==R&&void 0!==R&&R.enable_highlight){const l=q&&"object"===typeof e&&!Array.isArray(e)?Y(e):e;W({selectedHighlight:{highlight:l,highlightedPrompt:t,highlightedProfile:o,confidence:n}})}}}),(0,v.jsx)(cd,{open:P,setOpen:Z,promptId:null===f||void 0===f?void 0:f.prompt_id,promptKey:null===f||void 0===f?void 0:f.prompt_key,profileManagerId:E})]})}));Rd.displayName="PromptCard";const zd=(0,p.memo)((function(e){let{item:t,handleChangePromptCard:o,handleDelete:n,outputs:l,enforceTypeList:i,allTableSettings:s,setAllTableSettings:a,setUpdatedPromptsCopy:d,coverageCountData:c,isChallenge:u}=e;const{isSimplePromptStudio:p}=ee(),{handlePromptRunRequest:m}=me(),h=oe((e=>{var o;return(null===e||void 0===e||null===(o=e.promptRunStatus)||void 0===o?void 0:o[null===t||void 0===t?void 0:t.prompt_id])||{}}));return(0,v.jsxs)("div",{children:[(t.prompt_type===r.A6.prompt||p)&&(0,v.jsx)(Rd,{promptDetails:t,handleChangePromptCard:o,handleDelete:n,updatePlaceHolder:"Enter Prompt",promptOutputs:l,enforceTypeList:i,allTableSettings:s,setAllTableSettings:a,setUpdatedPromptsCopy:d,handlePromptRunRequest:m,promptRunStatus:h,coverageCountData:c,isChallenge:u}),t.prompt_type===r.A6.notes&&(0,v.jsx)(od,{promptDetails:t,handleChangePromptCard:o,handleDelete:n,updatePlaceHolder:"Enter Notes",setUpdatedPromptsCopy:d})]})}));let Wd,qd,Hd;zd.displayName="PromptCardWrapper";try{Wd=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-card/prompt-card-service'");throw e.code="MODULE_NOT_FOUND",e}()),qd=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/helper'");throw e.code="MODULE_NOT_FOUND",e}()),Hd=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/SpsPromptsEmptyState'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function Gd(e){var t,o;let{addPromptInstance:n,scrollToBottom:l,setScrollToBottom:i}=e;const[s,a]=(0,p.useState)([]),[d,c]=(0,p.useState)({}),[u,m]=(0,p.useState)(!1),[h,x]=(0,p.useState)([]),f=(0,p.useRef)(null),{details:g,isSimplePromptStudio:j,updateCustomTool:y,getDropdownItems:S,isChallengeEnabled:b,isPublicSource:w}=ee(),{sessionDetails:k}=N(),{setAlertDetails:E}=T(),C=ie(),O=_(),{promptOutputs:D}=de();let P;Wd&&!w&&(P=Wd()),(0,p.useEffect)((()=>{var e;const t=S("output_type")||{},o=null===(e=Object.keys(t))||void 0===e?void 0:e.map((e=>({value:t[e]})));return a(o),m(b),P&&P.getAllTableSettings().then((e=>{const t=null===e||void 0===e?void 0:e.data;x(t||[])})).catch((e=>{E(O(e))})),()=>{var e,t;const o={...null===(e=ee.getState())||void 0===e?void 0:e.details},n=null===(t=[...(null===o||void 0===o?void 0:o.prompts)||[]])||void 0===t?void 0:t.map((e=>{const t=null===e||void 0===e?void 0:e.prompt_id;return t&&d[t]?d[t]:e}));o.prompts=n,y({details:o})}}),[]),(0,p.useEffect)((()=>{m(g.enable_challenge)}),[g.enable_challenge]),(0,p.useEffect)((()=>{var e;l&&(null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),i(!1))}),[l]);const Z=e=>"/api/v1/unstract/".concat(null===k||void 0===k?void 0:k.orgId,"/prompt-studio/prompt/").concat(e),I=async(e,t,o)=>{const n=(null===g||void 0===g?void 0:g.prompts)||[];if("prompt_key"===e&&!t)return;const l=n.findIndex((e=>(null===e||void 0===e?void 0:e.prompt_id)===o));if(-1===l)return void E({type:"error",content:"Prompt not found"});const i=n[l],s={["".concat(e)]:t};let a=Z((null===i||void 0===i?void 0:i.prompt_id)+"/");j&&(a=qd(null===i||void 0===i?void 0:i.prompt_id));const d={method:"PATCH",url:a,headers:{"X-CSRFToken":null===k||void 0===k?void 0:k.csrfToken,"Content-Type":"application/json"},data:s};return C(d).then((e=>e)).catch((e=>{E(O(e,"Failed to update"))}))},L=e=>{let t=Z(e+"/");j&&(t=qd(e));const o={method:"DELETE",url:t,headers:{"X-CSRFToken":null===k||void 0===k?void 0:k.csrfToken}};C(o).then((()=>{const t={...g},o=[...(null===t||void 0===t?void 0:t.prompts)||[]].filter((t=>(null===t||void 0===t?void 0:t.prompt_id)!==e));t.prompts=o,y({details:t}),E({type:"success",content:"Deleted successfully"})})).catch((e=>{E(O(e,"Failed to delete"))}))},A=e=>{const t=Object.keys(D||{});if(null===t||void 0===t||!t.length)return{};const o={};return t.forEach((t=>{t.startsWith(e)&&(o[t]=D[t])})),o};return null!==g&&void 0!==g&&null!==(t=g.prompts)&&void 0!==t&&t.length?(0,v.jsx)("div",{className:"doc-parser-layout",children:null===g||void 0===g||null===(o=g.prompts)||void 0===o?void 0:o.map((e=>(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{className:"doc-parser-pad-top"}),(0,v.jsx)(zd,{item:e,handleChangePromptCard:I,handleDelete:L,outputs:A(null===e||void 0===e?void 0:e.prompt_id),enforceTypeList:s,allTableSettings:h,setAllTableSettings:x,setUpdatedPromptsCopy:c,coverageCountData:null===e||void 0===e?void 0:e.coverage,isChallenge:u}),(0,v.jsx)("div",{ref:f,className:"doc-parser-pad-bottom"})]},e.prompt_id)))}):j&&Hd?(0,v.jsx)(Hd,{}):(0,v.jsx)(tt,{text:"Add prompt or a note and choose the LLM profile",btnText:"Add Prompt",handleClick:()=>n(r.A6.prompt)})}function Kd(e){let{children:t}=e;return(0,v.jsx)("div",{className:"tool-ide-main-footer-layout display-flex-right",children:t})}function Bd(e){let{activeKey:t,addPromptInstance:o}=e;const{isPublicSource:n}=ee();return"1"===t?(0,v.jsx)(Kd,{children:(0,v.jsxs)("div",{className:"tool-ide-main-footer",children:[(0,v.jsx)("div",{children:(0,v.jsx)(i.ZP,{type:"link",icon:(0,v.jsx)(et.Z,{}),onClick:()=>o(r.A6.notes),disabled:n,children:"Notes"})}),(0,v.jsx)("div",{children:(0,v.jsx)(i.ZP,{type:"link",icon:(0,v.jsx)(et.Z,{}),onClick:()=>o(r.A6.prompt),disabled:n,children:"Prompt"})})]})}):(0,v.jsx)(v.Fragment,{})}var Xd=o(78622);function Vd(){const{selectedDoc:e,isMultiPassExtractLoading:t,isPublicSource:o}=ee(),{handlePromptRunRequest:n}=me();return(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(bo.Z,{title:"Run all prompts for all LLMs and current document",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(Si.Z,{className:"prompt-card-actions-head"}),onClick:()=>n(r.SS.RUN_ALL_PROMPTS_ALL_LLMS_ONE_DOC,null,null,null===e||void 0===e?void 0:e.document_id),disabled:t||o})}),(0,v.jsx)(bo.Z,{title:"Run all prompts for all LLMs and documents",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(vd.Z,{className:"prompt-card-actions-head"}),onClick:()=>n(r.SS.RUN_ALL_PROMPTS_ALL_LLMS_ALL_DOCS,null,null,null),disabled:t||o})})]})}const Yd="prompt";function Qd(e){let{prompt:t,index:o,movePrompt:n,onDrop:l,cancelDrag:i}=e;const s=(0,p.useRef)(null),[{handlerId:a},d]=(0,ss.L)({accept:Yd,hover:(e,t)=>{if(!s.current)return;const l=e.index,i=o;l!==i&&(n(l,i),e.index=i)},drop:()=>({index:o}),collect:e=>({handlerId:e.getHandlerId()})}),[{isDragging:r},c]=(0,ds.c)({type:Yd,item:{id:t.prompt_key,index:o,originalIndex:o},end:(e,t)=>{if(!t.didDrop())return void i();const o=t.getDropResult();if(o){const{originalIndex:t}=e,n=o.index;l(t,n)}},collect:e=>({isDragging:e.isDragging()})});return c(d(s)),(0,v.jsx)(ze.Z,{ref:s,className:"draggable-prompt prompt-card-bg-col1 ".concat(r?"dragging":""),"data-handler-id":a,children:(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.prompt_key})})}const Jd=(0,p.memo)(Qd);function $d(e){let{isOpen:t,updateReorderedStatus:o}=e;const[n,l]=(0,p.useState)([]),i=(0,p.useRef)([]),{details:s}=ee(),{sessionDetails:a}=N(),d=ie(),{setAlertDetails:r}=T(),c=_();(0,p.useEffect)((()=>{if(!t)return void l([]);const e=(null===s||void 0===s?void 0:s.prompts)||[];l(null===e||void 0===e?void 0:e.map((e=>({prompt_key:e.prompt_key,prompt_id:e.prompt_id,sequence_number:e.sequence_number}))))}),[t,s]);const u=(0,p.useCallback)(((e,t)=>{var o;e!==t&&(null!==(o=i.current)&&void 0!==o&&o.length||(i.current=n),l((o=>{const n=[...o],[l]=n.splice(e,1);return n.splice(t,0,l),n})))}),[n]),m=(0,p.useCallback)((e=>{const t=(e||[]).reduce(((e,t)=>(e[t.id]=t.sequence_number,e)),{});l((e=>{const o=null===e||void 0===e?void 0:e.map((e=>{const o=t[e.prompt_id];return void 0!==o?{...e,sequence_number:o}:e}));return o.sort(((e,t)=>e.sequence_number-t.sequence_number)),o})),i.current=[]}),[]),h=(0,p.useCallback)((e=>{l(i.current),i.current=[],r(c(e,"Failed to reorder the prompts"))}),[c,r]),x=(0,p.useCallback)((async(e,t)=>{var n,l,s;if(e===t)return;o(!0);const r={start_sequence_number:null===(n=i.current[e])||void 0===n?void 0:n.sequence_number,end_sequence_number:null===(l=i.current[t])||void 0===l?void 0:l.sequence_number,prompt_id:null===(s=i.current[e])||void 0===s?void 0:s.prompt_id},c={method:"POST",url:"/api/v1/unstract/".concat(null===a||void 0===a?void 0:a.orgId,"/prompt-studio/prompt/reorder/"),headers:{"X-CSRFToken":null===a||void 0===a?void 0:a.csrfToken,"Content-Type":"application/json"},data:r};try{const e=await d(c);m(null===e||void 0===e?void 0:e.data)}catch(vc){h(vc)}}),[d,h,m,i,null===a||void 0===a?void 0:a.csrfToken,null===a||void 0===a?void 0:a.orgId,o]),f=(0,p.useCallback)((()=>{var e;null!==(e=i.current)&&void 0!==e&&e.length&&(l(i.current),i.current=[])}),[]),g=(0,p.useMemo)((()=>null===n||void 0===n?void 0:n.map(((e,t)=>(0,v.jsx)(Jd,{index:t,prompt:e,movePrompt:u,onDrop:x,cancelDrag:f},e.prompt_key)))),[n,u,x,f]);return(0,v.jsx)(Pi.W,{backend:Zi.PD,children:(0,v.jsx)(Be.Z,{direction:"vertical",className:"prompts-container",children:g})})}function er(e){let{open:t,setOpen:o,updateReorderedStatus:n}=e;return(0,v.jsx)($e.Z,{open:t,onCancel:()=>o(!1),title:"Reorder Prompts",footer:null,maskClosable:!1,centered:!0,children:(0,v.jsx)($d,{isOpen:t,updateReorderedStatus:n})})}let tr,or,nr,lr,ir,sr,ar,dr,rr;try{tr=Object(function(){var e=new Error("Cannot find module '../../../plugins/run-single-pass-btn/RunSinglePassBtn'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{or=Object(function(){var e=new Error("Cannot find module '../../../plugins/simple-prompt-studio/AddPromptBtn'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{nr=Object(function(){var e=new Error("Cannot find module '../../../plugins/challenge-modal/ChallengeModal'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function cr(){const[e,t]=(0,p.useState)(!1),[o,n]=(0,p.useState)(!1),l=(0,p.useRef)(!1),{id:s}=(0,c.UO)(),{isMultiPassExtractLoading:a,singlePassExtractMode:d,isSinglePassExtractLoading:r,isSimplePromptStudio:u,defaultLlmProfile:m,selectedDoc:h,updateCustomTool:x}=ee(),f=(0,c.s0)(),{setPostHogCustomEvent:g}=Xt(),{tokenUsage:j}=ce(),{sessionDetails:y}=N(),S=ie(),{setAlertDetails:b}=T(),w=_(),k=(0,p.useMemo)((()=>"single_pass__".concat(m,"__").concat(null===h||void 0===h?void 0:h.document_id)),[m,null===h||void 0===h?void 0:h.document_id]),E=(0,p.useCallback)((()=>{f("outputAnalyzer");try{g("ps_output_analyser_seen",{info:"Clicked on 'Output Analyzer' button"})}catch(vc){}}),[f,g]),C=(0,p.useCallback)((e=>{l.current=e}),[]),O=(0,p.useCallback)((()=>{const e={method:"GET",url:"/api/v1/unstract/".concat(null===y||void 0===y?void 0:y.orgId,"/prompt-studio/").concat(s)};n(!0),S(e).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||{};x({details:t})})).catch((e=>{b(w(e,"Failed to fetch prompt details"))})).finally((()=>{n(!1)}))}),[]);return(0,p.useEffect)((()=>{e||!0!==l.current||(O(),C(!1))}),[e]),u&&or?(0,v.jsx)(or,{}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(Be.Z,{children:[d&&tr&&(0,v.jsx)(tr,{}),d&&nr&&(0,v.jsx)(nr,{challengeData:null===j||void 0===j?void 0:j["".concat(k,"__challenge_data")],context:null===j||void 0===j?void 0:j["".concat(k,"__context")],tokenUsage:null===j||void 0===j?void 0:j[k]}),!d&&(0,v.jsx)(Vd,{}),(0,v.jsx)(bo.Z,{title:"Output Analyzer",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(Xd.Z,{}),onClick:E,disabled:a||r})}),(0,v.jsx)(bo.Z,{title:"Reorder the list of prompts",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(Fa.Z,{}),onClick:()=>t(!0),loading:o})})]}),(0,v.jsx)(er,{open:e,setOpen:t,updateReorderedStatus:C})]})}function ur(){const[e,t]=(0,p.useState)("1"),[o,n]=(0,p.useState)([]),[l,i]=(0,p.useState)(!1),{sessionDetails:s}=N(),{details:a,defaultLlmProfile:d,selectedDoc:c,updateCustomTool:u,isMultiPassExtractLoading:m,isSimplePromptStudio:h,singlePassExtractMode:x}=ee(),{setAlertDetails:f}=T(),g=ie(),j=_(),{setPostHogCustomEvent:y}=Xt(),{promptOutputApi:S,updatePromptOutputState:b}=ve(),w=[{key:"1",label:h?(0,v.jsx)(bo.Z,{title:"Fields",children:(0,v.jsx)(Fa.Z,{})}):"Document Parser"},{key:"2",label:h?(0,v.jsx)(bo.Z,{title:"Combined Output",children:(0,v.jsx)(Ma.Z,{})}):"Combined Output",disabled:0===(null===o||void 0===o?void 0:o.length)||m}];(0,p.useEffect)((()=>{S(null===a||void 0===a?void 0:a.tool_id,null===c||void 0===c?void 0:c.document_id,null,null,x).then((e=>{const t=(null===e||void 0===e?void 0:e.data)||[];b(t,!0)})).catch((e=>{f(j(e,"Failed to fetch prompt outputs"))}))}),[c,x]);const k=e=>{const t="".concat(null===a||void 0===a?void 0:a.tool_name,"_").concat(e);return-1===[...o].findIndex((e=>(null===e||void 0===e?void 0:e.prompt_key)===t))?t:k(e+1)},E={prompt_key:k((null===o||void 0===o?void 0:o.length)+1),prompt:"",tool_id:null===a||void 0===a?void 0:a.tool_id,prompt_type:r.A6.prompt,profile_manager:d,sequence_number:(0,r.jJ)(o)},C={prompt_key:k((null===o||void 0===o?void 0:o.length)+1),prompt:"",tool_id:null===a||void 0===a?void 0:a.tool_id,prompt_type:r.A6.notes,sequence_number:(0,r.jJ)(o)};(0,p.useEffect)((()=>{n((null===a||void 0===a?void 0:a.prompts)||[])}),[a]);const O=e=>{try{y("ps_prompt_added",{info:"Clicked on + ".concat(e," button")})}catch(vc){}let t={};t=e===r.A6.prompt?{...E}:{...C};const o={method:"POST",url:"/api/v1/unstract/".concat(null===s||void 0===s?void 0:s.orgId,"/prompt-studio/prompt-studio-prompt/").concat(null===a||void 0===a?void 0:a.tool_id,"/"),headers:{"X-CSRFToken":null===s||void 0===s?void 0:s.csrfToken,"Content-Type":"application/json"},data:t};g(o).then((e=>{const t=null===e||void 0===e?void 0:e.data,o={...a},n=(null===o||void 0===o?void 0:o.prompts)||[];n.push(t),o.prompts=n,u({details:o}),i(!0)})).catch((e=>{f(j(e,"Failed to add"))}))};return(0,v.jsxs)("div",{className:"tools-main-layout",children:[(0,v.jsxs)("div",{className:"doc-manager-header",children:[(0,v.jsx)("div",{className:"tools-main-tabs",children:(0,v.jsx)(bl.Z,{activeKey:e,items:w,onChange:e=>{t(e)},moreIcon:(0,v.jsx)(v.Fragment,{})})}),(0,v.jsx)("div",{className:"display-flex-align-center",children:(0,v.jsx)(cr,{})})]}),(0,v.jsxs)("div",{className:"tools-main-body",children:["1"===e&&(0,v.jsx)(Gd,{addPromptInstance:O,scrollToBottom:l,setScrollToBottom:i}),"2"===e&&(0,v.jsx)(Va,{docId:null===c||void 0===c?void 0:c.document_id})]}),!h&&(0,v.jsx)("div",{className:"tools-main-footer",children:(0,v.jsx)(Bd,{activeKey:e,addPromptInstance:O})})]})}try{lr=Object(function(){var e=new Error("Cannot find module '../../../plugins/onboarding-messages/OnboardMessagesModal.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),rr=Object(function(){var e=new Error("Cannot find module '../../../plugins/onboarding-messages/prompt-slides.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){lr=null,rr=[]}try{ir=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/public-share-modal/PromptShareModal.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),sr=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/public-link-modal/PromptShareLink.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),dr=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/header-public/HeaderPublic.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{ar=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-clone/clone-title-modal/CloneTitle.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}function pr(){const[e,t]=(0,p.useState)(!1),{details:o,updateCustomTool:n,isMultiPassExtractLoading:l,selectedDoc:i,indexDocs:s,pushIndexDoc:a,deleteIndexDoc:d,shareId:r,isPublicSource:c}=ee(),{sessionDetails:u}=N(),{promptOnboardingMessage:m}=u,{setAlertDetails:h}=T(),x=ie(),f=_(),[g,j]=(0,p.useState)(!0),{setPostHogCustomEvent:y}=Xt(),[S,b]=(0,p.useState)(!1),[w,k]=(0,p.useState)(!1),[E,C]=(0,p.useState)(!1),[O,D]=(0,p.useState)(!1);(0,p.useEffect)((()=>{E&&(r?(k(!1),b(!0)):(k(!0),b(!1)))}),[r,E]),(0,p.useEffect)((()=>{E||(k(!1),b(!1))}),[E]);const P=async e=>{const t={method:"PATCH",url:"/api/v1/unstract/".concat(null===u||void 0===u?void 0:u.orgId,"/prompt-studio/").concat(null===o||void 0===o?void 0:o.tool_id,"/"),headers:{"X-CSRFToken":null===u||void 0===u?void 0:u.csrfToken,"Content-Type":"application/json"},data:e};return x(t).then((e=>e)).catch((e=>{throw e}))};return(0,v.jsxs)("div",{className:"tool-ide-layout",children:[(0,v.jsx)(ws,{title:null===o||void 0===o?void 0:o.tool_name}),c&&dr&&(0,v.jsx)(dr,{}),(0,v.jsx)("div",{children:(0,v.jsx)(fa,{handleUpdateTool:P,setOpenSettings:t,setOpenShareModal:C,setOpenCloneModal:D})}),(0,v.jsx)("div",{className:c?"public-tool-ide-body":"tool-ide-body",children:(0,v.jsx)("div",{className:"tool-ide-body-2",children:(0,v.jsxs)(Pe.Z,{className:"tool-ide-main",children:[(0,v.jsx)(Ze.Z,{span:12,className:"tool-ide-col",children:(0,v.jsx)("div",{className:"tool-ide-prompts",children:(0,v.jsx)(ur,{})})}),(0,v.jsx)(Ze.Z,{span:12,className:"tool-ide-col",children:(0,v.jsx)("div",{className:"tool-ide-pdf",children:(0,v.jsx)(ra,{generateIndex:async e=>{const t=null===e||void 0===e?void 0:e.document_id;if(s.includes(t))return void h({type:"error",content:"This document is already getting indexed"});const n={document_id:t},l={method:"POST",url:"/api/v1/unstract/".concat(null===u||void 0===u?void 0:u.orgId,"/prompt-studio/index-document/").concat(null===o||void 0===o?void 0:o.tool_id),headers:{"X-CSRFToken":null===u||void 0===u?void 0:u.csrfToken,"Content-Type":"application/json"},data:n};return a(t),x(l).then((()=>{h({type:"success",content:"".concat(null===e||void 0===e?void 0:e.document_name," - Indexed successfully")});try{y("intent_success_ps_indexed_file",{info:"Indexing completed"})}catch(vc){}})).catch((t=>{h(f(t,"".concat(null===e||void 0===e?void 0:e.document_name," - Failed to index")))})).finally((()=>{d(t)}))},handleUpdateTool:P,handleDocChange:e=>{if(l)return void h({type:"error",content:"Please wait for the run to complete"});const t=i;if(n({selectedDoc:e}),c)return;const o={output:null===e||void 0===e?void 0:e.document_id};P(o).then((e=>{const t=null===e||void 0===e?void 0:e.data;n({details:t})})).catch((e=>{n({selectedDoc:t}),h(f(e,"Failed to select the document"))}))}})})})]})})}),(0,v.jsx)("div",{className:"height-50"}),(0,v.jsx)(Ua,{open:e,setOpen:t,handleUpdateTool:P}),ir&&(0,v.jsx)(ir,{open:w,setOpenShareModal:C,setOpenShareConfirmation:k}),sr&&(0,v.jsx)(sr,{open:S,setOpenShareModal:C,setOpenShareLink:b}),ar&&(0,v.jsx)(ar,{open:O,setOpenCloneModal:D}),!m&&lr&&!c&&(0,v.jsx)(lr,{open:g,setOpen:j,slides:rr})]})}function vr(){return(0,v.jsx)(pr,{})}var mr=o(17828),hr=o(82033);let xr;try{xr=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/header-public/HeaderPublic.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}const fr={PREV:"PREV",NEXT:"NEXT"};function gr(e){let{docs:t,currentDocIndex:o,setCurrentDocIndex:n,selectedPrompts:l,openFilterDrawer:s}=e;const{sessionDetails:a}=N(),{id:d}=(0,c.UO)(),r=(0,c.s0)(),{isPublicSource:u}=ee(),[m,h]=(0,p.useState)(!1),x=(null===t||void 0===t?void 0:t.length)||0,f=(0,p.useMemo)((()=>Object.values(l).filter(Boolean).length),[l]),g=(0,p.useMemo)((()=>t.map(((e,t)=>({key:t.toString(),label:null===e||void 0===e?void 0:e.document_name})))),[t]),j=(0,p.useCallback)((()=>{const e=u?"/promptStudio/share/".concat(d):"/".concat(null===a||void 0===a?void 0:a.orgName,"/tools/").concat(d);r(e)}),[]),y=(0,p.useCallback)((e=>{n((t=>{let o=0;return e===fr.PREV?o=-1:e===fr.NEXT&&(o=1),Math.max(0,Math.min(t+o,x-1))}))}),[]),_=(0,p.useCallback)((e=>{n(parseInt(e.key,10))}),[]);return(0,v.jsxs)("div",{children:[u&&xr&&(0,v.jsx)(xr,{}),(0,v.jsxs)("div",{className:"output-analyzer-header",children:[(0,v.jsx)("div",{children:(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(i.ZP,{size:"small",type:"text",onClick:j,children:(0,v.jsx)(go.Z,{})}),(0,v.jsx)(Ee.default.Text,{className:"font-size-16",strong:!0,children:"Output Analyzer"})]})}),(0,v.jsx)("div",{children:(0,v.jsxs)(Be.Z,{children:[(0,v.jsx)(i.ZP,{type:"text",icon:(0,v.jsx)(hr.Z,{}),onClick:s,children:"".concat(f," of ").concat(Object.keys(l).length," fields selected")}),(0,v.jsx)(i.ZP,{type:"primary",icon:(0,v.jsx)(zs.Z,{}),onClick:()=>h(!0)}),(0,v.jsxs)("div",{children:[(0,v.jsx)(i.ZP,{type:"text",icon:(0,v.jsx)(sn.Z,{}),onClick:()=>y(fr.PREV),disabled:0===o}),(0,v.jsx)(i.ZP,{type:"text",icon:(0,v.jsx)(ln.Z,{}),onClick:()=>y(fr.NEXT),disabled:o===x-1})]})]})})]}),(0,v.jsx)(mr.Z,{title:"Document List",open:m,onClose:()=>h(!1),children:(0,v.jsx)(Mi.Z,{selectedKeys:[o.toString()],items:g,onSelect:_})})]})}let jr;try{jr=Object(function(){var e=new Error("Cannot find module '../../../plugins/prompt-studio-public-share/helpers/PublicShareAPIs'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function yr(e){let{doc:t,selectedPrompts:o,totalFields:n}=e;const[l,i]=(0,p.useState)(""),[s,a]=(0,p.useState)(!1),[d,u]=(0,p.useState)(0),{details:m,isPublicSource:h}=ee(),{sessionDetails:x}=N(),{setAlertDetails:f}=T(),g=ie(),j=_(),{id:y}=(0,c.UO)(),S=(0,p.useMemo)((()=>{return t?h?null===(e=jr)||void 0===e?void 0:e(y,t.document_id,null):"/api/v1/unstract/".concat(null===x||void 0===x?void 0:x.orgId,"/prompt-studio/file/").concat(null===m||void 0===m?void 0:m.tool_id,"?document_id=").concat(null===t||void 0===t?void 0:t.document_id):null;var e}),[t]);(0,p.useEffect)((()=>{if(!S)return void i("");(async()=>{a(!0);try{var e,t;const o=await g.get(S),n=(null===o||void 0===o||null===(e=o.data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.data)||"",l=(0,r.q$)(n);i(URL.createObjectURL(l))}catch(vc){f(j(vc,"Failed to load the document"))}finally{a(!1)}})()}),[S]);const b=(0,p.useMemo)((()=>0===n?"0":(d/n*100).toFixed(2)),[d,n]);return(0,v.jsxs)("div",{className:"output-analyzer-body2",children:[(0,v.jsxs)("div",{className:"output-analyzer-card-head",children:[(0,v.jsx)(Be.Z,{children:(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.document_name})}),(0,v.jsxs)(yo.Z,{children:[(0,v.jsxs)("div",{children:[(0,v.jsxs)(Ee.default.Text,{children:["Total top-level fields: ",(0,v.jsx)("strong",{children:n})]}),(0,v.jsx)(Ro.Z,{type:"vertical"})]}),(0,v.jsxs)("div",{children:[(0,v.jsxs)(Ee.default.Text,{children:["Fill rate: ",(0,v.jsx)("strong",{children:"".concat(b,"%")})]}),(0,v.jsx)(Ro.Z,{type:"vertical"})]}),(0,v.jsxs)("div",{children:[(0,v.jsxs)(Ee.default.Text,{children:["Filled fields: ",(0,v.jsx)("strong",{children:d})]}),(0,v.jsx)(Ro.Z,{type:"vertical"})]}),(0,v.jsx)("div",{children:(0,v.jsxs)(Ee.default.Text,{children:["Unfilled fields: ",(0,v.jsx)("strong",{children:n-d})]})})]})]}),(0,v.jsx)("div",{className:"output-analyzer-main",children:(0,v.jsxs)(Pe.Z,{className:"height-100",children:[(0,v.jsx)(Ze.Z,{span:12,className:"height-100",children:(0,v.jsx)("div",{className:"output-analyzer-left-box",children:(0,v.jsx)(Va,{docId:null===t||void 0===t?void 0:t.document_id,selectedPrompts:o,setFilledFields:u})})}),(0,v.jsx)(Ze.Z,{span:12,className:"height-100",children:(0,v.jsx)("div",{className:"output-analyzer-right-box",children:(0,v.jsx)(qs,{doc:t,isLoading:s,isContentAvailable:Boolean(l),children:(0,v.jsx)(ta,{fileUrl:l})})})})]})})]})}const _r=p.memo((e=>{let{isOpen:t,selectedPrompts:o,setSelectedPrompts:n}=e;const[l,i]=(0,p.useState)(o),[s,a]=(0,p.useState)(!1),[d]=dt.Z.useForm();(0,p.useEffect)((()=>{!t&&s&&n(l)}),[t,s,n,l]);const r=(0,p.useCallback)(((e,t)=>{a(!0),i(t)}),[]);return(0,v.jsx)(dt.Z,{form:d,initialValues:l,onValuesChange:r,children:Object.keys(l).map((e=>(0,v.jsx)(dt.Z.Item,{name:e,valuePropName:"checked",children:(0,v.jsx)(gt.Z,{children:e})},e)))})}));function Sr(){const[e,t]=(0,p.useState)(-1),{listOfDocs:o,details:n,isPublicSource:l,selectedDoc:i}=ee(),[s,a]=(0,p.useState)({}),[d,c]=(0,p.useState)(!1);(0,p.useEffect)((()=>{const e=((null===n||void 0===n?void 0:n.prompts)||[]).filter((e=>(null===e||void 0===e?void 0:e.prompt_type)===r.A6.prompt)).reduce(((e,t)=>(e[null===t||void 0===t?void 0:t.prompt_key]=!0,e)),{});a(e);const l=o.findIndex((e=>(null===e||void 0===e?void 0:e.document_id)===(null===i||void 0===i?void 0:i.document_id)))||0;t(l)}),[]);const u=(0,p.useMemo)((()=>Object.values(s).filter(Boolean).length),[s]),m=(0,p.useCallback)((()=>{c(!0)}),[]),h=(0,p.useCallback)((()=>{c(!1)}),[]),x=(0,p.useMemo)((()=>-1===e?null:o[e]),[o,e]);return(0,v.jsxs)("div",{className:"output-analyzer-layout",children:[(0,v.jsx)("div",{children:(0,v.jsx)(gr,{docs:o,currentDocIndex:e,setCurrentDocIndex:t,selectedPrompts:s,openFilterDrawer:m})}),(0,v.jsx)("div",{className:l?"public-output-analyzer-body":"output-analyzer-body",children:(0,v.jsx)("div",{className:"height-100",children:(0,v.jsx)(yr,{doc:x,selectedPrompts:s,totalFields:u})},null===x||void 0===x?void 0:x.document_id)}),(0,v.jsx)(mr.Z,{title:"Filter Prompt Fields",open:d,onClose:h,children:(0,v.jsx)(_r,{isOpen:d,selectedPrompts:s,setSelectedPrompts:a})})]})}function br(){return(0,v.jsx)(Sr,{})}_r.displayName="FilterPromptFields";var Nr=o(69849);const wr=e=>{let{tableData:t,loading:o,pagination:n,setPagination:l,setOrdering:i,activeTab:s}=e;const a=(0,c.s0)(),{sessionDetails:d}=N(),u=[{title:"Executed At",dataIndex:"executedAt",key:"executedAt",showSorterTooltip:{target:"full-header"},sorter:!0,render:(e,t)=>(0,v.jsx)(bo.Z,{title:t.executedAtWithSeconds,children:t.executedAt})},{title:"Execution ID",dataIndex:"executionId",key:"executionId",render:e=>(0,v.jsx)(Ee.default.Link,{className:"title-name-redirect",onClick:()=>a("".concat(s,"/").concat(e)),children:e})},{title:"Execution Name",dataIndex:"pipelineName",key:"executionName",render:(e,t)=>"WF"===s?(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.workflowName}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ee.default.Text,{strong:!0,children:null===t||void 0===t?void 0:t.pipelineName}),(0,v.jsx)("br",{}),(0,v.jsxs)(Ee.default.Text,{type:"secondary",className:"p-or-d-typography",children:["from ",null===t||void 0===t?void 0:t.workflowName]})]})},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>(0,v.jsxs)("span",{children:[(0,v.jsx)(bo.Z,{title:"Successful files",children:(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(nd.Z,{className:"gen-index-success"})," ",null===t||void 0===t?void 0:t.successfulFiles]})}),(0,v.jsx)(bo.Z,{title:"Failed files",children:(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(Hs.Z,{className:"gen-index-fail"})," ",null===t||void 0===t?void 0:t.failedFiles]})}),(0,v.jsx)(bo.Z,{title:"Queued files",children:(null===t||void 0===t?void 0:t.totalFiles)-((null===t||void 0===t?void 0:t.successfulFiles)+(null===t||void 0===t?void 0:t.failedFiles))>0&&(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(Nr.Z,{className:"gen-index-progress"})," ",(null===t||void 0===t?void 0:t.totalFiles)-((null===t||void 0===t?void 0:t.successfulFiles)+(null===t||void 0===t?void 0:t.failedFiles))]})})]})},{title:"Files Processed",dataIndex:"filesProcessed",key:"filesProcessed",render:(e,t)=>"".concat(null===t||void 0===t?void 0:t.processed,"/").concat(null===t||void 0===t?void 0:t.totalFiles)},{title:"Execution Time",dataIndex:"executionTime",key:"executionTime",render:(e,t)=>(null===t||void 0===t?void 0:t.execution_time)||"-"}];return(0,v.jsx)(Vo.Z,{columns:u,dataSource:t,pagination:n,bordered:!0,size:"small",loading:o,onChange:(e,t,o)=>{if(l((t=>({...t,...e}))),o.order){const t="ascend"===o.order?"created_at":"-created_at";i(t),l((t=>({...t,...e,current:1})))}else i(null)},sortDirections:["ascend","descend","ascend"],scroll:{y:550},locale:{emptyText:(0,v.jsx)(tt,{text:"Currently you have no ".concat(r.Tv[s].addBtn),btnText:"Add ".concat(r.Tv[s].addBtn),handleClick:()=>a("/".concat(null===d||void 0===d?void 0:d.orgName,"/").concat(r.Tv[s].route))})}})};var kr=o(24215),Tr=o(9168);const Er=e=>{let{filtered:t}=e;return(0,v.jsx)(hr.Z,{style:{color:t?"#1677ff":void 0}})},Cr=e=>{let{setSelectedKeys:t,selectedKeys:o,confirm:n,handleClearFilter:l,filterOptions:s}=e;return(0,v.jsxs)("div",{style:{padding:8},children:[(0,v.jsx)(Mo.ZP.Group,{onChange:e=>{t(e.target.value?[e.target.value]:[]),n()},value:o[0]||null,children:(0,v.jsx)(Be.Z,{direction:"vertical",children:s.map((e=>(0,v.jsx)(Mo.ZP,{value:e,children:e},e)))})}),(0,v.jsx)("br",{}),(0,v.jsx)(i.ZP,{className:"clear-button",type:"primary",size:"small",onClick:()=>l(n),children:"Clear"})]})};function Or(e){let{executionId:t,fileId:o,logDescModalOpen:n,setLogDescModalOpen:l,filterParams:i}=e;const s=ie(),{setAlertDetails:a}=T(),d=_(),{getUrl:c}=Kl(),[u,m]=(0,p.useState)([]),[h,x]=(0,p.useState)(!1),[f,g]=(0,p.useState)(null),[j,y]=(0,p.useState)(null),[S,b]=(0,p.useState)({current:1,pageSize:10,total:0}),N=["INFO","WARN","DEBUG","ERROR"],w=[{title:"Event Time",dataIndex:"eventTime",key:"eventTime",sorter:!0,width:200,render:(e,t)=>(0,v.jsx)(bo.Z,{title:t.executedAtWithSeconds,children:t.eventTime})},{title:"Event Stage",dataIndex:"eventStage",key:"stage"},{title:"Log Level",dataIndex:"logLevel",key:"level",filterDropdown:e=>(0,v.jsx)(Cr,{...e,handleClearFilter:k,filterOptions:N}),filteredValue:f?[f]:[],filterIcon:e=>(0,v.jsx)(Er,{filtered:e}),render:e=>(0,v.jsx)("span",{className:null===e||void 0===e?void 0:e.toLowerCase(),children:e})},{title:"Log",dataIndex:"log",key:"log"}],k=e=>{g(null),e()};return(0,p.useEffect)((()=>{n&&(async(e,t,o)=>{try{var n,l;const i=c("/execution/".concat(e,"/logs/")),a=await s.get(i,{params:{page_size:S.pageSize,page:o,file_execution_id:t||"null",log_level:f,ordering:j}});b({current:o,pageSize:null===S||void 0===S?void 0:S.pageSize,total:null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.count});const d=null===a||void 0===a||null===(l=a.data)||void 0===l?void 0:l.results.map((e=>{var t,o,n;return{key:null===e||void 0===e?void 0:e.id,eventTime:(0,r.wc)(null===e||void 0===e?void 0:e.event_time),eventStage:null===(t=e.data)||void 0===t?void 0:t.stage,logLevel:null===(o=e.data)||void 0===o?void 0:o.level,log:null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.log,executedAtWithSeconds:(0,r.Mx)(null===e||void 0===e?void 0:e.created_at)}}));m(d)}catch(vc){a(d(vc))}finally{x(!1)}})(t,o,S.current)}),[n,S.current,f,j]),(0,v.jsx)($e.Z,{title:"Execution Log Details - ".concat(o||t),centered:!0,open:n,onCancel:()=>{l(!1),m([]),b({current:1,pageSize:10,total:0})},footer:null,width:"80%",wrapClassName:"modal-body",destroyOnClose:!0,children:(0,v.jsx)(Vo.Z,{columns:w,dataSource:u,rowKey:"id",align:"left",pagination:{...S},loading:h,onChange:(e,t,o)=>{if(b((t=>({...t,...e}))),o.order){const e=i.executionTime||"created_at",t="ascend"===o.order?e:"-".concat(e);y(t)}else y(null);g(t.level[0])},sortDirections:["ascend","descend","ascend"]})})}const Dr=()=>{const{id:e,type:t}=(0,c.UO)(),o=ie(),{sessionDetails:n}=N(),{setAlertDetails:l}=T(),s=_(),a=(0,c.s0)(),{getUrl:d}=Kl(),[u,m]=(0,p.useState)(),[h,x]=(0,p.useState)(),[f,g]=(0,p.useState)(),[j,y]=(0,p.useState)({current:1,pageSize:10,total:0}),[S,b]=(0,p.useState)(!1),[w,k]=(0,p.useState)(null),[E,C]=(0,p.useState)(null),[O,D]=(0,p.useState)({}),[P,Z]=(0,p.useState)(null),[I,L]=(0,p.useState)(""),[A,U]=(0,p.useState)(null),F=async e=>{try{const t=d("/execution/".concat(e,"/")),n=await o.get(t),l=null===n||void 0===n?void 0:n.data,i=(null===l||void 0===l?void 0:l.total_files)||0,s=((null===l||void 0===l?void 0:l.successful_files)||0)+((null===l||void 0===l?void 0:l.failed_files)||0),a=i>0?Math.round(s/i*100):0,c={executedAt:(0,r.wc)(null===l||void 0===l?void 0:l.created_at),executionId:null===l||void 0===l?void 0:l.id,progress:a,processed:s,total:i,status:null===l||void 0===l?void 0:l.status,executionName:null===l||void 0===l?void 0:l.workflow_name,ranFor:null===l||void 0===l?void 0:l.execution_time,executedAtWithSeconds:(0,r.Mx)(null===l||void 0===l?void 0:l.created_at),successfulFiles:null===l||void 0===l?void 0:l.successful_files,failedFiles:null===l||void 0===l?void 0:l.failed_files,totalFiles:null===l||void 0===l?void 0:l.total_files};m(c)}catch(vc){l(s(vc))}finally{g(!1)}},M=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var i;const l=d("/execution/".concat(e,"/files/")),s={...{page_size:j.pageSize,page:t,ordering:E,file_name:I.trim()||null},...n},a=new URLSearchParams;Object.entries(s).forEach((e=>{let[t,o]=e;null!==o&&void 0!==o&&a.append(t,o)})),P&&P.length>0&&P.forEach((e=>{a.append("status",e)}));const c=await o.get("".concat(l,"?").concat(a.toString()));y({current:t,pageSize:j.pageSize,total:null===c||void 0===c||null===(i=c.data)||void 0===i?void 0:i.count}),function(e){var t;const o=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.results.map(((e,t)=>({key:"".concat(t.toString(),"-").concat(null===e||void 0===e?void 0:e.id),fileName:null===e||void 0===e?void 0:e.file_name,statusMessage:(null===e||void 0===e?void 0:e.status_msg)||"Yet to be processed",fileSize:null===e||void 0===e?void 0:e.file_size,status:null===e||void 0===e?void 0:e.status,executedAt:(0,r.wc)(null===e||void 0===e?void 0:e.created_at),executionTime:null===e||void 0===e?void 0:e.execution_time,executionId:null===e||void 0===e?void 0:e.id,executedAtWithSeconds:(0,r.Mx)(null===e||void 0===e?void 0:e.created_at),filePath:null===e||void 0===e?void 0:e.file_path})));x(o)}(c)}catch(vc){l(s(vc))}finally{g(!1)}};(0,p.useEffect)((()=>()=>{A&&clearTimeout(A)}),[A]);const R=[{title:"Executed At",dataIndex:"executedAt",key:"executedAt",sorter:!0,render:(e,t)=>(0,v.jsx)(bo.Z,{title:t.executedAtWithSeconds,children:t.executedAt})},{title:"File Name",dataIndex:"fileName",key:"fileName",filterDropdown:()=>(0,v.jsx)("div",{className:"search-container",children:(0,v.jsx)(_t.default,{placeholder:"Search files",value:I,onChange:t=>(t=>{A&&clearTimeout(A),L(t);const o=setTimeout((()=>{const o={file_name:t.trim()||null};M(e,j.current,o)}),1e3);U(o)})(t.target.value),className:"search-input"})}),filterIcon:()=>(0,v.jsx)(oo.Z,{style:{color:I?"#1890ff":void 0}})},{title:"Status Message",dataIndex:"statusMessage",key:"statusMessage"},{title:"Status",dataIndex:"status",key:"status",filters:["COMPLETED","PENDING","ERROR","EXECUTING"].map((e=>({text:e,value:e}))),filterIcon:e=>(0,v.jsx)(Er,{filtered:e})},{title:"File Size",dataIndex:"fileSize",key:"fileSize"},{title:"Execution Time",dataIndex:"executionTime",key:"executionTime"},..."API"!==t?[{title:"File Path",dataIndex:"filePath",key:"filePath"}]:[],{title:"Action",dataIndex:"action",key:"action",render:(e,t)=>(0,v.jsx)(bo.Z,{title:"View logs",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(kr.Z,{}),onClick:()=>z(t)})})}],z=e=>{b(!0),k(e)};(0,p.useEffect)((()=>{F(e),M(e,j.current)}),[j.current,E,P]),(0,p.useEffect)((()=>{let t=null;return"EXECUTING"===(null===u||void 0===u?void 0:u.status)&&(t=setInterval((()=>{F(e),M(e,j.current)}),5e3)),()=>{t&&clearInterval(t)}}),[null===u||void 0===u?void 0:u.status,e,j.current]),(0,p.useEffect)((()=>{const e=R.reduce(((e,t)=>(e[t.key]=!0,e)),{});D(e)}),[]);const W=R.filter((e=>O[e.key])),q={items:R.map((e=>({key:e.key,label:(0,v.jsx)(gt.Z,{checked:O[e.key],onChange:()=>{return t=e.key,void D((e=>({...e,[t]:!e[t]})));var t},children:e.title})})))};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(Ee.default.Title,{className:"logs-title",level:4,children:[(0,v.jsx)(i.ZP,{type:"text",shape:"circle",icon:(0,v.jsx)(go.Z,{}),onClick:()=>a("/".concat(null===n||void 0===n?void 0:n.orgName,"/logs"))}),t," Session ID - ",e," "]}),(0,v.jsxs)(yo.Z,{align:"center",justify:"space-between",children:[(0,v.jsxs)(yo.Z,{className:"pad-12",children:[(0,v.jsx)(ze.Z,{className:"logs-details-card",children:(0,v.jsxs)(yo.Z,{justify:"flex-start",align:"center",children:[(0,v.jsx)(Tr.Z,{className:"logging-card-icons"}),(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default,{className:"logging-card-title",children:"Started"}),(0,v.jsx)(bo.Z,{title:null===u||void 0===u?void 0:u.executedAtWithSeconds,children:(0,v.jsx)(Ee.default,{children:null===u||void 0===u?void 0:u.executedAt})})]})]})}),(0,v.jsx)(ze.Z,{className:"logs-details-card",children:(0,v.jsxs)(yo.Z,{justify:"flex-start",align:"center",children:[(0,v.jsx)(oi.Z,{className:"logging-card-icons"}),(0,v.jsxs)("div",{children:[(0,v.jsx)(Ee.default,{className:"logging-card-title",children:"executing"===(null===u||void 0===u?void 0:u.status.toLowerCase())?"Running for":"Ran for"}),(0,v.jsx)(Ee.default,{children:null===u||void 0===u?void 0:u.ranFor})]})]})}),(0,v.jsx)(ze.Z,{className:"logs-details-card",children:(0,v.jsxs)(yo.Z,{justify:"flex-start",align:"center",children:[(0,v.jsx)(Ws.Z,{className:"logging-card-icons"}),(0,v.jsxs)("div",{children:[(0,v.jsxs)(Ee.default,{className:"logging-card-title",children:["executing"===(null===u||void 0===u?void 0:u.status.toLowerCase())?"Processing files":"Processed files"," ","-"," ",(0,v.jsx)(bo.Z,{title:"Total files",children:(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(Ws.Z,{className:"gen-index-progress"})," ",null===u||void 0===u?void 0:u.totalFiles]})})]}),(0,v.jsxs)("span",{children:[(0,v.jsx)(bo.Z,{title:"Successful files",children:(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(nd.Z,{className:"gen-index-success"})," ",null===u||void 0===u?void 0:u.successfulFiles]})}),(0,v.jsx)(bo.Z,{title:"Failed files",children:(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(Hs.Z,{className:"gen-index-fail"})," ",null===u||void 0===u?void 0:u.failedFiles]})}),(0,v.jsx)(bo.Z,{title:"In Progress files",children:(null===u||void 0===u?void 0:u.totalFiles)-((null===u||void 0===u?void 0:u.successfulFiles)+(null===u||void 0===u?void 0:u.failedFiles))>0&&(0,v.jsxs)("span",{className:"status-container",children:[(0,v.jsx)(Nr.Z,{className:"gen-index-progress"})," ",(null===u||void 0===u?void 0:u.totalFiles)-((null===u||void 0===u?void 0:u.successfulFiles)+(null===u||void 0===u?void 0:u.failedFiles))]})})]})]})]})})]}),(0,v.jsx)(i.ZP,{className:"view-log-button",type:"link",onClick:()=>z({}),children:"View Logs"})]}),(0,v.jsxs)("div",{className:"settings-layout",children:[(0,v.jsx)(Xo.Z,{menu:q,trigger:["click"],className:"column-filter-dropdown",children:(0,v.jsx)(i.ZP,{icon:(0,v.jsx)(Xn.Z,{}),children:"Show/Hide Columns"})}),(0,v.jsx)(Vo.Z,{dataSource:h,columns:W,pagination:{...j},loading:f,onChange:(e,t,o)=>{if(y((t=>({...t,...e}))),o.order){const e="ascend"===o.order?"created_at":"-created_at";C(e)}else C(null);null!==t&&void 0!==t&&t.status?Z(t.status):Z(null)},sortDirections:["ascend","descend","ascend"],scroll:{y:550}})]}),(0,v.jsx)(Or,{executionId:e,fileId:null===w||void 0===w?void 0:w.executionId,logDescModalOpen:S,setLogDescModalOpen:b,filterParams:{executionTime:"event_time"}})]})};function Pr(){const{RangePicker:e}=lt.default,[t,o]=(0,p.useState)("ETL"),{id:n}=(0,c.UO)(),l=ie(),{sessionDetails:i}=N(),{setAlertDetails:s}=T(),a=_(),d=(0,c.s0)(),{getUrl:u}=Kl(),[m,h]=(0,p.useState)([]),[x,f]=(0,p.useState)(!0),[g,j]=(0,p.useState)({current:1,pageSize:10,total:0}),[y,S]=(0,p.useState)([]),[b,w]=(0,p.useState)(null),[k,E]=(0,p.useState)(null),[C,O]=(0,p.useState)(new Set),D=location.pathname!=="/".concat(null===i||void 0===i?void 0:i.orgName,"/logs"),P=[{key:"ETL",label:"ETL Sessions",icon:(0,v.jsx)(Ie.v7,{className:"log-tab-icon ".concat("ETL"===t?"active":"")})},{key:"API",label:"API Sessions",icon:(0,v.jsx)(Ie.D6,{className:"log-tab-icon ".concat("API"===t?"active":"")})},{key:"WF",label:"Workflow Sessions",icon:(0,v.jsx)(Ie.To,{className:"log-tab-icon ".concat("WF"===t?"active":"")})},{key:"TASK",label:"Task Sessions",icon:(0,v.jsx)(Ie.iQ,{className:"log-tab-icon ".concat("TASK"===t?"active":"")})}],Z=e=>{d("/".concat(null===i||void 0===i?void 0:i.orgName,"/logs")),o(e)},I=e=>{var t,o;e&&2===e.length&&e[0]&&e[1]&&(S([null===(t=e[0])||void 0===t?void 0:t.toISOString(),null===(o=e[1])||void 0===o?void 0:o.toISOString()]),w(e))},L=async e=>{try{const t=u("/execution/".concat(e,"/")),o=await l.get(t),n=null===o||void 0===o?void 0:o.data;h((t=>{const o=[...t],l=o.findIndex((t=>t.key===e));if(-1!==l){const t=n.total_files||0,i=((null===n||void 0===n?void 0:n.successful_files)||0)+((null===n||void 0===n?void 0:n.failed_files)||0),s=t>0?Math.round(i/t*100):0;o[l]={...o[l],progress:s,processed:i,total:t,success:"COMPLETED"===(null===n||void 0===n?void 0:n.status),isError:"ERROR"===(null===n||void 0===n?void 0:n.status),status:null===n||void 0===n?void 0:n.status,successfulFiles:null===n||void 0===n?void 0:n.successful_files,failedFiles:null===n||void 0===n?void 0:n.failed_files,execution_time:null===n||void 0===n?void 0:n.execution_time},"executing"!==(null===n||void 0===n?void 0:n.status.toLowerCase())&&O((t=>{const o=new Set(t);return o.delete(e),o}))}return o})),"EXECUTING"===(null===n||void 0===n?void 0:n.status)&&setTimeout((()=>L(e)),5e3)}catch(vc){O((t=>{const o=new Set(t);return o.delete(e),o}))}},A=async e=>{try{var o,n;f(!0);const i=u("/execution/"),s=await l.get(i,{params:{execution_entity:t,page_size:g.pageSize,page:e,created_at_after:y[0]||null,created_at_before:y[1]||null,ordering:k}});j({current:e,pageSize:null===g||void 0===g?void 0:g.pageSize,total:null===s||void 0===s||null===(o=s.data)||void 0===o?void 0:o.count});const a=null===s||void 0===s||null===(n=s.data)||void 0===n?void 0:n.results.map((e=>{const t=e.total_files||0,o=((null===e||void 0===e?void 0:e.successful_files)||0)+((null===e||void 0===e?void 0:e.failed_files)||0),n=t>0?Math.round(o/t*100):0;return{key:null===e||void 0===e?void 0:e.id,executedAt:(0,r.wc)(null===e||void 0===e?void 0:e.created_at),executedAtWithSeconds:(0,r.Mx)(null===e||void 0===e?void 0:e.created_at),executionId:null===e||void 0===e?void 0:e.id,progress:n,processed:o,success:"COMPLETED"===(null===e||void 0===e?void 0:e.status),isError:"ERROR"===(null===e||void 0===e?void 0:e.status),workflowName:null===e||void 0===e?void 0:e.workflow_name,pipelineName:(null===e||void 0===e?void 0:e.pipeline_name)||"Pipeline name not found",successfulFiles:null===e||void 0===e?void 0:e.successful_files,failedFiles:null===e||void 0===e?void 0:e.failed_files,totalFiles:null===e||void 0===e?void 0:e.total_files,status:null===e||void 0===e?void 0:e.status,execution_time:null===e||void 0===e?void 0:e.execution_time}}));h(a),a.forEach((e=>{"EXECUTING"!==e.status||C.has(e.key)||(O((t=>{const o=new Set(t);return o.add(e.key),o})),L(e.key))}))}catch(vc){s(a(vc))}finally{f(!1)}};return(0,p.useEffect)((()=>{D||(h([]),A(g.current))}),[t,g.current,y,k,D]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(jo,{title:"Logs",CustomButtons:()=>(0,v.jsxs)(yo.Z,{gap:10,className:"log-controls",children:[(0,v.jsx)(bl.Z,{activeKey:t,items:P,onChange:Z,className:"log-tab"}),(0,v.jsx)(e,{showTime:{format:"YYYY-MM-DDTHH:mm:ssZ[Z]"},value:b,onChange:e=>{w(e),S(e?[e[0].toISOString(),e[1].toISOString()]:[])},onOk:I,className:"logs-date-picker",disabled:D,format:"YYYY-MM-DD HH:mm:ss"})]}),enableSearch:!1}),(0,v.jsx)("div",{className:"file-log-layout",children:n?(0,v.jsx)(Dr,{}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ee.default.Title,{className:"logs-title",level:4,children:"Execution Logs"}),(0,v.jsx)("div",{className:"settings-layout",children:(0,v.jsx)(wr,{tableData:m,loading:x,pagination:g,setPagination:j,setOrdering:E,activeTab:t})})]})})]})}function Zr(){return(0,v.jsx)(Pr,{})}let Ir,Lr,Ar,Ur,Fr,Mr,Rr,zr,Wr,qr,Hr,Gr,Kr,Br,Xr,Vr,Yr,Qr={};try{Ir=Object(function(){var e=new Error("Cannot find module '../plugins/frictionless-onboard/RequirePlatformAdmin.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Lr=Object(function(){var e=new Error("Cannot find module '../plugins/frictionless-onboard/platform-admin-page/PlatformAdminPage.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Ar=Object(function(){var e=new Error("Cannot find module '../plugins/app-deployment/AppDeployments.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Ur=Object(function(){var e=new Error("Cannot find module '../plugins/app-deployment/chat-app/ChatAppPage.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Fr=Object(function(){var e=new Error("Cannot find module '../plugins/app-deployment/chat-app/ChatAppLayout.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Mr=Object(function(){var e=new Error("Cannot find module '../plugins/manual-review/settings/Settings.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Rr=Object(function(){var e=new Error("Cannot find module '../plugins/onboard-product/OnboardProduct.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Qr=Object(function(){var e=new Error("Cannot find module '../plugins/llm-whisperer/helper.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{zr=Object(function(){var e=new Error("Cannot find module '../plugins/manual-review/page/ManualReviewPage.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),qr=Object(function(){var e=new Error("Cannot find module '../plugins/manual-review/review-layout/ReviewLayout.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Wr=Object(function(){var e=new Error("Cannot find module '../plugins/manual-review/page/simple/SimpleManualReviewPage.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Gr=Object(function(){var e=new Error("Cannot find module '../plugins/unstract-subscription/pages/UnstractSubscriptionPage.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Hr=Object(function(){var e=new Error("Cannot find module '../plugins/unstract-subscription/pages/UnstractUsagePage.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),Kr=Object(function(){var e=new Error("Cannot find module '../plugins/unstract-subscription/components/UnstractSubscriptionCheck.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{Br=Object(function(){var e=new Error("Cannot find module '../../../plugins/product-fruits/ProductFruitsManager'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}try{Xr=o(Object(function(){var e=new Error("Cannot find module '../../../plugins/store/select-product-store.js'");throw e.code="MODULE_NOT_FOUND",e}()))}catch{}const Jr=()=>{const{sessionDetails:e}=N(),{setPostHogIdentity:t}=Xt(),o=(0,c.TH)(),n=null===e||void 0===e?void 0:e.isLoggedIn,l=null===e||void 0===e?void 0:e.orgName,i=null===o||void 0===o?void 0:o.pathname,s=null===e||void 0===e?void 0:e.adapters;try{Vr="llm-whisperer"===Xr.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct))}catch(u){}try{Yr="verticals"===Xr.useSelectedProductStore((e=>null===e||void 0===e?void 0:e.selectedProduct))}catch(u){}const a=(0,r.Gn)(i,Vr||Yr);(0,p.useEffect)((()=>{null!==e&&void 0!==e&&e.isLoggedIn&&t()}),[e]);let d="/".concat(l,"/onboard");return Vr?d="/llm-whisperer/".concat(l,"/playground"):Yr?d="/verticals/":(0,r.IU)(s)&&(d="/".concat(l,"/").concat(r.DK)),"unstract_reviewer"!==e.role&&"unstract_supervisor"!==e.role||(d="/".concat(l,"/review")),n?a!==l?(0,v.jsx)(c.Fg,{to:d}):(0,v.jsxs)(v.Fragment,{children:[Br&&(0,v.jsx)(Br,{}),(0,v.jsx)(c.j3,{})]}):(0,v.jsx)(c.Fg,{to:"/landing",state:{from:o},replace:!0})};let $r,ec,tc,oc,nc,lc,ic,sc,ac,dc;try{ec=Object(function(){var e=new Error("Cannot find module '../plugins/simple-prompt-studio/SimplePromptStudioHelper.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),tc=Object(function(){var e=new Error("Cannot find module '../plugins/simple-prompt-studio/SimplePromptStudio.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),oc=Object(function(){var e=new Error("Cannot find module '../plugins/simple-prompt-studio/SpsLanding.jsx'");throw e.code="MODULE_NOT_FOUND",e}()),nc=Object(function(){var e=new Error("Cannot find module '../plugins/simple-prompt-studio/SpsUpload.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{$r=Object(function(){var e=new Error("Cannot find module '../plugins/prompt-studio-public-share/helpers/PublicPromptStudioHelper.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{ac=Object(function(){var e=new Error("Cannot find module '../plugins/routes/useLlmWhispererRoutes.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{dc=Object(function(){var e=new Error("Cannot find module '../plugins/routes/useVerticalsRoutes.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{ic=Object(function(){var e=new Error("Cannot find module '../plugins/select-product/SelectProduct.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{sc=Object(function(){var e=new Error("Cannot find module '../plugins/unstract-subscription/pages/UnstractSubscriptionEndPage.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}try{lc=Object(function(){var e=new Error("Cannot find module '../plugins/payment-successful/PaymentSuccessful.jsx'");throw e.code="MODULE_NOT_FOUND",e}())}catch(vc){}function rc(){const e=function(){var e;const t=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(c.AW,{path:":orgName",element:(0,v.jsx)(mo,{}),children:(0,v.jsx)(c.AW,{path:"onboard",element:(0,v.jsx)(vo,{})})}),Fr&&Ur&&(0,v.jsx)(c.AW,{path:":orgName",element:(0,v.jsx)(Fr,{}),children:(0,v.jsx)(c.AW,{path:"app/:id",element:(0,v.jsx)(Ur,{})})}),(0,v.jsxs)(c.AW,{path:":orgName",element:(0,v.jsx)(tl,{}),children:[Hr&&(0,v.jsx)(c.AW,{path:"dashboard",element:(0,v.jsx)(Hr,{})}),Gr&&(0,v.jsx)(c.AW,{element:(0,v.jsx)(Go,{}),children:(0,v.jsx)(c.AW,{path:"pricing",element:(0,v.jsx)(Gr,{})})}),(0,v.jsx)(c.AW,{path:"profile",element:(0,v.jsx)(nl,{})}),(0,v.jsx)(c.AW,{path:"api",element:(0,v.jsx)(di,{type:r.UN.api})}),(0,v.jsx)(c.AW,{path:"etl",element:(0,v.jsx)(di,{type:r.UN.etl})}),(0,v.jsx)(c.AW,{path:"task",element:(0,v.jsx)(di,{type:r.UN.task})}),Ar&&(0,v.jsx)(c.AW,{path:"app",element:(0,v.jsx)(Ar,{type:"app"})}),(0,v.jsx)(c.AW,{path:"workflows",element:(0,v.jsx)(xi,{})}),(0,v.jsx)(c.AW,{path:"workflows/:id",element:(0,v.jsx)(yi,{}),children:(0,v.jsx)(c.AW,{path:"",element:(0,v.jsx)(Ts,{})})}),(0,v.jsx)(c.AW,{path:"tools",element:(0,v.jsx)(Ls,{})}),(0,v.jsxs)(c.AW,{path:"",element:(0,v.jsx)(Rs,{}),children:[(0,v.jsx)(c.AW,{path:"tools/:id",element:(0,v.jsx)(vr,{})}),(0,v.jsx)(c.AW,{path:"tools/:id/outputAnalyzer",element:(0,v.jsx)(br,{})})]}),(0,v.jsx)(c.AW,{path:"logs",element:(0,v.jsx)(Zr,{})}),(0,v.jsx)(c.AW,{path:"logs/:type/:id/",element:(0,v.jsx)(Zr,{})}),(0,v.jsx)(c.AW,{path:"settings/llms",element:(0,v.jsx)(Lo,{type:"llm"})}),(0,v.jsx)(c.AW,{path:"settings/vectorDbs",element:(0,v.jsx)(Lo,{type:"vector_db"})}),(0,v.jsx)(c.AW,{path:"settings/embedding",element:(0,v.jsx)(Lo,{type:"embedding"})}),(0,v.jsx)(c.AW,{path:"settings/textExtractor",element:(0,v.jsx)(Lo,{type:"x2text"})}),(0,v.jsx)(c.AW,{path:"settings/ocr",element:(0,v.jsx)(Lo,{type:"ocr"})}),(0,v.jsx)(c.AW,{path:"settings",element:(0,v.jsx)(Uo,{})}),Mr&&(0,v.jsx)(c.AW,{path:"settings/review",element:(0,v.jsx)(Mr,{})}),(0,v.jsx)(c.AW,{path:"settings/platform",element:(0,v.jsx)(qo,{})}),(0,v.jsxs)(c.AW,{element:(0,v.jsx)(Go,{}),children:[(0,v.jsx)(c.AW,{path:"users",element:(0,v.jsx)(Jo,{})}),(0,v.jsx)(c.AW,{path:"users/invite",element:(0,v.jsx)(en,{})}),(0,v.jsx)(c.AW,{path:"users/edit",element:(0,v.jsx)(en,{})})]}),(0,v.jsx)(c.AW,{path:"settings/triad",element:(0,v.jsx)(nn,{})}),Ir&&Lr&&(0,v.jsx)(c.AW,{element:(0,v.jsx)(Ir,{}),children:(0,v.jsx)(c.AW,{path:"settings/admin",element:(0,v.jsx)(Lr,{})})})]}),qr&&zr&&(0,v.jsxs)(c.AW,{path:":orgName",element:(0,v.jsx)(qr,{}),children:[(0,v.jsx)(c.AW,{path:"review",element:(0,v.jsx)(zr,{type:"review"})}),(0,v.jsx)(c.AW,{path:"simple_review/review",element:(0,v.jsx)(Wr,{type:"simple_review"})}),(0,v.jsx)(c.AW,{path:"simple_review/approve",element:(0,v.jsx)(Wr,{type:"simple_approve"})}),(0,v.jsx)(c.AW,{path:"review/download_and_sync",element:(0,v.jsx)(zr,{type:"download"})}),(0,v.jsx)(c.AW,{path:"review/approve",element:(0,v.jsx)(zr,{type:"approve"})})]})]});var o;return Rr&&null!==(e=Object.keys(Qr))&&void 0!==e&&e.length?(0,v.jsx)(c.AW,{path:"",element:(0,v.jsx)(Rr,{type:null===(o=Qr)||void 0===o?void 0:o.unstract}),children:(0,v.jsx)(c.AW,{path:"",element:(0,v.jsx)(Kr,{}),children:t})}):t}();return(0,v.jsxs)(c.Z5,{children:[(0,v.jsx)(c.AW,{path:"error",element:(0,v.jsx)(m,{})}),(0,v.jsxs)(c.AW,{path:"",element:(0,v.jsx)(ke,{}),children:[(0,v.jsxs)(c.AW,{path:"",children:[(0,v.jsx)(c.AW,{path:"",element:(0,v.jsx)(Te,{}),children:(0,v.jsx)(c.AW,{path:"landing",element:(0,v.jsx)(Re,{})})}),ec&&tc&&oc&&nc&&(0,v.jsxs)(c.AW,{path:"simple-prompt-studio",element:(0,v.jsx)(ec,{}),children:[(0,v.jsx)(c.AW,{path:"",element:(0,v.jsx)(tc,{})}),(0,v.jsx)(c.AW,{path:"landing",element:(0,v.jsx)(oc,{})}),(0,v.jsx)(c.AW,{path:"upload",element:(0,v.jsx)(nc,{})})]}),$r&&(0,v.jsxs)(c.AW,{path:"/promptStudio/share/:id",element:(0,v.jsx)($r,{}),children:[(0,v.jsx)(c.AW,{path:"",element:(0,v.jsx)(vr,{})}),(0,v.jsx)(c.AW,{path:"/promptStudio/share/:id/outputAnalyzer",element:(0,v.jsx)(br,{})})]})]}),(0,v.jsx)(c.AW,{path:"setOrg",element:(0,v.jsx)(He,{})}),ic&&(0,v.jsx)(c.AW,{path:"selectProduct",element:(0,v.jsx)(ic,{})}),sc&&(0,v.jsx)(c.AW,{path:"/subscription-expired",element:(0,v.jsx)(sc,{})}),lc&&(0,v.jsx)(c.AW,{path:"/payment/success",element:(0,v.jsx)(lc,{})}),(0,v.jsxs)(c.AW,{path:"",element:(0,v.jsx)(Jr,{}),children:[e,ac&&(0,v.jsx)(c.AW,{path:"llm-whisperer",children:ac()})]})]}),(0,v.jsx)(c.AW,{path:"*",element:(0,v.jsx)(h,{})}),(0,v.jsx)(c.AW,{path:"oauth-status",element:(0,v.jsx)(De,{})}),dc&&dc()]})}const cc=()=>{const e=(0,c.TH)(),t=(0,ne.U0)();return(0,p.useEffect)((()=>{t&&t.capture("$pageview")}),[e,t]),null};let uc;try{uc=Object(function(){var e=new Error("Cannot find module './plugins/google-tag-manager-helper/GoogleTagManagerHelper.js'");throw e.code="MODULE_NOT_FOUND",e}())}catch{}function pc(){const[e,t]=n.ZP.useNotification(),{defaultAlgorithm:o,darkAlgorithm:c}=l.default,{sessionDetails:u}=N(),{alertDetails:m}=T(),{pushLogMessages:h}=M(),x=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(i.ZP,{type:"link",size:"small",onClick:()=>e.destroy(null===m||void 0===m?void 0:m.key),children:"Close"}),(0,v.jsx)(i.ZP,{type:"link",size:"small",onClick:()=>e.destroy(),children:"Close All"})]});return(0,p.useEffect)((()=>{null!==m&&void 0!==m&&m.content&&(e.open({message:null===m||void 0===m?void 0:m.title,description:(0,v.jsx)(pt,{text:null===m||void 0===m?void 0:m.content}),type:null===m||void 0===m?void 0:m.type,duration:null===m||void 0===m?void 0:m.duration,btn:x,key:null===m||void 0===m?void 0:m.key}),h([{timestamp:Math.floor(Date.now()/1e3),level:null!==m&&void 0!==m&&m.type?null===m||void 0===m?void 0:m.type.toUpperCase():"",message:m.content,type:"NOTIFICATION"}]))}),[m]),(0,v.jsx)(s.ZP,{direction:window.direction||"ltr",theme:{algorithm:u.currentTheme===r.C6.DARK?c:o,components:{Button:{colorPrimary:"#092C4C",colorPrimaryHover:"#0e4274",colorPrimaryActive:"#092C4C"}}},children:(0,v.jsx)(d.B6,{children:(0,v.jsxs)(a.VK,{children:[(0,v.jsx)(cc,{}),(0,v.jsx)(ws,{title:"Unstract"}),uc&&(0,v.jsx)(uc,{}),t,(0,v.jsx)(rc,{})]})})})}},24320:(e,t,o)=>{"use strict";o.r(t),o.d(t,{fetchExecutionLogs:()=>n});const n=function(e,t,o,n,l,i,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:10;e({method:"GET",url:"/api/v1/unstract/".concat(null===o||void 0===o?void 0:o.orgId,"/pipeline/").concat(n.id,"/executions/"),headers:{"X-CSRFToken":null===o||void 0===o?void 0:o.csrfToken},params:{page:a,page_size:d}}).then((e=>{var t,o;const n=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(o=t.results)||void 0===o?void 0:o.map((e=>({created_at:e.created_at,execution_id:e.id,status:e.status,execution_time:e.execution_time})));l(n),i(e.data.count)})).catch((e=>{s(t(e))}))}},93414:()=>{},70172:()=>{},2001:()=>{},33779:()=>{},66558:()=>{},82258:()=>{}}]);
//# sourceMappingURL=452.2f50eea2.chunk.js.map